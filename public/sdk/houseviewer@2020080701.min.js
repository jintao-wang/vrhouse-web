// Copyright © 2017-2020 123看房 上海亦我信息技术有限公司. All rights reserved.
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).HouseViewer={})}(this,(function(t){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function r(t,e){return t(e={exports:{}},e.exports),e.exports}var o=function(t){return t&&t.Math==Math&&t},i=o("object"==typeof globalThis&&globalThis)||o("object"==typeof window&&window)||o("object"==typeof self&&self)||o("object"==typeof e&&e)||Function("return this")(),a=function(t){try{return!!t()}catch(t){return!0}},s=!a((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),l={}.propertyIsEnumerable,u=Object.getOwnPropertyDescriptor,c={f:u&&!l.call({1:2},1)?function(t){var e=u(this,t);return!!e&&e.enumerable}:l},h=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},p={}.toString,d=function(t){return p.call(t).slice(8,-1)},f="".split,m=a((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==d(t)?f.call(t,""):Object(t)}:Object,g=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t},v=function(t){return m(g(t))},y=function(t){return"object"==typeof t?null!==t:"function"==typeof t},w=function(t,e){if(!y(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!y(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!y(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!y(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")},b={}.hasOwnProperty,S=function(t,e){return b.call(t,e)},E=i.document,P=y(E)&&y(E.createElement),x=function(t){return P?E.createElement(t):{}},T=!s&&!a((function(){return 7!=Object.defineProperty(x("div"),"a",{get:function(){return 7}}).a})),C=Object.getOwnPropertyDescriptor,I={f:s?C:function(t,e){if(t=v(t),e=w(e,!0),T)try{return C(t,e)}catch(t){}if(S(t,e))return h(!c.f.call(t,e),t[e])}},D=function(t){if(!y(t))throw TypeError(String(t)+" is not an object");return t},k=Object.defineProperty,M={f:s?k:function(t,e,n){if(D(t),e=w(e,!0),D(n),T)try{return k(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},R=s?function(t,e,n){return M.f(t,e,h(1,n))}:function(t,e,n){return t[e]=n,t},A=function(t,e){try{R(i,t,e)}catch(n){i[t]=e}return e},H=i["__core-js_shared__"]||A("__core-js_shared__",{}),O=Function.toString;"function"!=typeof H.inspectSource&&(H.inspectSource=function(t){return O.call(t)});var L,B,F,N=H.inspectSource,j=i.WeakMap,V="function"==typeof j&&/native code/.test(N(j)),z=r((function(t){(t.exports=function(t,e){return H[t]||(H[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.6.5",mode:"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})})),W=0,G=Math.random(),U=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++W+G).toString(36)},Y=z("keys"),X=function(t){return Y[t]||(Y[t]=U(t))},Z={},q=i.WeakMap;if(V){var J=new q,K=J.get,Q=J.has,tt=J.set;L=function(t,e){return tt.call(J,t,e),e},B=function(t){return K.call(J,t)||{}},F=function(t){return Q.call(J,t)}}else{var et=X("state");Z[et]=!0,L=function(t,e){return R(t,et,e),e},B=function(t){return S(t,et)?t[et]:{}},F=function(t){return S(t,et)}}var nt,rt={set:L,get:B,has:F,enforce:function(t){return F(t)?B(t):L(t,{})},getterFor:function(t){return function(e){var n;if(!y(e)||(n=B(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return n}}},ot=r((function(t){var e=rt.get,n=rt.enforce,r=String(String).split("String");(t.exports=function(t,e,o,a){var s=!!a&&!!a.unsafe,l=!!a&&!!a.enumerable,u=!!a&&!!a.noTargetGet;"function"==typeof o&&("string"!=typeof e||S(o,"name")||R(o,"name",e),n(o).source=r.join("string"==typeof e?e:"")),t!==i?(s?!u&&t[e]&&(l=!0):delete t[e],l?t[e]=o:R(t,e,o)):l?t[e]=o:A(e,o)})(Function.prototype,"toString",(function(){return"function"==typeof this&&e(this).source||N(this)}))})),it=i,at=function(t){return"function"==typeof t?t:void 0},st=function(t,e){return arguments.length<2?at(it[t])||at(i[t]):it[t]&&it[t][e]||i[t]&&i[t][e]},lt=Math.ceil,ut=Math.floor,ct=function(t){return isNaN(t=+t)?0:(t>0?ut:lt)(t)},ht=Math.min,pt=function(t){return t>0?ht(ct(t),9007199254740991):0},dt=Math.max,ft=Math.min,mt=function(t,e){var n=ct(t);return n<0?dt(n+e,0):ft(n,e)},gt=function(t){return function(e,n,r){var o,i=v(e),a=pt(i.length),s=mt(r,a);if(t&&n!=n){for(;a>s;)if((o=i[s++])!=o)return!0}else for(;a>s;s++)if((t||s in i)&&i[s]===n)return t||s||0;return!t&&-1}},vt={includes:gt(!0),indexOf:gt(!1)},yt=vt.indexOf,wt=function(t,e){var n,r=v(t),o=0,i=[];for(n in r)!S(Z,n)&&S(r,n)&&i.push(n);for(;e.length>o;)S(r,n=e[o++])&&(~yt(i,n)||i.push(n));return i},bt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],St=bt.concat("length","prototype"),Et={f:Object.getOwnPropertyNames||function(t){return wt(t,St)}},Pt={f:Object.getOwnPropertySymbols},xt=st("Reflect","ownKeys")||function(t){var e=Et.f(D(t)),n=Pt.f;return n?e.concat(n(t)):e},_t=function(t,e){for(var n=xt(e),r=M.f,o=I.f,i=0;i<n.length;i++){var a=n[i];S(t,a)||r(t,a,o(e,a))}},Tt=/#|\.prototype\./,Ct=function(t,e){var n=Dt[It(t)];return n==Mt||n!=kt&&("function"==typeof e?a(e):!!e)},It=Ct.normalize=function(t){return String(t).replace(Tt,".").toLowerCase()},Dt=Ct.data={},kt=Ct.NATIVE="N",Mt=Ct.POLYFILL="P",Rt=Ct,At=I.f,Ht=function(t,e){var n,r,o,a,s,l=t.target,u=t.global,c=t.stat;if(n=u?i:c?i[l]||A(l,{}):(i[l]||{}).prototype)for(r in e){if(a=e[r],o=t.noTargetGet?(s=At(n,r))&&s.value:n[r],!Rt(u?r:l+(c?".":"#")+r,t.forced)&&void 0!==o){if(typeof a==typeof o)continue;_t(a,o)}(t.sham||o&&o.sham)&&R(a,"sham",!0),ot(n,r,a,t)}},Ot=!!Object.getOwnPropertySymbols&&!a((function(){return!String(Symbol())})),Lt=Ot&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Bt=Array.isArray||function(t){return"Array"==d(t)},Ft=function(t){return Object(g(t))},Nt=Object.keys||function(t){return wt(t,bt)},jt=s?Object.defineProperties:function(t,e){D(t);for(var n,r=Nt(e),o=r.length,i=0;o>i;)M.f(t,n=r[i++],e[n]);return t},Vt=st("document","documentElement"),zt=X("IE_PROTO"),Wt=function(){},Gt=function(t){return"<script>"+t+"<\/script>"},Ut=function(){try{nt=document.domain&&new ActiveXObject("htmlfile")}catch(t){}var t,e;Ut=nt?function(t){t.write(Gt("")),t.close();var e=t.parentWindow.Object;return t=null,e}(nt):((e=x("iframe")).style.display="none",Vt.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(Gt("document.F=Object")),t.close(),t.F);for(var n=bt.length;n--;)delete Ut.prototype[bt[n]];return Ut()};Z[zt]=!0;var Yt=Object.create||function(t,e){var n;return null!==t?(Wt.prototype=D(t),n=new Wt,Wt.prototype=null,n[zt]=t):n=Ut(),void 0===e?n:jt(n,e)},Xt=Et.f,Zt={}.toString,qt="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Jt={f:function(t){return qt&&"[object Window]"==Zt.call(t)?function(t){try{return Xt(t)}catch(t){return qt.slice()}}(t):Xt(v(t))}},$t=z("wks"),Kt=i.Symbol,Qt=Lt?Kt:Kt&&Kt.withoutSetter||U,te=function(t){return S($t,t)||(Ot&&S(Kt,t)?$t[t]=Kt[t]:$t[t]=Qt("Symbol."+t)),$t[t]},ee={f:te},ne=M.f,re=function(t){var e=it.Symbol||(it.Symbol={});S(e,t)||ne(e,t,{value:ee.f(t)})},oe=M.f,ie=te("toStringTag"),ae=function(t,e,n){t&&!S(t=n?t:t.prototype,ie)&&oe(t,ie,{configurable:!0,value:e})},se=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t},le=function(t,e,n){if(se(t),void 0===e)return t;switch(n){case 0:return function(){return t.call(e)};case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,o){return t.call(e,n,r,o)}}return function(){return t.apply(e,arguments)}},ue=te("species"),ce=function(t,e){var n;return Bt(t)&&("function"!=typeof(n=t.constructor)||n!==Array&&!Bt(n.prototype)?y(n)&&null===(n=n[ue])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===e?0:e)},he=[].push,pe=function(t){var e=1==t,n=2==t,r=3==t,o=4==t,i=6==t,a=5==t||i;return function(s,l,u,c){for(var h,p,d=Ft(s),f=m(d),g=le(l,u,3),v=pt(f.length),y=0,w=c||ce,b=e?w(s,v):n?w(s,0):void 0;v>y;y++)if((a||y in f)&&(p=g(h=f[y],y,d),t))if(e)b[y]=p;else if(p)switch(t){case 3:return!0;case 5:return h;case 6:return y;case 2:he.call(b,h)}else if(o)return!1;return i?-1:r||o?o:b}},de={forEach:pe(0),map:pe(1),filter:pe(2),some:pe(3),every:pe(4),find:pe(5),findIndex:pe(6)},fe=de.forEach,me=X("hidden"),ge=te("toPrimitive"),ve=rt.set,ye=rt.getterFor("Symbol"),we=Object.prototype,be=i.Symbol,Se=st("JSON","stringify"),Ee=I.f,Pe=M.f,xe=Jt.f,_e=c.f,Te=z("symbols"),Ce=z("op-symbols"),Ie=z("string-to-symbol-registry"),De=z("symbol-to-string-registry"),ke=z("wks"),Me=i.QObject,Re=!Me||!Me.prototype||!Me.prototype.findChild,Ae=s&&a((function(){return 7!=Yt(Pe({},"a",{get:function(){return Pe(this,"a",{value:7}).a}})).a}))?function(t,e,n){var r=Ee(we,e);r&&delete we[e],Pe(t,e,n),r&&t!==we&&Pe(we,e,r)}:Pe,He=function(t,e){var n=Te[t]=Yt(be.prototype);return ve(n,{type:"Symbol",tag:t,description:e}),s||(n.description=e),n},Oe=Lt?function(t){return"symbol"==typeof t}:function(t){return Object(t)instanceof be},Le=function(t,e,n){t===we&&Le(Ce,e,n),D(t);var r=w(e,!0);return D(n),S(Te,r)?(n.enumerable?(S(t,me)&&t[me][r]&&(t[me][r]=!1),n=Yt(n,{enumerable:h(0,!1)})):(S(t,me)||Pe(t,me,h(1,{})),t[me][r]=!0),Ae(t,r,n)):Pe(t,r,n)},Be=function(t,e){D(t);var n=v(e),r=Nt(n).concat(Ve(n));return fe(r,(function(e){s&&!Fe.call(n,e)||Le(t,e,n[e])})),t},Fe=function(t){var e=w(t,!0),n=_e.call(this,e);return!(this===we&&S(Te,e)&&!S(Ce,e))&&(!(n||!S(this,e)||!S(Te,e)||S(this,me)&&this[me][e])||n)},Ne=function(t,e){var n=v(t),r=w(e,!0);if(n!==we||!S(Te,r)||S(Ce,r)){var o=Ee(n,r);return!o||!S(Te,r)||S(n,me)&&n[me][r]||(o.enumerable=!0),o}},je=function(t){var e=xe(v(t)),n=[];return fe(e,(function(t){S(Te,t)||S(Z,t)||n.push(t)})),n},Ve=function(t){var e=t===we,n=xe(e?Ce:v(t)),r=[];return fe(n,(function(t){!S(Te,t)||e&&!S(we,t)||r.push(Te[t])})),r};if(Ot||(ot((be=function(){if(this instanceof be)throw TypeError("Symbol is not a constructor");var t=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,e=U(t),n=function(t){this===we&&n.call(Ce,t),S(this,me)&&S(this[me],e)&&(this[me][e]=!1),Ae(this,e,h(1,t))};return s&&Re&&Ae(we,e,{configurable:!0,set:n}),He(e,t)}).prototype,"toString",(function(){return ye(this).tag})),ot(be,"withoutSetter",(function(t){return He(U(t),t)})),c.f=Fe,M.f=Le,I.f=Ne,Et.f=Jt.f=je,Pt.f=Ve,ee.f=function(t){return He(te(t),t)},s&&(Pe(be.prototype,"description",{configurable:!0,get:function(){return ye(this).description}}),ot(we,"propertyIsEnumerable",Fe,{unsafe:!0}))),Ht({global:!0,wrap:!0,forced:!Ot,sham:!Ot},{Symbol:be}),fe(Nt(ke),(function(t){re(t)})),Ht({target:"Symbol",stat:!0,forced:!Ot},{for:function(t){var e=String(t);if(S(Ie,e))return Ie[e];var n=be(e);return Ie[e]=n,De[n]=e,n},keyFor:function(t){if(!Oe(t))throw TypeError(t+" is not a symbol");if(S(De,t))return De[t]},useSetter:function(){Re=!0},useSimple:function(){Re=!1}}),Ht({target:"Object",stat:!0,forced:!Ot,sham:!s},{create:function(t,e){return void 0===e?Yt(t):Be(Yt(t),e)},defineProperty:Le,defineProperties:Be,getOwnPropertyDescriptor:Ne}),Ht({target:"Object",stat:!0,forced:!Ot},{getOwnPropertyNames:je,getOwnPropertySymbols:Ve}),Ht({target:"Object",stat:!0,forced:a((function(){Pt.f(1)}))},{getOwnPropertySymbols:function(t){return Pt.f(Ft(t))}}),Se){var ze=!Ot||a((function(){var t=be();return"[null]"!=Se([t])||"{}"!=Se({a:t})||"{}"!=Se(Object(t))}));Ht({target:"JSON",stat:!0,forced:ze},{stringify:function(t,e,n){for(var r,o=[t],i=1;arguments.length>i;)o.push(arguments[i++]);if(r=e,(y(e)||void 0!==t)&&!Oe(t))return Bt(e)||(e=function(t,e){if("function"==typeof r&&(e=r.call(this,t,e)),!Oe(e))return e}),o[1]=e,Se.apply(null,o)}})}be.prototype[ge]||R(be.prototype,ge,be.prototype.valueOf),ae(be,"Symbol"),Z[me]=!0;var We=M.f,Ge=i.Symbol;if(s&&"function"==typeof Ge&&(!("description"in Ge.prototype)||void 0!==Ge().description)){var Ue={},Ye=function(){var t=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),e=this instanceof Ye?new Ge(t):void 0===t?Ge():Ge(t);return""===t&&(Ue[e]=!0),e};_t(Ye,Ge);var Xe=Ye.prototype=Ge.prototype;Xe.constructor=Ye;var Ze=Xe.toString,qe="Symbol(test)"==String(Ge("test")),Je=/^Symbol\((.*)\)[^)]+$/;We(Xe,"description",{configurable:!0,get:function(){var t=y(this)?this.valueOf():this,e=Ze.call(t);if(S(Ue,t))return"";var n=qe?e.slice(7,-1):e.replace(Je,"$1");return""===n?void 0:n}}),Ht({global:!0,forced:!0},{Symbol:Ye})}re("asyncIterator"),re("hasInstance"),re("isConcatSpreadable"),re("iterator"),re("match"),re("replace"),re("search"),re("species"),re("split"),re("toPrimitive"),re("toStringTag"),re("unscopables");var $e,Ke,Qe=function(t,e,n){var r=w(e);r in t?M.f(t,r,h(0,n)):t[r]=n},tn=st("navigator","userAgent")||"",en=i.process,nn=en&&en.versions,rn=nn&&nn.v8;rn?Ke=($e=rn.split("."))[0]+$e[1]:tn&&(!($e=tn.match(/Edge\/(\d+)/))||$e[1]>=74)&&($e=tn.match(/Chrome\/(\d+)/))&&(Ke=$e[1]);var on=Ke&&+Ke,an=te("species"),sn=function(t){return on>=51||!a((function(){var e=[];return(e.constructor={})[an]=function(){return{foo:1}},1!==e[t](Boolean).foo}))},ln=te("isConcatSpreadable"),un=on>=51||!a((function(){var t=[];return t[ln]=!1,t.concat()[0]!==t})),cn=sn("concat"),hn=function(t){if(!y(t))return!1;var e=t[ln];return void 0!==e?!!e:Bt(t)};Ht({target:"Array",proto:!0,forced:!un||!cn},{concat:function(t){var e,n,r,o,i,a=Ft(this),s=ce(a,0),l=0;for(e=-1,r=arguments.length;e<r;e++)if(hn(i=-1===e?a:arguments[e])){if(l+(o=pt(i.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(n=0;n<o;n++,l++)n in i&&Qe(s,l,i[n])}else{if(l>=9007199254740991)throw TypeError("Maximum allowed index exceeded");Qe(s,l++,i)}return s.length=l,s}});var pn=Math.min,dn=[].copyWithin||function(t,e){var n=Ft(this),r=pt(n.length),o=mt(t,r),i=mt(e,r),a=arguments.length>2?arguments[2]:void 0,s=pn((void 0===a?r:mt(a,r))-i,r-o),l=1;for(i<o&&o<i+s&&(l=-1,i+=s-1,o+=s-1);s-- >0;)i in n?n[o]=n[i]:delete n[o],o+=l,i+=l;return n},fn=te("unscopables"),mn=Array.prototype;null==mn[fn]&&M.f(mn,fn,{configurable:!0,value:Yt(null)});var gn=function(t){mn[fn][t]=!0};Ht({target:"Array",proto:!0},{copyWithin:dn}),gn("copyWithin");var vn=function(t,e){var n=[][t];return!!n&&a((function(){n.call(null,e||function(){throw 1},1)}))},yn=Object.defineProperty,wn={},bn=function(t){throw t},Sn=function(t,e){if(S(wn,t))return wn[t];e||(e={});var n=[][t],r=!!S(e,"ACCESSORS")&&e.ACCESSORS,o=S(e,0)?e[0]:bn,i=S(e,1)?e[1]:void 0;return wn[t]=!!n&&!a((function(){if(r&&!s)return!0;var t={length:-1};r?yn(t,1,{enumerable:!0,get:bn}):t[1]=1,n.call(t,o,i)}))},En=de.every,Pn=vn("every"),xn=Sn("every");Ht({target:"Array",proto:!0,forced:!Pn||!xn},{every:function(t){return En(this,t,arguments.length>1?arguments[1]:void 0)}});var _n=function(t){for(var e=Ft(this),n=pt(e.length),r=arguments.length,o=mt(r>1?arguments[1]:void 0,n),i=r>2?arguments[2]:void 0,a=void 0===i?n:mt(i,n);a>o;)e[o++]=t;return e};Ht({target:"Array",proto:!0},{fill:_n}),gn("fill");var Tn=de.filter,Cn=sn("filter"),In=Sn("filter");Ht({target:"Array",proto:!0,forced:!Cn||!In},{filter:function(t){return Tn(this,t,arguments.length>1?arguments[1]:void 0)}});var Dn=de.find,kn=!0,Mn=Sn("find");"find"in[]&&Array(1).find((function(){kn=!1})),Ht({target:"Array",proto:!0,forced:kn||!Mn},{find:function(t){return Dn(this,t,arguments.length>1?arguments[1]:void 0)}}),gn("find");var Rn=de.findIndex,An=!0,Hn=Sn("findIndex");"findIndex"in[]&&Array(1).findIndex((function(){An=!1})),Ht({target:"Array",proto:!0,forced:An||!Hn},{findIndex:function(t){return Rn(this,t,arguments.length>1?arguments[1]:void 0)}}),gn("findIndex");var On=function(t,e,n,r,o,i,a,s){for(var l,u=o,c=0,h=!!a&&le(a,s,3);c<r;){if(c in n){if(l=h?h(n[c],c,e):n[c],i>0&&Bt(l))u=On(t,e,l,pt(l.length),u,i-1)-1;else{if(u>=9007199254740991)throw TypeError("Exceed the acceptable array length");t[u]=l}u++}c++}return u},Ln=On;Ht({target:"Array",proto:!0},{flat:function(){var t=arguments.length?arguments[0]:void 0,e=Ft(this),n=pt(e.length),r=ce(e,0);return r.length=Ln(r,e,e,n,0,void 0===t?1:ct(t)),r}}),Ht({target:"Array",proto:!0},{flatMap:function(t){var e,n=Ft(this),r=pt(n.length);return se(t),(e=ce(n,0)).length=Ln(e,n,n,r,0,1,t,arguments.length>1?arguments[1]:void 0),e}});var Bn=de.forEach,Fn=vn("forEach"),Nn=Sn("forEach"),jn=Fn&&Nn?[].forEach:function(t){return Bn(this,t,arguments.length>1?arguments[1]:void 0)};Ht({target:"Array",proto:!0,forced:[].forEach!=jn},{forEach:jn});var Vn=function(t,e,n,r){try{return r?e(D(n)[0],n[1]):e(n)}catch(e){var o=t.return;throw void 0!==o&&D(o.call(t)),e}},zn={},Wn=te("iterator"),Gn=Array.prototype,Un=function(t){return void 0!==t&&(zn.Array===t||Gn[Wn]===t)},Yn={};Yn[te("toStringTag")]="z";var Xn="[object z]"===String(Yn),Zn=te("toStringTag"),qn="Arguments"==d(function(){return arguments}()),Jn=Xn?d:function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),Zn))?n:qn?d(e):"Object"==(r=d(e))&&"function"==typeof e.callee?"Arguments":r},$n=te("iterator"),Kn=function(t){if(null!=t)return t[$n]||t["@@iterator"]||zn[Jn(t)]},Qn=function(t){var e,n,r,o,i,a,s=Ft(t),l="function"==typeof this?this:Array,u=arguments.length,c=u>1?arguments[1]:void 0,h=void 0!==c,p=Kn(s),d=0;if(h&&(c=le(c,u>2?arguments[2]:void 0,2)),null==p||l==Array&&Un(p))for(n=new l(e=pt(s.length));e>d;d++)a=h?c(s[d],d):s[d],Qe(n,d,a);else for(i=(o=p.call(s)).next,n=new l;!(r=i.call(o)).done;d++)a=h?Vn(o,c,[r.value,d],!0):r.value,Qe(n,d,a);return n.length=d,n},tr=te("iterator"),er=!1;try{var nr=0,rr={next:function(){return{done:!!nr++}},return:function(){er=!0}};rr[tr]=function(){return this},Array.from(rr,(function(){throw 2}))}catch(t){}var or=function(t,e){if(!e&&!er)return!1;var n=!1;try{var r={};r[tr]=function(){return{next:function(){return{done:n=!0}}}},t(r)}catch(t){}return n},ir=!or((function(t){Array.from(t)}));Ht({target:"Array",stat:!0,forced:ir},{from:Qn});var ar=vt.includes,sr=Sn("indexOf",{ACCESSORS:!0,1:0});Ht({target:"Array",proto:!0,forced:!sr},{includes:function(t){return ar(this,t,arguments.length>1?arguments[1]:void 0)}}),gn("includes");var lr=vt.indexOf,ur=[].indexOf,cr=!!ur&&1/[1].indexOf(1,-0)<0,hr=vn("indexOf"),pr=Sn("indexOf",{ACCESSORS:!0,1:0});Ht({target:"Array",proto:!0,forced:cr||!hr||!pr},{indexOf:function(t){return cr?ur.apply(this,arguments)||0:lr(this,t,arguments.length>1?arguments[1]:void 0)}});var dr,fr,mr,gr=!a((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),vr=X("IE_PROTO"),yr=Object.prototype,wr=gr?Object.getPrototypeOf:function(t){return t=Ft(t),S(t,vr)?t[vr]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?yr:null},br=te("iterator"),Sr=!1;[].keys&&("next"in(mr=[].keys())?(fr=wr(wr(mr)))!==Object.prototype&&(dr=fr):Sr=!0),null==dr&&(dr={}),S(dr,br)||R(dr,br,(function(){return this}));var Er={IteratorPrototype:dr,BUGGY_SAFARI_ITERATORS:Sr},Pr=Er.IteratorPrototype,xr=function(){return this},_r=function(t,e,n){var r=e+" Iterator";return t.prototype=Yt(Pr,{next:h(1,n)}),ae(t,r,!1),zn[r]=xr,t},Tr=function(t){if(!y(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype");return t},Cr=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),e=n instanceof Array}catch(t){}return function(n,r){return D(n),Tr(r),e?t.call(n,r):n.__proto__=r,n}}():void 0),Ir=Er.IteratorPrototype,Dr=Er.BUGGY_SAFARI_ITERATORS,kr=te("iterator"),Mr=function(){return this},Rr=function(t,e,n,r,o,i,a){_r(n,e,r);var s,l,u,c=function(t){if(t===o&&m)return m;if(!Dr&&t in d)return d[t];switch(t){case"keys":case"values":case"entries":return function(){return new n(this,t)}}return function(){return new n(this)}},h=e+" Iterator",p=!1,d=t.prototype,f=d[kr]||d["@@iterator"]||o&&d[o],m=!Dr&&f||c(o),g="Array"==e&&d.entries||f;if(g&&(s=wr(g.call(new t)),Ir!==Object.prototype&&s.next&&(wr(s)!==Ir&&(Cr?Cr(s,Ir):"function"!=typeof s[kr]&&R(s,kr,Mr)),ae(s,h,!0))),"values"==o&&f&&"values"!==f.name&&(p=!0,m=function(){return f.call(this)}),d[kr]!==m&&R(d,kr,m),zn[e]=m,o)if(l={values:c("values"),keys:i?m:c("keys"),entries:c("entries")},a)for(u in l)(Dr||p||!(u in d))&&ot(d,u,l[u]);else Ht({target:e,proto:!0,forced:Dr||p},l);return l},Ar=rt.set,Hr=rt.getterFor("Array Iterator"),Or=Rr(Array,"Array",(function(t,e){Ar(this,{type:"Array Iterator",target:v(t),index:0,kind:e})}),(function(){var t=Hr(this),e=t.target,n=t.kind,r=t.index++;return!e||r>=e.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:e[r],done:!1}:{value:[r,e[r]],done:!1}}),"values");zn.Arguments=zn.Array,gn("keys"),gn("values"),gn("entries");var Lr=[].join,Br=m!=Object,Fr=vn("join",",");Ht({target:"Array",proto:!0,forced:Br||!Fr},{join:function(t){return Lr.call(v(this),void 0===t?",":t)}});var Nr=Math.min,jr=[].lastIndexOf,Vr=!!jr&&1/[1].lastIndexOf(1,-0)<0,zr=vn("lastIndexOf"),Wr=Sn("indexOf",{ACCESSORS:!0,1:0}),Gr=Vr||!zr||!Wr?function(t){if(Vr)return jr.apply(this,arguments)||0;var e=v(this),n=pt(e.length),r=n-1;for(arguments.length>1&&(r=Nr(r,ct(arguments[1]))),r<0&&(r=n+r);r>=0;r--)if(r in e&&e[r]===t)return r||0;return-1}:jr;Ht({target:"Array",proto:!0,forced:Gr!==[].lastIndexOf},{lastIndexOf:Gr});var Ur=de.map,Yr=sn("map"),Xr=Sn("map");Ht({target:"Array",proto:!0,forced:!Yr||!Xr},{map:function(t){return Ur(this,t,arguments.length>1?arguments[1]:void 0)}});var Zr=a((function(){function t(){}return!(Array.of.call(t)instanceof t)}));Ht({target:"Array",stat:!0,forced:Zr},{of:function(){for(var t=0,e=arguments.length,n=new("function"==typeof this?this:Array)(e);e>t;)Qe(n,t,arguments[t++]);return n.length=e,n}});var qr=function(t){return function(e,n,r,o){se(n);var i=Ft(e),a=m(i),s=pt(i.length),l=t?s-1:0,u=t?-1:1;if(r<2)for(;;){if(l in a){o=a[l],l+=u;break}if(l+=u,t?l<0:s<=l)throw TypeError("Reduce of empty array with no initial value")}for(;t?l>=0:s>l;l+=u)l in a&&(o=n(o,a[l],l,i));return o}},Jr={left:qr(!1),right:qr(!0)},$r=Jr.left,Kr=vn("reduce"),Qr=Sn("reduce",{1:0});Ht({target:"Array",proto:!0,forced:!Kr||!Qr},{reduce:function(t){return $r(this,t,arguments.length,arguments.length>1?arguments[1]:void 0)}});var to=Jr.right,eo=vn("reduceRight"),no=Sn("reduce",{1:0});Ht({target:"Array",proto:!0,forced:!eo||!no},{reduceRight:function(t){return to(this,t,arguments.length,arguments.length>1?arguments[1]:void 0)}});var ro=sn("slice"),oo=Sn("slice",{ACCESSORS:!0,0:0,1:2}),io=te("species"),ao=[].slice,so=Math.max;Ht({target:"Array",proto:!0,forced:!ro||!oo},{slice:function(t,e){var n,r,o,i=v(this),a=pt(i.length),s=mt(t,a),l=mt(void 0===e?a:e,a);if(Bt(i)&&("function"!=typeof(n=i.constructor)||n!==Array&&!Bt(n.prototype)?y(n)&&null===(n=n[io])&&(n=void 0):n=void 0,n===Array||void 0===n))return ao.call(i,s,l);for(r=new(void 0===n?Array:n)(so(l-s,0)),o=0;s<l;s++,o++)s in i&&Qe(r,o,i[s]);return r.length=o,r}});var lo=de.some,uo=vn("some"),co=Sn("some");Ht({target:"Array",proto:!0,forced:!uo||!co},{some:function(t){return lo(this,t,arguments.length>1?arguments[1]:void 0)}});var ho=te("species"),po=function(t){var e=st(t),n=M.f;s&&e&&!e[ho]&&n(e,ho,{configurable:!0,get:function(){return this}})};po("Array");var fo=sn("splice"),mo=Sn("splice",{ACCESSORS:!0,0:0,1:2}),go=Math.max,vo=Math.min;Ht({target:"Array",proto:!0,forced:!fo||!mo},{splice:function(t,e){var n,r,o,i,a,s,l=Ft(this),u=pt(l.length),c=mt(t,u),h=arguments.length;if(0===h?n=r=0:1===h?(n=0,r=u-c):(n=h-2,r=vo(go(ct(e),0),u-c)),u+n-r>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(o=ce(l,r),i=0;i<r;i++)(a=c+i)in l&&Qe(o,i,l[a]);if(o.length=r,n<r){for(i=c;i<u-r;i++)s=i+n,(a=i+r)in l?l[s]=l[a]:delete l[s];for(i=u;i>u-r+n;i--)delete l[i-1]}else if(n>r)for(i=u-r;i>c;i--)s=i+n-1,(a=i+r-1)in l?l[s]=l[a]:delete l[s];for(i=0;i<n;i++)l[i+c]=arguments[i+2];return l.length=u-r+n,o}}),gn("flat"),gn("flatMap");var yo="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,wo=function(t,e,n){for(var r in e)ot(t,r,e[r],n);return t},bo=function(t,e,n){if(!(t instanceof e))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return t},So=function(t){if(void 0===t)return 0;var e=ct(t),n=pt(e);if(e!==n)throw RangeError("Wrong length or index");return n},Eo=Math.abs,Po=Math.pow,xo=Math.floor,_o=Math.log,To=Math.LN2,Co=function(t,e,n){var r,o,i,a=new Array(n),s=8*n-e-1,l=(1<<s)-1,u=l>>1,c=23===e?Po(2,-24)-Po(2,-77):0,h=t<0||0===t&&1/t<0?1:0,p=0;for((t=Eo(t))!=t||t===1/0?(o=t!=t?1:0,r=l):(r=xo(_o(t)/To),t*(i=Po(2,-r))<1&&(r--,i*=2),(t+=r+u>=1?c/i:c*Po(2,1-u))*i>=2&&(r++,i/=2),r+u>=l?(o=0,r=l):r+u>=1?(o=(t*i-1)*Po(2,e),r+=u):(o=t*Po(2,u-1)*Po(2,e),r=0));e>=8;a[p++]=255&o,o/=256,e-=8);for(r=r<<e|o,s+=e;s>0;a[p++]=255&r,r/=256,s-=8);return a[--p]|=128*h,a},Io=function(t,e){var n,r=t.length,o=8*r-e-1,i=(1<<o)-1,a=i>>1,s=o-7,l=r-1,u=t[l--],c=127&u;for(u>>=7;s>0;c=256*c+t[l],l--,s-=8);for(n=c&(1<<-s)-1,c>>=-s,s+=e;s>0;n=256*n+t[l],l--,s-=8);if(0===c)c=1-a;else{if(c===i)return n?NaN:u?-1/0:1/0;n+=Po(2,e),c-=a}return(u?-1:1)*n*Po(2,c-e)},Do=Et.f,ko=M.f,Mo=rt.get,Ro=rt.set,Ao=i.ArrayBuffer,Ho=Ao,Oo=i.DataView,Lo=Oo&&Oo.prototype,Bo=Object.prototype,Fo=i.RangeError,No=Co,jo=Io,Vo=function(t){return[255&t]},zo=function(t){return[255&t,t>>8&255]},Wo=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},Go=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},Uo=function(t){return No(t,23,4)},Yo=function(t){return No(t,52,8)},Xo=function(t,e){ko(t.prototype,e,{get:function(){return Mo(this)[e]}})},Zo=function(t,e,n,r){var o=So(n),i=Mo(t);if(o+e>i.byteLength)throw Fo("Wrong index");var a=Mo(i.buffer).bytes,s=o+i.byteOffset,l=a.slice(s,s+e);return r?l:l.reverse()},qo=function(t,e,n,r,o,i){var a=So(n),s=Mo(t);if(a+e>s.byteLength)throw Fo("Wrong index");for(var l=Mo(s.buffer).bytes,u=a+s.byteOffset,c=r(+o),h=0;h<e;h++)l[u+h]=c[i?h:e-h-1]};if(yo){if(!a((function(){Ao(1)}))||!a((function(){new Ao(-1)}))||a((function(){return new Ao,new Ao(1.5),new Ao(NaN),"ArrayBuffer"!=Ao.name}))){for(var Jo,$o=(Ho=function(t){return bo(this,Ho),new Ao(So(t))}).prototype=Ao.prototype,Ko=Do(Ao),Qo=0;Ko.length>Qo;)(Jo=Ko[Qo++])in Ho||R(Ho,Jo,Ao[Jo]);$o.constructor=Ho}Cr&&wr(Lo)!==Bo&&Cr(Lo,Bo);var ti=new Oo(new Ho(2)),ei=Lo.setInt8;ti.setInt8(0,2147483648),ti.setInt8(1,2147483649),!ti.getInt8(0)&&ti.getInt8(1)||wo(Lo,{setInt8:function(t,e){ei.call(this,t,e<<24>>24)},setUint8:function(t,e){ei.call(this,t,e<<24>>24)}},{unsafe:!0})}else Ho=function(t){bo(this,Ho,"ArrayBuffer");var e=So(t);Ro(this,{bytes:_n.call(new Array(e),0),byteLength:e}),s||(this.byteLength=e)},Oo=function(t,e,n){bo(this,Oo,"DataView"),bo(t,Ho,"DataView");var r=Mo(t).byteLength,o=ct(e);if(o<0||o>r)throw Fo("Wrong offset");if(o+(n=void 0===n?r-o:pt(n))>r)throw Fo("Wrong length");Ro(this,{buffer:t,byteLength:n,byteOffset:o}),s||(this.buffer=t,this.byteLength=n,this.byteOffset=o)},s&&(Xo(Ho,"byteLength"),Xo(Oo,"buffer"),Xo(Oo,"byteLength"),Xo(Oo,"byteOffset")),wo(Oo.prototype,{getInt8:function(t){return Zo(this,1,t)[0]<<24>>24},getUint8:function(t){return Zo(this,1,t)[0]},getInt16:function(t){var e=Zo(this,2,t,arguments.length>1?arguments[1]:void 0);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=Zo(this,2,t,arguments.length>1?arguments[1]:void 0);return e[1]<<8|e[0]},getInt32:function(t){return Go(Zo(this,4,t,arguments.length>1?arguments[1]:void 0))},getUint32:function(t){return Go(Zo(this,4,t,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(t){return jo(Zo(this,4,t,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(t){return jo(Zo(this,8,t,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(t,e){qo(this,1,t,Vo,e)},setUint8:function(t,e){qo(this,1,t,Vo,e)},setInt16:function(t,e){qo(this,2,t,zo,e,arguments.length>2?arguments[2]:void 0)},setUint16:function(t,e){qo(this,2,t,zo,e,arguments.length>2?arguments[2]:void 0)},setInt32:function(t,e){qo(this,4,t,Wo,e,arguments.length>2?arguments[2]:void 0)},setUint32:function(t,e){qo(this,4,t,Wo,e,arguments.length>2?arguments[2]:void 0)},setFloat32:function(t,e){qo(this,4,t,Uo,e,arguments.length>2?arguments[2]:void 0)},setFloat64:function(t,e){qo(this,8,t,Yo,e,arguments.length>2?arguments[2]:void 0)}});ae(Ho,"ArrayBuffer"),ae(Oo,"DataView");var ni={ArrayBuffer:Ho,DataView:Oo},ri=ni.ArrayBuffer,oi=i.ArrayBuffer;Ht({global:!0,forced:oi!==ri},{ArrayBuffer:ri}),po("ArrayBuffer");var ii=te("toPrimitive"),ai=Date.prototype;ii in ai||R(ai,ii,(function(t){if("string"!==t&&"number"!==t&&"default"!==t)throw TypeError("Incorrect hint");return w(D(this),"number"!==t)}));var si=te("hasInstance"),li=Function.prototype;si in li||M.f(li,si,{value:function(t){if("function"!=typeof this||!y(t))return!1;if(!y(this.prototype))return t instanceof this;for(;t=wr(t);)if(this.prototype===t)return!0;return!1}});var ui=M.f,ci=Function.prototype,hi=ci.toString,pi=/^\s*function ([^ (]*)/;s&&!("name"in ci)&&ui(ci,"name",{configurable:!0,get:function(){try{return hi.call(this).match(pi)[1]}catch(t){return""}}}),ae(i.JSON,"JSON",!0);var di=!a((function(){return Object.isExtensible(Object.preventExtensions({}))})),fi=r((function(t){var e=M.f,n=U("meta"),r=0,o=Object.isExtensible||function(){return!0},i=function(t){e(t,n,{value:{objectID:"O"+ ++r,weakData:{}}})},a=t.exports={REQUIRED:!1,fastKey:function(t,e){if(!y(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!S(t,n)){if(!o(t))return"F";if(!e)return"E";i(t)}return t[n].objectID},getWeakData:function(t,e){if(!S(t,n)){if(!o(t))return!0;if(!e)return!1;i(t)}return t[n].weakData},onFreeze:function(t){return di&&a.REQUIRED&&o(t)&&!S(t,n)&&i(t),t}};Z[n]=!0})),mi=(fi.REQUIRED,fi.fastKey,fi.getWeakData,fi.onFreeze,r((function(t){var e=function(t,e){this.stopped=t,this.result=e};(t.exports=function(t,n,r,o,i){var a,s,l,u,c,h,p,d=le(n,r,o?2:1);if(i)a=t;else{if("function"!=typeof(s=Kn(t)))throw TypeError("Target is not iterable");if(Un(s)){for(l=0,u=pt(t.length);u>l;l++)if((c=o?d(D(p=t[l])[0],p[1]):d(t[l]))&&c instanceof e)return c;return new e(!1)}a=s.call(t)}for(h=a.next;!(p=h.call(a)).done;)if("object"==typeof(c=Vn(a,d,p.value,o))&&c&&c instanceof e)return c;return new e(!1)}).stop=function(t){return new e(!0,t)}}))),gi=function(t,e,n){var r,o;return Cr&&"function"==typeof(r=e.constructor)&&r!==n&&y(o=r.prototype)&&o!==n.prototype&&Cr(t,o),t},vi=function(t,e,n){var r=-1!==t.indexOf("Map"),o=-1!==t.indexOf("Weak"),s=r?"set":"add",l=i[t],u=l&&l.prototype,c=l,h={},p=function(t){var e=u[t];ot(u,t,"add"==t?function(t){return e.call(this,0===t?0:t),this}:"delete"==t?function(t){return!(o&&!y(t))&&e.call(this,0===t?0:t)}:"get"==t?function(t){return o&&!y(t)?void 0:e.call(this,0===t?0:t)}:"has"==t?function(t){return!(o&&!y(t))&&e.call(this,0===t?0:t)}:function(t,n){return e.call(this,0===t?0:t,n),this})};if(Rt(t,"function"!=typeof l||!(o||u.forEach&&!a((function(){(new l).entries().next()})))))c=n.getConstructor(e,t,r,s),fi.REQUIRED=!0;else if(Rt(t,!0)){var d=new c,f=d[s](o?{}:-0,1)!=d,m=a((function(){d.has(1)})),g=or((function(t){new l(t)})),v=!o&&a((function(){for(var t=new l,e=5;e--;)t[s](e,e);return!t.has(-0)}));g||((c=e((function(e,n){bo(e,c,t);var o=gi(new l,e,c);return null!=n&&mi(n,o[s],o,r),o}))).prototype=u,u.constructor=c),(m||v)&&(p("delete"),p("has"),r&&p("get")),(v||f)&&p(s),o&&u.clear&&delete u.clear}return h[t]=c,Ht({global:!0,forced:c!=l},h),ae(c,t),o||n.setStrong(c,t,r),c},yi=M.f,wi=fi.fastKey,bi=rt.set,Si=rt.getterFor,Ei={getConstructor:function(t,e,n,r){var o=t((function(t,i){bo(t,o,e),bi(t,{type:e,index:Yt(null),first:void 0,last:void 0,size:0}),s||(t.size=0),null!=i&&mi(i,t[r],t,n)})),i=Si(e),a=function(t,e,n){var r,o,a=i(t),u=l(t,e);return u?u.value=n:(a.last=u={index:o=wi(e,!0),key:e,value:n,previous:r=a.last,next:void 0,removed:!1},a.first||(a.first=u),r&&(r.next=u),s?a.size++:t.size++,"F"!==o&&(a.index[o]=u)),t},l=function(t,e){var n,r=i(t),o=wi(e);if("F"!==o)return r.index[o];for(n=r.first;n;n=n.next)if(n.key==e)return n};return wo(o.prototype,{clear:function(){for(var t=i(this),e=t.index,n=t.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete e[n.index],n=n.next;t.first=t.last=void 0,s?t.size=0:this.size=0},delete:function(t){var e=i(this),n=l(this,t);if(n){var r=n.next,o=n.previous;delete e.index[n.index],n.removed=!0,o&&(o.next=r),r&&(r.previous=o),e.first==n&&(e.first=r),e.last==n&&(e.last=o),s?e.size--:this.size--}return!!n},forEach:function(t){for(var e,n=i(this),r=le(t,arguments.length>1?arguments[1]:void 0,3);e=e?e.next:n.first;)for(r(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function(t){return!!l(this,t)}}),wo(o.prototype,n?{get:function(t){var e=l(this,t);return e&&e.value},set:function(t,e){return a(this,0===t?0:t,e)}}:{add:function(t){return a(this,t=0===t?0:t,t)}}),s&&yi(o.prototype,"size",{get:function(){return i(this).size}}),o},setStrong:function(t,e,n){var r=e+" Iterator",o=Si(e),i=Si(r);Rr(t,e,(function(t,e){bi(this,{type:r,target:t,state:o(t),kind:e,last:void 0})}),(function(){for(var t=i(this),e=t.kind,n=t.last;n&&n.removed;)n=n.previous;return t.target&&(t.last=n=n?n.next:t.state.first)?"keys"==e?{value:n.key,done:!1}:"values"==e?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(t.target=void 0,{value:void 0,done:!0})}),n?"entries":"values",!n,!0),po(e)}},Pi=(vi("Map",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),Ei),Math.log),xi=Math.log1p||function(t){return(t=+t)>-1e-8&&t<1e-8?t-t*t/2:Pi(1+t)},_i=Math.acosh,Ti=Math.log,Ci=Math.sqrt,Ii=Math.LN2,Di=!_i||710!=Math.floor(_i(Number.MAX_VALUE))||_i(1/0)!=1/0;Ht({target:"Math",stat:!0,forced:Di},{acosh:function(t){return(t=+t)<1?NaN:t>94906265.62425156?Ti(t)+Ii:xi(t-1+Ci(t-1)*Ci(t+1))}});var ki=Math.asinh,Mi=Math.log,Ri=Math.sqrt;Ht({target:"Math",stat:!0,forced:!(ki&&1/ki(0)>0)},{asinh:function t(e){return isFinite(e=+e)&&0!=e?e<0?-t(-e):Mi(e+Ri(e*e+1)):e}});var Ai=Math.atanh,Hi=Math.log;Ht({target:"Math",stat:!0,forced:!(Ai&&1/Ai(-0)<0)},{atanh:function(t){return 0==(t=+t)?t:Hi((1+t)/(1-t))/2}});var Oi=Math.sign||function(t){return 0==(t=+t)||t!=t?t:t<0?-1:1},Li=Math.abs,Bi=Math.pow;Ht({target:"Math",stat:!0},{cbrt:function(t){return Oi(t=+t)*Bi(Li(t),1/3)}});var Fi=Math.floor,Ni=Math.log,ji=Math.LOG2E;Ht({target:"Math",stat:!0},{clz32:function(t){return(t>>>=0)?31-Fi(Ni(t+.5)*ji):32}});var Vi=Math.expm1,zi=Math.exp,Wi=!Vi||Vi(10)>22025.465794806718||Vi(10)<22025.465794806718||-2e-17!=Vi(-2e-17)?function(t){return 0==(t=+t)?t:t>-1e-6&&t<1e-6?t+t*t/2:zi(t)-1}:Vi,Gi=Math.cosh,Ui=Math.abs,Yi=Math.E;Ht({target:"Math",stat:!0,forced:!Gi||Gi(710)===1/0},{cosh:function(t){var e=Wi(Ui(t)-1)+1;return(e+1/(e*Yi*Yi))*(Yi/2)}}),Ht({target:"Math",stat:!0,forced:Wi!=Math.expm1},{expm1:Wi});var Xi=Math.abs,Zi=Math.pow,qi=Zi(2,-52),Ji=Zi(2,-23),$i=Zi(2,127)*(2-Ji),Ki=Zi(2,-126),Qi=Math.fround||function(t){var e,n,r=Xi(t),o=Oi(t);return r<Ki?o*(r/Ki/Ji+1/qi-1/qi)*Ki*Ji:(n=(e=(1+Ji/qi)*r)-(e-r))>$i||n!=n?o*(1/0):o*n};Ht({target:"Math",stat:!0},{fround:Qi});var ta=Math.hypot,ea=Math.abs,na=Math.sqrt,ra=!!ta&&ta(1/0,NaN)!==1/0;Ht({target:"Math",stat:!0,forced:ra},{hypot:function(t,e){for(var n,r,o=0,i=0,a=arguments.length,s=0;i<a;)s<(n=ea(arguments[i++]))?(o=o*(r=s/n)*r+1,s=n):o+=n>0?(r=n/s)*r:n;return s===1/0?1/0:s*na(o)}});var oa=Math.imul,ia=a((function(){return-5!=oa(4294967295,5)||2!=oa.length}));Ht({target:"Math",stat:!0,forced:ia},{imul:function(t,e){var n=+t,r=+e,o=65535&n,i=65535&r;return 0|o*i+((65535&n>>>16)*i+o*(65535&r>>>16)<<16>>>0)}});var aa=Math.log,sa=Math.LOG10E;Ht({target:"Math",stat:!0},{log10:function(t){return aa(t)*sa}}),Ht({target:"Math",stat:!0},{log1p:xi});var la=Math.log,ua=Math.LN2;Ht({target:"Math",stat:!0},{log2:function(t){return la(t)/ua}}),Ht({target:"Math",stat:!0},{sign:Oi});var ca=Math.abs,ha=Math.exp,pa=Math.E,da=a((function(){return-2e-17!=Math.sinh(-2e-17)}));Ht({target:"Math",stat:!0,forced:da},{sinh:function(t){return ca(t=+t)<1?(Wi(t)-Wi(-t))/2:(ha(t-1)-ha(-t-1))*(pa/2)}});var fa=Math.exp;Ht({target:"Math",stat:!0},{tanh:function(t){var e=Wi(t=+t),n=Wi(-t);return e==1/0?1:n==1/0?-1:(e-n)/(fa(t)+fa(-t))}}),ae(Math,"Math",!0);var ma=Math.ceil,ga=Math.floor;Ht({target:"Math",stat:!0},{trunc:function(t){return(t>0?ga:ma)(t)}});var va="\t\n\v\f\r                　\u2028\u2029\ufeff",ya="["+va+"]",wa=RegExp("^"+ya+ya+"*"),ba=RegExp(ya+ya+"*$"),Sa=function(t){return function(e){var n=String(g(e));return 1&t&&(n=n.replace(wa,"")),2&t&&(n=n.replace(ba,"")),n}},Ea={start:Sa(1),end:Sa(2),trim:Sa(3)},Pa=Et.f,xa=I.f,_a=M.f,Ta=Ea.trim,Ca=i.Number,Ia=Ca.prototype,Da="Number"==d(Yt(Ia)),ka=function(t){var e,n,r,o,i,a,s,l,u=w(t,!1);if("string"==typeof u&&u.length>2)if(43===(e=(u=Ta(u)).charCodeAt(0))||45===e){if(88===(n=u.charCodeAt(2))||120===n)return NaN}else if(48===e){switch(u.charCodeAt(1)){case 66:case 98:r=2,o=49;break;case 79:case 111:r=8,o=55;break;default:return+u}for(a=(i=u.slice(2)).length,s=0;s<a;s++)if((l=i.charCodeAt(s))<48||l>o)return NaN;return parseInt(i,r)}return+u};if(Rt("Number",!Ca(" 0o1")||!Ca("0b1")||Ca("+0x1"))){for(var Ma,Ra=function(t){var e=arguments.length<1?0:t,n=this;return n instanceof Ra&&(Da?a((function(){Ia.valueOf.call(n)})):"Number"!=d(n))?gi(new Ca(ka(e)),n,Ra):ka(e)},Aa=s?Pa(Ca):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),Ha=0;Aa.length>Ha;Ha++)S(Ca,Ma=Aa[Ha])&&!S(Ra,Ma)&&_a(Ra,Ma,xa(Ca,Ma));Ra.prototype=Ia,Ia.constructor=Ra,ot(i,"Number",Ra)}Ht({target:"Number",stat:!0},{EPSILON:Math.pow(2,-52)});var Oa=i.isFinite,La=Number.isFinite||function(t){return"number"==typeof t&&Oa(t)};Ht({target:"Number",stat:!0},{isFinite:La});var Ba=Math.floor,Fa=function(t){return!y(t)&&isFinite(t)&&Ba(t)===t};Ht({target:"Number",stat:!0},{isInteger:Fa}),Ht({target:"Number",stat:!0},{isNaN:function(t){return t!=t}});var Na=Math.abs;Ht({target:"Number",stat:!0},{isSafeInteger:function(t){return Fa(t)&&Na(t)<=9007199254740991}}),Ht({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991}),Ht({target:"Number",stat:!0},{MIN_SAFE_INTEGER:-9007199254740991});var ja=Ea.trim,Va=i.parseFloat,za=1/Va(va+"-0")!=-1/0?function(t){var e=ja(String(t)),n=Va(e);return 0===n&&"-"==e.charAt(0)?-0:n}:Va;Ht({target:"Number",stat:!0,forced:Number.parseFloat!=za},{parseFloat:za});var Wa=Ea.trim,Ga=i.parseInt,Ua=/^[+-]?0[Xx]/,Ya=8!==Ga(va+"08")||22!==Ga(va+"0x16")?function(t,e){var n=Wa(String(t));return Ga(n,e>>>0||(Ua.test(n)?16:10))}:Ga;Ht({target:"Number",stat:!0,forced:Number.parseInt!=Ya},{parseInt:Ya});var Xa="".repeat||function(t){var e=String(g(this)),n="",r=ct(t);if(r<0||r==1/0)throw RangeError("Wrong number of repetitions");for(;r>0;(r>>>=1)&&(e+=e))1&r&&(n+=e);return n},Za=1..toFixed,qa=Math.floor,Ja=function(t,e,n){return 0===e?n:e%2==1?Ja(t,e-1,n*t):Ja(t*t,e/2,n)},$a=Za&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!a((function(){Za.call({})}));Ht({target:"Number",proto:!0,forced:$a},{toFixed:function(t){var e,n,r,o,i=function(t){if("number"!=typeof t&&"Number"!=d(t))throw TypeError("Incorrect invocation");return+t}(this),a=ct(t),s=[0,0,0,0,0,0],l="",u="0",c=function(t,e){for(var n=-1,r=e;++n<6;)r+=t*s[n],s[n]=r%1e7,r=qa(r/1e7)},h=function(t){for(var e=6,n=0;--e>=0;)n+=s[e],s[e]=qa(n/t),n=n%t*1e7},p=function(){for(var t=6,e="";--t>=0;)if(""!==e||0===t||0!==s[t]){var n=String(s[t]);e=""===e?n:e+Xa.call("0",7-n.length)+n}return e};if(a<0||a>20)throw RangeError("Incorrect fraction digits");if(i!=i)return"NaN";if(i<=-1e21||i>=1e21)return String(i);if(i<0&&(l="-",i=-i),i>1e-21)if(n=(e=function(t){for(var e=0,n=t;n>=4096;)e+=12,n/=4096;for(;n>=2;)e+=1,n/=2;return e}(i*Ja(2,69,1))-69)<0?i*Ja(2,-e,1):i/Ja(2,e,1),n*=4503599627370496,(e=52-e)>0){for(c(0,n),r=a;r>=7;)c(1e7,0),r-=7;for(c(Ja(10,r,1),0),r=e-1;r>=23;)h(1<<23),r-=23;h(1<<r),c(1,1),h(2),u=p()}else c(0,n),c(1<<-e,0),u=p()+Xa.call("0",a);return u=a>0?l+((o=u.length)<=a?"0."+Xa.call("0",a-o)+u:u.slice(0,o-a)+"."+u.slice(o-a)):l+u}});var Ka=Object.assign,Qa=Object.defineProperty,ts=!Ka||a((function(){if(s&&1!==Ka({b:1},Ka(Qa({},"a",{enumerable:!0,get:function(){Qa(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},n=Symbol();return t[n]=7,"abcdefghijklmnopqrst".split("").forEach((function(t){e[t]=t})),7!=Ka({},t)[n]||"abcdefghijklmnopqrst"!=Nt(Ka({},e)).join("")}))?function(t,e){for(var n=Ft(t),r=arguments.length,o=1,i=Pt.f,a=c.f;r>o;)for(var l,u=m(arguments[o++]),h=i?Nt(u).concat(i(u)):Nt(u),p=h.length,d=0;p>d;)l=h[d++],s&&!a.call(u,l)||(n[l]=u[l]);return n}:Ka;Ht({target:"Object",stat:!0,forced:Object.assign!==ts},{assign:ts});var es=!a((function(){var t=Math.random();__defineSetter__.call(null,t,(function(){})),delete i[t]}));s&&Ht({target:"Object",proto:!0,forced:es},{__defineGetter__:function(t,e){M.f(Ft(this),t,{get:se(e),enumerable:!0,configurable:!0})}}),s&&Ht({target:"Object",proto:!0,forced:es},{__defineSetter__:function(t,e){M.f(Ft(this),t,{set:se(e),enumerable:!0,configurable:!0})}});var ns=c.f,rs=function(t){return function(e){for(var n,r=v(e),o=Nt(r),i=o.length,a=0,l=[];i>a;)n=o[a++],s&&!ns.call(r,n)||l.push(t?[n,r[n]]:r[n]);return l}},os={entries:rs(!0),values:rs(!1)},is=os.entries;Ht({target:"Object",stat:!0},{entries:function(t){return is(t)}});var as=fi.onFreeze,ss=Object.freeze,ls=a((function(){ss(1)}));Ht({target:"Object",stat:!0,forced:ls,sham:!di},{freeze:function(t){return ss&&y(t)?ss(as(t)):t}}),Ht({target:"Object",stat:!0},{fromEntries:function(t){var e={};return mi(t,(function(t,n){Qe(e,t,n)}),void 0,!0),e}});var us=I.f,cs=a((function(){us(1)}));Ht({target:"Object",stat:!0,forced:!s||cs,sham:!s},{getOwnPropertyDescriptor:function(t,e){return us(v(t),e)}}),Ht({target:"Object",stat:!0,sham:!s},{getOwnPropertyDescriptors:function(t){for(var e,n,r=v(t),o=I.f,i=xt(r),a={},s=0;i.length>s;)void 0!==(n=o(r,e=i[s++]))&&Qe(a,e,n);return a}});var hs=Jt.f,ps=a((function(){return!Object.getOwnPropertyNames(1)}));Ht({target:"Object",stat:!0,forced:ps},{getOwnPropertyNames:hs});var ds=a((function(){wr(1)}));Ht({target:"Object",stat:!0,forced:ds,sham:!gr},{getPrototypeOf:function(t){return wr(Ft(t))}});var fs=Object.is||function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e};Ht({target:"Object",stat:!0},{is:fs});var ms=Object.isExtensible,gs=a((function(){ms(1)}));Ht({target:"Object",stat:!0,forced:gs},{isExtensible:function(t){return!!y(t)&&(!ms||ms(t))}});var vs=Object.isFrozen,ys=a((function(){vs(1)}));Ht({target:"Object",stat:!0,forced:ys},{isFrozen:function(t){return!y(t)||!!vs&&vs(t)}});var ws=Object.isSealed,bs=a((function(){ws(1)}));Ht({target:"Object",stat:!0,forced:bs},{isSealed:function(t){return!y(t)||!!ws&&ws(t)}});var Ss=a((function(){Nt(1)}));Ht({target:"Object",stat:!0,forced:Ss},{keys:function(t){return Nt(Ft(t))}});var Es=I.f;s&&Ht({target:"Object",proto:!0,forced:es},{__lookupGetter__:function(t){var e,n=Ft(this),r=w(t,!0);do{if(e=Es(n,r))return e.get}while(n=wr(n))}});var Ps=I.f;s&&Ht({target:"Object",proto:!0,forced:es},{__lookupSetter__:function(t){var e,n=Ft(this),r=w(t,!0);do{if(e=Ps(n,r))return e.set}while(n=wr(n))}});var xs=fi.onFreeze,_s=Object.preventExtensions,Ts=a((function(){_s(1)}));Ht({target:"Object",stat:!0,forced:Ts,sham:!di},{preventExtensions:function(t){return _s&&y(t)?_s(xs(t)):t}});var Cs=fi.onFreeze,Is=Object.seal,Ds=a((function(){Is(1)}));Ht({target:"Object",stat:!0,forced:Ds,sham:!di},{seal:function(t){return Is&&y(t)?Is(Cs(t)):t}});var ks=Xn?{}.toString:function(){return"[object "+Jn(this)+"]"};Xn||ot(Object.prototype,"toString",ks,{unsafe:!0});var Ms=os.values;Ht({target:"Object",stat:!0},{values:function(t){return Ms(t)}});var Rs,As,Hs,Os=i.Promise,Ls=te("species"),Bs=function(t,e){var n,r=D(t).constructor;return void 0===r||null==(n=D(r)[Ls])?e:se(n)},Fs=/(iphone|ipod|ipad).*applewebkit/i.test(tn),Ns=i.location,js=i.setImmediate,Vs=i.clearImmediate,zs=i.process,Ws=i.MessageChannel,Gs=i.Dispatch,Us=0,Ys={},Xs=function(t){if(Ys.hasOwnProperty(t)){var e=Ys[t];delete Ys[t],e()}},Zs=function(t){return function(){Xs(t)}},qs=function(t){Xs(t.data)},Js=function(t){i.postMessage(t+"",Ns.protocol+"//"+Ns.host)};js&&Vs||(js=function(t){for(var e=[],n=1;arguments.length>n;)e.push(arguments[n++]);return Ys[++Us]=function(){("function"==typeof t?t:Function(t)).apply(void 0,e)},Rs(Us),Us},Vs=function(t){delete Ys[t]},"process"==d(zs)?Rs=function(t){zs.nextTick(Zs(t))}:Gs&&Gs.now?Rs=function(t){Gs.now(Zs(t))}:Ws&&!Fs?(Hs=(As=new Ws).port2,As.port1.onmessage=qs,Rs=le(Hs.postMessage,Hs,1)):!i.addEventListener||"function"!=typeof postMessage||i.importScripts||a(Js)||"file:"===Ns.protocol?Rs="onreadystatechange"in x("script")?function(t){Vt.appendChild(x("script")).onreadystatechange=function(){Vt.removeChild(this),Xs(t)}}:function(t){setTimeout(Zs(t),0)}:(Rs=Js,i.addEventListener("message",qs,!1)));var $s,Ks,Qs,tl,el,nl,rl,ol,il={set:js,clear:Vs},al=I.f,sl=il.set,ll=i.MutationObserver||i.WebKitMutationObserver,ul=i.process,cl=i.Promise,hl="process"==d(ul),pl=al(i,"queueMicrotask"),dl=pl&&pl.value;dl||($s=function(){var t,e;for(hl&&(t=ul.domain)&&t.exit();Ks;){e=Ks.fn,Ks=Ks.next;try{e()}catch(t){throw Ks?tl():Qs=void 0,t}}Qs=void 0,t&&t.enter()},hl?tl=function(){ul.nextTick($s)}:ll&&!Fs?(el=!0,nl=document.createTextNode(""),new ll($s).observe(nl,{characterData:!0}),tl=function(){nl.data=el=!el}):cl&&cl.resolve?(rl=cl.resolve(void 0),ol=rl.then,tl=function(){ol.call(rl,$s)}):tl=function(){sl.call(i,$s)});var fl,ml,gl,vl,yl=dl||function(t){var e={fn:t,next:void 0};Qs&&(Qs.next=e),Ks||(Ks=e,tl()),Qs=e},wl=function(t){var e,n;this.promise=new t((function(t,r){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=r})),this.resolve=se(e),this.reject=se(n)},bl={f:function(t){return new wl(t)}},Sl=function(t,e){if(D(t),y(e)&&e.constructor===t)return e;var n=bl.f(t);return(0,n.resolve)(e),n.promise},El=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},Pl=il.set,xl=te("species"),_l="Promise",Tl=rt.get,Cl=rt.set,Il=rt.getterFor(_l),Dl=Os,kl=i.TypeError,Ml=i.document,Rl=i.process,Al=st("fetch"),Hl=bl.f,Ol=Hl,Ll="process"==d(Rl),Bl=!!(Ml&&Ml.createEvent&&i.dispatchEvent),Fl=Rt(_l,(function(){if(!(N(Dl)!==String(Dl))){if(66===on)return!0;if(!Ll&&"function"!=typeof PromiseRejectionEvent)return!0}if(on>=51&&/native code/.test(Dl))return!1;var t=Dl.resolve(1),e=function(t){t((function(){}),(function(){}))};return(t.constructor={})[xl]=e,!(t.then((function(){}))instanceof e)})),Nl=Fl||!or((function(t){Dl.all(t).catch((function(){}))})),jl=function(t){var e;return!(!y(t)||"function"!=typeof(e=t.then))&&e},Vl=function(t,e,n){if(!e.notified){e.notified=!0;var r=e.reactions;yl((function(){for(var o=e.value,i=1==e.state,a=0;r.length>a;){var s,l,u,c=r[a++],h=i?c.ok:c.fail,p=c.resolve,d=c.reject,f=c.domain;try{h?(i||(2===e.rejection&&Ul(t,e),e.rejection=1),!0===h?s=o:(f&&f.enter(),s=h(o),f&&(f.exit(),u=!0)),s===c.promise?d(kl("Promise-chain cycle")):(l=jl(s))?l.call(s,p,d):p(s)):d(o)}catch(t){f&&!u&&f.exit(),d(t)}}e.reactions=[],e.notified=!1,n&&!e.rejection&&Wl(t,e)}))}},zl=function(t,e,n){var r,o;Bl?((r=Ml.createEvent("Event")).promise=e,r.reason=n,r.initEvent(t,!1,!0),i.dispatchEvent(r)):r={promise:e,reason:n},(o=i["on"+t])?o(r):"unhandledrejection"===t&&function(t,e){var n=i.console;n&&n.error&&(1===arguments.length?n.error(t):n.error(t,e))}("Unhandled promise rejection",n)},Wl=function(t,e){Pl.call(i,(function(){var n,r=e.value;if(Gl(e)&&(n=El((function(){Ll?Rl.emit("unhandledRejection",r,t):zl("unhandledrejection",t,r)})),e.rejection=Ll||Gl(e)?2:1,n.error))throw n.value}))},Gl=function(t){return 1!==t.rejection&&!t.parent},Ul=function(t,e){Pl.call(i,(function(){Ll?Rl.emit("rejectionHandled",t):zl("rejectionhandled",t,e.value)}))},Yl=function(t,e,n,r){return function(o){t(e,n,o,r)}},Xl=function(t,e,n,r){e.done||(e.done=!0,r&&(e=r),e.value=n,e.state=2,Vl(t,e,!0))},Zl=function(t,e,n,r){if(!e.done){e.done=!0,r&&(e=r);try{if(t===n)throw kl("Promise can't be resolved itself");var o=jl(n);o?yl((function(){var r={done:!1};try{o.call(n,Yl(Zl,t,r,e),Yl(Xl,t,r,e))}catch(n){Xl(t,r,n,e)}})):(e.value=n,e.state=1,Vl(t,e,!1))}catch(n){Xl(t,{done:!1},n,e)}}};Fl&&(Dl=function(t){bo(this,Dl,_l),se(t),fl.call(this);var e=Tl(this);try{t(Yl(Zl,this,e),Yl(Xl,this,e))}catch(t){Xl(this,e,t)}},(fl=function(t){Cl(this,{type:_l,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=wo(Dl.prototype,{then:function(t,e){var n=Il(this),r=Hl(Bs(this,Dl));return r.ok="function"!=typeof t||t,r.fail="function"==typeof e&&e,r.domain=Ll?Rl.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&Vl(this,n,!1),r.promise},catch:function(t){return this.then(void 0,t)}}),ml=function(){var t=new fl,e=Tl(t);this.promise=t,this.resolve=Yl(Zl,t,e),this.reject=Yl(Xl,t,e)},bl.f=Hl=function(t){return t===Dl||t===gl?new ml(t):Ol(t)},"function"==typeof Os&&(vl=Os.prototype.then,ot(Os.prototype,"then",(function(t,e){var n=this;return new Dl((function(t,e){vl.call(n,t,e)})).then(t,e)}),{unsafe:!0}),"function"==typeof Al&&Ht({global:!0,enumerable:!0,forced:!0},{fetch:function(t){return Sl(Dl,Al.apply(i,arguments))}}))),Ht({global:!0,wrap:!0,forced:Fl},{Promise:Dl}),ae(Dl,_l,!1),po(_l),gl=st(_l),Ht({target:_l,stat:!0,forced:Fl},{reject:function(t){var e=Hl(this);return e.reject.call(void 0,t),e.promise}}),Ht({target:_l,stat:!0,forced:Fl},{resolve:function(t){return Sl(this,t)}}),Ht({target:_l,stat:!0,forced:Nl},{all:function(t){var e=this,n=Hl(e),r=n.resolve,o=n.reject,i=El((function(){var n=se(e.resolve),i=[],a=0,s=1;mi(t,(function(t){var l=a++,u=!1;i.push(void 0),s++,n.call(e,t).then((function(t){u||(u=!0,i[l]=t,--s||r(i))}),o)})),--s||r(i)}));return i.error&&o(i.value),n.promise},race:function(t){var e=this,n=Hl(e),r=n.reject,o=El((function(){var o=se(e.resolve);mi(t,(function(t){o.call(e,t).then(n.resolve,r)}))}));return o.error&&r(o.value),n.promise}});var ql=!!Os&&a((function(){Os.prototype.finally.call({then:function(){}},(function(){}))}));Ht({target:"Promise",proto:!0,real:!0,forced:ql},{finally:function(t){var e=Bs(this,st("Promise")),n="function"==typeof t;return this.then(n?function(n){return Sl(e,t()).then((function(){return n}))}:t,n?function(n){return Sl(e,t()).then((function(){throw n}))}:t)}}),"function"!=typeof Os||Os.prototype.finally||ot(Os.prototype,"finally",st("Promise").prototype.finally);var Jl=st("Reflect","apply"),$l=Function.apply,Kl=!a((function(){Jl((function(){}))}));Ht({target:"Reflect",stat:!0,forced:Kl},{apply:function(t,e,n){return se(t),D(n),Jl?Jl(t,e,n):$l.call(t,e,n)}});var Ql=[].slice,tu={},eu=function(t,e,n){if(!(e in tu)){for(var r=[],o=0;o<e;o++)r[o]="a["+o+"]";tu[e]=Function("C,a","return new C("+r.join(",")+")")}return tu[e](t,n)},nu=Function.bind||function(t){var e=se(this),n=Ql.call(arguments,1),r=function(){var o=n.concat(Ql.call(arguments));return this instanceof r?eu(e,o.length,o):e.apply(t,o)};return y(e.prototype)&&(r.prototype=e.prototype),r},ru=st("Reflect","construct"),ou=a((function(){function t(){}return!(ru((function(){}),[],t)instanceof t)})),iu=!a((function(){ru((function(){}))})),au=ou||iu;Ht({target:"Reflect",stat:!0,forced:au,sham:au},{construct:function(t,e){se(t),D(e);var n=arguments.length<3?t:se(arguments[2]);if(iu&&!ou)return ru(t,e,n);if(t==n){switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3])}var r=[null];return r.push.apply(r,e),new(nu.apply(t,r))}var o=n.prototype,i=Yt(y(o)?o:Object.prototype),a=Function.apply.call(t,i,e);return y(a)?a:i}});var su=a((function(){Reflect.defineProperty(M.f({},1,{value:1}),1,{value:2})}));Ht({target:"Reflect",stat:!0,forced:su,sham:!s},{defineProperty:function(t,e,n){D(t);var r=w(e,!0);D(n);try{return M.f(t,r,n),!0}catch(t){return!1}}});var lu=I.f;Ht({target:"Reflect",stat:!0},{deleteProperty:function(t,e){var n=lu(D(t),e);return!(n&&!n.configurable)&&delete t[e]}}),Ht({target:"Reflect",stat:!0},{get:function t(e,n){var r,o,i=arguments.length<3?e:arguments[2];return D(e)===i?e[n]:(r=I.f(e,n))?S(r,"value")?r.value:void 0===r.get?void 0:r.get.call(i):y(o=wr(e))?t(o,n,i):void 0}}),Ht({target:"Reflect",stat:!0,sham:!s},{getOwnPropertyDescriptor:function(t,e){return I.f(D(t),e)}}),Ht({target:"Reflect",stat:!0,sham:!gr},{getPrototypeOf:function(t){return wr(D(t))}}),Ht({target:"Reflect",stat:!0},{has:function(t,e){return e in t}});var uu=Object.isExtensible;Ht({target:"Reflect",stat:!0},{isExtensible:function(t){return D(t),!uu||uu(t)}}),Ht({target:"Reflect",stat:!0},{ownKeys:xt}),Ht({target:"Reflect",stat:!0,sham:!di},{preventExtensions:function(t){D(t);try{var e=st("Object","preventExtensions");return e&&e(t),!0}catch(t){return!1}}});var cu=a((function(){var t=M.f({},"a",{configurable:!0});return!1!==Reflect.set(wr(t),"a",1,t)}));Ht({target:"Reflect",stat:!0,forced:cu},{set:function t(e,n,r){var o,i,a=arguments.length<4?e:arguments[3],s=I.f(D(e),n);if(!s){if(y(i=wr(e)))return t(i,n,r,a);s=h(0)}if(S(s,"value")){if(!1===s.writable||!y(a))return!1;if(o=I.f(a,n)){if(o.get||o.set||!1===o.writable)return!1;o.value=r,M.f(a,n,o)}else M.f(a,n,h(0,r));return!0}return void 0!==s.set&&(s.set.call(a,r),!0)}}),Cr&&Ht({target:"Reflect",stat:!0},{setPrototypeOf:function(t,e){D(t),Tr(e);try{return Cr(t,e),!0}catch(t){return!1}}});var hu=te("match"),pu=function(t){var e;return y(t)&&(void 0!==(e=t[hu])?!!e:"RegExp"==d(t))},du=function(){var t=D(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e};function fu(t,e){return RegExp(t,e)}var mu={UNSUPPORTED_Y:a((function(){var t=fu("a","y");return t.lastIndex=2,null!=t.exec("abcd")})),BROKEN_CARET:a((function(){var t=fu("^r","gy");return t.lastIndex=2,null!=t.exec("str")}))},gu=M.f,vu=Et.f,yu=rt.set,wu=te("match"),bu=i.RegExp,Su=bu.prototype,Eu=/a/g,Pu=/a/g,xu=new bu(Eu)!==Eu,_u=mu.UNSUPPORTED_Y;if(s&&Rt("RegExp",!xu||_u||a((function(){return Pu[wu]=!1,bu(Eu)!=Eu||bu(Pu)==Pu||"/a/i"!=bu(Eu,"i")})))){for(var Tu=function(t,e){var n,r=this instanceof Tu,o=pu(t),i=void 0===e;if(!r&&o&&t.constructor===Tu&&i)return t;xu?o&&!i&&(t=t.source):t instanceof Tu&&(i&&(e=du.call(t)),t=t.source),_u&&(n=!!e&&e.indexOf("y")>-1)&&(e=e.replace(/y/g,""));var a=gi(xu?new bu(t,e):bu(t,e),r?this:Su,Tu);return _u&&n&&yu(a,{sticky:n}),a},Cu=function(t){t in Tu||gu(Tu,t,{configurable:!0,get:function(){return bu[t]},set:function(e){bu[t]=e}})},Iu=vu(bu),Du=0;Iu.length>Du;)Cu(Iu[Du++]);Su.constructor=Tu,Tu.prototype=Su,ot(i,"RegExp",Tu)}po("RegExp");var ku=RegExp.prototype.exec,Mu=String.prototype.replace,Ru=ku,Au=function(){var t=/a/,e=/b*/g;return ku.call(t,"a"),ku.call(e,"a"),0!==t.lastIndex||0!==e.lastIndex}(),Hu=mu.UNSUPPORTED_Y||mu.BROKEN_CARET,Ou=void 0!==/()??/.exec("")[1];(Au||Ou||Hu)&&(Ru=function(t){var e,n,r,o,i=this,a=Hu&&i.sticky,s=du.call(i),l=i.source,u=0,c=t;return a&&(-1===(s=s.replace("y","")).indexOf("g")&&(s+="g"),c=String(t).slice(i.lastIndex),i.lastIndex>0&&(!i.multiline||i.multiline&&"\n"!==t[i.lastIndex-1])&&(l="(?: "+l+")",c=" "+c,u++),n=new RegExp("^(?:"+l+")",s)),Ou&&(n=new RegExp("^"+l+"$(?!\\s)",s)),Au&&(e=i.lastIndex),r=ku.call(a?n:i,c),a?r?(r.input=r.input.slice(u),r[0]=r[0].slice(u),r.index=i.lastIndex,i.lastIndex+=r[0].length):i.lastIndex=0:Au&&r&&(i.lastIndex=i.global?r.index+r[0].length:e),Ou&&r&&r.length>1&&Mu.call(r[0],n,(function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(r[o]=void 0)})),r});var Lu=Ru;Ht({target:"RegExp",proto:!0,forced:/./.exec!==Lu},{exec:Lu}),s&&("g"!=/./g.flags||mu.UNSUPPORTED_Y)&&M.f(RegExp.prototype,"flags",{configurable:!0,get:du});var Bu=RegExp.prototype,Fu=Bu.toString,Nu=a((function(){return"/a/b"!=Fu.call({source:"a",flags:"b"})})),ju="toString"!=Fu.name;(Nu||ju)&&ot(RegExp.prototype,"toString",(function(){var t=D(this),e=String(t.source),n=t.flags;return"/"+e+"/"+String(void 0===n&&t instanceof RegExp&&!("flags"in Bu)?du.call(t):n)}),{unsafe:!0});vi("Set",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),Ei);var Vu=function(t){return function(e,n){var r,o,i=String(g(e)),a=ct(n),s=i.length;return a<0||a>=s?t?"":void 0:(r=i.charCodeAt(a))<55296||r>56319||a+1===s||(o=i.charCodeAt(a+1))<56320||o>57343?t?i.charAt(a):r:t?i.slice(a,a+2):o-56320+(r-55296<<10)+65536}},zu={codeAt:Vu(!1),charAt:Vu(!0)},Wu=zu.codeAt;Ht({target:"String",proto:!0},{codePointAt:function(t){return Wu(this,t)}});var Gu,Uu=function(t){if(pu(t))throw TypeError("The method doesn't accept regular expressions");return t},Yu=te("match"),Xu=function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[Yu]=!1,"/./"[t](e)}catch(t){}}return!1},Zu=I.f,qu="".endsWith,Ju=Math.min,$u=Xu("endsWith"),Ku=!($u||(Gu=Zu(String.prototype,"endsWith"),!Gu||Gu.writable));Ht({target:"String",proto:!0,forced:!Ku&&!$u},{endsWith:function(t){var e=String(g(this));Uu(t);var n=arguments.length>1?arguments[1]:void 0,r=pt(e.length),o=void 0===n?r:Ju(pt(n),r),i=String(t);return qu?qu.call(e,i,o):e.slice(o-i.length,o)===i}});var Qu=String.fromCharCode,tc=String.fromCodePoint,ec=!!tc&&1!=tc.length;Ht({target:"String",stat:!0,forced:ec},{fromCodePoint:function(t){for(var e,n=[],r=arguments.length,o=0;r>o;){if(e=+arguments[o++],mt(e,1114111)!==e)throw RangeError(e+" is not a valid code point");n.push(e<65536?Qu(e):Qu(55296+((e-=65536)>>10),e%1024+56320))}return n.join("")}}),Ht({target:"String",proto:!0,forced:!Xu("includes")},{includes:function(t){return!!~String(g(this)).indexOf(Uu(t),arguments.length>1?arguments[1]:void 0)}});var nc=zu.charAt,rc=rt.set,oc=rt.getterFor("String Iterator");Rr(String,"String",(function(t){rc(this,{type:"String Iterator",string:String(t),index:0})}),(function(){var t,e=oc(this),n=e.string,r=e.index;return r>=n.length?{value:void 0,done:!0}:(t=nc(n,r),e.index+=t.length,{value:t,done:!1})}));var ic=te("species"),ac=!a((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")})),sc="$0"==="a".replace(/./,"$0"),lc=te("replace"),uc=!!/./[lc]&&""===/./[lc]("a","$0"),cc=!a((function(){var t=/(?:)/,e=t.exec;t.exec=function(){return e.apply(this,arguments)};var n="ab".split(t);return 2!==n.length||"a"!==n[0]||"b"!==n[1]})),hc=function(t,e,n,r){var o=te(t),i=!a((function(){var e={};return e[o]=function(){return 7},7!=""[t](e)})),s=i&&!a((function(){var e=!1,n=/a/;return"split"===t&&((n={}).constructor={},n.constructor[ic]=function(){return n},n.flags="",n[o]=/./[o]),n.exec=function(){return e=!0,null},n[o](""),!e}));if(!i||!s||"replace"===t&&(!ac||!sc||uc)||"split"===t&&!cc){var l=/./[o],u=n(o,""[t],(function(t,e,n,r,o){return e.exec===Lu?i&&!o?{done:!0,value:l.call(e,n,r)}:{done:!0,value:t.call(n,e,r)}:{done:!1}}),{REPLACE_KEEPS_$0:sc,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:uc}),c=u[0],h=u[1];ot(String.prototype,t,c),ot(RegExp.prototype,o,2==e?function(t,e){return h.call(t,this,e)}:function(t){return h.call(t,this)})}r&&R(RegExp.prototype[o],"sham",!0)},pc=zu.charAt,dc=function(t,e,n){return e+(n?pc(t,e).length:1)},fc=function(t,e){var n=t.exec;if("function"==typeof n){var r=n.call(t,e);if("object"!=typeof r)throw TypeError("RegExp exec method returned something other than an Object or null");return r}if("RegExp"!==d(t))throw TypeError("RegExp#exec called on incompatible receiver");return Lu.call(t,e)};hc("match",1,(function(t,e,n){return[function(e){var n=g(this),r=null==e?void 0:e[t];return void 0!==r?r.call(e,n):new RegExp(e)[t](String(n))},function(t){var r=n(e,t,this);if(r.done)return r.value;var o=D(t),i=String(this);if(!o.global)return fc(o,i);var a=o.unicode;o.lastIndex=0;for(var s,l=[],u=0;null!==(s=fc(o,i));){var c=String(s[0]);l[u]=c,""===c&&(o.lastIndex=dc(i,pt(o.lastIndex),a)),u++}return 0===u?null:l}]}));var mc=Math.ceil,gc=function(t){return function(e,n,r){var o,i,a=String(g(e)),s=a.length,l=void 0===r?" ":String(r),u=pt(n);return u<=s||""==l?a:(o=u-s,(i=Xa.call(l,mc(o/l.length))).length>o&&(i=i.slice(0,o)),t?a+i:i+a)}},vc={start:gc(!1),end:gc(!0)},yc=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(tn),wc=vc.end;Ht({target:"String",proto:!0,forced:yc},{padEnd:function(t){return wc(this,t,arguments.length>1?arguments[1]:void 0)}});var bc=vc.start;Ht({target:"String",proto:!0,forced:yc},{padStart:function(t){return bc(this,t,arguments.length>1?arguments[1]:void 0)}}),Ht({target:"String",stat:!0},{raw:function(t){for(var e=v(t.raw),n=pt(e.length),r=arguments.length,o=[],i=0;n>i;)o.push(String(e[i++])),i<r&&o.push(String(arguments[i]));return o.join("")}}),Ht({target:"String",proto:!0},{repeat:Xa});var Sc=Math.max,Ec=Math.min,Pc=Math.floor,xc=/\$([$&'`]|\d\d?|<[^>]*>)/g,_c=/\$([$&'`]|\d\d?)/g;hc("replace",2,(function(t,e,n,r){var o=r.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,i=r.REPLACE_KEEPS_$0,a=o?"$":"$0";return[function(n,r){var o=g(this),i=null==n?void 0:n[t];return void 0!==i?i.call(n,o,r):e.call(String(o),n,r)},function(t,r){if(!o&&i||"string"==typeof r&&-1===r.indexOf(a)){var l=n(e,t,this,r);if(l.done)return l.value}var u=D(t),c=String(this),h="function"==typeof r;h||(r=String(r));var p=u.global;if(p){var d=u.unicode;u.lastIndex=0}for(var f=[];;){var m=fc(u,c);if(null===m)break;if(f.push(m),!p)break;""===String(m[0])&&(u.lastIndex=dc(c,pt(u.lastIndex),d))}for(var g,v="",y=0,w=0;w<f.length;w++){m=f[w];for(var b=String(m[0]),S=Sc(Ec(ct(m.index),c.length),0),E=[],P=1;P<m.length;P++)E.push(void 0===(g=m[P])?g:String(g));var x=m.groups;if(h){var _=[b].concat(E,S,c);void 0!==x&&_.push(x);var T=String(r.apply(void 0,_))}else T=s(b,c,S,E,x,r);S>=y&&(v+=c.slice(y,S)+T,y=S+b.length)}return v+c.slice(y)}];function s(t,n,r,o,i,a){var s=r+t.length,l=o.length,u=_c;return void 0!==i&&(i=Ft(i),u=xc),e.call(a,u,(function(e,a){var u;switch(a.charAt(0)){case"$":return"$";case"&":return t;case"`":return n.slice(0,r);case"'":return n.slice(s);case"<":u=i[a.slice(1,-1)];break;default:var c=+a;if(0===c)return e;if(c>l){var h=Pc(c/10);return 0===h?e:h<=l?void 0===o[h-1]?a.charAt(1):o[h-1]+a.charAt(1):e}u=o[c-1]}return void 0===u?"":u}))}})),hc("search",1,(function(t,e,n){return[function(e){var n=g(this),r=null==e?void 0:e[t];return void 0!==r?r.call(e,n):new RegExp(e)[t](String(n))},function(t){var r=n(e,t,this);if(r.done)return r.value;var o=D(t),i=String(this),a=o.lastIndex;fs(a,0)||(o.lastIndex=0);var s=fc(o,i);return fs(o.lastIndex,a)||(o.lastIndex=a),null===s?-1:s.index}]}));var Tc=[].push,Cc=Math.min,Ic=!a((function(){return!RegExp(4294967295,"y")}));hc("split",2,(function(t,e,n){var r;return r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(t,n){var r=String(g(this)),o=void 0===n?4294967295:n>>>0;if(0===o)return[];if(void 0===t)return[r];if(!pu(t))return e.call(r,t,o);for(var i,a,s,l=[],u=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),c=0,h=new RegExp(t.source,u+"g");(i=Lu.call(h,r))&&!((a=h.lastIndex)>c&&(l.push(r.slice(c,i.index)),i.length>1&&i.index<r.length&&Tc.apply(l,i.slice(1)),s=i[0].length,c=a,l.length>=o));)h.lastIndex===i.index&&h.lastIndex++;return c===r.length?!s&&h.test("")||l.push(""):l.push(r.slice(c)),l.length>o?l.slice(0,o):l}:"0".split(void 0,0).length?function(t,n){return void 0===t&&0===n?[]:e.call(this,t,n)}:e,[function(e,n){var o=g(this),i=null==e?void 0:e[t];return void 0!==i?i.call(e,o,n):r.call(String(o),e,n)},function(t,o){var i=n(r,t,this,o,r!==e);if(i.done)return i.value;var a=D(t),s=String(this),l=Bs(a,RegExp),u=a.unicode,c=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.unicode?"u":"")+(Ic?"y":"g"),h=new l(Ic?a:"^(?:"+a.source+")",c),p=void 0===o?4294967295:o>>>0;if(0===p)return[];if(0===s.length)return null===fc(h,s)?[s]:[];for(var d=0,f=0,m=[];f<s.length;){h.lastIndex=Ic?f:0;var g,v=fc(h,Ic?s:s.slice(f));if(null===v||(g=Cc(pt(h.lastIndex+(Ic?0:f)),s.length))===d)f=dc(s,f,u);else{if(m.push(s.slice(d,f)),m.length===p)return m;for(var y=1;y<=v.length-1;y++)if(m.push(v[y]),m.length===p)return m;f=d=g}}return m.push(s.slice(d)),m}]}),!Ic);var Dc=I.f,kc="".startsWith,Mc=Math.min,Rc=Xu("startsWith"),Ac=!Rc&&!!function(){var t=Dc(String.prototype,"startsWith");return t&&!t.writable}();Ht({target:"String",proto:!0,forced:!Ac&&!Rc},{startsWith:function(t){var e=String(g(this));Uu(t);var n=pt(Mc(arguments.length>1?arguments[1]:void 0,e.length)),r=String(t);return kc?kc.call(e,r,n):e.slice(n,n+r.length)===r}});var Hc=function(t){return a((function(){return!!va[t]()||"​᠎"!="​᠎"[t]()||va[t].name!==t}))},Oc=Ea.trim;Ht({target:"String",proto:!0,forced:Hc("trim")},{trim:function(){return Oc(this)}});var Lc=Ea.end,Bc=Hc("trimEnd"),Fc=Bc?function(){return Lc(this)}:"".trimEnd;Ht({target:"String",proto:!0,forced:Bc},{trimEnd:Fc,trimRight:Fc});var Nc=Ea.start,jc=Hc("trimStart"),Vc=jc?function(){return Nc(this)}:"".trimStart;Ht({target:"String",proto:!0,forced:jc},{trimStart:Vc,trimLeft:Vc});var zc=/"/g,Wc=function(t,e,n,r){var o=String(g(t)),i="<"+e;return""!==n&&(i+=" "+n+'="'+String(r).replace(zc,"&quot;")+'"'),i+">"+o+"</"+e+">"},Gc=function(t){return a((function(){var e=""[t]('"');return e!==e.toLowerCase()||e.split('"').length>3}))};Ht({target:"String",proto:!0,forced:Gc("anchor")},{anchor:function(t){return Wc(this,"a","name",t)}}),Ht({target:"String",proto:!0,forced:Gc("big")},{big:function(){return Wc(this,"big","","")}}),Ht({target:"String",proto:!0,forced:Gc("blink")},{blink:function(){return Wc(this,"blink","","")}}),Ht({target:"String",proto:!0,forced:Gc("bold")},{bold:function(){return Wc(this,"b","","")}}),Ht({target:"String",proto:!0,forced:Gc("fixed")},{fixed:function(){return Wc(this,"tt","","")}}),Ht({target:"String",proto:!0,forced:Gc("fontcolor")},{fontcolor:function(t){return Wc(this,"font","color",t)}}),Ht({target:"String",proto:!0,forced:Gc("fontsize")},{fontsize:function(t){return Wc(this,"font","size",t)}}),Ht({target:"String",proto:!0,forced:Gc("italics")},{italics:function(){return Wc(this,"i","","")}}),Ht({target:"String",proto:!0,forced:Gc("link")},{link:function(t){return Wc(this,"a","href",t)}}),Ht({target:"String",proto:!0,forced:Gc("small")},{small:function(){return Wc(this,"small","","")}}),Ht({target:"String",proto:!0,forced:Gc("strike")},{strike:function(){return Wc(this,"strike","","")}}),Ht({target:"String",proto:!0,forced:Gc("sub")},{sub:function(){return Wc(this,"sub","","")}}),Ht({target:"String",proto:!0,forced:Gc("sup")},{sup:function(){return Wc(this,"sup","","")}});var Uc,Yc=M.f,Xc=i.Int8Array,Zc=Xc&&Xc.prototype,qc=i.Uint8ClampedArray,Jc=qc&&qc.prototype,$c=Xc&&wr(Xc),Kc=Zc&&wr(Zc),Qc=Object.prototype,th=Qc.isPrototypeOf,eh=te("toStringTag"),nh=U("TYPED_ARRAY_TAG"),rh=yo&&!!Cr&&"Opera"!==Jn(i.opera),oh=!1,ih={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},ah=function(t){return y(t)&&S(ih,Jn(t))};for(Uc in ih)i[Uc]||(rh=!1);if((!rh||"function"!=typeof $c||$c===Function.prototype)&&($c=function(){throw TypeError("Incorrect invocation")},rh))for(Uc in ih)i[Uc]&&Cr(i[Uc],$c);if((!rh||!Kc||Kc===Qc)&&(Kc=$c.prototype,rh))for(Uc in ih)i[Uc]&&Cr(i[Uc].prototype,Kc);if(rh&&wr(Jc)!==Kc&&Cr(Jc,Kc),s&&!S(Kc,eh))for(Uc in oh=!0,Yc(Kc,eh,{get:function(){return y(this)?this[nh]:void 0}}),ih)i[Uc]&&R(i[Uc],nh,Uc);var sh={NATIVE_ARRAY_BUFFER_VIEWS:rh,TYPED_ARRAY_TAG:oh&&nh,aTypedArray:function(t){if(ah(t))return t;throw TypeError("Target is not a typed array")},aTypedArrayConstructor:function(t){if(Cr){if(th.call($c,t))return t}else for(var e in ih)if(S(ih,Uc)){var n=i[e];if(n&&(t===n||th.call(n,t)))return t}throw TypeError("Target is not a typed array constructor")},exportTypedArrayMethod:function(t,e,n){if(s){if(n)for(var r in ih){var o=i[r];o&&S(o.prototype,t)&&delete o.prototype[t]}Kc[t]&&!n||ot(Kc,t,n?e:rh&&Zc[t]||e)}},exportTypedArrayStaticMethod:function(t,e,n){var r,o;if(s){if(Cr){if(n)for(r in ih)(o=i[r])&&S(o,t)&&delete o[t];if($c[t]&&!n)return;try{return ot($c,t,n?e:rh&&Xc[t]||e)}catch(t){}}for(r in ih)!(o=i[r])||o[t]&&!n||ot(o,t,e)}},isView:function(t){var e=Jn(t);return"DataView"===e||S(ih,e)},isTypedArray:ah,TypedArray:$c,TypedArrayPrototype:Kc},lh=sh.NATIVE_ARRAY_BUFFER_VIEWS,uh=i.ArrayBuffer,ch=i.Int8Array,hh=!lh||!a((function(){ch(1)}))||!a((function(){new ch(-1)}))||!or((function(t){new ch,new ch(null),new ch(1.5),new ch(t)}),!0)||a((function(){return 1!==new ch(new uh(2),1,void 0).length})),ph=function(t,e){var n=function(t){var e=ct(t);if(e<0)throw RangeError("The argument can't be less than 0");return e}(t);if(n%e)throw RangeError("Wrong offset");return n},dh=sh.aTypedArrayConstructor,fh=function(t){var e,n,r,o,i,a,s=Ft(t),l=arguments.length,u=l>1?arguments[1]:void 0,c=void 0!==u,h=Kn(s);if(null!=h&&!Un(h))for(a=(i=h.call(s)).next,s=[];!(o=a.call(i)).done;)s.push(o.value);for(c&&l>2&&(u=le(u,arguments[2],2)),n=pt(s.length),r=new(dh(this))(n),e=0;n>e;e++)r[e]=c?u(s[e],e):s[e];return r},mh=r((function(t){var e=Et.f,n=de.forEach,r=rt.get,o=rt.set,a=M.f,l=I.f,u=Math.round,c=i.RangeError,p=ni.ArrayBuffer,d=ni.DataView,f=sh.NATIVE_ARRAY_BUFFER_VIEWS,m=sh.TYPED_ARRAY_TAG,g=sh.TypedArray,v=sh.TypedArrayPrototype,b=sh.aTypedArrayConstructor,E=sh.isTypedArray,P=function(t,e){for(var n=0,r=e.length,o=new(b(t))(r);r>n;)o[n]=e[n++];return o},x=function(t,e){a(t,e,{get:function(){return r(this)[e]}})},_=function(t){var e;return t instanceof p||"ArrayBuffer"==(e=Jn(t))||"SharedArrayBuffer"==e},T=function(t,e){return E(t)&&"symbol"!=typeof e&&e in t&&String(+e)==String(e)},C=function(t,e){return T(t,e=w(e,!0))?h(2,t[e]):l(t,e)},D=function(t,e,n){return!(T(t,e=w(e,!0))&&y(n)&&S(n,"value"))||S(n,"get")||S(n,"set")||n.configurable||S(n,"writable")&&!n.writable||S(n,"enumerable")&&!n.enumerable?a(t,e,n):(t[e]=n.value,t)};s?(f||(I.f=C,M.f=D,x(v,"buffer"),x(v,"byteOffset"),x(v,"byteLength"),x(v,"length")),Ht({target:"Object",stat:!0,forced:!f},{getOwnPropertyDescriptor:C,defineProperty:D}),t.exports=function(t,s,l){var h=t.match(/\d+$/)[0]/8,w=t+(l?"Clamped":"")+"Array",b="get"+t,S="set"+t,x=i[w],T=x,C=T&&T.prototype,I={},D=function(t,e){a(t,e,{get:function(){return function(t,e){var n=r(t);return n.view[b](e*h+n.byteOffset,!0)}(this,e)},set:function(t){return function(t,e,n){var o=r(t);l&&(n=(n=u(n))<0?0:n>255?255:255&n),o.view[S](e*h+o.byteOffset,n,!0)}(this,e,t)},enumerable:!0})};f?hh&&(T=s((function(t,e,n,r){return bo(t,T,w),gi(y(e)?_(e)?void 0!==r?new x(e,ph(n,h),r):void 0!==n?new x(e,ph(n,h)):new x(e):E(e)?P(T,e):fh.call(T,e):new x(So(e)),t,T)})),Cr&&Cr(T,g),n(e(x),(function(t){t in T||R(T,t,x[t])})),T.prototype=C):(T=s((function(t,e,n,r){bo(t,T,w);var i,a,s,l=0,u=0;if(y(e)){if(!_(e))return E(e)?P(T,e):fh.call(T,e);i=e,u=ph(n,h);var f=e.byteLength;if(void 0===r){if(f%h)throw c("Wrong length");if((a=f-u)<0)throw c("Wrong length")}else if((a=pt(r)*h)+u>f)throw c("Wrong length");s=a/h}else s=So(e),i=new p(a=s*h);for(o(t,{buffer:i,byteOffset:u,byteLength:a,length:s,view:new d(i)});l<s;)D(t,l++)})),Cr&&Cr(T,g),C=T.prototype=Yt(v)),C.constructor!==T&&R(C,"constructor",T),m&&R(C,m,w),I[w]=T,Ht({global:!0,forced:T!=x,sham:!f},I),"BYTES_PER_ELEMENT"in T||R(T,"BYTES_PER_ELEMENT",h),"BYTES_PER_ELEMENT"in C||R(C,"BYTES_PER_ELEMENT",h),po(w)}):t.exports=function(){}}));mh("Float32",(function(t){return function(e,n,r){return t(this,e,n,r)}})),mh("Float64",(function(t){return function(e,n,r){return t(this,e,n,r)}})),mh("Int8",(function(t){return function(e,n,r){return t(this,e,n,r)}})),mh("Int16",(function(t){return function(e,n,r){return t(this,e,n,r)}})),mh("Int32",(function(t){return function(e,n,r){return t(this,e,n,r)}})),mh("Uint8",(function(t){return function(e,n,r){return t(this,e,n,r)}})),mh("Uint8",(function(t){return function(e,n,r){return t(this,e,n,r)}}),!0),mh("Uint16",(function(t){return function(e,n,r){return t(this,e,n,r)}})),mh("Uint32",(function(t){return function(e,n,r){return t(this,e,n,r)}}));var gh=sh.aTypedArray;(0,sh.exportTypedArrayMethod)("copyWithin",(function(t,e){return dn.call(gh(this),t,e,arguments.length>2?arguments[2]:void 0)}));var vh=de.every,yh=sh.aTypedArray;(0,sh.exportTypedArrayMethod)("every",(function(t){return vh(yh(this),t,arguments.length>1?arguments[1]:void 0)}));var wh=sh.aTypedArray;(0,sh.exportTypedArrayMethod)("fill",(function(t){return _n.apply(wh(this),arguments)}));var bh=de.filter,Sh=sh.aTypedArray,Eh=sh.aTypedArrayConstructor;(0,sh.exportTypedArrayMethod)("filter",(function(t){for(var e=bh(Sh(this),t,arguments.length>1?arguments[1]:void 0),n=Bs(this,this.constructor),r=0,o=e.length,i=new(Eh(n))(o);o>r;)i[r]=e[r++];return i}));var Ph=de.find,xh=sh.aTypedArray;(0,sh.exportTypedArrayMethod)("find",(function(t){return Ph(xh(this),t,arguments.length>1?arguments[1]:void 0)}));var _h=de.findIndex,Th=sh.aTypedArray;(0,sh.exportTypedArrayMethod)("findIndex",(function(t){return _h(Th(this),t,arguments.length>1?arguments[1]:void 0)}));var Ch=de.forEach,Ih=sh.aTypedArray;(0,sh.exportTypedArrayMethod)("forEach",(function(t){Ch(Ih(this),t,arguments.length>1?arguments[1]:void 0)})),(0,sh.exportTypedArrayStaticMethod)("from",fh,hh);var Dh=vt.includes,kh=sh.aTypedArray;(0,sh.exportTypedArrayMethod)("includes",(function(t){return Dh(kh(this),t,arguments.length>1?arguments[1]:void 0)}));var Mh=vt.indexOf,Rh=sh.aTypedArray;(0,sh.exportTypedArrayMethod)("indexOf",(function(t){return Mh(Rh(this),t,arguments.length>1?arguments[1]:void 0)}));var Ah=te("iterator"),Hh=i.Uint8Array,Oh=Or.values,Lh=Or.keys,Bh=Or.entries,Fh=sh.aTypedArray,Nh=sh.exportTypedArrayMethod,jh=Hh&&Hh.prototype[Ah],Vh=!!jh&&("values"==jh.name||null==jh.name),zh=function(){return Oh.call(Fh(this))};Nh("entries",(function(){return Bh.call(Fh(this))})),Nh("keys",(function(){return Lh.call(Fh(this))})),Nh("values",zh,!Vh),Nh(Ah,zh,!Vh);var Wh=sh.aTypedArray,Gh=[].join;(0,sh.exportTypedArrayMethod)("join",(function(t){return Gh.apply(Wh(this),arguments)}));var Uh=sh.aTypedArray;(0,sh.exportTypedArrayMethod)("lastIndexOf",(function(t){return Gr.apply(Uh(this),arguments)}));var Yh=de.map,Xh=sh.aTypedArray,Zh=sh.aTypedArrayConstructor;(0,sh.exportTypedArrayMethod)("map",(function(t){return Yh(Xh(this),t,arguments.length>1?arguments[1]:void 0,(function(t,e){return new(Zh(Bs(t,t.constructor)))(e)}))}));var qh=sh.aTypedArrayConstructor;(0,sh.exportTypedArrayStaticMethod)("of",(function(){for(var t=0,e=arguments.length,n=new(qh(this))(e);e>t;)n[t]=arguments[t++];return n}),hh);var Jh=Jr.left,$h=sh.aTypedArray;(0,sh.exportTypedArrayMethod)("reduce",(function(t){return Jh($h(this),t,arguments.length,arguments.length>1?arguments[1]:void 0)}));var Kh=Jr.right,Qh=sh.aTypedArray;(0,sh.exportTypedArrayMethod)("reduceRight",(function(t){return Kh(Qh(this),t,arguments.length,arguments.length>1?arguments[1]:void 0)}));var tp=sh.aTypedArray,ep=sh.exportTypedArrayMethod,np=Math.floor;ep("reverse",(function(){for(var t,e=tp(this).length,n=np(e/2),r=0;r<n;)t=this[r],this[r++]=this[--e],this[e]=t;return this}));var rp=sh.aTypedArray;(0,sh.exportTypedArrayMethod)("set",(function(t){rp(this);var e=ph(arguments.length>1?arguments[1]:void 0,1),n=this.length,r=Ft(t),o=pt(r.length),i=0;if(o+e>n)throw RangeError("Wrong length");for(;i<o;)this[e+i]=r[i++]}),a((function(){new Int8Array(1).set({})})));var op=sh.aTypedArray,ip=sh.aTypedArrayConstructor,ap=[].slice;(0,sh.exportTypedArrayMethod)("slice",(function(t,e){for(var n=ap.call(op(this),t,e),r=Bs(this,this.constructor),o=0,i=n.length,a=new(ip(r))(i);i>o;)a[o]=n[o++];return a}),a((function(){new Int8Array(1).slice()})));var sp=de.some,lp=sh.aTypedArray;(0,sh.exportTypedArrayMethod)("some",(function(t){return sp(lp(this),t,arguments.length>1?arguments[1]:void 0)}));var up=sh.aTypedArray,cp=[].sort;(0,sh.exportTypedArrayMethod)("sort",(function(t){return cp.call(up(this),t)}));var hp=sh.aTypedArray;(0,sh.exportTypedArrayMethod)("subarray",(function(t,e){var n=hp(this),r=n.length,o=mt(t,r);return new(Bs(n,n.constructor))(n.buffer,n.byteOffset+o*n.BYTES_PER_ELEMENT,pt((void 0===e?r:mt(e,r))-o))}));var pp=i.Int8Array,dp=sh.aTypedArray,fp=sh.exportTypedArrayMethod,mp=[].toLocaleString,gp=[].slice,vp=!!pp&&a((function(){mp.call(new pp(1))}));fp("toLocaleString",(function(){return mp.apply(vp?gp.call(dp(this)):dp(this),arguments)}),a((function(){return[1,2].toLocaleString()!=new pp([1,2]).toLocaleString()}))||!a((function(){pp.prototype.toLocaleString.call([1,2])})));var yp=sh.exportTypedArrayMethod,wp=i.Uint8Array,bp=wp&&wp.prototype||{},Sp=[].toString,Ep=[].join;a((function(){Sp.call({})}))&&(Sp=function(){return Ep.call(this)});var Pp=bp.toString!=Sp;yp("toString",Sp,Pp);var xp=fi.getWeakData,_p=rt.set,Tp=rt.getterFor,Cp=de.find,Ip=de.findIndex,Dp=0,kp=function(t){return t.frozen||(t.frozen=new Mp)},Mp=function(){this.entries=[]},Rp=function(t,e){return Cp(t.entries,(function(t){return t[0]===e}))};Mp.prototype={get:function(t){var e=Rp(this,t);if(e)return e[1]},has:function(t){return!!Rp(this,t)},set:function(t,e){var n=Rp(this,t);n?n[1]=e:this.entries.push([t,e])},delete:function(t){var e=Ip(this.entries,(function(e){return e[0]===t}));return~e&&this.entries.splice(e,1),!!~e}};var Ap={getConstructor:function(t,e,n,r){var o=t((function(t,i){bo(t,o,e),_p(t,{type:e,id:Dp++,frozen:void 0}),null!=i&&mi(i,t[r],t,n)})),i=Tp(e),a=function(t,e,n){var r=i(t),o=xp(D(e),!0);return!0===o?kp(r).set(e,n):o[r.id]=n,t};return wo(o.prototype,{delete:function(t){var e=i(this);if(!y(t))return!1;var n=xp(t);return!0===n?kp(e).delete(t):n&&S(n,e.id)&&delete n[e.id]},has:function(t){var e=i(this);if(!y(t))return!1;var n=xp(t);return!0===n?kp(e).has(t):n&&S(n,e.id)}}),wo(o.prototype,n?{get:function(t){var e=i(this);if(y(t)){var n=xp(t);return!0===n?kp(e).get(t):n?n[e.id]:void 0}},set:function(t,e){return a(this,t,e)}}:{add:function(t){return a(this,t,!0)}}),o}};r((function(t){var e,n=rt.enforce,r=!i.ActiveXObject&&"ActiveXObject"in i,o=Object.isExtensible,a=function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},s=t.exports=vi("WeakMap",a,Ap);if(V&&r){e=Ap.getConstructor(a,"WeakMap",!0),fi.REQUIRED=!0;var l=s.prototype,u=l.delete,c=l.has,h=l.get,p=l.set;wo(l,{delete:function(t){if(y(t)&&!o(t)){var r=n(this);return r.frozen||(r.frozen=new e),u.call(this,t)||r.frozen.delete(t)}return u.call(this,t)},has:function(t){if(y(t)&&!o(t)){var r=n(this);return r.frozen||(r.frozen=new e),c.call(this,t)||r.frozen.has(t)}return c.call(this,t)},get:function(t){if(y(t)&&!o(t)){var r=n(this);return r.frozen||(r.frozen=new e),c.call(this,t)?h.call(this,t):r.frozen.get(t)}return h.call(this,t)},set:function(t,r){if(y(t)&&!o(t)){var i=n(this);i.frozen||(i.frozen=new e),c.call(this,t)?p.call(this,t,r):i.frozen.set(t,r)}else p.call(this,t,r);return this}})}}));vi("WeakSet",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),Ap);var Hp={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0};for(var Op in Hp){var Lp=i[Op],Bp=Lp&&Lp.prototype;if(Bp&&Bp.forEach!==jn)try{R(Bp,"forEach",jn)}catch(t){Bp.forEach=jn}}var Fp=te("iterator"),Np=te("toStringTag"),jp=Or.values;for(var Vp in Hp){var zp=i[Vp],Wp=zp&&zp.prototype;if(Wp){if(Wp[Fp]!==jp)try{R(Wp,Fp,jp)}catch(t){Wp[Fp]=jp}if(Wp[Np]||R(Wp,Np,Vp),Hp[Vp])for(var Gp in Or)if(Wp[Gp]!==Or[Gp])try{R(Wp,Gp,Or[Gp])}catch(t){Wp[Gp]=Or[Gp]}}}var Up=i.process,Yp="process"==d(Up);Ht({global:!0,enumerable:!0,noTargetGet:!0},{queueMicrotask:function(t){var e=Yp&&Up.domain;yl(e?e.bind(t):t)}});var Xp=te("iterator"),Zp=!a((function(){var t=new URL("b?a=1&b=2&c=3","http://a"),e=t.searchParams,n="";return t.pathname="c%20d",e.forEach((function(t,r){e.delete("b"),n+=r+t})),!e.sort||"http://a/c%20d?a=1&c=3"!==t.href||"3"!==e.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!e[Xp]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://тест").host||"#%D0%B1"!==new URL("http://a#б").hash||"a1c3"!==n||"x"!==new URL("http://x",void 0).host})),qp=/[^\0-\u007E]/,Jp=/[.\u3002\uFF0E\uFF61]/g,$p="Overflow: input needs wider integers to process",Kp=Math.floor,Qp=String.fromCharCode,td=function(t){return t+22+75*(t<26)},ed=function(t,e,n){var r=0;for(t=n?Kp(t/700):t>>1,t+=Kp(t/e);t>455;r+=36)t=Kp(t/35);return Kp(r+36*t/(t+38))},nd=function(t){var e,n,r=[],o=(t=function(t){for(var e=[],n=0,r=t.length;n<r;){var o=t.charCodeAt(n++);if(o>=55296&&o<=56319&&n<r){var i=t.charCodeAt(n++);56320==(64512&i)?e.push(((1023&o)<<10)+(1023&i)+65536):(e.push(o),n--)}else e.push(o)}return e}(t)).length,i=128,a=0,s=72;for(e=0;e<t.length;e++)(n=t[e])<128&&r.push(Qp(n));var l=r.length,u=l;for(l&&r.push("-");u<o;){var c=2147483647;for(e=0;e<t.length;e++)(n=t[e])>=i&&n<c&&(c=n);var h=u+1;if(c-i>Kp((2147483647-a)/h))throw RangeError($p);for(a+=(c-i)*h,i=c,e=0;e<t.length;e++){if((n=t[e])<i&&++a>2147483647)throw RangeError($p);if(n==i){for(var p=a,d=36;;d+=36){var f=d<=s?1:d>=s+26?26:d-s;if(p<f)break;var m=p-f,g=36-f;r.push(Qp(td(f+m%g))),p=Kp(m/g)}r.push(Qp(td(p))),s=ed(a,h,u==l),a=0,++u}}++a,++i}return r.join("")},rd=function(t){var e=Kn(t);if("function"!=typeof e)throw TypeError(String(t)+" is not iterable");return D(e.call(t))},od=st("fetch"),id=st("Headers"),ad=te("iterator"),sd=rt.set,ld=rt.getterFor("URLSearchParams"),ud=rt.getterFor("URLSearchParamsIterator"),cd=/\+/g,hd=Array(4),pd=function(t){return hd[t-1]||(hd[t-1]=RegExp("((?:%[\\da-f]{2}){"+t+"})","gi"))},dd=function(t){try{return decodeURIComponent(t)}catch(e){return t}},fd=function(t){var e=t.replace(cd," "),n=4;try{return decodeURIComponent(e)}catch(t){for(;n;)e=e.replace(pd(n--),dd);return e}},md=/[!'()~]|%20/g,gd={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},vd=function(t){return gd[t]},yd=function(t){return encodeURIComponent(t).replace(md,vd)},wd=function(t,e){if(e)for(var n,r,o=e.split("&"),i=0;i<o.length;)(n=o[i++]).length&&(r=n.split("="),t.push({key:fd(r.shift()),value:fd(r.join("="))}))},bd=function(t){this.entries.length=0,wd(this.entries,t)},Sd=function(t,e){if(t<e)throw TypeError("Not enough arguments")},Ed=_r((function(t,e){sd(this,{type:"URLSearchParamsIterator",iterator:rd(ld(t).entries),kind:e})}),"Iterator",(function(){var t=ud(this),e=t.kind,n=t.iterator.next(),r=n.value;return n.done||(n.value="keys"===e?r.key:"values"===e?r.value:[r.key,r.value]),n})),Pd=function(){bo(this,Pd,"URLSearchParams");var t,e,n,r,o,i,a,s,l,u=arguments.length>0?arguments[0]:void 0,c=this,h=[];if(sd(c,{type:"URLSearchParams",entries:h,updateURL:function(){},updateSearchParams:bd}),void 0!==u)if(y(u))if("function"==typeof(t=Kn(u)))for(n=(e=t.call(u)).next;!(r=n.call(e)).done;){if((a=(i=(o=rd(D(r.value))).next).call(o)).done||(s=i.call(o)).done||!i.call(o).done)throw TypeError("Expected sequence with length 2");h.push({key:a.value+"",value:s.value+""})}else for(l in u)S(u,l)&&h.push({key:l,value:u[l]+""});else wd(h,"string"==typeof u?"?"===u.charAt(0)?u.slice(1):u:u+"")},xd=Pd.prototype;wo(xd,{append:function(t,e){Sd(arguments.length,2);var n=ld(this);n.entries.push({key:t+"",value:e+""}),n.updateURL()},delete:function(t){Sd(arguments.length,1);for(var e=ld(this),n=e.entries,r=t+"",o=0;o<n.length;)n[o].key===r?n.splice(o,1):o++;e.updateURL()},get:function(t){Sd(arguments.length,1);for(var e=ld(this).entries,n=t+"",r=0;r<e.length;r++)if(e[r].key===n)return e[r].value;return null},getAll:function(t){Sd(arguments.length,1);for(var e=ld(this).entries,n=t+"",r=[],o=0;o<e.length;o++)e[o].key===n&&r.push(e[o].value);return r},has:function(t){Sd(arguments.length,1);for(var e=ld(this).entries,n=t+"",r=0;r<e.length;)if(e[r++].key===n)return!0;return!1},set:function(t,e){Sd(arguments.length,1);for(var n,r=ld(this),o=r.entries,i=!1,a=t+"",s=e+"",l=0;l<o.length;l++)(n=o[l]).key===a&&(i?o.splice(l--,1):(i=!0,n.value=s));i||o.push({key:a,value:s}),r.updateURL()},sort:function(){var t,e,n,r=ld(this),o=r.entries,i=o.slice();for(o.length=0,n=0;n<i.length;n++){for(t=i[n],e=0;e<n;e++)if(o[e].key>t.key){o.splice(e,0,t);break}e===n&&o.push(t)}r.updateURL()},forEach:function(t){for(var e,n=ld(this).entries,r=le(t,arguments.length>1?arguments[1]:void 0,3),o=0;o<n.length;)r((e=n[o++]).value,e.key,this)},keys:function(){return new Ed(this,"keys")},values:function(){return new Ed(this,"values")},entries:function(){return new Ed(this,"entries")}},{enumerable:!0}),ot(xd,ad,xd.entries),ot(xd,"toString",(function(){for(var t,e=ld(this).entries,n=[],r=0;r<e.length;)t=e[r++],n.push(yd(t.key)+"="+yd(t.value));return n.join("&")}),{enumerable:!0}),ae(Pd,"URLSearchParams"),Ht({global:!0,forced:!Zp},{URLSearchParams:Pd}),Zp||"function"!=typeof od||"function"!=typeof id||Ht({global:!0,enumerable:!0,forced:!0},{fetch:function(t){var e,n,r,o=[t];return arguments.length>1&&(y(e=arguments[1])&&(n=e.body,"URLSearchParams"===Jn(n)&&((r=e.headers?new id(e.headers):new id).has("content-type")||r.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),e=Yt(e,{body:h(0,String(n)),headers:h(0,r)}))),o.push(e)),od.apply(this,o)}});var _d,Td={URLSearchParams:Pd,getState:ld},Cd=zu.codeAt,Id=i.URL,Dd=Td.URLSearchParams,kd=Td.getState,Md=rt.set,Rd=rt.getterFor("URL"),Ad=Math.floor,Hd=Math.pow,Od=/[A-Za-z]/,Ld=/[\d+-.A-Za-z]/,Bd=/\d/,Fd=/^(0x|0X)/,Nd=/^[0-7]+$/,jd=/^\d+$/,Vd=/^[\dA-Fa-f]+$/,zd=/[\u0000\u0009\u000A\u000D #%/:?@[\\]]/,Wd=/[\u0000\u0009\u000A\u000D #/:?@[\\]]/,Gd=/^[\u0000-\u001F ]+|[\u0000-\u001F ]+$/g,Ud=/[\u0009\u000A\u000D]/g,Yd=function(t,e){var n,r,o;if("["==e.charAt(0)){if("]"!=e.charAt(e.length-1))return"Invalid host";if(!(n=Zd(e.slice(1,-1))))return"Invalid host";t.host=n}else if(nf(t)){if(e=function(t){var e,n,r=[],o=t.toLowerCase().replace(Jp,".").split(".");for(e=0;e<o.length;e++)n=o[e],r.push(qp.test(n)?"xn--"+nd(n):n);return r.join(".")}(e),zd.test(e))return"Invalid host";if(null===(n=Xd(e)))return"Invalid host";t.host=n}else{if(Wd.test(e))return"Invalid host";for(n="",r=Qn(e),o=0;o<r.length;o++)n+=tf(r[o],Jd);t.host=n}},Xd=function(t){var e,n,r,o,i,a,s,l=t.split(".");if(l.length&&""==l[l.length-1]&&l.pop(),(e=l.length)>4)return t;for(n=[],r=0;r<e;r++){if(""==(o=l[r]))return t;if(i=10,o.length>1&&"0"==o.charAt(0)&&(i=Fd.test(o)?16:8,o=o.slice(8==i?1:2)),""===o)a=0;else{if(!(10==i?jd:8==i?Nd:Vd).test(o))return t;a=parseInt(o,i)}n.push(a)}for(r=0;r<e;r++)if(a=n[r],r==e-1){if(a>=Hd(256,5-e))return null}else if(a>255)return null;for(s=n.pop(),r=0;r<n.length;r++)s+=n[r]*Hd(256,3-r);return s},Zd=function(t){var e,n,r,o,i,a,s,l=[0,0,0,0,0,0,0,0],u=0,c=null,h=0,p=function(){return t.charAt(h)};if(":"==p()){if(":"!=t.charAt(1))return;h+=2,c=++u}for(;p();){if(8==u)return;if(":"!=p()){for(e=n=0;n<4&&Vd.test(p());)e=16*e+parseInt(p(),16),h++,n++;if("."==p()){if(0==n)return;if(h-=n,u>6)return;for(r=0;p();){if(o=null,r>0){if(!("."==p()&&r<4))return;h++}if(!Bd.test(p()))return;for(;Bd.test(p());){if(i=parseInt(p(),10),null===o)o=i;else{if(0==o)return;o=10*o+i}if(o>255)return;h++}l[u]=256*l[u]+o,2!=++r&&4!=r||u++}if(4!=r)return;break}if(":"==p()){if(h++,!p())return}else if(p())return;l[u++]=e}else{if(null!==c)return;h++,c=++u}}if(null!==c)for(a=u-c,u=7;0!=u&&a>0;)s=l[u],l[u--]=l[c+a-1],l[c+--a]=s;else if(8!=u)return;return l},qd=function(t){var e,n,r,o;if("number"==typeof t){for(e=[],n=0;n<4;n++)e.unshift(t%256),t=Ad(t/256);return e.join(".")}if("object"==typeof t){for(e="",r=function(t){for(var e=null,n=1,r=null,o=0,i=0;i<8;i++)0!==t[i]?(o>n&&(e=r,n=o),r=null,o=0):(null===r&&(r=i),++o);return o>n&&(e=r,n=o),e}(t),n=0;n<8;n++)o&&0===t[n]||(o&&(o=!1),r===n?(e+=n?":":"::",o=!0):(e+=t[n].toString(16),n<7&&(e+=":")));return"["+e+"]"}return t},Jd={},$d=ts({},Jd,{" ":1,'"':1,"<":1,">":1,"`":1}),Kd=ts({},$d,{"#":1,"?":1,"{":1,"}":1}),Qd=ts({},Kd,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),tf=function(t,e){var n=Cd(t,0);return n>32&&n<127&&!S(e,t)?t:encodeURIComponent(t)},ef={ftp:21,file:null,http:80,https:443,ws:80,wss:443},nf=function(t){return S(ef,t.scheme)},rf=function(t){return""!=t.username||""!=t.password},of=function(t){return!t.host||t.cannotBeABaseURL||"file"==t.scheme},af=function(t,e){var n;return 2==t.length&&Od.test(t.charAt(0))&&(":"==(n=t.charAt(1))||!e&&"|"==n)},sf=function(t){var e;return t.length>1&&af(t.slice(0,2))&&(2==t.length||"/"===(e=t.charAt(2))||"\\"===e||"?"===e||"#"===e)},lf=function(t){var e=t.path,n=e.length;!n||"file"==t.scheme&&1==n&&af(e[0],!0)||e.pop()},uf=function(t){return"."===t||"%2e"===t.toLowerCase()},cf={},hf={},pf={},df={},ff={},mf={},gf={},vf={},yf={},wf={},bf={},Sf={},Ef={},Pf={},xf={},_f={},Tf={},Cf={},If={},Df={},kf={},Mf=function(t,e,n,r){var o,i,a,s,l,u=n||cf,c=0,h="",p=!1,d=!1,f=!1;for(n||(t.scheme="",t.username="",t.password="",t.host=null,t.port=null,t.path=[],t.query=null,t.fragment=null,t.cannotBeABaseURL=!1,e=e.replace(Gd,"")),e=e.replace(Ud,""),o=Qn(e);c<=o.length;){switch(i=o[c],u){case cf:if(!i||!Od.test(i)){if(n)return"Invalid scheme";u=pf;continue}h+=i.toLowerCase(),u=hf;break;case hf:if(i&&(Ld.test(i)||"+"==i||"-"==i||"."==i))h+=i.toLowerCase();else{if(":"!=i){if(n)return"Invalid scheme";h="",u=pf,c=0;continue}if(n&&(nf(t)!=S(ef,h)||"file"==h&&(rf(t)||null!==t.port)||"file"==t.scheme&&!t.host))return;if(t.scheme=h,n)return void(nf(t)&&ef[t.scheme]==t.port&&(t.port=null));h="","file"==t.scheme?u=Pf:nf(t)&&r&&r.scheme==t.scheme?u=df:nf(t)?u=vf:"/"==o[c+1]?(u=ff,c++):(t.cannotBeABaseURL=!0,t.path.push(""),u=If)}break;case pf:if(!r||r.cannotBeABaseURL&&"#"!=i)return"Invalid scheme";if(r.cannotBeABaseURL&&"#"==i){t.scheme=r.scheme,t.path=r.path.slice(),t.query=r.query,t.fragment="",t.cannotBeABaseURL=!0,u=kf;break}u="file"==r.scheme?Pf:mf;continue;case df:if("/"!=i||"/"!=o[c+1]){u=mf;continue}u=yf,c++;break;case ff:if("/"==i){u=wf;break}u=Cf;continue;case mf:if(t.scheme=r.scheme,i==_d)t.username=r.username,t.password=r.password,t.host=r.host,t.port=r.port,t.path=r.path.slice(),t.query=r.query;else if("/"==i||"\\"==i&&nf(t))u=gf;else if("?"==i)t.username=r.username,t.password=r.password,t.host=r.host,t.port=r.port,t.path=r.path.slice(),t.query="",u=Df;else{if("#"!=i){t.username=r.username,t.password=r.password,t.host=r.host,t.port=r.port,t.path=r.path.slice(),t.path.pop(),u=Cf;continue}t.username=r.username,t.password=r.password,t.host=r.host,t.port=r.port,t.path=r.path.slice(),t.query=r.query,t.fragment="",u=kf}break;case gf:if(!nf(t)||"/"!=i&&"\\"!=i){if("/"!=i){t.username=r.username,t.password=r.password,t.host=r.host,t.port=r.port,u=Cf;continue}u=wf}else u=yf;break;case vf:if(u=yf,"/"!=i||"/"!=h.charAt(c+1))continue;c++;break;case yf:if("/"!=i&&"\\"!=i){u=wf;continue}break;case wf:if("@"==i){p&&(h="%40"+h),p=!0,a=Qn(h);for(var m=0;m<a.length;m++){var g=a[m];if(":"!=g||f){var v=tf(g,Qd);f?t.password+=v:t.username+=v}else f=!0}h=""}else if(i==_d||"/"==i||"?"==i||"#"==i||"\\"==i&&nf(t)){if(p&&""==h)return"Invalid authority";c-=Qn(h).length+1,h="",u=bf}else h+=i;break;case bf:case Sf:if(n&&"file"==t.scheme){u=_f;continue}if(":"!=i||d){if(i==_d||"/"==i||"?"==i||"#"==i||"\\"==i&&nf(t)){if(nf(t)&&""==h)return"Invalid host";if(n&&""==h&&(rf(t)||null!==t.port))return;if(s=Yd(t,h))return s;if(h="",u=Tf,n)return;continue}"["==i?d=!0:"]"==i&&(d=!1),h+=i}else{if(""==h)return"Invalid host";if(s=Yd(t,h))return s;if(h="",u=Ef,n==Sf)return}break;case Ef:if(!Bd.test(i)){if(i==_d||"/"==i||"?"==i||"#"==i||"\\"==i&&nf(t)||n){if(""!=h){var y=parseInt(h,10);if(y>65535)return"Invalid port";t.port=nf(t)&&y===ef[t.scheme]?null:y,h=""}if(n)return;u=Tf;continue}return"Invalid port"}h+=i;break;case Pf:if(t.scheme="file","/"==i||"\\"==i)u=xf;else{if(!r||"file"!=r.scheme){u=Cf;continue}if(i==_d)t.host=r.host,t.path=r.path.slice(),t.query=r.query;else if("?"==i)t.host=r.host,t.path=r.path.slice(),t.query="",u=Df;else{if("#"!=i){sf(o.slice(c).join(""))||(t.host=r.host,t.path=r.path.slice(),lf(t)),u=Cf;continue}t.host=r.host,t.path=r.path.slice(),t.query=r.query,t.fragment="",u=kf}}break;case xf:if("/"==i||"\\"==i){u=_f;break}r&&"file"==r.scheme&&!sf(o.slice(c).join(""))&&(af(r.path[0],!0)?t.path.push(r.path[0]):t.host=r.host),u=Cf;continue;case _f:if(i==_d||"/"==i||"\\"==i||"?"==i||"#"==i){if(!n&&af(h))u=Cf;else if(""==h){if(t.host="",n)return;u=Tf}else{if(s=Yd(t,h))return s;if("localhost"==t.host&&(t.host=""),n)return;h="",u=Tf}continue}h+=i;break;case Tf:if(nf(t)){if(u=Cf,"/"!=i&&"\\"!=i)continue}else if(n||"?"!=i)if(n||"#"!=i){if(i!=_d&&(u=Cf,"/"!=i))continue}else t.fragment="",u=kf;else t.query="",u=Df;break;case Cf:if(i==_d||"/"==i||"\\"==i&&nf(t)||!n&&("?"==i||"#"==i)){if(".."===(l=(l=h).toLowerCase())||"%2e."===l||".%2e"===l||"%2e%2e"===l?(lf(t),"/"==i||"\\"==i&&nf(t)||t.path.push("")):uf(h)?"/"==i||"\\"==i&&nf(t)||t.path.push(""):("file"==t.scheme&&!t.path.length&&af(h)&&(t.host&&(t.host=""),h=h.charAt(0)+":"),t.path.push(h)),h="","file"==t.scheme&&(i==_d||"?"==i||"#"==i))for(;t.path.length>1&&""===t.path[0];)t.path.shift();"?"==i?(t.query="",u=Df):"#"==i&&(t.fragment="",u=kf)}else h+=tf(i,Kd);break;case If:"?"==i?(t.query="",u=Df):"#"==i?(t.fragment="",u=kf):i!=_d&&(t.path[0]+=tf(i,Jd));break;case Df:n||"#"!=i?i!=_d&&("'"==i&&nf(t)?t.query+="%27":t.query+="#"==i?"%23":tf(i,Jd)):(t.fragment="",u=kf);break;case kf:i!=_d&&(t.fragment+=tf(i,$d))}c++}},Rf=function(t){var e,n,r=bo(this,Rf,"URL"),o=arguments.length>1?arguments[1]:void 0,i=String(t),a=Md(r,{type:"URL"});if(void 0!==o)if(o instanceof Rf)e=Rd(o);else if(n=Mf(e={},String(o)))throw TypeError(n);if(n=Mf(a,i,null,e))throw TypeError(n);var l=a.searchParams=new Dd,u=kd(l);u.updateSearchParams(a.query),u.updateURL=function(){a.query=String(l)||null},s||(r.href=Hf.call(r),r.origin=Of.call(r),r.protocol=Lf.call(r),r.username=Bf.call(r),r.password=Ff.call(r),r.host=Nf.call(r),r.hostname=jf.call(r),r.port=Vf.call(r),r.pathname=zf.call(r),r.search=Wf.call(r),r.searchParams=Gf.call(r),r.hash=Uf.call(r))},Af=Rf.prototype,Hf=function(){var t=Rd(this),e=t.scheme,n=t.username,r=t.password,o=t.host,i=t.port,a=t.path,s=t.query,l=t.fragment,u=e+":";return null!==o?(u+="//",rf(t)&&(u+=n+(r?":"+r:"")+"@"),u+=qd(o),null!==i&&(u+=":"+i)):"file"==e&&(u+="//"),u+=t.cannotBeABaseURL?a[0]:a.length?"/"+a.join("/"):"",null!==s&&(u+="?"+s),null!==l&&(u+="#"+l),u},Of=function(){var t=Rd(this),e=t.scheme,n=t.port;if("blob"==e)try{return new URL(e.path[0]).origin}catch(t){return"null"}return"file"!=e&&nf(t)?e+"://"+qd(t.host)+(null!==n?":"+n:""):"null"},Lf=function(){return Rd(this).scheme+":"},Bf=function(){return Rd(this).username},Ff=function(){return Rd(this).password},Nf=function(){var t=Rd(this),e=t.host,n=t.port;return null===e?"":null===n?qd(e):qd(e)+":"+n},jf=function(){var t=Rd(this).host;return null===t?"":qd(t)},Vf=function(){var t=Rd(this).port;return null===t?"":String(t)},zf=function(){var t=Rd(this),e=t.path;return t.cannotBeABaseURL?e[0]:e.length?"/"+e.join("/"):""},Wf=function(){var t=Rd(this).query;return t?"?"+t:""},Gf=function(){return Rd(this).searchParams},Uf=function(){var t=Rd(this).fragment;return t?"#"+t:""},Yf=function(t,e){return{get:t,set:e,configurable:!0,enumerable:!0}};if(s&&jt(Af,{href:Yf(Hf,(function(t){var e=Rd(this),n=String(t),r=Mf(e,n);if(r)throw TypeError(r);kd(e.searchParams).updateSearchParams(e.query)})),origin:Yf(Of),protocol:Yf(Lf,(function(t){var e=Rd(this);Mf(e,String(t)+":",cf)})),username:Yf(Bf,(function(t){var e=Rd(this),n=Qn(String(t));if(!of(e)){e.username="";for(var r=0;r<n.length;r++)e.username+=tf(n[r],Qd)}})),password:Yf(Ff,(function(t){var e=Rd(this),n=Qn(String(t));if(!of(e)){e.password="";for(var r=0;r<n.length;r++)e.password+=tf(n[r],Qd)}})),host:Yf(Nf,(function(t){var e=Rd(this);e.cannotBeABaseURL||Mf(e,String(t),bf)})),hostname:Yf(jf,(function(t){var e=Rd(this);e.cannotBeABaseURL||Mf(e,String(t),Sf)})),port:Yf(Vf,(function(t){var e=Rd(this);of(e)||(""==(t=String(t))?e.port=null:Mf(e,t,Ef))})),pathname:Yf(zf,(function(t){var e=Rd(this);e.cannotBeABaseURL||(e.path=[],Mf(e,t+"",Tf))})),search:Yf(Wf,(function(t){var e=Rd(this);""==(t=String(t))?e.query=null:("?"==t.charAt(0)&&(t=t.slice(1)),e.query="",Mf(e,t,Df)),kd(e.searchParams).updateSearchParams(e.query)})),searchParams:Yf(Gf),hash:Yf(Uf,(function(t){var e=Rd(this);""!=(t=String(t))?("#"==t.charAt(0)&&(t=t.slice(1)),e.fragment="",Mf(e,t,kf)):e.fragment=null}))}),ot(Af,"toJSON",(function(){return Hf.call(this)}),{enumerable:!0}),ot(Af,"toString",(function(){return Hf.call(this)}),{enumerable:!0}),Id){var Xf=Id.createObjectURL,Zf=Id.revokeObjectURL;Xf&&ot(Rf,"createObjectURL",(function(t){return Xf.apply(Id,arguments)})),Zf&&ot(Rf,"revokeObjectURL",(function(t){return Zf.apply(Id,arguments)}))}ae(Rf,"URL"),Ht({global:!0,forced:!Zp,sham:!s},{URL:Rf}),Ht({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}});r((function(t){var e=function(t){var e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function s(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var o=e&&e.prototype instanceof h?e:h,i=Object.create(o.prototype),a=new P(r||[]);return i._invoke=function(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return _()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===c)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var l=u(t,e,n);if("normal"===l.type){if(r=n.done?"completed":"suspendedYield",l.arg===c)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r="completed",n.method="throw",n.arg=l.arg)}}}(t,n,a),i}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var c={};function h(){}function p(){}function d(){}var f={};f[o]=function(){return this};var m=Object.getPrototypeOf,g=m&&m(m(x([])));g&&g!==e&&n.call(g,o)&&(f=g);var v=d.prototype=h.prototype=Object.create(f);function y(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var r;this._invoke=function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,s){var l=u(t[o],t,i);if("throw"!==l.type){var c=l.arg,h=c.value;return h&&"object"==typeof h&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(h).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,s)}))}s(l.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}}function b(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return c;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}var r=u(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,c;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,c):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,c)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function x(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:_}}function _(){return{value:void 0,done:!0}}return p.prototype=v.constructor=d,d.constructor=p,p.displayName=s(d,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,s(t,a,"GeneratorFunction")),t.prototype=Object.create(v),t},t.awrap=function(t){return{__await:t}},y(w.prototype),w.prototype[i]=function(){return this},t.AsyncIterator=w,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new w(l(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},y(v),s(v,a,"Generator"),v[o]=function(){return this},v.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=x,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(s&&l){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,c):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),c},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),E(n),c}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;E(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:x(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),c}},t}(t.exports);try{regeneratorRuntime=e}catch(t){Function("r","regeneratorRuntime = r")(e)}}));function qf(t){return(qf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Jf(t,e,n,r,o,i,a){try{var s=t[i](a),l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(r,o)}function $f(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){Jf(i,r,o,a,s,"next",t)}function s(t){Jf(i,r,o,a,s,"throw",t)}a(void 0)}))}}function Kf(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Qf(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function tm(t,e,n){return e&&Qf(t.prototype,e),n&&Qf(t,n),t}function em(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function nm(){return(nm=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function rm(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function om(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?rm(Object(n),!0).forEach((function(e){em(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):rm(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function im(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&sm(t,e)}function am(t){return(am=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function sm(t,e){return(sm=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function lm(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function um(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?lm(t):e}function cm(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=am(t);if(e){var o=am(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return um(this,n)}}function hm(t){return function(t){if(Array.isArray(t))return dm(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||pm(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pm(t,e){if(t){if("string"==typeof t)return dm(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?dm(t,e):void 0}}function dm(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function fm(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=pm(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}window.EPSILON=1e-6,Array.clone=function(){return nm({},this)},Array.isNullOrEmpty=function(t){return!t||0===t.length},Array.remove=function(t,e){for(var n=t.indexOf(e);n>-1;)t.splice(n,1),n=t.indexOf(e)},Array.except=function(t,e){e.forEach((function(e){t.splice(t.indexOf(e),1)}))},Array.get=function(t,e){return t[(e+t.length)%t.length]},Array.cartesian=function(t){var e,n=[],r=fm(this);try{for(r.s();!(e=r.n()).done;){var o,i=e.value,a=fm(t);try{for(a.s();!(o=a.n()).done;){var s=o.value;n.push([i,s].flat())}}catch(t){a.e(t)}finally{a.f()}}}catch(t){r.e(t)}finally{r.f()}return n},String.isNullOrEmpty=function(t){return!t||""===t},Object.bindFunctions=function(t){Object.getOwnPropertyNames(t.__proto__).filter((function(t){return"constructor"!==t&&"caller"!==t&&"arguments"!==t})).forEach((function(e){t.__proto__[e]instanceof Function&&(t[e]=t[e].bind(t))}))},THREE.OrbitControls=function(t,e,n){this.object=t,this.Object3D=n,this.domElement=void 0!==e?e:document,this.enabled=!0,this.mosaicMode=!1,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableInertia=!1,this.inertiaFactor=.75,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=.8,this.screenSpacePanning=!0,this.keyPanSpeed=3,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.limitInScreenPoint=null,this.minDistanceFlag=!1,this.diyMode="",this.setDiyMode=function(t){this.diyMode=t},this.setTarget=function(t){this.target=t},this.setSpherical=function(t){c=t},this.onObjectMoved=function(){},this.onZoomChanged=function(){},this.getPolarAngle=function(){return c.phi},this.getAzimuthalAngle=function(){return c.theta},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(o),r.update(),l=s.NONE},this.focus=function(t){var e=(new THREE.Box3).setFromObject(t);this.object.lookAt(e.getCenter().clone()),r.dispatchEvent(o)},this.updateScale=function(t){m=t},this.updateZoom=function(t){r.object.zoom=t,r.object.updateProjectionMatrix()},this.onReachMinDistance=function(){},this.update=function(){var e=new THREE.Vector3,n=(new THREE.Quaternion).setFromUnitVectors(t.up,new THREE.Vector3(0,1,0)),i=n.clone().inverse(),a=new THREE.Vector3,y=new THREE.Quaternion;return function(){var t=r.object.position.clone(),w=r.object.position;if(e.copy(w).sub(r.target),e.applyQuaternion(n),c.setFromVector3(e),r.autoRotate&&l===s.NONE&&D(2*Math.PI/60/60*r.autoRotateSpeed,!0),c.theta+=h.theta,c.phi+=h.phi,r.enableInertia&&(d||(c.theta+=p.theta,c.phi+=p.phi),0===p.theta&&0===p.phi||(p.theta*=r.inertiaFactor,p.phi*=r.inertiaFactor,Math.abs(p.theta)<u&&(p.theta=0),Math.abs(p.phi)<u&&(p.phi=0))),c.theta=Math.max(r.minAzimuthAngle,Math.min(r.maxAzimuthAngle,c.theta)),c.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,c.phi)),c.makeSafe(),c.radius*=m,c.radius=Math.max(r.minDistance,Math.min(r.maxDistance,c.radius)),c.radius<=r.minDistance&&window.appConfig&&!window.appConfig.ZoomLimitIn3D?(r.onReachMinDistance&&!r.minDistanceFlag&&r.onReachMinDistance(),r.minDistanceFlag=!0):r.minDistanceFlag=!1,r.target.add(g),e.setFromSpherical(c),e.applyQuaternion(i),r.object.isOrthographicCamera&&r.getTargetObject&&r.getTargetObject()){var b=r.getTargetObject().scale,S=b.x/2,E=b.y/2;r.target.x=Math.max(-S,Math.min(S,r.target.x)),r.target.y=Math.max(-E,Math.min(E,r.target.y)),w.copy(r.target),r.object.lookAt(w)}else if(r.object.isPerspectiveCamera&&r.limitInScreenPoint&&!r.diyMode){var P=r.limitInScreenPoint.clone().project(r.object),x=Math.abs(P.x)>1||Math.abs(P.y)>1||Math.abs(P.z)>1;x&&!f&&(f=r.target.clone()),!d&&x&&f&&(r.target.copy(f).multiplyScalar(.75),f=null),w.copy(r.target).add(e),r.object.lookAt(r.target)}else w.copy(r.target).add(e),"indoor"!==r.diyMode&&r.object.lookAt(r.target);!0===r.enableDamping?(h.theta*=1-r.dampingFactor,h.phi*=1-r.dampingFactor,g.multiplyScalar(1-r.dampingFactor)):(h.set(0,0,0),g.set(0,0,0)),m=1;var _=!1;return(v||a.distanceToSquared(r.object.position)>u||8*(1-y.dot(r.object.quaternion))>u)&&(r.dispatchEvent(o),a.copy(r.object.position),y.copy(r.object.quaternion),v=!1,_=!0),r.autoRotate||t.approxEquals(r.object.position,.1)||r.onObjectMoved(r.object),_}()},this.dispose=function(){r.domElement.removeEventListener("contextmenu",Y,!1),r.domElement.removeEventListener("mousedown",F,!1),r.domElement.removeEventListener("wheel",V,!1),r.domElement.removeEventListener("touchstart",W,!1),r.domElement.removeEventListener("touchend",U,!1),r.domElement.removeEventListener("touchmove",G,!1),document.removeEventListener("mousemove",N,!1),document.removeEventListener("mouseup",j,!1),window.removeEventListener("keydown",z,!1)},this.panUp=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;O(0,t),r.update()},this.panDown=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;O(0,-t),r.update()},this.panLeft=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.015;r.target.copy(r.object.position.rotatePointByY(r.target,t)),r.update()},this.panRight=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.015;r.target.copy(r.object.position.rotatePointByY(r.target,-t)),r.update()};var r=this,o={type:"change"},i={type:"start"},a={type:"end"},s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY_PAN:4},l=s.NONE,u=1e-6,c=new THREE.Spherical,h=new THREE.Spherical,p=new THREE.Spherical,d=!1,f=null,m=1,g=new THREE.Vector3,v=!1,y=new THREE.Vector2,w=new THREE.Vector2,b=new THREE.Vector2,S=new THREE.Vector2,E=new THREE.Vector2,P=new THREE.Vector2,x=new THREE.Vector2,_=new THREE.Vector2,T=new THREE.Vector2;function C(t){var e=new THREE.Vector3;e.setFromMatrixColumn(r.object.matrix,0),e.crossVectors(r.object.up,e),r.object.position.addScaledVector(e,t)}function I(t){return r.zoomSpeed=t?r.zoomSpeed*r.zoomSpeed:Math.pow(r.zoomSpeed,.5),Math.pow(.95,r.zoomSpeed)}function D(t,e){h.theta-=t,e||(p.theta-=t)}function k(t){h.phi-=t,p.phi-=t}var M,R,A=(M=new THREE.Vector3,function(t,e){M.setFromMatrixColumn(e,0),M.multiplyScalar(-t),g.add(M)}),H=function(){var t=new THREE.Vector3;return function(e,n){!0===r.screenSpacePanning?t.setFromMatrixColumn(n,1):(t.setFromMatrixColumn(n,0),t.crossVectors(r.object.up,t)),t.multiplyScalar(e),g.add(t)}}(),O=(R=new THREE.Vector3,function(t,e){var n=r.domElement===document?r.domElement.body:r.domElement;if(r.object.isPerspectiveCamera){var o=r.object.position;R.copy(o).sub(r.target);var i=R.length();i*=Math.tan(r.object.fov/2*Math.PI/180),A(2*t*i/n.clientHeight,r.object.matrix),H(2*e*i/n.clientHeight,r.object.matrix)}else r.object.isOrthographicCamera?(A(t*(r.object.right-r.object.left)/r.object.zoom/n.clientWidth,r.object.matrix),H(e*(r.object.top-r.object.bottom)/r.object.zoom/n.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)});function L(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];"indoor"===r.diyMode?C(-30*(e?-.3:1)):r.object.isPerspectiveCamera?m/=t:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom*t)),r.object.updateProjectionMatrix(),v=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function B(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];"indoor"===r.diyMode?C(30*(e?-.3:1)):r.object.isPerspectiveCamera?m*=t:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/t)),r.object.updateProjectionMatrix(),v=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function F(t){if(!1!==r.enabled){t.preventDefault();var e=t.button;switch(r.object.isOrthographicCamera&&t.button===r.mouseButtons.ORBIT&&(e=r.mouseButtons.PAN),e){case r.mouseButtons.ORBIT:if(!1===r.enableRotate)return;!function(t){y.set(t.clientX,t.clientY)}(t),l=s.ROTATE;break;case r.mouseButtons.ZOOM:if(!1===r.enableZoom)return;!function(t){x.set(t.clientX,t.clientY)}(t),l=s.DOLLY;break;case r.mouseButtons.PAN:if(!1===r.enablePan)return;!function(t){S.set(t.clientX,t.clientY)}(t),l=s.PAN}l!==s.NONE&&(document.addEventListener("mousemove",N,!1),document.addEventListener("mouseup",j,!1),document.addEventListener("mouseout",j,!1),r.dispatchEvent(i))}}function N(t){if(!1!==r.enabled)switch(d=!0,t.preventDefault(),l){case s.ROTATE:if("indoor"===r.diyMode)return;if(!1===r.enableRotate)return;!function(t){w.set(t.clientX,t.clientY),b.subVectors(w,y).multiplyScalar(r.rotateSpeed);var e=r.domElement===document?r.domElement.body:r.domElement;D(2*Math.PI*b.x/e.clientWidth),k(2*Math.PI*b.y/e.clientHeight),y.copy(w),r.update()}(t);break;case s.DOLLY:if(!1===r.enableZoom)return;!function(t){_.set(t.clientX,t.clientY),T.subVectors(_,x),T.y>0?L(I()):T.y<0&&B(I()),x.copy(_),r.update()}(t);break;case s.PAN:if(!1===r.enablePan)return;!function(t){E.set(t.clientX,t.clientY),P.subVectors(E,S).multiplyScalar(r.panSpeed),O(P.x,P.y),S.copy(E),r.update()}(t)}}function j(t){!1!==r.enabled&&(d=!1,document.removeEventListener("mousemove",N,!1),document.removeEventListener("mouseup",j,!1),document.removeEventListener("mouseout",j,!1),r.dispatchEvent(a),l=s.NONE)}function V(t){!1===r.enabled||!1===r.enableZoom||l!==s.NONE&&l!==s.ROTATE||(t.preventDefault(),t.stopPropagation(),r.dispatchEvent(i),function(t){if(t.deltaY<0?B(I()):t.deltaY>0&&L(I()),window.appConfig&&window.appConfig.ZoomLimitIn3D){var e=new THREE.Raycaster;e.setFromCamera({x:0,y:0},r.object);var n=e.intersectObject(r.Object3D,!0);n.length>0&&r.target.set(n[0].point.x,n[0].point.y,n[0].point.z)}r.update(),r.onZoomChanged(r.object)}(t),r.dispatchEvent(a))}function z(t){!1!==r.enabled&&!1!==r.enableKeys&&!1!==r.enablePan&&function(t){switch(t.keyCode){case r.keys.UP:O(0,r.keyPanSpeed),r.update();break;case r.keys.BOTTOM:O(0,-r.keyPanSpeed),r.update();break;case r.keys.LEFT:r.target.copy(r.object.position.rotatePointByY(r.target,.015)),r.update();break;case r.keys.RIGHT:r.target.copy(r.object.position.rotatePointByY(r.target,-.015)),r.update()}}(t)}function W(t){if(!1!==r.enabled){switch(t.preventDefault(),t.touches.length){case 1:if(r.object.isOrthographicCamera){if(!1===r.enablePan)return;r.mosaicMode&&function(t){S.set(t.touches[0].pageX,t.touches[0].pageY)}(t),l=s.TOUCH_DOLLY_PAN}else{if(!1===r.enableRotate)return;!function(t){y.set(t.touches[0].pageX,t.touches[0].pageY)}(t),l=s.TOUCH_ROTATE}break;case 2:if(!1===r.enableZoom&&!1===r.enablePan)return;!function(t){if(r.enableZoom){var e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY,o=Math.sqrt(e*e+n*n);x.set(0,o)}if(r.enablePan){var i=.5*(t.touches[0].pageX+t.touches[1].pageX),a=.5*(t.touches[0].pageY+t.touches[1].pageY);S.set(i,a)}}(t),l=s.TOUCH_DOLLY_PAN;break;default:l=s.NONE}l!==s.NONE&&r.dispatchEvent(i)}}function G(t){if(!1!==r.enabled)switch(d=!0,t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:if("indoor"===r.diyMode)return;if(r.object.isOrthographicCamera){if(!1===r.enablePan)return;if(l!==s.TOUCH_DOLLY_PAN)return;r.mosaicMode&&function(t){E.set(t.touches[0].pageX,t.touches[0].pageY),P.subVectors(E,S),O(P.x,P.y),S.copy(E),r.update()}(t)}else{if(!1===r.enableRotate)return;if(l!==s.TOUCH_ROTATE)return;!function(t){w.set(t.touches[0].pageX,t.touches[0].pageY),b.subVectors(w,y).multiplyScalar(r.rotateSpeed);var e=r.domElement===document?r.domElement.body:r.domElement;D(2*Math.PI*b.x/e.clientWidth),k(2*Math.PI*b.y/e.clientHeight),y.copy(w),r.update()}(t)}break;case 2:if(!1===r.enableZoom&&!1===r.enablePan)return;if(l!==s.TOUCH_DOLLY_PAN)return;!function(t){if(r.enableZoom){var e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY,o=Math.sqrt(e*e+n*n);_.set(0,o),T.set(0,Math.pow(_.y/x.y,r.zoomSpeed)),r.diyMode&&T.y<1?B(T.y,!0):L(T.y,!0),x.copy(_)}if(r.enablePan){var i=.5*(t.touches[0].pageX+t.touches[1].pageX),a=.5*(t.touches[0].pageY+t.touches[1].pageY);E.set(i,a),P.subVectors(E,S).multiplyScalar(r.panSpeed),O(P.x,P.y),S.copy(E)}r.update()}(t),r.onZoomChanged(r.object);break;default:l=s.NONE}}function U(t){!1!==r.enabled&&(d=!1,r.dispatchEvent(a),l=s.NONE)}function Y(t){!1!==r.enabled&&t.preventDefault()}r.domElement.addEventListener("contextmenu",Y,!1),r.domElement.addEventListener("mousedown",F,!1),r.domElement.addEventListener("wheel",V,!1),r.domElement.addEventListener("touchstart",W,!1),r.domElement.addEventListener("touchend",U,!1),r.domElement.addEventListener("touchmove",G,!1),window.addEventListener("keydown",z,!1),r.update(),function t(){requestAnimationFrame(t);var e=0!==p.theta||0!==p.phi||r.autoRotate;r.enabled&&r.object.isVisible()?e&&r.update():(p.theta=0,p.phi=0)}()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(t){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!t}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(t){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!t}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(t){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!t}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(t){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!t}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(t){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!t}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(t){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=t}}}),THREE.MapControls=function(t,e){THREE.OrbitControls.call(this,t,e),this.mouseButtons.LEFT=THREE.MOUSE.PAN,this.mouseButtons.RIGHT=THREE.MOUSE.ROTATE},THREE.MapControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.MapControls.prototype.constructor=THREE.MapControls;var mm=Object.prototype.hasOwnProperty,gm=Array.isArray,vm=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),ym=function(t,e){for(var n=e&&e.plainObjects?Object.create(null):{},r=0;r<t.length;++r)void 0!==t[r]&&(n[r]=t[r]);return n},wm={arrayToObject:ym,assign:function(t,e){return Object.keys(e).reduce((function(t,n){return t[n]=e[n],t}),t)},combine:function(t,e){return[].concat(t,e)},compact:function(t){for(var e=[{obj:{o:t},prop:"o"}],n=[],r=0;r<e.length;++r)for(var o=e[r],i=o.obj[o.prop],a=Object.keys(i),s=0;s<a.length;++s){var l=a[s],u=i[l];"object"==typeof u&&null!==u&&-1===n.indexOf(u)&&(e.push({obj:i,prop:l}),n.push(u))}return function(t){for(;t.length>1;){var e=t.pop(),n=e.obj[e.prop];if(gm(n)){for(var r=[],o=0;o<n.length;++o)void 0!==n[o]&&r.push(n[o]);e.obj[e.prop]=r}}}(e),t},decode:function(t,e,n){var r=t.replace(/\+/g," ");if("iso-8859-1"===n)return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch(t){return r}},encode:function(t,e,n){if(0===t.length)return t;var r=t;if("symbol"==typeof t?r=Symbol.prototype.toString.call(t):"string"!=typeof t&&(r=String(t)),"iso-8859-1"===n)return escape(r).replace(/%u[0-9a-f]{4}/gi,(function(t){return"%26%23"+parseInt(t.slice(2),16)+"%3B"}));for(var o="",i=0;i<r.length;++i){var a=r.charCodeAt(i);45===a||46===a||95===a||126===a||a>=48&&a<=57||a>=65&&a<=90||a>=97&&a<=122?o+=r.charAt(i):a<128?o+=vm[a]:a<2048?o+=vm[192|a>>6]+vm[128|63&a]:a<55296||a>=57344?o+=vm[224|a>>12]+vm[128|a>>6&63]+vm[128|63&a]:(i+=1,a=65536+((1023&a)<<10|1023&r.charCodeAt(i)),o+=vm[240|a>>18]+vm[128|a>>12&63]+vm[128|a>>6&63]+vm[128|63&a])}return o},isBuffer:function(t){return!(!t||"object"!=typeof t)&&!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},isRegExp:function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},maybeMap:function(t,e){if(gm(t)){for(var n=[],r=0;r<t.length;r+=1)n.push(e(t[r]));return n}return e(t)},merge:function t(e,n,r){if(!n)return e;if("object"!=typeof n){if(gm(e))e.push(n);else{if(!e||"object"!=typeof e)return[e,n];(r&&(r.plainObjects||r.allowPrototypes)||!mm.call(Object.prototype,n))&&(e[n]=!0)}return e}if(!e||"object"!=typeof e)return[e].concat(n);var o=e;return gm(e)&&!gm(n)&&(o=ym(e,r)),gm(e)&&gm(n)?(n.forEach((function(n,o){if(mm.call(e,o)){var i=e[o];i&&"object"==typeof i&&n&&"object"==typeof n?e[o]=t(i,n,r):e.push(n)}else e[o]=n})),e):Object.keys(n).reduce((function(e,o){var i=n[o];return mm.call(e,o)?e[o]=t(e[o],i,r):e[o]=i,e}),o)}},bm=String.prototype.replace,Sm=/%20/g,Em={RFC1738:"RFC1738",RFC3986:"RFC3986"},Pm=wm.assign({default:Em.RFC3986,formatters:{RFC1738:function(t){return bm.call(t,Sm,"+")},RFC3986:function(t){return String(t)}}},Em),xm=Object.prototype.hasOwnProperty,_m={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},Tm=Array.isArray,Cm=Array.prototype.push,Im=function(t,e){Cm.apply(t,Tm(e)?e:[e])},Dm=Date.prototype.toISOString,km=Pm.default,Mm={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:wm.encode,encodeValuesOnly:!1,format:km,formatter:Pm.formatters[km],indices:!1,serializeDate:function(t){return Dm.call(t)},skipNulls:!1,strictNullHandling:!1},Rm=function t(e,n,r,o,i,a,s,l,u,c,h,p,d){var f,m=e;if("function"==typeof s?m=s(n,m):m instanceof Date?m=c(m):"comma"===r&&Tm(m)&&(m=wm.maybeMap(m,(function(t){return t instanceof Date?c(t):t})).join(",")),null===m){if(o)return a&&!p?a(n,Mm.encoder,d,"key"):n;m=""}if("string"==typeof(f=m)||"number"==typeof f||"boolean"==typeof f||"symbol"==typeof f||"bigint"==typeof f||wm.isBuffer(m))return a?[h(p?n:a(n,Mm.encoder,d,"key"))+"="+h(a(m,Mm.encoder,d,"value"))]:[h(n)+"="+h(String(m))];var g,v=[];if(void 0===m)return v;if(Tm(s))g=s;else{var y=Object.keys(m);g=l?y.sort(l):y}for(var w=0;w<g.length;++w){var b=g[w],S=m[b];if(!i||null!==S){var E=Tm(m)?"function"==typeof r?r(n,b):n:n+(u?"."+b:"["+b+"]");Im(v,t(S,E,r,o,i,a,s,l,u,c,h,p,d))}}return v},Am=(Object.prototype.hasOwnProperty,Array.isArray,function(t,e){var n,r=t,o=function(t){if(!t)return Mm;if(null!==t.encoder&&void 0!==t.encoder&&"function"!=typeof t.encoder)throw new TypeError("Encoder has to be a function.");var e=t.charset||Mm.charset;if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=Pm.default;if(void 0!==t.format){if(!xm.call(Pm.formatters,t.format))throw new TypeError("Unknown format option provided.");n=t.format}var r=Pm.formatters[n],o=Mm.filter;return("function"==typeof t.filter||Tm(t.filter))&&(o=t.filter),{addQueryPrefix:"boolean"==typeof t.addQueryPrefix?t.addQueryPrefix:Mm.addQueryPrefix,allowDots:void 0===t.allowDots?Mm.allowDots:!!t.allowDots,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:Mm.charsetSentinel,delimiter:void 0===t.delimiter?Mm.delimiter:t.delimiter,encode:"boolean"==typeof t.encode?t.encode:Mm.encode,encoder:"function"==typeof t.encoder?t.encoder:Mm.encoder,encodeValuesOnly:"boolean"==typeof t.encodeValuesOnly?t.encodeValuesOnly:Mm.encodeValuesOnly,filter:o,formatter:r,serializeDate:"function"==typeof t.serializeDate?t.serializeDate:Mm.serializeDate,skipNulls:"boolean"==typeof t.skipNulls?t.skipNulls:Mm.skipNulls,sort:"function"==typeof t.sort?t.sort:null,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:Mm.strictNullHandling}}(e);"function"==typeof o.filter?r=(0,o.filter)("",r):Tm(o.filter)&&(n=o.filter);var i,a=[];if("object"!=typeof r||null===r)return"";i=e&&e.arrayFormat in _m?e.arrayFormat:e&&"indices"in e?e.indices?"indices":"repeat":"indices";var s=_m[i];n||(n=Object.keys(r)),o.sort&&n.sort(o.sort);for(var l=0;l<n.length;++l){var u=n[l];o.skipNulls&&null===r[u]||Im(a,Rm(r[u],u,s,o.strictNullHandling,o.skipNulls,o.encode?o.encoder:null,o.filter,o.sort,o.allowDots,o.serializeDate,o.formatter,o.encodeValuesOnly,o.charset))}var c=a.join(o.delimiter),h=!0===o.addQueryPrefix?"?":"";return o.charsetSentinel&&("iso-8859-1"===o.charset?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),c.length>0?h+c:""});var Hm=function(t,e){for(var n=-1,r=e.length,o=t.length;++n<r;)t[o+n]=e[n];return t},Om="object"==typeof e&&e&&e.Object===Object&&e,Lm="object"==typeof self&&self&&self.Object===Object&&self,Bm=Om||Lm||Function("return this")(),Fm=Bm.Symbol,Nm=Object.prototype,jm=Nm.hasOwnProperty,Vm=Nm.toString,zm=Fm?Fm.toStringTag:void 0;var Wm=function(t){var e=jm.call(t,zm),n=t[zm];try{t[zm]=void 0;var r=!0}catch(t){}var o=Vm.call(t);return r&&(e?t[zm]=n:delete t[zm]),o},Gm=Object.prototype.toString;var Um=function(t){return Gm.call(t)},Ym=Fm?Fm.toStringTag:void 0;var Xm=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":Ym&&Ym in Object(t)?Wm(t):Um(t)};var Zm=function(t){return null!=t&&"object"==typeof t};var qm=function(t){return Zm(t)&&"[object Arguments]"==Xm(t)},Jm=Object.prototype,$m=Jm.hasOwnProperty,Km=Jm.propertyIsEnumerable,Qm=qm(function(){return arguments}())?qm:function(t){return Zm(t)&&$m.call(t,"callee")&&!Km.call(t,"callee")},tg=Array.isArray,eg=Fm?Fm.isConcatSpreadable:void 0;var ng=function(t){return tg(t)||Qm(t)||!!(eg&&t&&t[eg])};var rg=function t(e,n,r,o,i){var a=-1,s=e.length;for(r||(r=ng),i||(i=[]);++a<s;){var l=e[a];n>0&&r(l)?n>1?t(l,n-1,r,o,i):Hm(i,l):o||(i[i.length]=l)}return i};var og=function(t,e){for(var n=-1,r=null==t?0:t.length,o=Array(r);++n<r;)o[n]=e(t[n],n,t);return o};var ig=function(){this.__data__=[],this.size=0};var ag=function(t,e){return t===e||t!=t&&e!=e};var sg=function(t,e){for(var n=t.length;n--;)if(ag(t[n][0],e))return n;return-1},lg=Array.prototype.splice;var ug=function(t){var e=this.__data__,n=sg(e,t);return!(n<0)&&(n==e.length-1?e.pop():lg.call(e,n,1),--this.size,!0)};var cg=function(t){var e=this.__data__,n=sg(e,t);return n<0?void 0:e[n][1]};var hg=function(t){return sg(this.__data__,t)>-1};var pg=function(t,e){var n=this.__data__,r=sg(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};function dg(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}dg.prototype.clear=ig,dg.prototype.delete=ug,dg.prototype.get=cg,dg.prototype.has=hg,dg.prototype.set=pg;var fg=dg;var mg=function(){this.__data__=new fg,this.size=0};var gg=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n};var vg=function(t){return this.__data__.get(t)};var yg=function(t){return this.__data__.has(t)};var wg=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)};var bg=function(t){if(!wg(t))return!1;var e=Xm(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},Sg=Bm["__core-js_shared__"],Eg=function(){var t=/[^.]+$/.exec(Sg&&Sg.keys&&Sg.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();var Pg=function(t){return!!Eg&&Eg in t},xg=Function.prototype.toString;var _g=function(t){if(null!=t){try{return xg.call(t)}catch(t){}try{return t+""}catch(t){}}return""},Tg=/^\[object .+?Constructor\]$/,Cg=Function.prototype,Ig=Object.prototype,Dg=Cg.toString,kg=Ig.hasOwnProperty,Mg=RegExp("^"+Dg.call(kg).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Rg=function(t){return!(!wg(t)||Pg(t))&&(bg(t)?Mg:Tg).test(_g(t))};var Ag=function(t,e){return null==t?void 0:t[e]};var Hg=function(t,e){var n=Ag(t,e);return Rg(n)?n:void 0},Og=Hg(Bm,"Map"),Lg=Hg(Object,"create");var Bg=function(){this.__data__=Lg?Lg(null):{},this.size=0};var Fg=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Ng=Object.prototype.hasOwnProperty;var jg=function(t){var e=this.__data__;if(Lg){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return Ng.call(e,t)?e[t]:void 0},Vg=Object.prototype.hasOwnProperty;var zg=function(t){var e=this.__data__;return Lg?void 0!==e[t]:Vg.call(e,t)};var Wg=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Lg&&void 0===e?"__lodash_hash_undefined__":e,this};function Gg(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Gg.prototype.clear=Bg,Gg.prototype.delete=Fg,Gg.prototype.get=jg,Gg.prototype.has=zg,Gg.prototype.set=Wg;var Ug=Gg;var Yg=function(){this.size=0,this.__data__={hash:new Ug,map:new(Og||fg),string:new Ug}};var Xg=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var Zg=function(t,e){var n=t.__data__;return Xg(e)?n["string"==typeof e?"string":"hash"]:n.map};var qg=function(t){var e=Zg(this,t).delete(t);return this.size-=e?1:0,e};var Jg=function(t){return Zg(this,t).get(t)};var $g=function(t){return Zg(this,t).has(t)};var Kg=function(t,e){var n=Zg(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};function Qg(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Qg.prototype.clear=Yg,Qg.prototype.delete=qg,Qg.prototype.get=Jg,Qg.prototype.has=$g,Qg.prototype.set=Kg;var tv=Qg;var ev=function(t,e){var n=this.__data__;if(n instanceof fg){var r=n.__data__;if(!Og||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new tv(r)}return n.set(t,e),this.size=n.size,this};function nv(t){var e=this.__data__=new fg(t);this.size=e.size}nv.prototype.clear=mg,nv.prototype.delete=gg,nv.prototype.get=vg,nv.prototype.has=yg,nv.prototype.set=ev;var rv=nv;var ov=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this};var iv=function(t){return this.__data__.has(t)};function av(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new tv;++e<n;)this.add(t[e])}av.prototype.add=av.prototype.push=ov,av.prototype.has=iv;var sv=av;var lv=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1};var uv=function(t,e){return t.has(e)};var cv=function(t,e,n,r,o,i){var a=1&n,s=t.length,l=e.length;if(s!=l&&!(a&&l>s))return!1;var u=i.get(t),c=i.get(e);if(u&&c)return u==e&&c==t;var h=-1,p=!0,d=2&n?new sv:void 0;for(i.set(t,e),i.set(e,t);++h<s;){var f=t[h],m=e[h];if(r)var g=a?r(m,f,h,e,t,i):r(f,m,h,t,e,i);if(void 0!==g){if(g)continue;p=!1;break}if(d){if(!lv(e,(function(t,e){if(!uv(d,e)&&(f===t||o(f,t,n,r,i)))return d.push(e)}))){p=!1;break}}else if(f!==m&&!o(f,m,n,r,i)){p=!1;break}}return i.delete(t),i.delete(e),p},hv=Bm.Uint8Array;var pv=function(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n};var dv=function(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n},fv=Fm?Fm.prototype:void 0,mv=fv?fv.valueOf:void 0;var gv=function(t,e,n,r,o,i,a){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!i(new hv(t),new hv(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return ag(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var s=pv;case"[object Set]":var l=1&r;if(s||(s=dv),t.size!=e.size&&!l)return!1;var u=a.get(t);if(u)return u==e;r|=2,a.set(t,e);var c=cv(s(t),s(e),r,o,i,a);return a.delete(t),c;case"[object Symbol]":if(mv)return mv.call(t)==mv.call(e)}return!1};var vv=function(t,e,n){var r=e(t);return tg(t)?r:Hm(r,n(t))};var yv=function(t,e){for(var n=-1,r=null==t?0:t.length,o=0,i=[];++n<r;){var a=t[n];e(a,n,t)&&(i[o++]=a)}return i};var wv=function(){return[]},bv=Object.prototype.propertyIsEnumerable,Sv=Object.getOwnPropertySymbols,Ev=Sv?function(t){return null==t?[]:(t=Object(t),yv(Sv(t),(function(e){return bv.call(t,e)})))}:wv;var Pv=function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r};var xv=function(){return!1},_v=r((function(t,e){var n=e&&!e.nodeType&&e,r=n&&t&&!t.nodeType&&t,o=r&&r.exports===n?Bm.Buffer:void 0,i=(o?o.isBuffer:void 0)||xv;t.exports=i})),Tv=/^(?:0|[1-9]\d*)$/;var Cv=function(t,e){var n=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==n||"symbol"!=n&&Tv.test(t))&&t>-1&&t%1==0&&t<e};var Iv=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991},Dv={};Dv["[object Float32Array]"]=Dv["[object Float64Array]"]=Dv["[object Int8Array]"]=Dv["[object Int16Array]"]=Dv["[object Int32Array]"]=Dv["[object Uint8Array]"]=Dv["[object Uint8ClampedArray]"]=Dv["[object Uint16Array]"]=Dv["[object Uint32Array]"]=!0,Dv["[object Arguments]"]=Dv["[object Array]"]=Dv["[object ArrayBuffer]"]=Dv["[object Boolean]"]=Dv["[object DataView]"]=Dv["[object Date]"]=Dv["[object Error]"]=Dv["[object Function]"]=Dv["[object Map]"]=Dv["[object Number]"]=Dv["[object Object]"]=Dv["[object RegExp]"]=Dv["[object Set]"]=Dv["[object String]"]=Dv["[object WeakMap]"]=!1;var kv=function(t){return Zm(t)&&Iv(t.length)&&!!Dv[Xm(t)]};var Mv=function(t){return function(e){return t(e)}},Rv=r((function(t,e){var n=e&&!e.nodeType&&e,r=n&&t&&!t.nodeType&&t,o=r&&r.exports===n&&Om.process,i=function(){try{var t=r&&r.require&&r.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=i})),Av=Rv&&Rv.isTypedArray,Hv=Av?Mv(Av):kv,Ov=Object.prototype.hasOwnProperty;var Lv=function(t,e){var n=tg(t),r=!n&&Qm(t),o=!n&&!r&&_v(t),i=!n&&!r&&!o&&Hv(t),a=n||r||o||i,s=a?Pv(t.length,String):[],l=s.length;for(var u in t)!e&&!Ov.call(t,u)||a&&("length"==u||o&&("offset"==u||"parent"==u)||i&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Cv(u,l))||s.push(u);return s},Bv=Object.prototype;var Fv=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Bv)};var Nv=function(t,e){return function(n){return t(e(n))}}(Object.keys,Object),jv=Object.prototype.hasOwnProperty;var Vv=function(t){if(!Fv(t))return Nv(t);var e=[];for(var n in Object(t))jv.call(t,n)&&"constructor"!=n&&e.push(n);return e};var zv=function(t){return null!=t&&Iv(t.length)&&!bg(t)};var Wv=function(t){return zv(t)?Lv(t):Vv(t)};var Gv=function(t){return vv(t,Wv,Ev)},Uv=Object.prototype.hasOwnProperty;var Yv=function(t,e,n,r,o,i){var a=1&n,s=Gv(t),l=s.length;if(l!=Gv(e).length&&!a)return!1;for(var u=l;u--;){var c=s[u];if(!(a?c in e:Uv.call(e,c)))return!1}var h=i.get(t),p=i.get(e);if(h&&p)return h==e&&p==t;var d=!0;i.set(t,e),i.set(e,t);for(var f=a;++u<l;){var m=t[c=s[u]],g=e[c];if(r)var v=a?r(g,m,c,e,t,i):r(m,g,c,t,e,i);if(!(void 0===v?m===g||o(m,g,n,r,i):v)){d=!1;break}f||(f="constructor"==c)}if(d&&!f){var y=t.constructor,w=e.constructor;y==w||!("constructor"in t)||!("constructor"in e)||"function"==typeof y&&y instanceof y&&"function"==typeof w&&w instanceof w||(d=!1)}return i.delete(t),i.delete(e),d},Xv=Hg(Bm,"DataView"),Zv=Hg(Bm,"Promise"),qv=Hg(Bm,"Set"),Jv=Hg(Bm,"WeakMap"),$v=_g(Xv),Kv=_g(Og),Qv=_g(Zv),ty=_g(qv),ey=_g(Jv),ny=Xm;(Xv&&"[object DataView]"!=ny(new Xv(new ArrayBuffer(1)))||Og&&"[object Map]"!=ny(new Og)||Zv&&"[object Promise]"!=ny(Zv.resolve())||qv&&"[object Set]"!=ny(new qv)||Jv&&"[object WeakMap]"!=ny(new Jv))&&(ny=function(t){var e=Xm(t),n="[object Object]"==e?t.constructor:void 0,r=n?_g(n):"";if(r)switch(r){case $v:return"[object DataView]";case Kv:return"[object Map]";case Qv:return"[object Promise]";case ty:return"[object Set]";case ey:return"[object WeakMap]"}return e});var ry=ny,oy=Object.prototype.hasOwnProperty;var iy=function(t,e,n,r,o,i){var a=tg(t),s=tg(e),l=a?"[object Array]":ry(t),u=s?"[object Array]":ry(e),c="[object Object]"==(l="[object Arguments]"==l?"[object Object]":l),h="[object Object]"==(u="[object Arguments]"==u?"[object Object]":u),p=l==u;if(p&&_v(t)){if(!_v(e))return!1;a=!0,c=!1}if(p&&!c)return i||(i=new rv),a||Hv(t)?cv(t,e,n,r,o,i):gv(t,e,l,n,r,o,i);if(!(1&n)){var d=c&&oy.call(t,"__wrapped__"),f=h&&oy.call(e,"__wrapped__");if(d||f){var m=d?t.value():t,g=f?e.value():e;return i||(i=new rv),o(m,g,n,r,i)}}return!!p&&(i||(i=new rv),Yv(t,e,n,r,o,i))};var ay=function t(e,n,r,o,i){return e===n||(null==e||null==n||!Zm(e)&&!Zm(n)?e!=e&&n!=n:iy(e,n,r,o,t,i))};var sy=function(t,e,n,r){var o=n.length,i=o,a=!r;if(null==t)return!i;for(t=Object(t);o--;){var s=n[o];if(a&&s[2]?s[1]!==t[s[0]]:!(s[0]in t))return!1}for(;++o<i;){var l=(s=n[o])[0],u=t[l],c=s[1];if(a&&s[2]){if(void 0===u&&!(l in t))return!1}else{var h=new rv;if(r)var p=r(u,c,l,t,e,h);if(!(void 0===p?ay(c,u,3,r,h):p))return!1}}return!0};var ly=function(t){return t==t&&!wg(t)};var uy=function(t){for(var e=Wv(t),n=e.length;n--;){var r=e[n],o=t[r];e[n]=[r,o,ly(o)]}return e};var cy=function(t,e){return function(n){return null!=n&&(n[t]===e&&(void 0!==e||t in Object(n)))}};var hy=function(t){var e=uy(t);return 1==e.length&&e[0][2]?cy(e[0][0],e[0][1]):function(n){return n===t||sy(n,t,e)}};var py=function(t){return"symbol"==typeof t||Zm(t)&&"[object Symbol]"==Xm(t)},dy=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,fy=/^\w*$/;var my=function(t,e){if(tg(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!py(t))||(fy.test(t)||!dy.test(t)||null!=e&&t in Object(e))};function gy(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var n=function(){var r=arguments,o=e?e.apply(this,r):r[0],i=n.cache;if(i.has(o))return i.get(o);var a=t.apply(this,r);return n.cache=i.set(o,a)||i,a};return n.cache=new(gy.Cache||tv),n}gy.Cache=tv;var vy=gy;var yy=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,wy=/\\(\\)?/g,by=function(t){var e=vy(t,(function(t){return 500===n.size&&n.clear(),t})),n=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(yy,(function(t,n,r,o){e.push(r?o.replace(wy,"$1"):n||t)})),e})),Sy=Fm?Fm.prototype:void 0,Ey=Sy?Sy.toString:void 0;var Py=function t(e){if("string"==typeof e)return e;if(tg(e))return og(e,t)+"";if(py(e))return Ey?Ey.call(e):"";var n=e+"";return"0"==n&&1/e==-1/0?"-0":n};var xy=function(t){return null==t?"":Py(t)};var _y=function(t,e){return tg(t)?t:my(t,e)?[t]:by(xy(t))};var Ty=function(t){if("string"==typeof t||py(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e};var Cy=function(t,e){for(var n=0,r=(e=_y(e,t)).length;null!=t&&n<r;)t=t[Ty(e[n++])];return n&&n==r?t:void 0};var Iy=function(t,e,n){var r=null==t?void 0:Cy(t,e);return void 0===r?n:r};var Dy=function(t,e){return null!=t&&e in Object(t)};var ky=function(t,e,n){for(var r=-1,o=(e=_y(e,t)).length,i=!1;++r<o;){var a=Ty(e[r]);if(!(i=null!=t&&n(t,a)))break;t=t[a]}return i||++r!=o?i:!!(o=null==t?0:t.length)&&Iv(o)&&Cv(a,o)&&(tg(t)||Qm(t))};var My=function(t,e){return null!=t&&ky(t,e,Dy)};var Ry=function(t,e){return my(t)&&ly(e)?cy(Ty(t),e):function(n){var r=Iy(n,t);return void 0===r&&r===e?My(n,t):ay(e,r,3)}};var Ay=function(t){return t};var Hy=function(t){return function(e){return null==e?void 0:e[t]}};var Oy=function(t){return function(e){return Cy(e,t)}};var Ly=function(t){return my(t)?Hy(Ty(t)):Oy(t)};var By=function(t){return"function"==typeof t?t:null==t?Ay:"object"==typeof t?tg(t)?Ry(t[0],t[1]):hy(t):Ly(t)};var Fy=function(t){return function(e,n,r){for(var o=-1,i=Object(e),a=r(e),s=a.length;s--;){var l=a[t?s:++o];if(!1===n(i[l],l,i))break}return e}}();var Ny=function(t,e){return function(n,r){if(null==n)return n;if(!zv(n))return t(n,r);for(var o=n.length,i=e?o:-1,a=Object(n);(e?i--:++i<o)&&!1!==r(a[i],i,a););return n}}((function(t,e){return t&&Fy(t,e,Wv)}));var jy=function(t,e){var n=-1,r=zv(t)?Array(t.length):[];return Ny(t,(function(t,o,i){r[++n]=e(t,o,i)})),r};var Vy=function(t,e){return(tg(t)?og:jy)(t,By(e))},zy=/^\s+|\s+$/g,Wy=/^[-+]0x[0-9a-f]+$/i,Gy=/^0b[01]+$/i,Uy=/^0o[0-7]+$/i,Yy=parseInt;var Xy=function(t){if("number"==typeof t)return t;if(py(t))return NaN;if(wg(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=wg(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(zy,"");var n=Gy.test(t);return n||Uy.test(t)?Yy(t.slice(2),n?2:8):Wy.test(t)?NaN:+t};var Zy=function(t){return t?(t=Xy(t))===1/0||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0};var qy=function(t){var e=Zy(t),n=e%1;return e==e?n?e-n:e:0};var Jy=function(t,e,n){return n=void 0===n?1:qy(n),rg(Vy(t,e),n)};var $y,Ky,Qy,tw,ew,nw,rw,ow=function(t,e){return(null==t?0:t.length)?(e=void 0===e?1:qy(e),rg(t,e)):[]};function iw(){}iw.checkIsPhone=function(){var t=navigator.userAgent.toLowerCase(),e="ipad"==t.match(/ipad/i),n="iphone"==t.match(/iphone/i),r="midp"==t.match(/midp/i),o="rv:1.2.3.4"==t.match(/rv:1.2.3.4/i),i="ucweb"==t.match(/ucweb/i),a="android"==t.match(/android/i),s="windows ce"==t.match(/windows ce/i),l="windows mobile"==t.match(/windows mobile/i);return e||n||r||o||i||a||s||l},iw.isIPhoneX=function(){return"iphone"==navigator.userAgent.toLowerCase().match(/iphone/i)&&375==screen.width&&812==screen.height&&3==window.devicePixelRatio},iw.getUrlParameter=function(t){if(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(e);return n?decodeURIComponent(n[2]):null}},iw.existUrlParameter=function(t){return null!==this.getUrlParameter(t)},iw.setFullScreen=function(t){t?(document.documentElement.requestFullscreen&&document.documentElement.requestFullscreen(),document.documentElement.msRequestFullscreen&&document.documentElement.msRequestFullscreen(),document.documentElement.mozRequestFullScreen&&document.documentElement.mozRequestFullScreen(),document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)):(document.exitFullscreen&&document.exitFullscreen(),document.msExitFullscreen&&document.msExitFullscreen(),document.mozCancelFullScreen&&document.mozCancelFullScreen(),document.webkitExitFullscreen&&document.webkitExitFullscreen())},iw.isLandscape=function(){return window.matchMedia("(orientation: landscape)").matches},iw.addStats=function(t){var e=new Stats;t.appendChild(e.dom),function t(){e.update(),requestAnimationFrame(t)}()},iw.setCursorOnHover=function(t,e,n){t.style.cursor=e?"url("+n+"), pointer":"default"},iw.rgbaColorToString=function(t){return"rgba("+t.r+","+t.g+","+t.b+","+t.a+")"},iw.rgbColorToString=function(t){return"rgb("+t.r+","+t.g+","+t.b+")"},iw.intersection=function(t,e){var n,r=[],o=t.length,i=e.length;if(o>=i)for(var a=0;a<i;a++)n=e[a],t.indexOf(n)>=0&&r.push(n);else r=this.intersection(e,t);return r},iw.union=function(t,e){var n=t.concat(e);return this.unique(n)},iw.pushUniq=function(t,e){-1==t.indexOf(e)&&t.push(e)},iw.unique=function(t){return t.filter((function(t,e,n){return n.indexOf(t,0)===e}))},iw.copyArray=function(t){var e=[];return t.forEach((function(t){e.push(t)})),e},iw.remove=function(t,e){for(var n=t.indexOf(e);n>-1;)t.splice(n,1),n=t.indexOf(e)},iw.average=function(){var t,e=(t=[]).concat.apply(t,arguments);return e.reduce((function(t,e){return t+e}),0)/e.length},iw.saveAndDownload=function(t,e){var n=new Blob([t],{type:"text/plain"});window.URL=window.URL||window.webkitURL,window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder;var r=document.createElement("a");r.style.display="none",document.body.appendChild(r),r.href=URL.createObjectURL(n),r.download=e||"data.json",r.click()},iw.getFileName=function(t){if(t&&-1!==t.indexOf(".")){var e=t.split(".");return e[e.length-1]}},iw.isWebGLSupport=function(){try{var t=document.createElement("canvas");return!(!window.WebGLRenderingContext||!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(t){return!1}},iw.UUID8Bit=function(){for(var t=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],e="",n=0;n<8;++n){e+=t[Math.min(Math.floor(62*Math.random()),61)]}return e},iw.formatDateYMDHMS=function(t){if(t&&"object"===qf(t)&&"function"==typeof t.getFullYear){var e=t.getFullYear()+"-";return e+=("0"+(t.getMonth()+1)).slice(-2)+"-",e+=("0"+t.getDate()).slice(-2),e+=" "+("0"+t.getHours()).slice(-2)+":",e+=("0"+t.getMinutes()).slice(-2)+":",e+=("0"+t.getSeconds()).slice(-2)}return""},iw.formatAreaString=function(t,e,n){return e?Math.round(t/.3048/.3048)+"ft²":t.toFixed(n)+"㎡"},String.prototype.format=function(){if(0===arguments.length)return this;var t=arguments[0],e=this;if("object"===qf(t)){for(var n in t)e=e.replace(new RegExp("\\{"+n+"\\}","g"),t[n]);return e}for(var r=0;r<arguments.length;r++)e=e.replace(new RegExp("\\{"+r+"\\}","g"),arguments[r]);return e},iw.cloneDeep=function(t){return"function"==typeof _&&_.cloneDeep?_.cloneDeep(t):function t(e){if("object"!==qf(e))return e;var n=e instanceof Array?[]:{};for(var r in e)e.hasOwnProperty(r)&&(n[r]="object"===qf(e[r])?t(e[r]):e[r]);return n}(t)},iw.flatMap=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return t.flatMap?t.flatMap(e):Jy(t,e,n)},iw.flat=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t.flat?t.flat(e):ow(t,e)},iw.throttle=function(t,e){var n=null;return function(){var r=this,o=arguments;n||(n=setTimeout((function(){t.apply(r,o),n=null}),e))}},iw.debounce=function(t,e){var n;return function(){var r=this,o=arguments;n&&clearTimeout(n),n=setTimeout((function(){t.apply(r,o)}),e)}},iw.detectInfo=window.kfdetect||{},Date.prototype.pattern=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours()%12==0?12:this.getHours()%12,"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var n in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),/(E+)/.test(t)&&(t=t.replace(RegExp.$1,(RegExp.$1.length>1?RegExp.$1.length>2?"/u661f/u671f":"/u5468":"")+{0:"/u65e5",1:"/u4e00",2:"/u4e8c",3:"/u4e09",4:"/u56db",5:"/u4e94",6:"/u516d"}[this.getDay()+""])),e)new RegExp("("+n+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[n]:("00"+e[n]).substr((""+e[n]).length)));return t},iw.isJSON=function(t){return"object"==qf(t)&&t.constructor==Object},iw.Ajax={getJSON:function(t){return new Promise((function(e,n){var r=new XMLHttpRequest;r.open("GET",t,!0),r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status)e(r.response,r);else{var t={code:r.status,response:r.response};n(t,r)}},r.send()}))},getJSONAsync:function(t){var e=this;return $f(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.getJSON(t);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n)})))()},postJSON:function(t,e){return new Promise((function(n,r){var o=new XMLHttpRequest;o.open("POST",t,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){if(4===o.readyState)if(200===o.status)n(JSON.parse(o.responseText),o);else{var t={code:o.status,response:o.response};r(t,o)}},o.send(Am(e))}))},postJSONAsync:function(t,e){var n=this;return $f(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.postJSON(t,e);case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),r)})))()}},iw.getFloorByHeight=function(t){return Math.floor(Math.abs(t)/290)},iw.getMousePosition=function(t,e){var n=0,r=0;if("touchstart"===t.type||"touchmove"===t.type?(n=t.touches[0].pageX,r=t.touches[0].pageY):"touchend"===t.type?(n=t.changedTouches[0].pageX,r=t.changedTouches[0].pageY):(n=t.clientX,r=t.clientY),n/=e.clientWidth,r/=e.clientHeight,this.camera&&this.camera.viewPort){var o=this.camera.viewPort.left/e.clientWidth,i=this.camera.viewPort.top/e.clientHeight;n=(n-o)/(this.camera.viewPort.width/e.clientWidth),r=(r-i)/(this.camera.viewPort.height/e.clientHeight)}else{var a=e.getBoundingClientRect(),s=a.left,l=a.top,u=a.width,c=a.height;s/=e.clientWidth,l/=e.clientHeight,n=(n-s)/(u/=e.clientWidth),r=(r-l)/(c/=e.clientHeight)}var h=new THREE.Vector2;return h.x=2*n-1,h.y=2*-r+1,h},window.domain=(null===($y=window.appConfig)||void 0===$y?void 0:$y.defaultDomain)||"//vrhouse-test.oss-cn-shanghai.aliyuncs.com/",window.configUrl="//webresource.123kanfang.com/",window.language="cn",window.isPhone=iw.checkIsPhone(),window.lang={};var aw=function t(){Kf(this,t)};em(aw,"largeViewBgColor",4473924),em(aw,"switchAutoTimeout",(null===(Ky=window.appConfig)||void 0===Ky?void 0:Ky.switchAutoTimeout)||4e3),em(aw,"unitPerMetre",100),em(aw,"isIPhoneX",iw.isIPhoneX()),em(aw,"isDisplayPanoramaFirst",!0),em(aw,"floorPlanFirst",iw.getUrlParameter("floorPlanFirst")),em(aw,"enableBlurLoading",!1),em(aw,"cameraWalk",!0),em(aw,"alwaysDisplayThumbnail",!1),em(aw,"enableVRMode",!0),em(aw,"enableMeasurement",iw.getUrlParameter("enablemeasurement")),em(aw,"anisotropy",1),em(aw,"stereoHouseFirstPlayTimeout",2e3),em(aw,"autoPlayIntervalTime",5e3),em(aw,"autoPlayStepTime",500),em(aw,"isStartAutoPlay",!1),em(aw,"showCompass",!0),em(aw,"isWebGLSupport",iw.isWebGLSupport()),em(aw,"rotationOrder","YZX"),em(aw,"showDefaultBottom","true"===iw.getUrlParameter("showDefaultBottom")),em(aw,"noCache","true"===iw.getUrlParameter("noCache")),em(aw,"textFontFamily2D",null===(Qy=window.appConfig)||void 0===Qy?void 0:Qy.textFontFamily2D),em(aw,"productAnchorImageDomain",window.appConfig.productAnchorImageDomain);var sw=function t(){Kf(this,t)};em(sw,"width",(null===(tw=screen)||void 0===tw?void 0:tw.width)&&(isPhone?375:600)),em(sw,"height",(null===(ew=screen)||void 0===ew?void 0:ew.height)&&(isPhone?667:450));var lw=function t(){Kf(this,t)};em(lw,"gazeTime",1500),em(lw,"fov",93);var uw=function t(){Kf(this,t)};em(uw,"largeFov",60),em(uw,"smallFov",35),em(uw,"orbitControlsMaxDistance",200),em(uw,"orbitControlsMinDistance",isPhone?.6:.3),em(uw,"orbitControlsDampingFactor",.75),em(uw,"smallViewAutoRotateSpeed",.7),em(uw,"largeViewAutoRotateSpeed",1),em(uw,"largeViewZoomSpeed",.8),em(uw,"isLargeViewAutoRotate",!0),em(uw,"floorWithoutHighlightOpacity",.1),em(uw,"beamHeight",70),em(uw,"beamAddHeight",8),em(uw,"beamRadius",.5),em(uw,"beamBaseEnabled",!window.appConfig||!window.appConfig.beamBaseEnabled||window.appConfig.beamBaseEnabled),em(uw,"hotSpotNameHeight",40),em(uw,"entranceColor",{r:255,g:132,b:0,a:1}),em(uw,"hotSpotHighlightColor",window.appConfig&&window.appConfig.hotSpotHighlightColor?window.appConfig.hotSpotHighlightColor:{r:22,g:212,b:117,a:1}),em(uw,"animateStereoHotSpot",window.appConfig.animateStereoHotSpot),em(uw,"walkingAnimation",window.appConfig.walkingAnimation);var cw=function t(){Kf(this,t)};em(cw,"left",10),em(cw,"top",46),em(cw,"smallViewSize",120),em(cw,"marginTopPhone",16),em(cw,"cameraDepth",10),em(cw,"bgColor",0),em(cw,"bgOpacity",.4),em(cw,"sectorSize",160),em(cw,"cameraZoomInMaxMetre",30),em(cw,"smallViewMargin",.05),em(cw,"hotSpotSize",40),em(cw,"hotSpotNameMarginTop",-48),em(cw,"rulerPadding",30),em(cw,"rulerFontSize",isPhone?24:16),em(cw,"rulerTextPadding",10),em(cw,"floorPlanMargin",0),em(cw,"largeViewMargin",{left:2/sw.width,top:isPhone?45/sw.height:.2,right:2/sw.width,bottom:isPhone?83/sw.height:.2}),em(cw,"hotSpotNameColor",{black:{r:58,g:58,b:58,a:1},white:{r:255,g:255,b:255,a:1}});var hw=function t(){Kf(this,t)};em(hw,"maxFov",window.appConfig.panoramaFovRange&&window.appConfig.panoramaFovRange[1]||80),em(hw,"minFov",window.appConfig.panoramaFovRange&&window.appConfig.panoramaFovRange[0]||50),em(hw,"zoomSteps",3),em(hw,"defaultFov",window.appConfig.panoramaFov||80),em(hw,"logoSize",63),em(hw,"logoHeight",-100),em(hw,"logoOpacity",iw.getUrlParameter("logoOpacity")||(window.appConfig&&window.appConfig.hasOwnProperty("panoramaLogoOpacity")?window.appConfig.panoramaLogoOpacity:1)),em(hw,"logoUrl",iw.getUrlParameter("logoUrl")||null),em(hw,"companyName",iw.getUrlParameter("companyName")||(null===(nw=window.appConfig)||void 0===nw?void 0:nw.companyName)||null),em(hw,"isAutoRotateWhenStart",!0),em(hw,"autoRotateSpeed",isPhone?3:2),em(hw,"autoRotateDelay",4e3),em(hw,"showLoadingTipTimeout",500),em(hw,"inertiaFactor",.9),em(hw,"inertiaMovingFactor",.7),em(hw,"controlSpeed",.8),em(hw,"zoomSpeed",.8),em(hw,"hotSpotHeight",window.appConfig.isOutScene?5:-45),em(hw,"onlyShowThumbnailPanel",iw.existUrlParameter("onlyShowThumbnailPanel")),em(hw,"panoramaMouseEnabled",!iw.checkIsPhone()&&"editor"!==iw.getUrlParameter("mode")&&!window.appConfig.isOutScene&&window.appConfig.panoramaMouseEnabled),em(hw,"rulerTextSize",(null===(rw=window.appConfig)||void 0===rw?void 0:rw.rulerTextSize)||20),em(hw,"companyNameStatic",window.appConfig.companyNameStatic),em(hw,"companyNameSize",window.appConfig.companyNameSize?window.appConfig.companyNameSize:0),em(hw,"logoDepthWrite",window.appConfig.logoDepthWrite);var pw=function t(){Kf(this,t)};em(pw,"PanoramaManager",0),em(pw,"OrthographicLayer",1),em(pw,"FloorPlanManager",2),em(pw,"StereoHouseManager",3),em(pw,"PanoramaRoverLayer",4),em(pw,"PlanarHouseManager",5);var dw=function t(){Kf(this,t)};em(dw,"left",22),em(dw,"top",46),em(dw,"width",88),em(dw,"height",86);var fw=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;Kf(this,t),em(this,"hotSpotData",void 0),em(this,"showBestCameraView",!1),em(this,"isAutoRotate",hw.isAutoRotateWhenStart),em(this,"autoRotateDelay",hw.autoRotateDelay),em(this,"isPlayFadeAnimation",!1),em(this,"isCameraWalk",!1),em(this,"isUpdate",!1),this.hotSpotData=e}return tm(t,[{key:"onPanoramaImageLoaded",value:function(){}},{key:"onAnimationFinished",value:function(){}},{key:"clone",value:function(e){var n=new t(e);return n.showBestCameraView=this.showBestCameraView,n.isAutoRotate=this.isAutoRotate,n.autoRotateDelay=this.autoRotateDelay,n.isPlayFadeAnimation=this.isPlayFadeAnimation,n.isCameraWalk=this.isCameraWalk,n.isUpdate=this.isUpdate,n}}]),t}();function mw(){}var gw={hotSpotHighlight:"",animateArrow:"",animateCircular:"",hotSpotLight:"",hotSpotFeet:"",hotSpotSector:"",hotSpotPoint:"",beamBase:"",compass_2d:"",hand:"",circle:"",entranceDirectionAnimation:"",labelRoomBg:"",pcCompassEmpty:"",pcCompass:"",pcCompassEmptyNoDirection:"",pcCompassNoDirection:"",pcCompassLogo:"",anchor:"",anchorHover:"",entranceArrow:"",hotSpotStatic:"",hotSpotLoadStatic:"",hotSpotClicked:"",waterMark:"",arrow:"",anchorOutScene:"",anchorBackground:"",productAnchor:"",textAnchor:"",iframeAnchor:"",hrefAnchor:"",videoAnchor:"",imageAnchor:"",audioAnchor:"",balloonAnchor:"",anchorDetailDefaultImg:"",hotSpotOutScene:"",flyIcon:"",roamArrow:"",stairArrow:"",walkingAnimation:"",ThreeDAnchorBg:"",ThreeDAnchorPlane:""};mw.init=function(t,e){var n=this;if(this.publicPath=t||"","object"===qf(e)){var r=new Set,o=Object.keys(gw);o.forEach((function(n){n in e&&(gw[n]=t+e[n],r.add(n))})),console.log("HouseViewer.Resources required texture paths inited!"),o.length!==r.size&&console.log("Some Required texture paths are not given "),o.forEach((function(t){""===gw[t]?console.log("{0} is not given!".format(t)):"string"!=typeof gw[t]?console.log("path for [{0}] is invalid! given path: {1}".format(t,gw[t])):n.path[t]=gw[t]}))}else console.log("HouseViewer.Resources init error! need subPaths")},mw.path={},mw.publicPath="";var vw=function(){function t(e){Kf(this,t),console.log("VRApp执行了",e),this.id=iw.UUID8Bit();var n=new THREE.WebGLRenderer({antialias:!0});n.sortObjects=!1,n.setPixelRatio(window.devicePixelRatio),n.autoClearColor=!1,window.addEventListener("unload",n.dispose);var r=n.capabilities?n.capabilities.getMaxAnisotropy():1;this.anisotropy=r>=2?2:1,this.screenWidth=e.mainContainerWidth||t.defaultScreenWidth,this.screenHeight=e.mainContainerHeight||t.defaultScreenHeight,n.setSize(this.screenWidth,this.screenHeight),this.container=e.mainContainer,this.renderer=n,this.container.appendChild(this.renderer.domElement),this.scene=new THREE.Scene,window.scene=this.scene,this.scene.data=this,this.objects=[],this.isWindowResized=!1;var o=new THREE.Object3D;o.name="root",this.scene.add(o),this.root=o,this.needsUpdate=!0,this.updateCount=30}return tm(t,[{key:"run",value:function(){this.updateAll(),this.update();var t=this;requestAnimationFrame((function(){t.run()}))}},{key:"update",value:function(){}},{key:"updateAll",value:function(){var t=this;if(this.needsUpdate||!(this.updateCount--<=0)){var e=this.renderer.domElement;this.screenWidth===e.clientWidth&&this.screenHeight===e.clientHeight||(this.screenWidth=e.clientWidth,this.screenHeight=e.clientHeight,this.isWindowResized=!0,this.onWindowResize(this.screenWidth,this.screenHeight)),this.objects.forEach((function(e){t.isWindowResized&&e.resizeWindow(),e.updateAll()})),this.isWindowResized=!1,this.needsUpdate&&(this.updateCount=30)}}},{key:"addObject",value:function(t){this.objects.push(t),this.root.add(t.object3D),t.startAll&&t.startAll()}},{key:"onWindowResize",value:function(t,e){this.renderer.setSize(t,e),window.scrollTo(0,0)}},{key:"dispose",value:function(){this.needsUpdate=!1,this.root.children.slice().forEach((function(t){t.dispose()})),this.renderer.dispose(),this.objects.splice(0,this.objects.length),this.needsUpdate=!0}}]),t}();em(vw,"defaultScreenWidth",window.innerWidth),em(vw,"defaultScreenHeight",window.innerHeight);var yw=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";Kf(this,t),this.object3D=new THREE.Object3D,this.object3D.name=e||this.constructor.name,this._scene=void 0,this._renderer=void 0,this._isStarted=!1,this.children=[]}return tm(t,[{key:"getApp",value:function(){var t=this.scene;return t?t.data:null}},{key:"onWindowResize",value:function(t,e){}},{key:"resizeWindow",value:function(){this.onWindowResize(this.screenWidth,this.screenHeight),this.children.forEach((function(t){return t.resizeWindow()}))}},{key:"start",value:function(){}},{key:"startAll",value:function(){if(!this._isStarted&&this.scene){try{this.start()}catch(t){console.error("Update failed, {0}: {1}".format(this.object3D.name,t.stack))}this._isStarted=!0}this.children.forEach((function(t){return t.startAll()}))}},{key:"update",value:function(){}},{key:"updateAll",value:function(){if(this.object3D.visible){try{this.update()}catch(t){console.error("Update failed, {0}: {1}".format(this.object3D.name,t.stack))}this.children.forEach((function(t){return t.updateAll()}))}}},{key:"show",value:function(){this.object3D.visible=!0}},{key:"hide",value:function(){this.object3D.visible=!1}},{key:"setLayer",value:function(t){this.object3D.setLayer(t)}},{key:"setRenderOrder",value:function(t){this.object3D.setRenderOrder(t)}},{key:"addChild",value:function(t){this.children.push(t),this.object3D.add(t.object3D),this.startAll()}},{key:"screenWidth",get:function(){return this.getApp()?this.getApp().screenWidth:vw.defaultScreenWidth}},{key:"screenHeight",get:function(){return this.getApp()?this.getApp().screenHeight:vw.defaultScreenHeight}},{key:"scene",get:function(){if(this._scene)return this._scene;var t=void 0;if(this.object3D){for(var e=this.object3D;e.parent;)e=e.parent;"Scene"===e.type&&(t=e,this._scene=t)}return t}},{key:"renderer",get:function(){if(this._renderer)return this._renderer;var t=this.getApp();return this._renderer=t?t.renderer:null,this._renderer}},{key:"visible",get:function(){return this.object3D.visible}}]),t}();function ww(){}THREE.Texture.prototype.isCancelled=!1,ww.maxRunningNum=5,ww.taskQueue=[],ww.runningTasks=[],ww.preparedResources=[],ww.cubeTextureLoader=void 0,ww.textureLoader=void 0,ww.jsonLoader=void 0,ww.fileLoader=void 0,ww.retryNum=3,ww.noCache=!1,ww.cache=[],ww.renderer=null,ww.preRenderList=[];var bw="json",Sw="svg",Ew="texture",Pw="font",xw="txt",_w="obj",Tw="gltf",Cw="glb";function Iw(){this.onPress=function(t,e,n){},this.onclick=function(t,e){},this.ondblclick=function(t,e){},this.onHover=function(t,e,n){},this.onMouseout=function(t,e){},this.onDragStart=function(t){},this.onDrag=function(t,e,n,r){},this.onDragEnd=function(t){},this.onMouseMove=function(t,e){},this.onPointMove=function(t,e){},this.onMouseDown=function(t,e){},this.onMouseUp=function(t,e){},this.onPress=null,this.onclick=null,this.ondblclick=null,this.onHover=null,this.onMouseout=null,this.onMouseMove=null,this.onPointMove=null,this.onMouseDown=null,this.onMouseUp=null,this.onDragStart=null,this.onDrag=null,this.onDragEnd=null,this.object3D=null,this.camera=null,this.enabled=!0,this.isMouseIn=!1,this.intersect=null,this.isPressDown=!1,this.isStartDrag=!1,this.mousePosition=null;var t=this,e=null,n=null,r=!1,o=null,i=null,a=null;this.dispose=function(){var t=Dw.events.indexOf(this);-1!==t&&Dw.events.splice(t,1)},this.processDragEvent=function(e,n,r){"touchend"===e.type||"mouseup"===e.type?t.isStartDrag&&(t.isPressDown=!1,t.isStartDrag=!1,t.onDragEnd&&t.onDragEnd(t.object3D)):"mousemove"!==e.type&&"touchmove"!==e.type||(t.isPressDown&&!t.isStartDrag&&r===this?function(){if(!t.onDragStart&&!t.onDrag)return;if(!o)return void console.log("please set intersectObj using function event.dragOnObject");var e=t.getIntersectOnObject(o,i);if(!e)return;var n=t.object3D.realPosition||t.object3D.getWorldPosition(new THREE.Vector3);a=n.clone().sub(e.point),t.isStartDrag=!0,t.onDragStart&&t.onDragStart(t.object3D)}():t.isPressDown&&t.isStartDrag&&function(){var e=t.getIntersectOnObject(o,i);if(!e)return;var n=t.object3D.realPosition||t.object3D.getWorldPosition(new THREE.Vector3),r=e.point.clone().add(a),s=r.clone().sub(n);t.onDrag&&t.onDrag(t.object3D,s,r,t)}())},this.dragOnObject=function(e,n){return o=e,i=n,t},this.processPressUpEvent=function(o,i){!function(o){var i="touchend"===o.type?Dw.touchMoveThreshold:Dw.mouseMoveThreshold,a=e&&t.mousePosition.distanceTo(e)>i;r||!t.isPressDown||a||(t.getActionIncludesParent("ondblclick")?n=setTimeout((function(){n=null,t.click()}),Dw.doubleClickInterval):t.click());t.isPressDown=!1,t.press(!1),r=!1}(o)},this.processEvent=function(o,i,a){"touchstart"!==o.type&&"mousedown"!==o.type||function(){(new Date).getTime(),e=t.mousePosition,n&&(t.dblclick(),clearTimeout(n),n=null,r=!0);t.isPressDown=!0,t.press(!0),document.body.click()}(),"mousemove"===o.type&&t.object3D&&t.invokeAction("onMouseMove",t),"mousedown"===o.type&&t.object3D&&t.invokeAction("onMouseDown",t),"mouseup"===o.type&&t.object3D&&t.invokeAction("onMouseUp",t)},this.getIntersectOnObject=function(t,e,n){var r=void 0;if(e||(e=this.camera),n||(n=this.mousePosition),e){var o=new THREE.Raycaster;o.setFromCamera(n,e),o.layers.mask=t.layers.mask,r=o.intersectObject(t,!0)[0]}return r},this.press=function(t){this.onPress&&this.onPress(this.object3D,t,this.intersect)},this.invokeAction=function(t){for(var e=this.getActionIncludesParent(t),n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];e&&e.apply(void 0,[this.object3D].concat(r))},this.getActionIncludesParent=function(t){var e,n;return null!==(e=this[t])&&void 0!==e?e:null===(n=Dw.getEvent(this.object3D.parent))||void 0===n?void 0:n.getActionIncludesParent(t)},this.click=function(){this.invokeAction("onclick",this.intersect)},this.dblclick=function(){this.invokeAction("ondblclick",this.intersect)},this.hasMoveEvent=function(){return!!(t.onHover||t.onMouseout||t.onMouseMove||t.onPointMove)},this.hasDragEvent=function(){return!!t.onDrag||!!t.onDragStart||!!t.onDragEnd},this.hasPressEvent=function(){return!!t.onPress||!!t.onclick||!!t.ondblclick}}function Dw(){}ww.getResourceLoader=function(t){var e=null;switch(t){case bw:e=ww.getJsonLoader();break;case Sw:console.error("not implement!!!");break;case Ew:e=ww.getTextureLoader();break;case Pw:e=ww.getFontLoader();break;case xw:e=ww.getFileLoader();break;case _w:e=ww.getOBJLoader2();break;case Tw:case Cw:e=ww.getGltfLoader()}return e},ww.getCubeTextureLoader=function(){return ww.cubeTextureLoader||(ww.cubeTextureLoader=new THREE.CubeTextureLoader),ww.cubeTextureLoader},ww.getTextureLoader=function(){return ww.textureLoader||(ww.textureLoader=new THREE.TextureLoader),ww.textureLoader},ww.getJsonLoader=function(){return ww.jsonLoader||(ww.jsonLoader=new THREE.JSONLoader,ww.jsonLoader.crossOrigin=!0),ww.jsonLoader},ww.getFileLoader=function(){return ww.fileLoader||(ww.fileLoader=new THREE.FileLoader,ww.fileLoader.crossOrigin=!0),ww.fileLoader},ww.getFontLoader=function(){return ww.fontLoader||(ww.fontLoader=new THREE.FontLoader,ww.fontLoader.crossOrigin=!0),ww.fontLoader},ww.getOBJLoader2=function(){var t=function(){};return t.load=function(t,e,n,r){var o=new THREE.OBJLoader2;o.setLogging(!1,!1),o.loadMtl(t.replace(".obj",".mtl"),null,(function(i){o.setMaterials(i),o.load(t.replace(".mtl",".obj"),(function(t){e&&e(t.detail.loaderRootNode)}),n,(function(t){r&&r(t)}),null,!0)}))},t},ww.getGltfLoader=function(){return ww.gltfLoader||(ww.gltfLoader=new THREE.GLTFLoader,ww.gltfLoader.crossOrigin=!0),ww.gltfLoader},ww.getType=function(t){t||console.info("no url");var e=void 0,n=iw.getFileName(t);switch(n=n.toLowerCase()){case"jpg":case"png":e=Ew;break;case"js":e=bw;break;case"font":e=Pw;break;case"txt":e=xw;break;case"obj":e=_w;break;case"gltf":e=Tw;break;case"glb":e=Cw;break;default:e=Ew}return e},ww.Task=function(t,e,n,r,o){this.url=t,this.onLoad=n,this.onProgress=r,this.onError=o,this.isPreRender=e,this.priority=100;var i=this;this.run=function(){ww.loadResource(this.url,(function(t){for(var e=0;e<ww.runningTasks.length;e++)if(ww.runningTasks[e]===i){ww.runningTasks.splice(e,1);break}ww.runTasks(),i.onLoad&&i.onLoad(t)}),this.onProgress,this.onError,this.isPreRender)}},ww.runTasks=function(){var t=ww.maxRunningNum-ww.runningTasks.length;if(0!==t&&0!==ww.taskQueue.length){t=Math.min(t,ww.taskQueue.length);for(var e=0;e<t;e++){var n=ww.taskQueue.shift();ww.runningTasks.push(n),n.run()}}},ww.loadGLTFScene=function(){var t=$f(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){(new THREE.GLTFLoader).load(e,(function(e){e?t(e.scene):(console.err("Failed to get gltf file!"),n())}),(function(t){var n=t.total/1e3/1e3;e.split("/");n>.5&&(window.exceedingGUID[e]=n+"M")}),(function(e){return t("error")}))})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),ww.loadOBJResource=function(){var t=$f(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=e.replace(".obj",""),t.abrupt("return",new Promise((function(t,n){(new THREE.MTLLoader).load(e+".mtl",(function(r){if(r.preload(),r){var o=new THREE.OBJLoader;o.setMaterials(r),o.load(e+".obj",(function(e){t(e)}))}else console.err("Failed to get mtl file!"),n()}))})));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),ww.loadMTLResource=function(){var t=$f(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){(new THREE.MTLLoader).load(e+".mtl",(function(e){e.preload(),e?t(e.materials):(console.err("Failed to get mtl file!"),n())}))})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),ww.loadCubeTexture=function(t,e,n,r){ww.noCache&&(t=t.map((function(t){return t+"?"+iw.UUID8Bit()})));var o=ww.getCubeTextureLoader().load(t,e,n,r);return o.generateMipmaps=!1,o.magFilter=THREE.LinearFilter,o.minFilter=THREE.LinearFilter,o.format=THREE.RGBAFormat,o},ww.loadResource=function(t,e,n,r,o){var i=ww.preparedResources[t],a=0,s=ww.getType(t);function l(t,n){var r;switch(s){case Ew:case Sw:case Pw:case xw:case _w:case Tw:case Cw:r=t;break;case bw:r={geometry:t,materials:n}}r.isCancelled||(s===Ew&&ww.renderer&&o&&ww.preRenderList.push(r),e&&e(r))}function u(t,e){s===Ew&&(t.needsUpdate=!0),l(t,e)}if(i)delete ww.preparedResources[t],e&&e(i);else{ww.noCache&&(t+="?"+iw.UUID8Bit()),t=t.replace("\\","/"),(i=ww.getResourceLoader(s).load(t,l,n,(function e(o){if(i)if(!i.isCancelled&&a<ww.retryNum){var l=ww.getResourceLoader(s).load(t,u,n,e);s===Ew&&(i.image=l.image),a++}else r&&r(o)})))&&(i.isCancelled=!1)}return i},ww.preRender=function(t){if(t&&(ww.renderer=t),ww.preRenderList.length>0){var e=ww.preRenderList.shift();ww.renderer.setTexture2D(e,0)}requestAnimationFrame((function(){ww.preRender()}))},ww.loadResourceInQueue=function(t,e,n,r,o){var i=new ww.Task(t,o,e,n,r);ww.taskQueue.push(i),ww.runTasks()},ww.loadResources=function(t,e,n,r,o,i){var a=[],s=0;function l(l){return ww.loadResource(t[l],(function(o){!function(o,i){a[o]=i,++s,e&&e(t[o],i),r&&r(Math.floor(100*s/t.length+.5)),s===t.length&&n&&n(a)}(l,o)}),null,o,i)}if(0===t.length)n&&n([]);else for(var u=0;u<t.length;++u)a[u]=l(u);return a},ww.cancelTextures=function(t){t&&t.forEach((function(t){return ww.cancelTexture(t)}))},ww.cancelTexture=function(t){t.image&&(t.image.src="",t.image=null),t.needsUpdate=!1,t.dispose(),t.isCancelled=!0},ww.prepareResources=function(t,e,n,r){ww.loadResources(t,(function(t,e){ww.preparedResources[t]=e}),e,n,r,!0)},THREE.Object3D.prototype.ignoreEvent=!1,Dw.events=[],Dw.changeCamera=!1,Dw.doubleClickInterval=150,Dw.touchMoveThreshold=.01,Dw.mouseMoveThreshold=.005,Dw.vrEnabled=!1,Dw.listen=function(t){var e=new THREE.Raycaster,n=null,r=null;function o(n){var r=s(n,e);null==r||r.processEvent(n,e,t),function(e,n){n&&("touchend"!==e.type&&"mouseup"!==e.type||n.enabled&&n.processPressUpEvent(e,t))}(n,r),function(t,e){"mousemove"===t.type&&(Dw.events.forEach((function(t){t!==e&&t.isMouseIn&&(t.isMouseIn=!1,t.onHover&&t.onHover(t.object3D,!1,e),t.onMouseout&&t.onMouseout(t.object3D,!0)),t.onPointMove&&t.onPointMove(t.object3D,t)})),e&&!e.isMouseIn&&(e.isMouseIn=!0,e.onHover&&e.onHover(e.object3D,!0,e)))}(n,r),function(e,n){Dw.events.forEach((function(r){r.enabled&&r.processDragEvent(e,t,n)}))}(n,r)}function i(t,e,n,r){var o=t.getRoot().getChildren(!0).filter((function(t){return-1!==t.type.indexOf("Camera")&&t.isVisible()})).sort((function(t,e){return t.renderOrder-e.renderOrder}));if(0===o.length)return[];var i,s=[],l=fm(o);try{for(l.s();!(i=l.n()).done;){var u=i.value,c=r?new THREE.Vector2:a(u,e,n);c.x>=-1&&c.x<=1&&c.y>=-1&&c.y<=1&&s.push({camera:u,mousePosition:c})}}catch(t){l.e(t)}finally{l.f()}var h=s[0].camera.renderOrder;return s=s.filter((function(t){return t.camera.renderOrder===h}))}function a(t,e,n){var r=0,o=0;if("touchstart"===e.type||"touchmove"===e.type?(r=e.touches[0].pageX,o=e.touches[0].pageY):"touchend"===e.type?(r=e.changedTouches[0].pageX,o=e.changedTouches[0].pageY):(r=e.clientX,o=e.clientY),n&&n.viewPort){var i=n.viewPort;r=(r-i.left)/i.width,o=(o-i.top)/i.height}else if(t&&t.viewPort){var a=t.viewPort.left/n.clientWidth,s=t.viewPort.top/n.clientHeight;r=(r-a)/(t.viewPort.width/n.clientWidth),o=(o-s)/(t.viewPort.height/n.clientHeight)}else{r/=n.clientWidth,o/=n.clientHeight;var l=n.getBoundingClientRect(),u=l.left,c=l.top,h=l.width,p=l.height;u/=n.clientWidth,c/=n.clientHeight,r=(r-u)/(h/=n.clientWidth),o=(o-c)/(p/=n.clientHeight)}var d=new THREE.Vector2;return d.x=2*r-1,d.y=2*-o+1,d}function s(e,n,r){var o=function(t){var e=!!t&&("mousemove"===t.type||"touchmove"===t.type);return Dw.events.flatMap((function(t){var n=t.enabled&&t.object3D&&t.object3D instanceof THREE.Object3D,r=t.hasMoveEvent()||t.hasDragEvent()&&t.isPressDown,o=t.hasPressEvent()||t.hasDragEvent();return((n=n&&(e?r:o))?[t.object3D].concat(hm(t.object3D.getChildren(!0))):[]).filter((function(t){return!t.ignoreEvent}))}))}(e);if(!(o.length<=0)){var a,s,u=fm(o.filter((function(t){return"Group"===t.type})));try{for(u.s();!(s=u.n()).done;){if(0!==(a=i(s.value,e,t,r)).length)break}}catch(t){u.e(t)}finally{u.f()}if(0!==a.length){var c=[];if(a.forEach((function(t){var r=o.filter((function(e){return e.isVisible(t.camera.layers)}));n.setFromCamera(t.mousePosition,t.camera),n.layers.mask=t.camera.layers.mask,c.push.apply(c,hm(n.intersectObjects(r))),Dw.events.filter((function(e){var n;return null===(n=e.object3D)||void 0===n?void 0:n.layers.test(t.camera.layers)})).forEach((function(n,r){n.intersect=void 0,n.mousePosition=t.mousePosition,n.domEvent=e,n.camera=t.camera}))})),c.sort(l),!(c.length<=0)){var h=Dw.getEvent(c[0].object);if(h)return h.intersect=c[0],h}}}}function l(t,e){var n=(e.object.eventOrder?e.object.eventOrder:0)-(t.object.eventOrder?t.object.eventOrder:0),r=e.object.layers.mask-t.object.layers.mask,o=e.object.renderOrder-t.object.renderOrder,i=t.distance-e.distance;return 0!==n?n:0!==r?r:0!==o?o:i}t.attachEvent?(t.attachEvent("touchstart",o,!1),t.attachEvent("touchend",o,!1),t.attachEvent("touchmove",o,!1),t.attachEvent("mousedown",o,!1),t.attachEvent("mouseup",o,!1),t.attachEvent("mousemove",o,!1)):(t.addEventListener("touchstart",o,!1),t.addEventListener("touchend",o,!1),t.addEventListener("touchmove",o,!1),t.addEventListener("mousedown",o,!1),t.addEventListener("mouseup",o,!1),t.addEventListener("mousemove",o,!1)),function t(){(function(){if(!Dw.events)return;for(var t=Dw.events.length-1;t>=0;t--){var e=Dw.events[t];e.object3D&&e.object3D.parent||Dw.events.splice(t,1)}})(),Dw.vrEnabled?(o=s(null,e,!0),r!==o&&(clearTimeout(n),null!==o&&(n=setTimeout((function(){o.onclick&&o.onclick(o.object3D,o.intersect)}),1500))),r=o):(r=null,null!==n&&(clearTimeout(n),n=null)),requestAnimationFrame(t);var o}()},Dw.get=function(t){if(t){var e=Dw.getEvent(t,!1);return e||((e=new Iw).object3D=t,Dw.events.push(e)),e}},Dw.remove=function(t){if(t)for(var e=0;e<Dw.events.length;e++)if(Dw.events[e].object3D===t)return void Dw.events.splice(e,1)},Dw.getEvent=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=Dw.events.find((function(e){return e.object3D===t}));return n||(e&&t.parent?Dw.getEvent(t.parent,e):void 0)};var kw=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Kf(this,t),this.isPlaying=!1,this.animationFrame=null,this.progress=0,this.promiseResolve=void 0,this.params=e,this.duration=n,this.play=this.play.bind(this)}var e;return tm(t,[{key:"onStart",value:function(t){}},{key:"onUpdate",value:function(t,e){}},{key:"onPostUpdate",value:function(t,e){}},{key:"onFinish",value:function(t,e){}},{key:"playAsync",value:(e=$f(regeneratorRuntime.mark((function t(e){var n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t){n.promiseResolve=t,n.play(e)}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)}))),function(t){return e.apply(this,arguments)})},{key:"play",value:function(t){this.params=nm(this.params,t);var e=this;e.isPlaying=!0;var n=(new Date).getTime();return function t(){if(e.isPlaying){var r=0;e.duration>0&&(r=((new Date).getTime()-n)/e.duration),r>=1?(r=1,e.progress=r,e.onUpdate(e.params,r),e.onPostUpdate(e.params,r),e.stop()):(0===r&&e.onStart(e.params),e.progress=r,e.onUpdate(e.params,r),e.onPostUpdate(e.params,r),e.animationFrame=requestAnimationFrame((function(){t()})))}}(),this}},{key:"stop",value:function(){var t=this.progress>=1;return this.isPlaying?(this.isPlaying=!1,this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=void 0),this.onFinish(this.params,t),this.promiseResolve&&(this.promiseResolve({params:this.params,isCompleted:t}),this.promiseResolve=void 0),t):t}}]),t}();function Mw(){}Mw.createTextSprite=function(t,e){var n=document.createElement("canvas");e=Mw.mergeWithDefaultParameters(e),Mw.setCanvas(n,t,e);var r=new THREE.Texture;Mw.setTextTexture(r,n,e);var o=new THREE.SpriteMaterial({map:r,transparent:!0,alphaTest:.01,sizeAttenuation:e.sizeAttenuation}),i=new THREE.Sprite(o);return i.text=t,Mw.setTextSpriteScale(i,e),i},Mw.updateTextSprite=function(t,e,n){t.text=e;var r=t.material.map,o=r.image;n=n||r.parameters,o.getContext("2d").clearRect(0,0,o.width,o.height),n=Mw.mergeWithDefaultParameters(n),Mw.setCanvas(o,e,n),Mw.setTextTexture(r,o,n),Mw.setTextSpriteScale(t,n)},Mw.setTextSpriteScale=function(t,e){var n=t.material.map,r=e.spriteScale?e.spriteScale:1;t.scale.set(n.scaleX*r,n.scaleY*r,1),t.defaultScale=t.scale.clone()},Mw.setTextTexture=function(t,e,n){return t.image=e,t.anisotropy=n.anisotropy?n.anisotropy:1,t.minFilter=n.anisotropy?n.minFilter:THREE.LinearFilter,t.needsUpdate=!0,t.parameters=n,t.scaleX=e.width,t.scaleY=e.height,t},Mw.mergeWithDefaultParameters=function(t){t=t||{};return t=nm({fontFace:"sans-serif",fontSize:18,fontWeight:"normal",textMargin:34,borderThickness:0,borderColor:{r:0,g:0,b:0,a:0},backgroundColor:{r:0,g:0,b:0,a:0},textColor:{r:255,g:255,b:255,a:1},cornerWidth:0,textAlign:"center",enableShadow:!1,shadowColor:{r:0,g:0,b:0,a:0},shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,sizeAttenuation:!0,imageSmoothingEnabled:!0,imageSmoothingQuality:"high"},t=Mw.changeFontFaceForMacOrWin(t))},Mw.setCanvas=function(t,e,n){var r=t.getContext("2d");r.font="normal "+n.fontSize+"px "+n.fontFace;var o,i=n.textMargin/3,a=e.split("\n"),s=a.length,l=0;a.forEach((function(t){(o=r.measureText(t).width)>l&&(l=o)}));var u=l+2*n.textMargin+2*n.borderThickness,c=s*n.fontSize+(s-1)*i+n.textMargin+2*n.borderThickness;n.leftIco&&(u+=n.fontSize),n.rightIco&&(u+=n.fontSize),t.width=u,t.height=c,r.fillStyle=iw.rgbaColorToString(n.backgroundColor),r.strokeStyle=iw.rgbaColorToString(n.borderColor),r.font=n.fontWeight+" "+n.fontSize+"px "+n.fontFace,r.textBaseline="middle",r.textAlign=n.textAlign,r.lineWidth=n.borderThickness,n.enableShadow&&(r.shadowColor=iw.rgbaColorToString(n.shadowColor),r.shadowOffsetX=n.shadowOffsetX,r.shadowOffsetY=n.shadowOffsetY,r.shadowBlur=n.shadowBlur);var h,p,d,f,m,g,v=n.cornerWidth/n.fontSize*c;h=r,p=n.borderThickness,d=n.borderThickness,f=u-2*n.borderThickness,m=c-2*n.borderThickness,g=v,h.beginPath(),h.moveTo(p+g,d),h.lineTo(p+f-g,d),h.quadraticCurveTo(p+f,d,p+f,d+g),h.lineTo(p+f,d+m-g),h.quadraticCurveTo(p+f,d+m,p+f-g,d+m),h.lineTo(p+g,d+m),h.quadraticCurveTo(p,d+m,p,d+m-g),h.lineTo(p,d+g),h.quadraticCurveTo(p,d,p+g,d),h.closePath(),h.fill(),h.stroke(),n.rightIco&&n.rightIcoBackground&&(r.fillStyle=iw.rgbaColorToString(n.rightIcoBackground),function(t,e,n,r,o,i){t.beginPath(),t.moveTo(e,n),t.lineTo(e+r-i,n),t.quadraticCurveTo(e+r,n,e+r,n+i),t.lineTo(e+r,n+o-i),t.quadraticCurveTo(e+r,n+o,e+r-i,n+o),t.lineTo(e,n+o),t.lineTo(e,n),t.closePath(),t.fill(),t.stroke()}(r,.7*u,n.borderThickness,.3*u-n.borderThickness,c-2*n.borderThickness,v)),r.fillStyle=iw.rgbaColorToString(n.textColor),a.forEach((function(t,e){var o=n.fontFace.indexOf("Yahei")?c/2+(i+n.fontSize)*(e-(a.length-1)/2)+1.5:c/2+(i+n.fontSize)*(e-(a.length-1)/2),s=u/2;n.leftIco&&(s+=n.fontSize),n.rightIco&&(s-=n.fontSize),r.fillText(t,s,o)}))},Mw.changeFontFaceForMacOrWin=function(t){return 1!==t.fontFace.indexOf("PingFang")&&-1!==navigator.userAgent.indexOf("Win")&&(t.fontFace="Microsoft Yahei"),1!==t.fontFace.indexOf("Yahei")&&-1!==navigator.userAgent.indexOf("Mac")&&(t.fontFace="PingFangSC-Regular"),t},Mw.cropString=function(t,e){return t.length<=e?t:t.substring(0,e-1)+"..."};var Rw=function(){function t(){Kf(this,t)}return tm(t,null,[{key:"approxEquals",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:EPSILON;return Math.abs(t-e)<n}},{key:"round",value:function(t,e){var n=10*e;return Math.round(t*n)/n}}]),t}();function Aw(){}Aw.lerp=function(t,e,n){return t+(e-t)*n},Aw.convertPointToXYPlane=function(t,e){var n=new THREE.Vector3(0,0,1),r=n.angleTo(e),o=n.cross(e).normalize();return t=t.clone().applyAxisAngle(o,r),new THREE.Vector2(t.x,t.y)},Aw.isClockwiseVector2=function(t){for(var e=0,n=0;n<t.length-1;n++)e+=t[n].clone().cross(t[n+1]);return e>0},Aw.isPointInConvexPolygonVector2=function(t,e){for(var n=!0,r=e.length,o=Aw.isClockwiseVector2(e),i=0;i<r;i++){var a=(i+1)%r;if(Aw.isClockwiseVector2([e[i],t,e[a],e[i]])===o){n=!1;break}}return n},Aw.getLineNormalVector2=function(t,e){return new THREE.Vector2(e.y-t.y,t.x-e.x)},Aw.getLineNormalVector3=function(t,e){return new THREE.Vector3(e.y-t.y,t.x-e.x,0)},Aw.isSameDir=function(t,e,n){var r=1-Math.cos(THREE.Math.degToRad(n));return Math.abs(t.clone().normalize().dot(e.clone().normalize())-1)<r},Aw.isParallel=function(t,e,n,r){var o=!1,i=this.getLineNormalVector3(t,e),a=this.getLineNormalVector3(n,r),s=i.angleTo(a);return((s*=THREE.Math.RAD2DEG)>=170||s<=10)&&(o=!0),o},Aw.isCollinear=function(t,e,n,r){r=r||.1;var o=t.x*(e.y-n.y)+e.x*(n.y-t.y)+n.x*(t.y-e.y);return Math.abs(o)<r},Aw.JudgePointInLineSegment=function(t,e){var n=e[0],r=e[1],o=Math.sqrt(Math.pow(n.x-r.x,2)+Math.pow(n.y-r.y,2)),i=Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2)),a=Math.sqrt(Math.pow(t.x-r.x,2)+Math.pow(t.y-r.y,2));return Math.abs(i+a-o)<.001},Aw.calcLightDamping=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4;return(Math.pow(2,-6*t)*Math.cos((t-e/2)*(2*Math.PI)/e)+1).toFixed(4)};var Hw=function(){function t(e,n){Kf(this,t),em(this,"raw",[]),em(this,"ClassMapper",{raw:THREE.Vector2}),this.raw=[e,n]}return tm(t,[{key:"direction",value:function(){return this.p2.clone().sub(this.p1).normalize()}},{key:"toVector3",value:function(t){return new THREE.Vector3(this.p1,t,this.p2)}},{key:"intersect",value:function(t){var e=this.p1,n=this.p2,r=t.p1,o=t.p2;function i(t,e,n){return t.clone().sub(n).cross(e.clone().sub(n))}var a=i(e,n,r),s=i(e,n,o),l=i(r,o,e),u=i(r,o,n);if(a*s<=0&&l*u<=0){var c=l/(s-a);return n.clone().sub(e).multiplyScalar(c).add(e)}}},{key:"isIntersect",value:function(t){return!this.intersect(t)}},{key:"isSameDirection",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.direction().isSameDirection(t.direction(),e)}},{key:"isReverseDirection",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.direction().isSameDirection(t.direction().multiplyScalar(-1),e)}},{key:"isParallel",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.direction().isParallel(t.direction(),e)}},{key:"isCoincide",value:function(t){return this.p2.clone().sub(this.p1).add(t.p2).sub(t.p1).isParallel(this.direction())&&(this.p1.isOnSegment(t)||this.p2.isOnSegment(t))}},{key:"getCoincideSegment",value:function(e){return new t(this.p1.isOnSegment(e)?this.p1:this.p2,e.p1.isOnSegment(this)?e.p1:e.p2)}},{key:"p1",get:function(){return this.raw[0]}},{key:"p2",get:function(){return this.raw[1]}}]),t}(),Ow=function(t){im(n,THREE.ShaderMaterial);var e=cm(n);function n(){var t;return Kf(this,n),em(lm(t=e.call(this)),"uniforms",{panoramaCenter:{type:"vec3",value:new THREE.Vector3},panoramaMatrix:{type:"mat4",value:new THREE.Matrix4},panoramaTexture:{type:"t",value:void 0},opacity:{type:"float",value:1}}),em(lm(t),"vertexShader","\n        varying vec3 vPosition;\n        varying vec3 vNormal;\n        varying vec2 vUv;\n\n        void main() {\n            vNormal = normal;\n            vUv = uv;\n            vPosition = (modelMatrix * vec4(position, 1.0)).xyz;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }\n    "),em(lm(t),"fragmentShader","\n        uniform vec3 panoramaCenter;\n        uniform mat4 panoramaMatrix;\n        uniform sampler2D panoramaTexture;\n        uniform float opacity;\n\n        varying vec3 vPosition;\n        varying vec3 vNormal;\n        varying vec2 vUv;\n\n        float PI = 3.1415926535898;\n\n        void main() {\n            vec3 direction = vPosition - panoramaCenter;\n            direction.x = -direction.x;\n            direction = (vec4(direction, 1.0) * panoramaMatrix).xyz;\n            float theta = atan(direction.x, direction.z);\n            float phi = asin(direction.y / length(direction));\n            highp vec2 position = vec2(theta / (2.0 * PI), phi / PI + 0.5);\n            vec4 color = texture2D(panoramaTexture, position);\n            color.a = opacity;\n            gl_FragColor = color;\n        }\n    "),t}return tm(n,[{key:"opacity",get:function(){if(this.uniforms)return this.uniforms.opacity.value},set:function(t){this.uniforms&&(this.uniforms.opacity.value=parseFloat(t))}}]),n}(),Lw=function(t){im(n,THREE.ShaderMaterial);var e=cm(n);function n(){var t;Kf(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return em(lm(t=e.call.apply(e,[this].concat(o))),"uniforms",{onlyPanoramaCube1:{type:"int",value:1},panoramaCube1:{type:"samplerCube",value:void 0},panoramaCube2:{type:"samplerCube",value:void 0},panoramaPos1:{type:"vec3",value:new THREE.Vector3},panoramaPos2:{type:"vec3",value:new THREE.Vector3},panoramaMatrix1:{type:"mat4",value:new THREE.Matrix4},panoramaMatrix2:{type:"mat4",value:new THREE.Matrix4},panorama2Opacity:{type:"float",value:0},opacity:{type:"float",value:1},blurPanorama1:{type:"bool",value:!1},blurPanorama2:{type:"bool",value:!1}}),em(lm(t),"vertexShader","\n        precision highp float;\n        precision highp int;\n\n        varying vec3 vPosition;\n        varying vec3 vNormal;\n        varying vec2 vUv;\n\n        void main() {\n            vNormal = normal;\n            vUv = uv;\n            vPosition = (modelMatrix * vec4(position, 1.0)).xyz;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }\n    "),em(lm(t),"fragmentShader","\n        precision highp float;\n        precision highp int;\n\n        uniform int onlyPanoramaCube1;\n        uniform mat4 panoramaMatrix1;\n        uniform mat4 panoramaMatrix2;\n        uniform vec3 panoramaPos1;\n        uniform vec3 panoramaPos2;\n        uniform float panorama2Opacity;\n        uniform float opacity;\n        uniform samplerCube panoramaCube1;\n        uniform samplerCube panoramaCube2;\n        uniform bool blurPanorama1;\n        uniform bool blurPanorama2;\n      \n        varying vec3 vPosition;\n        varying vec3 vNormal;\n        varying vec2 vUv;\n        \n        vec4 getBlurColorFromCube(samplerCube panoramaCube, vec3 direction) {\n            vec4 sum = vec4(0, 0, 0, 0);\n            float floatHelper = 99.0;\n            float gaussBlur[7]; \n            gaussBlur[0] = 0.15;\n            gaussBlur[1] = 0.15;\n            gaussBlur[2] = 0.14;\n            gaussBlur[3] = 0.14;\n            gaussBlur[4] = 0.14;\n            gaussBlur[5] = 0.14;\n            gaussBlur[6] = 0.14;\n            \n            for (int i = 1; i < 7; i++) {\n                floatHelper = floatHelper + 3.0;\n                sum += textureCube(panoramaCube, normalize(vec3(direction.x, direction.y - floatHelper, direction.z))) * gaussBlur[i] / 4.0;\n                sum += textureCube(panoramaCube, normalize(vec3(direction.x, direction.y + floatHelper, direction.z))) * gaussBlur[i] / 4.0;\n                sum += textureCube(panoramaCube, normalize(vec3(direction.x - floatHelper, direction.y, direction.z))) * gaussBlur[i] / 4.0;\n                sum += textureCube(panoramaCube, normalize(vec3(direction.x + floatHelper, direction.y, direction.z))) * gaussBlur[i] / 4.0;\n            }\n            \n            sum += textureCube(panoramaCube, normalize(vec3(direction.x, direction.y, direction.z))) * gaussBlur[0];\n            \n            return sum;\n        }\n\n        vec4 getColorFromCube(samplerCube panoramaCube, vec3 panoramaPos, mat4 panoramaMatrix, bool isBlur) {\n            vec3 direction = vPosition - panoramaPos;\n            direction.x = -direction.x;\n            direction = (vec4(direction, 1.0) * panoramaMatrix).xyz;\n            \n            if(isBlur == false){\n                return textureCube(panoramaCube, normalize(direction));\n            } \n            \n            return getBlurColorFromCube(panoramaCube, direction);   \n        }\n\n        void main() {\n           if(onlyPanoramaCube1 == 1) {\n               gl_FragColor = getColorFromCube(panoramaCube1, panoramaPos1, panoramaMatrix1, blurPanorama1);\n           } else {\n               vec4 color1 = getColorFromCube(panoramaCube1, panoramaPos1, panoramaMatrix1, blurPanorama1);\n               vec4 color2 = getColorFromCube(panoramaCube2, panoramaPos2, panoramaMatrix2, blurPanorama2);\n               vec4 color = mix(color1, color2, panorama2Opacity);\n               vec4 black = vec4(0,0,0,1);\n               gl_FragColor = mix(black, color, opacity);\n           }\n        }\n    "),t}return n}();function Bw(t,e,n,r,o,i){THREE.BufferGeometry.call(this),this.type="CubeBufferGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:r,heightSegments:o,depthSegments:i};var a=this;t=t||1,e=e||1,n=n||1,r=Math.floor(r)||1,o=Math.floor(o)||1,i=Math.floor(i)||1;var s=[],l=[],u=[],c=[],h=0,p=0;function d(t,e,n,r,o,i,d,f,m,g,v){var y,w,b,S,E=i/m,P=d/g,x=i/2,_=d/2,T=f/2,C=0,I=new THREE.Vector3;for(y=0;y<m;y++){var D=y*E-x;for(w=0;w<g;w++){var k=w*P-_;for(b=0;b<2;b++)for(S=0;S<2;S++)I[t]=(D+b*E)*r,I[e]=(k+S*P)*o,I[n]=T,l.push(I.x,I.y,I.z),C+=1,I[t]=0,I[e]=0,I[n]=f>0?1:-1,u.push(I.x,I.y,I.z),c.push(b),c.push(1-S);s.push(h+C-4,h+C-3,h+C-2),s.push(h+C-3,h+C-1,h+C-2),a.addGroup(p,6,v),p+=6,v++}}h+=C}d("z","y","x",-1,-1,n,e,t,i,o,0),d("z","y","x",1,-1,n,e,-t,i,o,1*i*o),d("x","z","y",1,1,t,n,e,r,i,2*r*i),d("x","z","y",1,-1,t,n,-e,r,i,3*r*i),d("x","y","z",1,-1,t,e,n,r,o,4*r*o),d("x","y","z",-1,-1,t,e,-n,r,o,5*r*o),this.setIndex(s),this.setAttribute("position",new THREE.Float32BufferAttribute(l,3)),this.setAttribute("normal",new THREE.Float32BufferAttribute(u,3)),this.setAttribute("uv",new THREE.Float32BufferAttribute(c,2))}Bw.prototype=new THREE.BufferGeometry;var Fw=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Kf(this,t),em(this,"Sections",[]),em(this,"ClassMapper",{Sections:Nw}),em(this,"PropertyIgnore",["meshData","defaultMaterial","materials","ClassMapper","PropertyIgnore"]),this.Sections=e,e.forEach((function(t,e){t.SectionIndex=e})),this.meshData=null,this.defaultMaterial=new THREE.MeshPhongMaterial({color:"#dcdcdc"}),this.defaultBaseicMaterial=new THREE.MeshBasicMaterial({name:"fu",color:"#dcdcdc"}),this.opcityMaterial=new THREE.MeshPhongMaterial({color:"#c9c9c9",opacity:.4,transparent:!0}),this.materials=[]}return tm(t,[{key:"fromUnity",value:function(){return this.Sections.flatMap((function(t){return t.MeshFaces})).forEach((function(t){t.Vertices.forEach((function(t){return t.fromUnityPosition()})),t.Normal.fromUnityPosition()})),this.Sections.forEach((function(t){return t.InnerDirection.fromUnityPosition()})),this}},{key:"merge",value:function(t){if(t!==this)return this.Sections=this.Sections.concat(t.Sections),this}},{key:"createMesh",value:function(){var t=this.Sections.flatMap((function(t){return t.MeshFaces})),e=t.flatMap((function(t){return t.Vertices})).flatMap((function(t){return t.toArray()})),n=t.flatMap((function(t){return t.UVs})).flatMap((function(t){return t.toArray()})),r=t.filter((function(t){return void 0!==t.Normal})).flatMap((function(t){return t.Vertices.flatMap((function(e){return t.Normal.toArray()}))})),o=new THREE.BufferGeometry,i=0,a=[];t.forEach((function(t){a=a.concat(t.Triangles.map((function(t){return t+i}))),i+=t.Vertices.length})),Array.isNullOrEmpty(a)||o.setIndex(a),o.setAttribute("position",new THREE.BufferAttribute(new Float32Array(e),3)),n.length>0&&o.setAttribute("uv",new THREE.BufferAttribute(new Float32Array(n),2)),r.length>0&&o.setAttribute("normal",new THREE.BufferAttribute(new Float32Array(r),3));var s=0;this.Sections.forEach((function(t,e){var n=t.MeshFaces.reduce((function(t,e){return t+e.Vertices.length}),0);o.addGroup(s,n,e),s+=n}));var l=this.Sections.filter((function(t){return void 0!==t.Material})).map((function(t){return t.Material}));return new THREE.Mesh(o,l)}},{key:"createBufferMesh",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1?arguments[1]:void 0;console.time("createBufferMesh");var r=e?this.Sections.filter(e):this.Sections,o=r.flatMap((function(t){return t.MeshFaces})),i=o.flatMap((function(t){return t.Vertices})).flatMap((function(t){return t.toArray()})),a=o.flatMap((function(t){return t.UVs})).flatMap((function(t){return t.toArray()})),s=o.filter((function(t){return void 0!==t.Normal})).flatMap((function(t){return t.Vertices.flatMap((function(e){return t.Normal.toArray()}))})),l=new THREE.BufferGeometry,u=0,c=[];o.forEach((function(t){c=c.concat(t.Triangles.map((function(t){return t+u}))),u+=t.Vertices.length})),Array.isNullOrEmpty(c)||l.setIndex(c),l.setAttribute("position",new THREE.Float32BufferAttribute(i,3)),l.setAttribute("normal",new THREE.Float32BufferAttribute(s,3)),l.setAttribute("uv",new THREE.BufferAttribute(new Float32Array(a),2));var h=0;return this.materials=n||[],n?(this.materials=n,r.forEach((function(e,n){e.start=h,e.count=e.MeshFaces.reduce((function(t,e){return t+e.Triangles.length}),0),e.groupIndex=n,e.keepmaterialIndex||(t.materials.push("WallOuter"===e.Type?t.opcityMaterial:t.defaultBaseicMaterial),e.materialIndex=t.materials.length-1),l.addGroup(e.start,e.count,e.materialIndex),h+=e.count}))):r.forEach((function(e,n){e.start=h,e.count=e.MeshFaces.reduce((function(t,e){return t+e.Triangles.length}),0),e.groupIndex=n,t.materials.push(t.defaultMaterial.clone()),e.materialIndex=e.groupIndex,e.MaterialPath&&e.getMaterial().then((function(n){n&&(t.materials[e.materialIndex]=n)})),l.addGroup(e.start,e.count,e.materialIndex),h+=e.count})),this.meshData=new THREE.Mesh(l,this.materials),console.timeEnd("createBufferMesh"),this.meshData}},{key:"createMeshByMaterial",value:function(){var t=this,e=new THREE.Group,n=this.Sections;return iw.unique(this.Sections.map((function(t){return t.MaterialPath+t.MaterialSubPath}))).forEach((function(r){if(t.Sections=n.filter((function(t){return t.MaterialPath+t.MaterialSubPath===r})),t.Sections.length){var o=t.createBufferMesh();t.Sections[0].getMaterial().then((function(t){return o.material=t})),e.add(o)}})),e}}]),t}();em(Fw,"materialBank",{});var Nw=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0;Kf(this,t),em(this,"Type",""),em(this,"ID",""),em(this,"SectionIndex",0),em(this,"MaterialPath",""),em(this,"MaterialSubPath",""),em(this,"InnerDirection",null),em(this,"MeshFaces",[]),em(this,"ClassMapper",{MeshFaces:jw,InnerDirection:THREE.Vector3}),em(this,"PropertyIgnore",["Material","start","count","materialIndex","groupIndex","ID","InnerDirection","materialName","ClassMapper","PropertyIgnore"]),this.MeshFaces=e,this.Material=n,this.start=0,this.count=0,this.materialIndex=0,this.groupIndex=0}var e;return tm(t,[{key:"fromUnity",value:function(){return this.MeshFaces.forEach((function(t){t.Vertices.forEach((function(t){return t.fromUnityPosition()})),t.Normal.fromUnityPosition()})),this.InnerDirection.fromUnityPosition(),this}},{key:"setMaterial",value:function(t,e){this.MaterialPath=t,this.MaterialSubPath="/Materials/"+e.split("/").pop()}},{key:"getMaterial",value:(e=$f(regeneratorRuntime.mark((function t(){var e,n,r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.getMaterialPath(),n=this.MaterialPath+this.MaterialSubPath,t.abrupt("return",Fw.materialBank.hasOwnProperty(n)?Fw.materialBank[n]:ww.loadMTLResource(e).then((function(t){var e=r.MaterialSubPath.split("/").pop();if(t){if(Fw.materialBank.hasOwnProperty(n))for(var o in t)t[o].dispose();else Fw.materialBank[n]=t[e];t[e]&&(t[e].name=e)}return Fw.materialBank[n]})));case 3:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"getMaterialPath",value:function(){if(!this.MaterialSubPath)return null;this.materialName=this.MaterialSubPath.split("/").pop();return"https://vrhouse-decoration.oss-cn-shanghai.aliyuncs.com/Resources/"+this.MaterialPath+"/Web/"+this.materialName}},{key:"createBufferGeometry",value:function(){var t=this.MeshFaces.flatMap((function(t){return t.Vertices})).flatMap((function(t){return t.toArray()})),e=this.MeshFaces.flatMap((function(t){return t.UVs})).flatMap((function(t){return t.toArray()})),n=this.MeshFaces.filter((function(t){return void 0!==t.Normal})).flatMap((function(t){return t.Vertices.flatMap((function(e){return t.Normal.toArray()}))})),r=new THREE.BufferGeometry,o=0,i=[];return this.MeshFaces.toArray().forEach((function(t){i=i.concat(t.Triangles.map((function(t){return t+o})).toArray()),o+=t.Vertices.length})),Array.isNullOrEmpty(i)||r.setIndex(i),r.setAttribute("position",new THREE.Float32BufferAttribute(t,3)),r.setAttribute("normal",new THREE.Float32BufferAttribute(n,3)),r.setAttribute("uv",new THREE.BufferAttribute(new Float32Array(e),2)),r}},{key:"merge",value:function(t){if(t!==this)return this.MeshFaces=this.MeshFaces.concat(t.MeshFaces),this}}]),t}(),jw=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0;Kf(this,t),em(this,"ClassMapper",{Vertices:THREE.Vector3,UVs:THREE.Vector2,Normal:THREE.Vector3}),em(this,"PropertyIgnore",["ClassMapper","PropertyIgnore","OriginVertices","Holes","IsValid","ValidVertices"]),this.OriginVertices=e,this.Holes=[],this.IsValid=!0,this.ValidVertices=[],this.Vertices=e,this.UVs=n,this.Normal=r,this.Triangles=[],this.isBackSide=!1}return tm(t,[{key:"fromUnityToThree",value:function(){if(!this.UVs)return null;var t=[];return this.UVs.forEach((function(e){e.y>1?t.push(new THREE.Vector2(e.x,e.y-Math.floor(e.y))):t.push(new THREE.Vector2(e.x,e.x))})),t}}]),t}(),Vw=function(){function t(){Kf(this,t)}return tm(t,null,[{key:"toSmallCaseVector",value:function(t){if(t)return t=(t=(t=t.replace(/"X"/g,'"x"')).replace(/"Y"/g,'"y"')).replace(/"Z"/g,'"z"')}},{key:"fromJson",value:function(t,e){if(t)try{return"string"==typeof t&&(t=JSON.parse(t)),function t(e,r){if(void 0===e)return;if(e instanceof Array)return e.map((function(e){return t(n(e,r),r)}));e=n(e,r);var o=(new r).ClassMapper;if(!o)return e;var i=Object.getOwnPropertyNames(e),a=function(n){var r=i.find((function(t){return t.toString()===n}));r&&(e[r]=t(e[r],o[n]))};for(var s in o)a(s);return e}(t,e)}catch(t){console.log("fromJson: "+t)}function n(t,e){var n,r=new e,o={};for(var i in r){o[i.toUpperCase()]=i}for(var a in t)n=a.toUpperCase(),o.hasOwnProperty(n)&&(r[o[n]]=t[a]);return r}}}]),t}(),zw=r((function(t,e){var n;t.exports=(n=n||function(t,e){var n=Object.create||function(){function t(){}return function(e){var n;return t.prototype=e,n=new t,t.prototype=null,n}}(),r={},o=r.lib={},i=o.Base={extend:function(t){var e=n(this);return t&&e.mixIn(t),e.hasOwnProperty("init")&&this.init!==e.init||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},a=o.WordArray=i.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=null!=e?e:4*t.length},toString:function(t){return(t||l).stringify(this)},concat:function(t){var e=this.words,n=t.words,r=this.sigBytes,o=t.sigBytes;if(this.clamp(),r%4)for(var i=0;i<o;i++){var a=n[i>>>2]>>>24-i%4*8&255;e[r+i>>>2]|=a<<24-(r+i)%4*8}else for(i=0;i<o;i+=4)e[r+i>>>2]=n[i>>>2];return this.sigBytes+=o,this},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-n%4*8,e.length=t.ceil(n/4)},clone:function(){var t=i.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var n,r=[],o=function(e){e=e;var n=987654321,r=4294967295;return function(){var o=((n=36969*(65535&n)+(n>>16)&r)<<16)+(e=18e3*(65535&e)+(e>>16)&r)&r;return o/=4294967296,(o+=.5)*(t.random()>.5?1:-1)}},i=0;i<e;i+=4){var s=o(4294967296*(n||t.random()));n=987654071*s(),r.push(4294967296*s()|0)}return new a.init(r,e)}}),s=r.enc={},l=s.Hex={stringify:function(t){for(var e=t.words,n=t.sigBytes,r=[],o=0;o<n;o++){var i=e[o>>>2]>>>24-o%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse:function(t){for(var e=t.length,n=[],r=0;r<e;r+=2)n[r>>>3]|=parseInt(t.substr(r,2),16)<<24-r%8*4;return new a.init(n,e/2)}},u=s.Latin1={stringify:function(t){for(var e=t.words,n=t.sigBytes,r=[],o=0;o<n;o++){var i=e[o>>>2]>>>24-o%4*8&255;r.push(String.fromCharCode(i))}return r.join("")},parse:function(t){for(var e=t.length,n=[],r=0;r<e;r++)n[r>>>2]|=(255&t.charCodeAt(r))<<24-r%4*8;return new a.init(n,e)}},c=s.Utf8={stringify:function(t){try{return decodeURIComponent(escape(u.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return u.parse(unescape(encodeURIComponent(t)))}},h=o.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=c.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var n=this._data,r=n.words,o=n.sigBytes,i=this.blockSize,s=o/(4*i),l=(s=e?t.ceil(s):t.max((0|s)-this._minBufferSize,0))*i,u=t.min(4*l,o);if(l){for(var c=0;c<l;c+=i)this._doProcessBlock(r,c);var h=r.splice(0,l);n.sigBytes-=u}return new a.init(h,u)},clone:function(){var t=i.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),p=(o.Hasher=h.extend({cfg:i.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,n){return new t.init(n).finalize(e)}},_createHmacHelper:function(t){return function(e,n){return new p.HMAC.init(t,n).finalize(e)}}}),r.algo={});return r}(Math),n)})),Ww=(r((function(t,e){var n,r,o,i,a,s;t.exports=(r=(n=s=zw).lib,o=r.Base,i=r.WordArray,(a=n.x64={}).Word=o.extend({init:function(t,e){this.high=t,this.low=e}}),a.WordArray=o.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=null!=e?e:8*t.length},toX32:function(){for(var t=this.words,e=t.length,n=[],r=0;r<e;r++){var o=t[r];n.push(o.high),n.push(o.low)}return i.create(n,this.sigBytes)},clone:function(){for(var t=o.clone.call(this),e=t.words=this.words.slice(0),n=e.length,r=0;r<n;r++)e[r]=e[r].clone();return t}}),s)})),r((function(t,e){var n;t.exports=(n=zw,function(){if("function"==typeof ArrayBuffer){var t=n.lib.WordArray,e=t.init;(t.init=function(t){if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),(t instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array)&&(t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),t instanceof Uint8Array){for(var n=t.byteLength,r=[],o=0;o<n;o++)r[o>>>2]|=t[o]<<24-o%4*8;e.call(this,r,n)}else e.apply(this,arguments)}).prototype=t}}(),n.lib.WordArray)})),r((function(t,e){var n;t.exports=(n=zw,function(){var t=n,e=t.lib.WordArray,r=t.enc;function o(t){return t<<8&4278255360|t>>>8&16711935}r.Utf16=r.Utf16BE={stringify:function(t){for(var e=t.words,n=t.sigBytes,r=[],o=0;o<n;o+=2){var i=e[o>>>2]>>>16-o%4*8&65535;r.push(String.fromCharCode(i))}return r.join("")},parse:function(t){for(var n=t.length,r=[],o=0;o<n;o++)r[o>>>1]|=t.charCodeAt(o)<<16-o%2*16;return e.create(r,2*n)}},r.Utf16LE={stringify:function(t){for(var e=t.words,n=t.sigBytes,r=[],i=0;i<n;i+=2){var a=o(e[i>>>2]>>>16-i%4*8&65535);r.push(String.fromCharCode(a))}return r.join("")},parse:function(t){for(var n=t.length,r=[],i=0;i<n;i++)r[i>>>1]|=o(t.charCodeAt(i)<<16-i%2*16);return e.create(r,2*n)}}}(),n.enc.Utf16)})),r((function(t,e){var n,r,o;t.exports=(r=(n=o=zw).lib.WordArray,n.enc.Base64={stringify:function(t){var e=t.words,n=t.sigBytes,r=this._map;t.clamp();for(var o=[],i=0;i<n;i+=3)for(var a=(e[i>>>2]>>>24-i%4*8&255)<<16|(e[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|e[i+2>>>2]>>>24-(i+2)%4*8&255,s=0;s<4&&i+.75*s<n;s++)o.push(r.charAt(a>>>6*(3-s)&63));var l=r.charAt(64);if(l)for(;o.length%4;)o.push(l);return o.join("")},parse:function(t){var e=t.length,n=this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var i=0;i<n.length;i++)o[n.charCodeAt(i)]=i}var a=n.charAt(64);if(a){var s=t.indexOf(a);-1!==s&&(e=s)}return function(t,e,n){for(var o=[],i=0,a=0;a<e;a++)if(a%4){var s=n[t.charCodeAt(a-1)]<<a%4*2,l=n[t.charCodeAt(a)]>>>6-a%4*2;o[i>>>2]|=(s|l)<<24-i%4*8,i++}return r.create(o,i)}(t,e,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},o.enc.Base64)})),r((function(t,e){var n;t.exports=(n=zw,function(t){var e=n,r=e.lib,o=r.WordArray,i=r.Hasher,a=e.algo,s=[];!function(){for(var e=0;e<64;e++)s[e]=4294967296*t.abs(t.sin(e+1))|0}();var l=a.MD5=i.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,e){for(var n=0;n<16;n++){var r=e+n,o=t[r];t[r]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}var i=this._hash.words,a=t[e+0],l=t[e+1],d=t[e+2],f=t[e+3],m=t[e+4],g=t[e+5],v=t[e+6],y=t[e+7],w=t[e+8],b=t[e+9],S=t[e+10],E=t[e+11],P=t[e+12],x=t[e+13],_=t[e+14],T=t[e+15],C=i[0],I=i[1],D=i[2],k=i[3];C=u(C,I,D,k,a,7,s[0]),k=u(k,C,I,D,l,12,s[1]),D=u(D,k,C,I,d,17,s[2]),I=u(I,D,k,C,f,22,s[3]),C=u(C,I,D,k,m,7,s[4]),k=u(k,C,I,D,g,12,s[5]),D=u(D,k,C,I,v,17,s[6]),I=u(I,D,k,C,y,22,s[7]),C=u(C,I,D,k,w,7,s[8]),k=u(k,C,I,D,b,12,s[9]),D=u(D,k,C,I,S,17,s[10]),I=u(I,D,k,C,E,22,s[11]),C=u(C,I,D,k,P,7,s[12]),k=u(k,C,I,D,x,12,s[13]),D=u(D,k,C,I,_,17,s[14]),C=c(C,I=u(I,D,k,C,T,22,s[15]),D,k,l,5,s[16]),k=c(k,C,I,D,v,9,s[17]),D=c(D,k,C,I,E,14,s[18]),I=c(I,D,k,C,a,20,s[19]),C=c(C,I,D,k,g,5,s[20]),k=c(k,C,I,D,S,9,s[21]),D=c(D,k,C,I,T,14,s[22]),I=c(I,D,k,C,m,20,s[23]),C=c(C,I,D,k,b,5,s[24]),k=c(k,C,I,D,_,9,s[25]),D=c(D,k,C,I,f,14,s[26]),I=c(I,D,k,C,w,20,s[27]),C=c(C,I,D,k,x,5,s[28]),k=c(k,C,I,D,d,9,s[29]),D=c(D,k,C,I,y,14,s[30]),C=h(C,I=c(I,D,k,C,P,20,s[31]),D,k,g,4,s[32]),k=h(k,C,I,D,w,11,s[33]),D=h(D,k,C,I,E,16,s[34]),I=h(I,D,k,C,_,23,s[35]),C=h(C,I,D,k,l,4,s[36]),k=h(k,C,I,D,m,11,s[37]),D=h(D,k,C,I,y,16,s[38]),I=h(I,D,k,C,S,23,s[39]),C=h(C,I,D,k,x,4,s[40]),k=h(k,C,I,D,a,11,s[41]),D=h(D,k,C,I,f,16,s[42]),I=h(I,D,k,C,v,23,s[43]),C=h(C,I,D,k,b,4,s[44]),k=h(k,C,I,D,P,11,s[45]),D=h(D,k,C,I,T,16,s[46]),C=p(C,I=h(I,D,k,C,d,23,s[47]),D,k,a,6,s[48]),k=p(k,C,I,D,y,10,s[49]),D=p(D,k,C,I,_,15,s[50]),I=p(I,D,k,C,g,21,s[51]),C=p(C,I,D,k,P,6,s[52]),k=p(k,C,I,D,f,10,s[53]),D=p(D,k,C,I,S,15,s[54]),I=p(I,D,k,C,l,21,s[55]),C=p(C,I,D,k,w,6,s[56]),k=p(k,C,I,D,T,10,s[57]),D=p(D,k,C,I,v,15,s[58]),I=p(I,D,k,C,x,21,s[59]),C=p(C,I,D,k,m,6,s[60]),k=p(k,C,I,D,E,10,s[61]),D=p(D,k,C,I,d,15,s[62]),I=p(I,D,k,C,b,21,s[63]),i[0]=i[0]+C|0,i[1]=i[1]+I|0,i[2]=i[2]+D|0,i[3]=i[3]+k|0},_doFinalize:function(){var e=this._data,n=e.words,r=8*this._nDataBytes,o=8*e.sigBytes;n[o>>>5]|=128<<24-o%32;var i=t.floor(r/4294967296),a=r;n[15+(o+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),n[14+(o+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),e.sigBytes=4*(n.length+1),this._process();for(var s=this._hash,l=s.words,u=0;u<4;u++){var c=l[u];l[u]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8)}return s},clone:function(){var t=i.clone.call(this);return t._hash=this._hash.clone(),t}});function u(t,e,n,r,o,i,a){var s=t+(e&n|~e&r)+o+a;return(s<<i|s>>>32-i)+e}function c(t,e,n,r,o,i,a){var s=t+(e&r|n&~r)+o+a;return(s<<i|s>>>32-i)+e}function h(t,e,n,r,o,i,a){var s=t+(e^n^r)+o+a;return(s<<i|s>>>32-i)+e}function p(t,e,n,r,o,i,a){var s=t+(n^(e|~r))+o+a;return(s<<i|s>>>32-i)+e}e.MD5=i._createHelper(l),e.HmacMD5=i._createHmacHelper(l)}(Math),n.MD5)})),r((function(t,e){var n,r,o,i,a,s,l,u;t.exports=(r=(n=u=zw).lib,o=r.WordArray,i=r.Hasher,a=n.algo,s=[],l=a.SHA1=i.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var n=this._hash.words,r=n[0],o=n[1],i=n[2],a=n[3],l=n[4],u=0;u<80;u++){if(u<16)s[u]=0|t[e+u];else{var c=s[u-3]^s[u-8]^s[u-14]^s[u-16];s[u]=c<<1|c>>>31}var h=(r<<5|r>>>27)+l+s[u];h+=u<20?1518500249+(o&i|~o&a):u<40?1859775393+(o^i^a):u<60?(o&i|o&a|i&a)-1894007588:(o^i^a)-899497514,l=a,a=i,i=o<<30|o>>>2,o=r,r=h}n[0]=n[0]+r|0,n[1]=n[1]+o|0,n[2]=n[2]+i|0,n[3]=n[3]+a|0,n[4]=n[4]+l|0},_doFinalize:function(){var t=this._data,e=t.words,n=8*this._nDataBytes,r=8*t.sigBytes;return e[r>>>5]|=128<<24-r%32,e[14+(r+64>>>9<<4)]=Math.floor(n/4294967296),e[15+(r+64>>>9<<4)]=n,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=i.clone.call(this);return t._hash=this._hash.clone(),t}}),n.SHA1=i._createHelper(l),n.HmacSHA1=i._createHmacHelper(l),u.SHA1)})),r((function(t,e){var n;t.exports=(n=zw,function(t){var e=n,r=e.lib,o=r.WordArray,i=r.Hasher,a=e.algo,s=[],l=[];!function(){function e(e){for(var n=t.sqrt(e),r=2;r<=n;r++)if(!(e%r))return!1;return!0}function n(t){return 4294967296*(t-(0|t))|0}for(var r=2,o=0;o<64;)e(r)&&(o<8&&(s[o]=n(t.pow(r,.5))),l[o]=n(t.pow(r,1/3)),o++),r++}();var u=[],c=a.SHA256=i.extend({_doReset:function(){this._hash=new o.init(s.slice(0))},_doProcessBlock:function(t,e){for(var n=this._hash.words,r=n[0],o=n[1],i=n[2],a=n[3],s=n[4],c=n[5],h=n[6],p=n[7],d=0;d<64;d++){if(d<16)u[d]=0|t[e+d];else{var f=u[d-15],m=(f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3,g=u[d-2],v=(g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10;u[d]=m+u[d-7]+v+u[d-16]}var y=r&o^r&i^o&i,w=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),b=p+((s<<26|s>>>6)^(s<<21|s>>>11)^(s<<7|s>>>25))+(s&c^~s&h)+l[d]+u[d];p=h,h=c,c=s,s=a+b|0,a=i,i=o,o=r,r=b+(w+y)|0}n[0]=n[0]+r|0,n[1]=n[1]+o|0,n[2]=n[2]+i|0,n[3]=n[3]+a|0,n[4]=n[4]+s|0,n[5]=n[5]+c|0,n[6]=n[6]+h|0,n[7]=n[7]+p|0},_doFinalize:function(){var e=this._data,n=e.words,r=8*this._nDataBytes,o=8*e.sigBytes;return n[o>>>5]|=128<<24-o%32,n[14+(o+64>>>9<<4)]=t.floor(r/4294967296),n[15+(o+64>>>9<<4)]=r,e.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var t=i.clone.call(this);return t._hash=this._hash.clone(),t}});e.SHA256=i._createHelper(c),e.HmacSHA256=i._createHmacHelper(c)}(Math),n.SHA256)})),r((function(t,e){var n,r,o,i,a,s;t.exports=(r=(n=s=zw).lib.WordArray,o=n.algo,i=o.SHA256,a=o.SHA224=i.extend({_doReset:function(){this._hash=new r.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var t=i._doFinalize.call(this);return t.sigBytes-=4,t}}),n.SHA224=i._createHelper(a),n.HmacSHA224=i._createHmacHelper(a),s.SHA224)})),r((function(t,e){var n;t.exports=(n=zw,function(){var t=n,e=t.lib.Hasher,r=t.x64,o=r.Word,i=r.WordArray,a=t.algo;function s(){return o.create.apply(o,arguments)}var l=[s(1116352408,3609767458),s(1899447441,602891725),s(3049323471,3964484399),s(3921009573,2173295548),s(961987163,4081628472),s(1508970993,3053834265),s(2453635748,2937671579),s(2870763221,3664609560),s(3624381080,2734883394),s(310598401,1164996542),s(607225278,1323610764),s(1426881987,3590304994),s(1925078388,4068182383),s(2162078206,991336113),s(2614888103,633803317),s(3248222580,3479774868),s(3835390401,2666613458),s(4022224774,944711139),s(264347078,2341262773),s(604807628,2007800933),s(770255983,1495990901),s(1249150122,1856431235),s(1555081692,3175218132),s(1996064986,2198950837),s(2554220882,3999719339),s(2821834349,766784016),s(2952996808,2566594879),s(3210313671,3203337956),s(3336571891,1034457026),s(3584528711,2466948901),s(113926993,3758326383),s(338241895,168717936),s(666307205,1188179964),s(773529912,1546045734),s(1294757372,1522805485),s(1396182291,2643833823),s(1695183700,2343527390),s(1986661051,1014477480),s(2177026350,1206759142),s(2456956037,344077627),s(2730485921,1290863460),s(2820302411,3158454273),s(3259730800,3505952657),s(3345764771,106217008),s(3516065817,3606008344),s(3600352804,1432725776),s(4094571909,1467031594),s(275423344,851169720),s(430227734,3100823752),s(506948616,1363258195),s(659060556,3750685593),s(883997877,3785050280),s(958139571,3318307427),s(1322822218,3812723403),s(1537002063,2003034995),s(1747873779,3602036899),s(1955562222,1575990012),s(2024104815,1125592928),s(2227730452,2716904306),s(2361852424,442776044),s(2428436474,593698344),s(2756734187,3733110249),s(3204031479,2999351573),s(3329325298,3815920427),s(3391569614,3928383900),s(3515267271,566280711),s(3940187606,3454069534),s(4118630271,4000239992),s(116418474,1914138554),s(174292421,2731055270),s(289380356,3203993006),s(460393269,320620315),s(685471733,587496836),s(852142971,1086792851),s(1017036298,365543100),s(1126000580,2618297676),s(1288033470,3409855158),s(1501505948,4234509866),s(1607167915,987167468),s(1816402316,1246189591)],u=[];!function(){for(var t=0;t<80;t++)u[t]=s()}();var c=a.SHA512=e.extend({_doReset:function(){this._hash=new i.init([new o.init(1779033703,4089235720),new o.init(3144134277,2227873595),new o.init(1013904242,4271175723),new o.init(2773480762,1595750129),new o.init(1359893119,2917565137),new o.init(2600822924,725511199),new o.init(528734635,4215389547),new o.init(1541459225,327033209)])},_doProcessBlock:function(t,e){for(var n=this._hash.words,r=n[0],o=n[1],i=n[2],a=n[3],s=n[4],c=n[5],h=n[6],p=n[7],d=r.high,f=r.low,m=o.high,g=o.low,v=i.high,y=i.low,w=a.high,b=a.low,S=s.high,E=s.low,P=c.high,x=c.low,_=h.high,T=h.low,C=p.high,I=p.low,D=d,k=f,M=m,R=g,A=v,H=y,O=w,L=b,B=S,F=E,N=P,j=x,V=_,z=T,W=C,G=I,U=0;U<80;U++){var Y=u[U];if(U<16)var X=Y.high=0|t[e+2*U],Z=Y.low=0|t[e+2*U+1];else{var q=u[U-15],J=q.high,$=q.low,K=(J>>>1|$<<31)^(J>>>8|$<<24)^J>>>7,Q=($>>>1|J<<31)^($>>>8|J<<24)^($>>>7|J<<25),tt=u[U-2],et=tt.high,nt=tt.low,rt=(et>>>19|nt<<13)^(et<<3|nt>>>29)^et>>>6,ot=(nt>>>19|et<<13)^(nt<<3|et>>>29)^(nt>>>6|et<<26),it=u[U-7],at=it.high,st=it.low,lt=u[U-16],ut=lt.high,ct=lt.low;X=(X=(X=K+at+((Z=Q+st)>>>0<Q>>>0?1:0))+rt+((Z+=ot)>>>0<ot>>>0?1:0))+ut+((Z+=ct)>>>0<ct>>>0?1:0),Y.high=X,Y.low=Z}var ht,pt=B&N^~B&V,dt=F&j^~F&z,ft=D&M^D&A^M&A,mt=k&R^k&H^R&H,gt=(D>>>28|k<<4)^(D<<30|k>>>2)^(D<<25|k>>>7),vt=(k>>>28|D<<4)^(k<<30|D>>>2)^(k<<25|D>>>7),yt=(B>>>14|F<<18)^(B>>>18|F<<14)^(B<<23|F>>>9),wt=(F>>>14|B<<18)^(F>>>18|B<<14)^(F<<23|B>>>9),bt=l[U],St=bt.high,Et=bt.low,Pt=W+yt+((ht=G+wt)>>>0<G>>>0?1:0),xt=vt+mt;W=V,G=z,V=N,z=j,N=B,j=F,B=O+(Pt=(Pt=(Pt=Pt+pt+((ht+=dt)>>>0<dt>>>0?1:0))+St+((ht+=Et)>>>0<Et>>>0?1:0))+X+((ht+=Z)>>>0<Z>>>0?1:0))+((F=L+ht|0)>>>0<L>>>0?1:0)|0,O=A,L=H,A=M,H=R,M=D,R=k,D=Pt+(gt+ft+(xt>>>0<vt>>>0?1:0))+((k=ht+xt|0)>>>0<ht>>>0?1:0)|0}f=r.low=f+k,r.high=d+D+(f>>>0<k>>>0?1:0),g=o.low=g+R,o.high=m+M+(g>>>0<R>>>0?1:0),y=i.low=y+H,i.high=v+A+(y>>>0<H>>>0?1:0),b=a.low=b+L,a.high=w+O+(b>>>0<L>>>0?1:0),E=s.low=E+F,s.high=S+B+(E>>>0<F>>>0?1:0),x=c.low=x+j,c.high=P+N+(x>>>0<j>>>0?1:0),T=h.low=T+z,h.high=_+V+(T>>>0<z>>>0?1:0),I=p.low=I+G,p.high=C+W+(I>>>0<G>>>0?1:0)},_doFinalize:function(){var t=this._data,e=t.words,n=8*this._nDataBytes,r=8*t.sigBytes;return e[r>>>5]|=128<<24-r%32,e[30+(r+128>>>10<<5)]=Math.floor(n/4294967296),e[31+(r+128>>>10<<5)]=n,t.sigBytes=4*e.length,this._process(),this._hash.toX32()},clone:function(){var t=e.clone.call(this);return t._hash=this._hash.clone(),t},blockSize:32});t.SHA512=e._createHelper(c),t.HmacSHA512=e._createHmacHelper(c)}(),n.SHA512)})),r((function(t,e){var n,r,o,i,a,s,l,u;t.exports=(r=(n=u=zw).x64,o=r.Word,i=r.WordArray,a=n.algo,s=a.SHA512,l=a.SHA384=s.extend({_doReset:function(){this._hash=new i.init([new o.init(3418070365,3238371032),new o.init(1654270250,914150663),new o.init(2438529370,812702999),new o.init(355462360,4144912697),new o.init(1731405415,4290775857),new o.init(2394180231,1750603025),new o.init(3675008525,1694076839),new o.init(1203062813,3204075428)])},_doFinalize:function(){var t=s._doFinalize.call(this);return t.sigBytes-=16,t}}),n.SHA384=s._createHelper(l),n.HmacSHA384=s._createHmacHelper(l),u.SHA384)})),r((function(t,e){var n;t.exports=(n=zw,function(t){var e=n,r=e.lib,o=r.WordArray,i=r.Hasher,a=e.x64.Word,s=e.algo,l=[],u=[],c=[];!function(){for(var t=1,e=0,n=0;n<24;n++){l[t+5*e]=(n+1)*(n+2)/2%64;var r=(2*t+3*e)%5;t=e%5,e=r}for(t=0;t<5;t++)for(e=0;e<5;e++)u[t+5*e]=e+(2*t+3*e)%5*5;for(var o=1,i=0;i<24;i++){for(var s=0,h=0,p=0;p<7;p++){if(1&o){var d=(1<<p)-1;d<32?h^=1<<d:s^=1<<d-32}128&o?o=o<<1^113:o<<=1}c[i]=a.create(s,h)}}();var h=[];!function(){for(var t=0;t<25;t++)h[t]=a.create()}();var p=s.SHA3=i.extend({cfg:i.cfg.extend({outputLength:512}),_doReset:function(){for(var t=this._state=[],e=0;e<25;e++)t[e]=new a.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(t,e){for(var n=this._state,r=this.blockSize/2,o=0;o<r;o++){var i=t[e+2*o],a=t[e+2*o+1];i=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),a=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),(I=n[o]).high^=a,I.low^=i}for(var s=0;s<24;s++){for(var p=0;p<5;p++){for(var d=0,f=0,m=0;m<5;m++)d^=(I=n[p+5*m]).high,f^=I.low;var g=h[p];g.high=d,g.low=f}for(p=0;p<5;p++){var v=h[(p+4)%5],y=h[(p+1)%5],w=y.high,b=y.low;for(d=v.high^(w<<1|b>>>31),f=v.low^(b<<1|w>>>31),m=0;m<5;m++)(I=n[p+5*m]).high^=d,I.low^=f}for(var S=1;S<25;S++){var E=(I=n[S]).high,P=I.low,x=l[S];x<32?(d=E<<x|P>>>32-x,f=P<<x|E>>>32-x):(d=P<<x-32|E>>>64-x,f=E<<x-32|P>>>64-x);var _=h[u[S]];_.high=d,_.low=f}var T=h[0],C=n[0];for(T.high=C.high,T.low=C.low,p=0;p<5;p++)for(m=0;m<5;m++){var I=n[S=p+5*m],D=h[S],k=h[(p+1)%5+5*m],M=h[(p+2)%5+5*m];I.high=D.high^~k.high&M.high,I.low=D.low^~k.low&M.low}I=n[0];var R=c[s];I.high^=R.high,I.low^=R.low}},_doFinalize:function(){var e=this._data,n=e.words,r=(this._nDataBytes,8*e.sigBytes),i=32*this.blockSize;n[r>>>5]|=1<<24-r%32,n[(t.ceil((r+1)/i)*i>>>5)-1]|=128,e.sigBytes=4*n.length,this._process();for(var a=this._state,s=this.cfg.outputLength/8,l=s/8,u=[],c=0;c<l;c++){var h=a[c],p=h.high,d=h.low;p=16711935&(p<<8|p>>>24)|4278255360&(p<<24|p>>>8),d=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8),u.push(d),u.push(p)}return new o.init(u,s)},clone:function(){for(var t=i.clone.call(this),e=t._state=this._state.slice(0),n=0;n<25;n++)e[n]=e[n].clone();return t}});e.SHA3=i._createHelper(p),e.HmacSHA3=i._createHmacHelper(p)}(Math),n.SHA3)})),r((function(t,e){var n;t.exports=(n=zw,
/** @preserve
		(c) 2012 by Cédric Mesnil. All rights reserved.

		Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

		    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
		    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

		THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
		*/
function(t){var e=n,r=e.lib,o=r.WordArray,i=r.Hasher,a=e.algo,s=o.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),l=o.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),u=o.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),c=o.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),h=o.create([0,1518500249,1859775393,2400959708,2840853838]),p=o.create([1352829926,1548603684,1836072691,2053994217,0]),d=a.RIPEMD160=i.extend({_doReset:function(){this._hash=o.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var n=0;n<16;n++){var r=e+n,o=t[r];t[r]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}var i,a,d,b,S,E,P,x,_,T,C,I=this._hash.words,D=h.words,k=p.words,M=s.words,R=l.words,A=u.words,H=c.words;for(E=i=I[0],P=a=I[1],x=d=I[2],_=b=I[3],T=S=I[4],n=0;n<80;n+=1)C=i+t[e+M[n]]|0,C+=n<16?f(a,d,b)+D[0]:n<32?m(a,d,b)+D[1]:n<48?g(a,d,b)+D[2]:n<64?v(a,d,b)+D[3]:y(a,d,b)+D[4],C=(C=w(C|=0,A[n]))+S|0,i=S,S=b,b=w(d,10),d=a,a=C,C=E+t[e+R[n]]|0,C+=n<16?y(P,x,_)+k[0]:n<32?v(P,x,_)+k[1]:n<48?g(P,x,_)+k[2]:n<64?m(P,x,_)+k[3]:f(P,x,_)+k[4],C=(C=w(C|=0,H[n]))+T|0,E=T,T=_,_=w(x,10),x=P,P=C;C=I[1]+d+_|0,I[1]=I[2]+b+T|0,I[2]=I[3]+S+E|0,I[3]=I[4]+i+P|0,I[4]=I[0]+a+x|0,I[0]=C},_doFinalize:function(){var t=this._data,e=t.words,n=8*this._nDataBytes,r=8*t.sigBytes;e[r>>>5]|=128<<24-r%32,e[14+(r+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),t.sigBytes=4*(e.length+1),this._process();for(var o=this._hash,i=o.words,a=0;a<5;a++){var s=i[a];i[a]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}return o},clone:function(){var t=i.clone.call(this);return t._hash=this._hash.clone(),t}});function f(t,e,n){return t^e^n}function m(t,e,n){return t&e|~t&n}function g(t,e,n){return(t|~e)^n}function v(t,e,n){return t&n|e&~n}function y(t,e,n){return t^(e|~n)}function w(t,e){return t<<e|t>>>32-e}e.RIPEMD160=i._createHelper(d),e.HmacRIPEMD160=i._createHmacHelper(d)}(),n.RIPEMD160)})),r((function(t,e){var n,r,o;t.exports=(r=(n=zw).lib.Base,o=n.enc.Utf8,void(n.algo.HMAC=r.extend({init:function(t,e){t=this._hasher=new t.init,"string"==typeof e&&(e=o.parse(e));var n=t.blockSize,r=4*n;e.sigBytes>r&&(e=t.finalize(e)),e.clamp();for(var i=this._oKey=e.clone(),a=this._iKey=e.clone(),s=i.words,l=a.words,u=0;u<n;u++)s[u]^=1549556828,l[u]^=909522486;i.sigBytes=a.sigBytes=r,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var e=this._hasher,n=e.finalize(t);return e.reset(),e.finalize(this._oKey.clone().concat(n))}})))})),r((function(t,e){var n,r,o,i,a,s,l,u,c;t.exports=(r=(n=c=zw).lib,o=r.Base,i=r.WordArray,a=n.algo,s=a.SHA1,l=a.HMAC,u=a.PBKDF2=o.extend({cfg:o.extend({keySize:4,hasher:s,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var n=this.cfg,r=l.create(n.hasher,t),o=i.create(),a=i.create([1]),s=o.words,u=a.words,c=n.keySize,h=n.iterations;s.length<c;){var p=r.update(e).finalize(a);r.reset();for(var d=p.words,f=d.length,m=p,g=1;g<h;g++){m=r.finalize(m),r.reset();for(var v=m.words,y=0;y<f;y++)d[y]^=v[y]}o.concat(p),u[0]++}return o.sigBytes=4*c,o}}),n.PBKDF2=function(t,e,n){return u.create(n).compute(t,e)},c.PBKDF2)})),r((function(t,e){var n,r,o,i,a,s,l,u;t.exports=(r=(n=u=zw).lib,o=r.Base,i=r.WordArray,a=n.algo,s=a.MD5,l=a.EvpKDF=o.extend({cfg:o.extend({keySize:4,hasher:s,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var n=this.cfg,r=n.hasher.create(),o=i.create(),a=o.words,s=n.keySize,l=n.iterations;a.length<s;){u&&r.update(u);var u=r.update(t).finalize(e);r.reset();for(var c=1;c<l;c++)u=r.finalize(u),r.reset();o.concat(u)}return o.sigBytes=4*s,o}}),n.EvpKDF=function(t,e,n){return l.create(n).compute(t,e)},u.EvpKDF)})),r((function(t,e){var n,r,o,i,a,s,l,u,c,h,p,d,f,m,g,v,y,w,b;t.exports=void((n=zw).lib.Cipher||(r=n,o=r.lib,i=o.Base,a=o.WordArray,s=o.BufferedBlockAlgorithm,l=r.enc,l.Utf8,u=l.Base64,c=r.algo.EvpKDF,h=o.Cipher=s.extend({cfg:i.extend(),createEncryptor:function(t,e){return this.create(this._ENC_XFORM_MODE,t,e)},createDecryptor:function(t,e){return this.create(this._DEC_XFORM_MODE,t,e)},init:function(t,e,n){this.cfg=this.cfg.extend(n),this._xformMode=t,this._key=e,this.reset()},reset:function(){s.reset.call(this),this._doReset()},process:function(t){return this._append(t),this._process()},finalize:function(t){return t&&this._append(t),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function t(t){return"string"==typeof t?b:y}return function(e){return{encrypt:function(n,r,o){return t(r).encrypt(e,n,r,o)},decrypt:function(n,r,o){return t(r).decrypt(e,n,r,o)}}}}()}),o.StreamCipher=h.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),p=r.mode={},d=o.BlockCipherMode=i.extend({createEncryptor:function(t,e){return this.Encryptor.create(t,e)},createDecryptor:function(t,e){return this.Decryptor.create(t,e)},init:function(t,e){this._cipher=t,this._iv=e}}),f=p.CBC=function(){var t=d.extend();function e(t,e,n){var r=this._iv;if(r){var o=r;this._iv=void 0}else o=this._prevBlock;for(var i=0;i<n;i++)t[e+i]^=o[i]}return t.Encryptor=t.extend({processBlock:function(t,n){var r=this._cipher,o=r.blockSize;e.call(this,t,n,o),r.encryptBlock(t,n),this._prevBlock=t.slice(n,n+o)}}),t.Decryptor=t.extend({processBlock:function(t,n){var r=this._cipher,o=r.blockSize,i=t.slice(n,n+o);r.decryptBlock(t,n),e.call(this,t,n,o),this._prevBlock=i}}),t}(),m=(r.pad={}).Pkcs7={pad:function(t,e){for(var n=4*e,r=n-t.sigBytes%n,o=r<<24|r<<16|r<<8|r,i=[],s=0;s<r;s+=4)i.push(o);var l=a.create(i,r);t.concat(l)},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}},o.BlockCipher=h.extend({cfg:h.cfg.extend({mode:f,padding:m}),reset:function(){h.reset.call(this);var t=this.cfg,e=t.iv,n=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var r=n.createEncryptor;else r=n.createDecryptor,this._minBufferSize=1;this._mode&&this._mode.__creator==r?this._mode.init(this,e&&e.words):(this._mode=r.call(n,this,e&&e.words),this._mode.__creator=r)},_doProcessBlock:function(t,e){this._mode.processBlock(t,e)},_doFinalize:function(){var t=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){t.pad(this._data,this.blockSize);var e=this._process(!0)}else e=this._process(!0),t.unpad(e);return e},blockSize:4}),g=o.CipherParams=i.extend({init:function(t){this.mixIn(t)},toString:function(t){return(t||this.formatter).stringify(this)}}),v=(r.format={}).OpenSSL={stringify:function(t){var e=t.ciphertext,n=t.salt;if(n)var r=a.create([1398893684,1701076831]).concat(n).concat(e);else r=e;return r.toString(u)},parse:function(t){var e=u.parse(t),n=e.words;if(1398893684==n[0]&&1701076831==n[1]){var r=a.create(n.slice(2,4));n.splice(0,4),e.sigBytes-=16}return g.create({ciphertext:e,salt:r})}},y=o.SerializableCipher=i.extend({cfg:i.extend({format:v}),encrypt:function(t,e,n,r){r=this.cfg.extend(r);var o=t.createEncryptor(n,r),i=o.finalize(e),a=o.cfg;return g.create({ciphertext:i,key:n,iv:a.iv,algorithm:t,mode:a.mode,padding:a.padding,blockSize:t.blockSize,formatter:r.format})},decrypt:function(t,e,n,r){return r=this.cfg.extend(r),e=this._parse(e,r.format),t.createDecryptor(n,r).finalize(e.ciphertext)},_parse:function(t,e){return"string"==typeof t?e.parse(t,this):t}}),w=(r.kdf={}).OpenSSL={execute:function(t,e,n,r){r||(r=a.random(8));var o=c.create({keySize:e+n}).compute(t,r),i=a.create(o.words.slice(e),4*n);return o.sigBytes=4*e,g.create({key:o,iv:i,salt:r})}},b=o.PasswordBasedCipher=y.extend({cfg:y.cfg.extend({kdf:w}),encrypt:function(t,e,n,r){var o=(r=this.cfg.extend(r)).kdf.execute(n,t.keySize,t.ivSize);r.iv=o.iv;var i=y.encrypt.call(this,t,e,o.key,r);return i.mixIn(o),i},decrypt:function(t,e,n,r){r=this.cfg.extend(r),e=this._parse(e,r.format);var o=r.kdf.execute(n,t.keySize,t.ivSize,e.salt);return r.iv=o.iv,y.decrypt.call(this,t,e,o.key,r)}})))})),r((function(t,e){var n;t.exports=((n=zw).mode.CFB=function(){var t=n.lib.BlockCipherMode.extend();function e(t,e,n,r){var o=this._iv;if(o){var i=o.slice(0);this._iv=void 0}else i=this._prevBlock;r.encryptBlock(i,0);for(var a=0;a<n;a++)t[e+a]^=i[a]}return t.Encryptor=t.extend({processBlock:function(t,n){var r=this._cipher,o=r.blockSize;e.call(this,t,n,o,r),this._prevBlock=t.slice(n,n+o)}}),t.Decryptor=t.extend({processBlock:function(t,n){var r=this._cipher,o=r.blockSize,i=t.slice(n,n+o);e.call(this,t,n,o,r),this._prevBlock=i}}),t}(),n.mode.CFB)})),r((function(t,e){var n,r,o;t.exports=((o=zw).mode.CTR=(n=o.lib.BlockCipherMode.extend(),r=n.Encryptor=n.extend({processBlock:function(t,e){var n=this._cipher,r=n.blockSize,o=this._iv,i=this._counter;o&&(i=this._counter=o.slice(0),this._iv=void 0);var a=i.slice(0);n.encryptBlock(a,0),i[r-1]=i[r-1]+1|0;for(var s=0;s<r;s++)t[e+s]^=a[s]}}),n.Decryptor=r,n),o.mode.CTR)})),r((function(t,e){var n;t.exports=(
/** @preserve
		 * Counter block mode compatible with  Dr Brian Gladman fileenc.c
		 * derived from CryptoJS.mode.CTR
		 * Jan Hruby jhruby.web@gmail.com
		 */
(n=zw).mode.CTRGladman=function(){var t=n.lib.BlockCipherMode.extend();function e(t){if(255==(t>>24&255)){var e=t>>16&255,n=t>>8&255,r=255&t;255===e?(e=0,255===n?(n=0,255===r?r=0:++r):++n):++e,t=0,t+=e<<16,t+=n<<8,t+=r}else t+=1<<24;return t}var r=t.Encryptor=t.extend({processBlock:function(t,n){var r=this._cipher,o=r.blockSize,i=this._iv,a=this._counter;i&&(a=this._counter=i.slice(0),this._iv=void 0),function(t){0===(t[0]=e(t[0]))&&(t[1]=e(t[1]))}(a);var s=a.slice(0);r.encryptBlock(s,0);for(var l=0;l<o;l++)t[n+l]^=s[l]}});return t.Decryptor=r,t}(),n.mode.CTRGladman)})),r((function(t,e){var n,r,o;t.exports=((o=zw).mode.OFB=(n=o.lib.BlockCipherMode.extend(),r=n.Encryptor=n.extend({processBlock:function(t,e){var n=this._cipher,r=n.blockSize,o=this._iv,i=this._keystream;o&&(i=this._keystream=o.slice(0),this._iv=void 0),n.encryptBlock(i,0);for(var a=0;a<r;a++)t[e+a]^=i[a]}}),n.Decryptor=r,n),o.mode.OFB)})),r((function(t,e){var n,r;t.exports=((r=zw).mode.ECB=((n=r.lib.BlockCipherMode.extend()).Encryptor=n.extend({processBlock:function(t,e){this._cipher.encryptBlock(t,e)}}),n.Decryptor=n.extend({processBlock:function(t,e){this._cipher.decryptBlock(t,e)}}),n),r.mode.ECB)})),r((function(t,e){var n;t.exports=((n=zw).pad.AnsiX923={pad:function(t,e){var n=t.sigBytes,r=4*e,o=r-n%r,i=n+o-1;t.clamp(),t.words[i>>>2]|=o<<24-i%4*8,t.sigBytes+=o},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}},n.pad.Ansix923)})),r((function(t,e){var n;t.exports=((n=zw).pad.Iso10126={pad:function(t,e){var r=4*e,o=r-t.sigBytes%r;t.concat(n.lib.WordArray.random(o-1)).concat(n.lib.WordArray.create([o<<24],1))},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}},n.pad.Iso10126)})),r((function(t,e){var n;t.exports=((n=zw).pad.Iso97971={pad:function(t,e){t.concat(n.lib.WordArray.create([2147483648],1)),n.pad.ZeroPadding.pad(t,e)},unpad:function(t){n.pad.ZeroPadding.unpad(t),t.sigBytes--}},n.pad.Iso97971)})),r((function(t,e){var n;t.exports=((n=zw).pad.ZeroPadding={pad:function(t,e){var n=4*e;t.clamp(),t.sigBytes+=n-(t.sigBytes%n||n)},unpad:function(t){for(var e=t.words,n=t.sigBytes-1;!(e[n>>>2]>>>24-n%4*8&255);)n--;t.sigBytes=n+1}},n.pad.ZeroPadding)})),r((function(t,e){var n;t.exports=((n=zw).pad.NoPadding={pad:function(){},unpad:function(){}},n.pad.NoPadding)})),r((function(t,e){var n,r,o,i;t.exports=(r=(n=i=zw).lib.CipherParams,o=n.enc.Hex,n.format.Hex={stringify:function(t){return t.ciphertext.toString(o)},parse:function(t){var e=o.parse(t);return r.create({ciphertext:e})}},i.format.Hex)})),r((function(t,e){var n;t.exports=(n=zw,function(){var t=n,e=t.lib.BlockCipher,r=t.algo,o=[],i=[],a=[],s=[],l=[],u=[],c=[],h=[],p=[],d=[];!function(){for(var t=[],e=0;e<256;e++)t[e]=e<128?e<<1:e<<1^283;var n=0,r=0;for(e=0;e<256;e++){var f=r^r<<1^r<<2^r<<3^r<<4;f=f>>>8^255&f^99,o[n]=f,i[f]=n;var m=t[n],g=t[m],v=t[g],y=257*t[f]^16843008*f;a[n]=y<<24|y>>>8,s[n]=y<<16|y>>>16,l[n]=y<<8|y>>>24,u[n]=y,y=16843009*v^65537*g^257*m^16843008*n,c[f]=y<<24|y>>>8,h[f]=y<<16|y>>>16,p[f]=y<<8|y>>>24,d[f]=y,n?(n=m^t[t[t[v^m]]],r^=t[t[r]]):n=r=1}}();var f=[0,1,2,4,8,16,32,64,128,27,54],m=r.AES=e.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var t=this._keyPriorReset=this._key,e=t.words,n=t.sigBytes/4,r=4*((this._nRounds=n+6)+1),i=this._keySchedule=[],a=0;a<r;a++)if(a<n)i[a]=e[a];else{var s=i[a-1];a%n?n>6&&a%n==4&&(s=o[s>>>24]<<24|o[s>>>16&255]<<16|o[s>>>8&255]<<8|o[255&s]):(s=o[(s=s<<8|s>>>24)>>>24]<<24|o[s>>>16&255]<<16|o[s>>>8&255]<<8|o[255&s],s^=f[a/n|0]<<24),i[a]=i[a-n]^s}for(var l=this._invKeySchedule=[],u=0;u<r;u++)a=r-u,s=u%4?i[a]:i[a-4],l[u]=u<4||a<=4?s:c[o[s>>>24]]^h[o[s>>>16&255]]^p[o[s>>>8&255]]^d[o[255&s]]}},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._keySchedule,a,s,l,u,o)},decryptBlock:function(t,e){var n=t[e+1];t[e+1]=t[e+3],t[e+3]=n,this._doCryptBlock(t,e,this._invKeySchedule,c,h,p,d,i),n=t[e+1],t[e+1]=t[e+3],t[e+3]=n},_doCryptBlock:function(t,e,n,r,o,i,a,s){for(var l=this._nRounds,u=t[e]^n[0],c=t[e+1]^n[1],h=t[e+2]^n[2],p=t[e+3]^n[3],d=4,f=1;f<l;f++){var m=r[u>>>24]^o[c>>>16&255]^i[h>>>8&255]^a[255&p]^n[d++],g=r[c>>>24]^o[h>>>16&255]^i[p>>>8&255]^a[255&u]^n[d++],v=r[h>>>24]^o[p>>>16&255]^i[u>>>8&255]^a[255&c]^n[d++],y=r[p>>>24]^o[u>>>16&255]^i[c>>>8&255]^a[255&h]^n[d++];u=m,c=g,h=v,p=y}m=(s[u>>>24]<<24|s[c>>>16&255]<<16|s[h>>>8&255]<<8|s[255&p])^n[d++],g=(s[c>>>24]<<24|s[h>>>16&255]<<16|s[p>>>8&255]<<8|s[255&u])^n[d++],v=(s[h>>>24]<<24|s[p>>>16&255]<<16|s[u>>>8&255]<<8|s[255&c])^n[d++],y=(s[p>>>24]<<24|s[u>>>16&255]<<16|s[c>>>8&255]<<8|s[255&h])^n[d++],t[e]=m,t[e+1]=g,t[e+2]=v,t[e+3]=y},keySize:8});t.AES=e._createHelper(m)}(),n.AES)})),r((function(t,e){var n;t.exports=(n=zw,function(){var t=n,e=t.lib,r=e.WordArray,o=e.BlockCipher,i=t.algo,a=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],s=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],l=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],u=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],c=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],h=i.DES=o.extend({_doReset:function(){for(var t=this._key.words,e=[],n=0;n<56;n++){var r=a[n]-1;e[n]=t[r>>>5]>>>31-r%32&1}for(var o=this._subKeys=[],i=0;i<16;i++){var u=o[i]=[],c=l[i];for(n=0;n<24;n++)u[n/6|0]|=e[(s[n]-1+c)%28]<<31-n%6,u[4+(n/6|0)]|=e[28+(s[n+24]-1+c)%28]<<31-n%6;for(u[0]=u[0]<<1|u[0]>>>31,n=1;n<7;n++)u[n]=u[n]>>>4*(n-1)+3;u[7]=u[7]<<5|u[7]>>>27}var h=this._invSubKeys=[];for(n=0;n<16;n++)h[n]=o[15-n]},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._subKeys)},decryptBlock:function(t,e){this._doCryptBlock(t,e,this._invSubKeys)},_doCryptBlock:function(t,e,n){this._lBlock=t[e],this._rBlock=t[e+1],p.call(this,4,252645135),p.call(this,16,65535),d.call(this,2,858993459),d.call(this,8,16711935),p.call(this,1,1431655765);for(var r=0;r<16;r++){for(var o=n[r],i=this._lBlock,a=this._rBlock,s=0,l=0;l<8;l++)s|=u[l][((a^o[l])&c[l])>>>0];this._lBlock=a,this._rBlock=i^s}var h=this._lBlock;this._lBlock=this._rBlock,this._rBlock=h,p.call(this,1,1431655765),d.call(this,8,16711935),d.call(this,2,858993459),p.call(this,16,65535),p.call(this,4,252645135),t[e]=this._lBlock,t[e+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function p(t,e){var n=(this._lBlock>>>t^this._rBlock)&e;this._rBlock^=n,this._lBlock^=n<<t}function d(t,e){var n=(this._rBlock>>>t^this._lBlock)&e;this._lBlock^=n,this._rBlock^=n<<t}t.DES=o._createHelper(h);var f=i.TripleDES=o.extend({_doReset:function(){var t=this._key.words;this._des1=h.createEncryptor(r.create(t.slice(0,2))),this._des2=h.createEncryptor(r.create(t.slice(2,4))),this._des3=h.createEncryptor(r.create(t.slice(4,6)))},encryptBlock:function(t,e){this._des1.encryptBlock(t,e),this._des2.decryptBlock(t,e),this._des3.encryptBlock(t,e)},decryptBlock:function(t,e){this._des3.decryptBlock(t,e),this._des2.encryptBlock(t,e),this._des1.decryptBlock(t,e)},keySize:6,ivSize:2,blockSize:2});t.TripleDES=o._createHelper(f)}(),n.TripleDES)})),r((function(t,e){var n;t.exports=(n=zw,function(){var t=n,e=t.lib.StreamCipher,r=t.algo,o=r.RC4=e.extend({_doReset:function(){for(var t=this._key,e=t.words,n=t.sigBytes,r=this._S=[],o=0;o<256;o++)r[o]=o;o=0;for(var i=0;o<256;o++){var a=o%n,s=e[a>>>2]>>>24-a%4*8&255;i=(i+r[o]+s)%256;var l=r[o];r[o]=r[i],r[i]=l}this._i=this._j=0},_doProcessBlock:function(t,e){t[e]^=i.call(this)},keySize:8,ivSize:0});function i(){for(var t=this._S,e=this._i,n=this._j,r=0,o=0;o<4;o++){n=(n+t[e=(e+1)%256])%256;var i=t[e];t[e]=t[n],t[n]=i,r|=t[(t[e]+t[n])%256]<<24-8*o}return this._i=e,this._j=n,r}t.RC4=e._createHelper(o);var a=r.RC4Drop=o.extend({cfg:o.cfg.extend({drop:192}),_doReset:function(){o._doReset.call(this);for(var t=this.cfg.drop;t>0;t--)i.call(this)}});t.RC4Drop=e._createHelper(a)}(),n.RC4)})),r((function(t,e){var n;t.exports=(n=zw,function(){var t=n,e=t.lib.StreamCipher,r=t.algo,o=[],i=[],a=[],s=r.Rabbit=e.extend({_doReset:function(){for(var t=this._key.words,e=this.cfg.iv,n=0;n<4;n++)t[n]=16711935&(t[n]<<8|t[n]>>>24)|4278255360&(t[n]<<24|t[n]>>>8);var r=this._X=[t[0],t[3]<<16|t[2]>>>16,t[1],t[0]<<16|t[3]>>>16,t[2],t[1]<<16|t[0]>>>16,t[3],t[2]<<16|t[1]>>>16],o=this._C=[t[2]<<16|t[2]>>>16,4294901760&t[0]|65535&t[1],t[3]<<16|t[3]>>>16,4294901760&t[1]|65535&t[2],t[0]<<16|t[0]>>>16,4294901760&t[2]|65535&t[3],t[1]<<16|t[1]>>>16,4294901760&t[3]|65535&t[0]];for(this._b=0,n=0;n<4;n++)l.call(this);for(n=0;n<8;n++)o[n]^=r[n+4&7];if(e){var i=e.words,a=i[0],s=i[1],u=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),c=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),h=u>>>16|4294901760&c,p=c<<16|65535&u;for(o[0]^=u,o[1]^=h,o[2]^=c,o[3]^=p,o[4]^=u,o[5]^=h,o[6]^=c,o[7]^=p,n=0;n<4;n++)l.call(this)}},_doProcessBlock:function(t,e){var n=this._X;l.call(this),o[0]=n[0]^n[5]>>>16^n[3]<<16,o[1]=n[2]^n[7]>>>16^n[5]<<16,o[2]=n[4]^n[1]>>>16^n[7]<<16,o[3]=n[6]^n[3]>>>16^n[1]<<16;for(var r=0;r<4;r++)o[r]=16711935&(o[r]<<8|o[r]>>>24)|4278255360&(o[r]<<24|o[r]>>>8),t[e+r]^=o[r]},blockSize:4,ivSize:2});function l(){for(var t=this._X,e=this._C,n=0;n<8;n++)i[n]=e[n];for(e[0]=e[0]+1295307597+this._b|0,e[1]=e[1]+3545052371+(e[0]>>>0<i[0]>>>0?1:0)|0,e[2]=e[2]+886263092+(e[1]>>>0<i[1]>>>0?1:0)|0,e[3]=e[3]+1295307597+(e[2]>>>0<i[2]>>>0?1:0)|0,e[4]=e[4]+3545052371+(e[3]>>>0<i[3]>>>0?1:0)|0,e[5]=e[5]+886263092+(e[4]>>>0<i[4]>>>0?1:0)|0,e[6]=e[6]+1295307597+(e[5]>>>0<i[5]>>>0?1:0)|0,e[7]=e[7]+3545052371+(e[6]>>>0<i[6]>>>0?1:0)|0,this._b=e[7]>>>0<i[7]>>>0?1:0,n=0;n<8;n++){var r=t[n]+e[n],o=65535&r,s=r>>>16,l=((o*o>>>17)+o*s>>>15)+s*s,u=((4294901760&r)*r|0)+((65535&r)*r|0);a[n]=l^u}t[0]=a[0]+(a[7]<<16|a[7]>>>16)+(a[6]<<16|a[6]>>>16)|0,t[1]=a[1]+(a[0]<<8|a[0]>>>24)+a[7]|0,t[2]=a[2]+(a[1]<<16|a[1]>>>16)+(a[0]<<16|a[0]>>>16)|0,t[3]=a[3]+(a[2]<<8|a[2]>>>24)+a[1]|0,t[4]=a[4]+(a[3]<<16|a[3]>>>16)+(a[2]<<16|a[2]>>>16)|0,t[5]=a[5]+(a[4]<<8|a[4]>>>24)+a[3]|0,t[6]=a[6]+(a[5]<<16|a[5]>>>16)+(a[4]<<16|a[4]>>>16)|0,t[7]=a[7]+(a[6]<<8|a[6]>>>24)+a[5]|0}t.Rabbit=e._createHelper(s)}(),n.Rabbit)})),r((function(t,e){var n;t.exports=(n=zw,function(){var t=n,e=t.lib.StreamCipher,r=t.algo,o=[],i=[],a=[],s=r.RabbitLegacy=e.extend({_doReset:function(){var t=this._key.words,e=this.cfg.iv,n=this._X=[t[0],t[3]<<16|t[2]>>>16,t[1],t[0]<<16|t[3]>>>16,t[2],t[1]<<16|t[0]>>>16,t[3],t[2]<<16|t[1]>>>16],r=this._C=[t[2]<<16|t[2]>>>16,4294901760&t[0]|65535&t[1],t[3]<<16|t[3]>>>16,4294901760&t[1]|65535&t[2],t[0]<<16|t[0]>>>16,4294901760&t[2]|65535&t[3],t[1]<<16|t[1]>>>16,4294901760&t[3]|65535&t[0]];this._b=0;for(var o=0;o<4;o++)l.call(this);for(o=0;o<8;o++)r[o]^=n[o+4&7];if(e){var i=e.words,a=i[0],s=i[1],u=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),c=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),h=u>>>16|4294901760&c,p=c<<16|65535&u;for(r[0]^=u,r[1]^=h,r[2]^=c,r[3]^=p,r[4]^=u,r[5]^=h,r[6]^=c,r[7]^=p,o=0;o<4;o++)l.call(this)}},_doProcessBlock:function(t,e){var n=this._X;l.call(this),o[0]=n[0]^n[5]>>>16^n[3]<<16,o[1]=n[2]^n[7]>>>16^n[5]<<16,o[2]=n[4]^n[1]>>>16^n[7]<<16,o[3]=n[6]^n[3]>>>16^n[1]<<16;for(var r=0;r<4;r++)o[r]=16711935&(o[r]<<8|o[r]>>>24)|4278255360&(o[r]<<24|o[r]>>>8),t[e+r]^=o[r]},blockSize:4,ivSize:2});function l(){for(var t=this._X,e=this._C,n=0;n<8;n++)i[n]=e[n];for(e[0]=e[0]+1295307597+this._b|0,e[1]=e[1]+3545052371+(e[0]>>>0<i[0]>>>0?1:0)|0,e[2]=e[2]+886263092+(e[1]>>>0<i[1]>>>0?1:0)|0,e[3]=e[3]+1295307597+(e[2]>>>0<i[2]>>>0?1:0)|0,e[4]=e[4]+3545052371+(e[3]>>>0<i[3]>>>0?1:0)|0,e[5]=e[5]+886263092+(e[4]>>>0<i[4]>>>0?1:0)|0,e[6]=e[6]+1295307597+(e[5]>>>0<i[5]>>>0?1:0)|0,e[7]=e[7]+3545052371+(e[6]>>>0<i[6]>>>0?1:0)|0,this._b=e[7]>>>0<i[7]>>>0?1:0,n=0;n<8;n++){var r=t[n]+e[n],o=65535&r,s=r>>>16,l=((o*o>>>17)+o*s>>>15)+s*s,u=((4294901760&r)*r|0)+((65535&r)*r|0);a[n]=l^u}t[0]=a[0]+(a[7]<<16|a[7]>>>16)+(a[6]<<16|a[6]>>>16)|0,t[1]=a[1]+(a[0]<<8|a[0]>>>24)+a[7]|0,t[2]=a[2]+(a[1]<<16|a[1]>>>16)+(a[0]<<16|a[0]>>>16)|0,t[3]=a[3]+(a[2]<<8|a[2]>>>24)+a[1]|0,t[4]=a[4]+(a[3]<<16|a[3]>>>16)+(a[2]<<16|a[2]>>>16)|0,t[5]=a[5]+(a[4]<<8|a[4]>>>24)+a[3]|0,t[6]=a[6]+(a[5]<<16|a[5]>>>16)+(a[4]<<16|a[4]>>>16)|0,t[7]=a[7]+(a[6]<<8|a[6]>>>24)+a[5]|0}t.RabbitLegacy=e._createHelper(s)}(),n.RabbitLegacy)})),r((function(t,e){t.exports=zw}))),Gw=r((function(t,e){var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function r(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var n=e.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var o in n)r(n,o)&&(t[o]=n[o])}}return t},e.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var o={arraySet:function(t,e,n,r,o){if(e.subarray&&t.subarray)t.set(e.subarray(n,n+r),o);else for(var i=0;i<r;i++)t[o+i]=e[n+i]},flattenChunks:function(t){var e,n,r,o,i,a;for(r=0,e=0,n=t.length;e<n;e++)r+=t[e].length;for(a=new Uint8Array(r),o=0,e=0,n=t.length;e<n;e++)i=t[e],a.set(i,o),o+=i.length;return a}},i={arraySet:function(t,e,n,r,o){for(var i=0;i<r;i++)t[o+i]=e[n+i]},flattenChunks:function(t){return[].concat.apply([],t)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,o)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,i))},e.setTyped(n)}));Gw.assign,Gw.shrinkBuf,Gw.setTyped,Gw.Buf8,Gw.Buf16,Gw.Buf32;function Uw(t){for(var e=t.length;--e>=0;)t[e]=0}var Yw=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Xw=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Zw=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],qw=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Jw=new Array(576);Uw(Jw);var $w=new Array(60);Uw($w);var Kw=new Array(512);Uw(Kw);var Qw=new Array(256);Uw(Qw);var tb=new Array(29);Uw(tb);var eb,nb,rb,ob=new Array(30);function ib(t,e,n,r,o){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=r,this.max_length=o,this.has_stree=t&&t.length}function ab(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function sb(t){return t<256?Kw[t]:Kw[256+(t>>>7)]}function lb(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function ub(t,e,n){t.bi_valid>16-n?(t.bi_buf|=e<<t.bi_valid&65535,lb(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=n-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)}function cb(t,e,n){ub(t,n[2*e],n[2*e+1])}function hb(t,e){var n=0;do{n|=1&t,t>>>=1,n<<=1}while(--e>0);return n>>>1}function pb(t,e,n){var r,o,i=new Array(16),a=0;for(r=1;r<=15;r++)i[r]=a=a+n[r-1]<<1;for(o=0;o<=e;o++){var s=t[2*o+1];0!==s&&(t[2*o]=hb(i[s]++,s))}}function db(t){var e;for(e=0;e<286;e++)t.dyn_ltree[2*e]=0;for(e=0;e<30;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function fb(t){t.bi_valid>8?lb(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function mb(t,e,n,r){var o=2*e,i=2*n;return t[o]<t[i]||t[o]===t[i]&&r[e]<=r[n]}function gb(t,e,n){for(var r=t.heap[n],o=n<<1;o<=t.heap_len&&(o<t.heap_len&&mb(e,t.heap[o+1],t.heap[o],t.depth)&&o++,!mb(e,r,t.heap[o],t.depth));)t.heap[n]=t.heap[o],n=o,o<<=1;t.heap[n]=r}function vb(t,e,n){var r,o,i,a,s=0;if(0!==t.last_lit)do{r=t.pending_buf[t.d_buf+2*s]<<8|t.pending_buf[t.d_buf+2*s+1],o=t.pending_buf[t.l_buf+s],s++,0===r?cb(t,o,e):(cb(t,(i=Qw[o])+256+1,e),0!==(a=Yw[i])&&ub(t,o-=tb[i],a),cb(t,i=sb(--r),n),0!==(a=Xw[i])&&ub(t,r-=ob[i],a))}while(s<t.last_lit);cb(t,256,e)}function yb(t,e){var n,r,o,i=e.dyn_tree,a=e.stat_desc.static_tree,s=e.stat_desc.has_stree,l=e.stat_desc.elems,u=-1;for(t.heap_len=0,t.heap_max=573,n=0;n<l;n++)0!==i[2*n]?(t.heap[++t.heap_len]=u=n,t.depth[n]=0):i[2*n+1]=0;for(;t.heap_len<2;)i[2*(o=t.heap[++t.heap_len]=u<2?++u:0)]=1,t.depth[o]=0,t.opt_len--,s&&(t.static_len-=a[2*o+1]);for(e.max_code=u,n=t.heap_len>>1;n>=1;n--)gb(t,i,n);o=l;do{n=t.heap[1],t.heap[1]=t.heap[t.heap_len--],gb(t,i,1),r=t.heap[1],t.heap[--t.heap_max]=n,t.heap[--t.heap_max]=r,i[2*o]=i[2*n]+i[2*r],t.depth[o]=(t.depth[n]>=t.depth[r]?t.depth[n]:t.depth[r])+1,i[2*n+1]=i[2*r+1]=o,t.heap[1]=o++,gb(t,i,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function(t,e){var n,r,o,i,a,s,l=e.dyn_tree,u=e.max_code,c=e.stat_desc.static_tree,h=e.stat_desc.has_stree,p=e.stat_desc.extra_bits,d=e.stat_desc.extra_base,f=e.stat_desc.max_length,m=0;for(i=0;i<=15;i++)t.bl_count[i]=0;for(l[2*t.heap[t.heap_max]+1]=0,n=t.heap_max+1;n<573;n++)(i=l[2*l[2*(r=t.heap[n])+1]+1]+1)>f&&(i=f,m++),l[2*r+1]=i,r>u||(t.bl_count[i]++,a=0,r>=d&&(a=p[r-d]),s=l[2*r],t.opt_len+=s*(i+a),h&&(t.static_len+=s*(c[2*r+1]+a)));if(0!==m){do{for(i=f-1;0===t.bl_count[i];)i--;t.bl_count[i]--,t.bl_count[i+1]+=2,t.bl_count[f]--,m-=2}while(m>0);for(i=f;0!==i;i--)for(r=t.bl_count[i];0!==r;)(o=t.heap[--n])>u||(l[2*o+1]!==i&&(t.opt_len+=(i-l[2*o+1])*l[2*o],l[2*o+1]=i),r--)}}(t,e),pb(i,u,t.bl_count)}function wb(t,e,n){var r,o,i=-1,a=e[1],s=0,l=7,u=4;for(0===a&&(l=138,u=3),e[2*(n+1)+1]=65535,r=0;r<=n;r++)o=a,a=e[2*(r+1)+1],++s<l&&o===a||(s<u?t.bl_tree[2*o]+=s:0!==o?(o!==i&&t.bl_tree[2*o]++,t.bl_tree[32]++):s<=10?t.bl_tree[34]++:t.bl_tree[36]++,s=0,i=o,0===a?(l=138,u=3):o===a?(l=6,u=3):(l=7,u=4))}function bb(t,e,n){var r,o,i=-1,a=e[1],s=0,l=7,u=4;for(0===a&&(l=138,u=3),r=0;r<=n;r++)if(o=a,a=e[2*(r+1)+1],!(++s<l&&o===a)){if(s<u)do{cb(t,o,t.bl_tree)}while(0!=--s);else 0!==o?(o!==i&&(cb(t,o,t.bl_tree),s--),cb(t,16,t.bl_tree),ub(t,s-3,2)):s<=10?(cb(t,17,t.bl_tree),ub(t,s-3,3)):(cb(t,18,t.bl_tree),ub(t,s-11,7));s=0,i=o,0===a?(l=138,u=3):o===a?(l=6,u=3):(l=7,u=4)}}Uw(ob);var Sb=!1;function Eb(t,e,n,r){ub(t,0+(r?1:0),3),function(t,e,n,r){fb(t),r&&(lb(t,n),lb(t,~n)),Gw.arraySet(t.pending_buf,t.window,e,n,t.pending),t.pending+=n}(t,e,n,!0)}var Pb={_tr_init:function(t){Sb||(!function(){var t,e,n,r,o,i=new Array(16);for(n=0,r=0;r<28;r++)for(tb[r]=n,t=0;t<1<<Yw[r];t++)Qw[n++]=r;for(Qw[n-1]=r,o=0,r=0;r<16;r++)for(ob[r]=o,t=0;t<1<<Xw[r];t++)Kw[o++]=r;for(o>>=7;r<30;r++)for(ob[r]=o<<7,t=0;t<1<<Xw[r]-7;t++)Kw[256+o++]=r;for(e=0;e<=15;e++)i[e]=0;for(t=0;t<=143;)Jw[2*t+1]=8,t++,i[8]++;for(;t<=255;)Jw[2*t+1]=9,t++,i[9]++;for(;t<=279;)Jw[2*t+1]=7,t++,i[7]++;for(;t<=287;)Jw[2*t+1]=8,t++,i[8]++;for(pb(Jw,287,i),t=0;t<30;t++)$w[2*t+1]=5,$w[2*t]=hb(t,5);eb=new ib(Jw,Yw,257,286,15),nb=new ib($w,Xw,0,30,15),rb=new ib(new Array(0),Zw,0,19,7)}(),Sb=!0),t.l_desc=new ab(t.dyn_ltree,eb),t.d_desc=new ab(t.dyn_dtree,nb),t.bl_desc=new ab(t.bl_tree,rb),t.bi_buf=0,t.bi_valid=0,db(t)},_tr_stored_block:Eb,_tr_flush_block:function(t,e,n,r){var o,i,a=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,n=4093624447;for(e=0;e<=31;e++,n>>>=1)if(1&n&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<256;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0}(t)),yb(t,t.l_desc),yb(t,t.d_desc),a=function(t){var e;for(wb(t,t.dyn_ltree,t.l_desc.max_code),wb(t,t.dyn_dtree,t.d_desc.max_code),yb(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*qw[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),o=t.opt_len+3+7>>>3,(i=t.static_len+3+7>>>3)<=o&&(o=i)):o=i=n+5,n+4<=o&&-1!==e?Eb(t,e,n,r):4===t.strategy||i===o?(ub(t,2+(r?1:0),3),vb(t,Jw,$w)):(ub(t,4+(r?1:0),3),function(t,e,n,r){var o;for(ub(t,e-257,5),ub(t,n-1,5),ub(t,r-4,4),o=0;o<r;o++)ub(t,t.bl_tree[2*qw[o]+1],3);bb(t,t.dyn_ltree,e-1),bb(t,t.dyn_dtree,n-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,a+1),vb(t,t.dyn_ltree,t.dyn_dtree)),db(t),r&&fb(t)},_tr_tally:function(t,e,n){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&n,t.last_lit++,0===e?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(Qw[n]+256+1)]++,t.dyn_dtree[2*sb(e)]++),t.last_lit===t.lit_bufsize-1},_tr_align:function(t){ub(t,2,3),cb(t,256,Jw),function(t){16===t.bi_valid?(lb(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}};var xb=function(t,e,n,r){for(var o=65535&t|0,i=t>>>16&65535|0,a=0;0!==n;){n-=a=n>2e3?2e3:n;do{i=i+(o=o+e[r++]|0)|0}while(--a);o%=65521,i%=65521}return o|i<<16|0};var _b=function(){for(var t,e=[],n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e}();var Tb,Cb=function(t,e,n,r){var o=_b,i=r+n;t^=-1;for(var a=r;a<i;a++)t=t>>>8^o[255&(t^e[a])];return-1^t},Ib={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};function Db(t,e){return t.msg=Ib[e],e}function kb(t){return(t<<1)-(t>4?9:0)}function Mb(t){for(var e=t.length;--e>=0;)t[e]=0}function Rb(t){var e=t.state,n=e.pending;n>t.avail_out&&(n=t.avail_out),0!==n&&(Gw.arraySet(t.output,e.pending_buf,e.pending_out,n,t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,0===e.pending&&(e.pending_out=0))}function Ab(t,e){Pb._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,Rb(t.strm)}function Hb(t,e){t.pending_buf[t.pending++]=e}function Ob(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function Lb(t,e){var n,r,o=t.max_chain_length,i=t.strstart,a=t.prev_length,s=t.nice_match,l=t.strstart>t.w_size-262?t.strstart-(t.w_size-262):0,u=t.window,c=t.w_mask,h=t.prev,p=t.strstart+258,d=u[i+a-1],f=u[i+a];t.prev_length>=t.good_match&&(o>>=2),s>t.lookahead&&(s=t.lookahead);do{if(u[(n=e)+a]===f&&u[n+a-1]===d&&u[n]===u[i]&&u[++n]===u[i+1]){i+=2,n++;do{}while(u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&i<p);if(r=258-(p-i),i=p-258,r>a){if(t.match_start=e,a=r,r>=s)break;d=u[i+a-1],f=u[i+a]}}}while((e=h[e&c])>l&&0!=--o);return a<=t.lookahead?a:t.lookahead}function Bb(t){var e,n,r,o,i,a,s,l,u,c,h=t.w_size;do{if(o=t.window_size-t.lookahead-t.strstart,t.strstart>=h+(h-262)){Gw.arraySet(t.window,t.window,h,h,0),t.match_start-=h,t.strstart-=h,t.block_start-=h,e=n=t.hash_size;do{r=t.head[--e],t.head[e]=r>=h?r-h:0}while(--n);e=n=h;do{r=t.prev[--e],t.prev[e]=r>=h?r-h:0}while(--n);o+=h}if(0===t.strm.avail_in)break;if(a=t.strm,s=t.window,l=t.strstart+t.lookahead,u=o,c=void 0,(c=a.avail_in)>u&&(c=u),n=0===c?0:(a.avail_in-=c,Gw.arraySet(s,a.input,a.next_in,c,l),1===a.state.wrap?a.adler=xb(a.adler,s,c,l):2===a.state.wrap&&(a.adler=Cb(a.adler,s,c,l)),a.next_in+=c,a.total_in+=c,c),t.lookahead+=n,t.lookahead+t.insert>=3)for(i=t.strstart-t.insert,t.ins_h=t.window[i],t.ins_h=(t.ins_h<<t.hash_shift^t.window[i+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[i+3-1])&t.hash_mask,t.prev[i&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=i,i++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<262&&0!==t.strm.avail_in)}function Fb(t,e){for(var n,r;;){if(t.lookahead<262){if(Bb(t),t.lookahead<262&&0===e)return 1;if(0===t.lookahead)break}if(n=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==n&&t.strstart-n<=t.w_size-262&&(t.match_length=Lb(t,n)),t.match_length>=3)if(r=Pb._tr_tally(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else r=Pb._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(Ab(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,4===e?(Ab(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Ab(t,!1),0===t.strm.avail_out)?1:2}function Nb(t,e){for(var n,r,o;;){if(t.lookahead<262){if(Bb(t),t.lookahead<262&&0===e)return 1;if(0===t.lookahead)break}if(n=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==n&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-262&&(t.match_length=Lb(t,n),t.match_length<=5&&(1===t.strategy||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){o=t.strstart+t.lookahead-3,r=Pb._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=o&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,r&&(Ab(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if((r=Pb._tr_tally(t,0,t.window[t.strstart-1]))&&Ab(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=Pb._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,4===e?(Ab(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Ab(t,!1),0===t.strm.avail_out)?1:2}function jb(t,e,n,r,o){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=r,this.func=o}function Vb(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Gw.Buf16(1146),this.dyn_dtree=new Gw.Buf16(122),this.bl_tree=new Gw.Buf16(78),Mb(this.dyn_ltree),Mb(this.dyn_dtree),Mb(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Gw.Buf16(16),this.heap=new Gw.Buf16(573),Mb(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Gw.Buf16(573),Mb(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function zb(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=2,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?42:113,t.adler=2===e.wrap?0:1,e.last_flush=0,Pb._tr_init(e),0):Db(t,-2)}function Wb(t){var e,n=zb(t);return 0===n&&((e=t.state).window_size=2*e.w_size,Mb(e.head),e.max_lazy_match=Tb[e.level].max_lazy,e.good_match=Tb[e.level].good_length,e.nice_match=Tb[e.level].nice_length,e.max_chain_length=Tb[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0),n}function Gb(t,e,n,r,o,i){if(!t)return-2;var a=1;if(-1===e&&(e=6),r<0?(a=0,r=-r):r>15&&(a=2,r-=16),o<1||o>9||8!==n||r<8||r>15||e<0||e>9||i<0||i>4)return Db(t,-2);8===r&&(r=9);var s=new Vb;return t.state=s,s.strm=t,s.wrap=a,s.gzhead=null,s.w_bits=r,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=o+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new Gw.Buf8(2*s.w_size),s.head=new Gw.Buf16(s.hash_size),s.prev=new Gw.Buf16(s.w_size),s.lit_bufsize=1<<o+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Gw.Buf8(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=e,s.strategy=i,s.method=n,Wb(t)}Tb=[new jb(0,0,0,0,(function(t,e){var n=65535;for(n>t.pending_buf_size-5&&(n=t.pending_buf_size-5);;){if(t.lookahead<=1){if(Bb(t),0===t.lookahead&&0===e)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var r=t.block_start+n;if((0===t.strstart||t.strstart>=r)&&(t.lookahead=t.strstart-r,t.strstart=r,Ab(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-262&&(Ab(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(Ab(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&(Ab(t,!1),t.strm.avail_out),1)})),new jb(4,4,8,4,Fb),new jb(4,5,16,8,Fb),new jb(4,6,32,32,Fb),new jb(4,4,16,16,Nb),new jb(8,16,32,32,Nb),new jb(8,16,128,128,Nb),new jb(8,32,128,256,Nb),new jb(32,128,258,1024,Nb),new jb(32,258,258,4096,Nb)];var Ub={deflateInit:function(t,e){return Gb(t,e,8,15,8,0)},deflateInit2:Gb,deflateReset:Wb,deflateResetKeep:zb,deflateSetHeader:function(t,e){return t&&t.state?2!==t.state.wrap?-2:(t.state.gzhead=e,0):-2},deflate:function(t,e){var n,r,o,i;if(!t||!t.state||e>5||e<0)return t?Db(t,-2):-2;if(r=t.state,!t.output||!t.input&&0!==t.avail_in||666===r.status&&4!==e)return Db(t,0===t.avail_out?-5:-2);if(r.strm=t,n=r.last_flush,r.last_flush=e,42===r.status)if(2===r.wrap)t.adler=0,Hb(r,31),Hb(r,139),Hb(r,8),r.gzhead?(Hb(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),Hb(r,255&r.gzhead.time),Hb(r,r.gzhead.time>>8&255),Hb(r,r.gzhead.time>>16&255),Hb(r,r.gzhead.time>>24&255),Hb(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),Hb(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(Hb(r,255&r.gzhead.extra.length),Hb(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=Cb(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(Hb(r,0),Hb(r,0),Hb(r,0),Hb(r,0),Hb(r,0),Hb(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),Hb(r,3),r.status=113);else{var a=8+(r.w_bits-8<<4)<<8;a|=(r.strategy>=2||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(a|=32),a+=31-a%31,r.status=113,Ob(r,a),0!==r.strstart&&(Ob(r,t.adler>>>16),Ob(r,65535&t.adler)),t.adler=1}if(69===r.status)if(r.gzhead.extra){for(o=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>o&&(t.adler=Cb(t.adler,r.pending_buf,r.pending-o,o)),Rb(t),o=r.pending,r.pending!==r.pending_buf_size));)Hb(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>o&&(t.adler=Cb(t.adler,r.pending_buf,r.pending-o,o)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){o=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>o&&(t.adler=Cb(t.adler,r.pending_buf,r.pending-o,o)),Rb(t),o=r.pending,r.pending===r.pending_buf_size)){i=1;break}i=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,Hb(r,i)}while(0!==i);r.gzhead.hcrc&&r.pending>o&&(t.adler=Cb(t.adler,r.pending_buf,r.pending-o,o)),0===i&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){o=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>o&&(t.adler=Cb(t.adler,r.pending_buf,r.pending-o,o)),Rb(t),o=r.pending,r.pending===r.pending_buf_size)){i=1;break}i=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,Hb(r,i)}while(0!==i);r.gzhead.hcrc&&r.pending>o&&(t.adler=Cb(t.adler,r.pending_buf,r.pending-o,o)),0===i&&(r.status=103)}else r.status=103;if(103===r.status&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&Rb(t),r.pending+2<=r.pending_buf_size&&(Hb(r,255&t.adler),Hb(r,t.adler>>8&255),t.adler=0,r.status=113)):r.status=113),0!==r.pending){if(Rb(t),0===t.avail_out)return r.last_flush=-1,0}else if(0===t.avail_in&&kb(e)<=kb(n)&&4!==e)return Db(t,-5);if(666===r.status&&0!==t.avail_in)return Db(t,-5);if(0!==t.avail_in||0!==r.lookahead||0!==e&&666!==r.status){var s=2===r.strategy?function(t,e){for(var n;;){if(0===t.lookahead&&(Bb(t),0===t.lookahead)){if(0===e)return 1;break}if(t.match_length=0,n=Pb._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(Ab(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(Ab(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Ab(t,!1),0===t.strm.avail_out)?1:2}(r,e):3===r.strategy?function(t,e){for(var n,r,o,i,a=t.window;;){if(t.lookahead<=258){if(Bb(t),t.lookahead<=258&&0===e)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(r=a[o=t.strstart-1])===a[++o]&&r===a[++o]&&r===a[++o]){i=t.strstart+258;do{}while(r===a[++o]&&r===a[++o]&&r===a[++o]&&r===a[++o]&&r===a[++o]&&r===a[++o]&&r===a[++o]&&r===a[++o]&&o<i);t.match_length=258-(i-o),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(n=Pb._tr_tally(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=Pb._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(Ab(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(Ab(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Ab(t,!1),0===t.strm.avail_out)?1:2}(r,e):Tb[r.level].func(r,e);if(3!==s&&4!==s||(r.status=666),1===s||3===s)return 0===t.avail_out&&(r.last_flush=-1),0;if(2===s&&(1===e?Pb._tr_align(r):5!==e&&(Pb._tr_stored_block(r,0,0,!1),3===e&&(Mb(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),Rb(t),0===t.avail_out))return r.last_flush=-1,0}return 4!==e?0:r.wrap<=0?1:(2===r.wrap?(Hb(r,255&t.adler),Hb(r,t.adler>>8&255),Hb(r,t.adler>>16&255),Hb(r,t.adler>>24&255),Hb(r,255&t.total_in),Hb(r,t.total_in>>8&255),Hb(r,t.total_in>>16&255),Hb(r,t.total_in>>24&255)):(Ob(r,t.adler>>>16),Ob(r,65535&t.adler)),Rb(t),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?0:1)},deflateEnd:function(t){var e;return t&&t.state?42!==(e=t.state.status)&&69!==e&&73!==e&&91!==e&&103!==e&&113!==e&&666!==e?Db(t,-2):(t.state=null,113===e?Db(t,-3):0):-2},deflateSetDictionary:function(t,e){var n,r,o,i,a,s,l,u,c=e.length;if(!t||!t.state)return-2;if(2===(i=(n=t.state).wrap)||1===i&&42!==n.status||n.lookahead)return-2;for(1===i&&(t.adler=xb(t.adler,e,c,0)),n.wrap=0,c>=n.w_size&&(0===i&&(Mb(n.head),n.strstart=0,n.block_start=0,n.insert=0),u=new Gw.Buf8(n.w_size),Gw.arraySet(u,e,c-n.w_size,n.w_size,0),e=u,c=n.w_size),a=t.avail_in,s=t.next_in,l=t.input,t.avail_in=c,t.next_in=0,t.input=e,Bb(n);n.lookahead>=3;){r=n.strstart,o=n.lookahead-2;do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+3-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--o);n.strstart=r,n.lookahead=2,Bb(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,t.next_in=s,t.input=l,t.avail_in=a,n.wrap=i,0},deflateInfo:"pako deflate (from Nodeca project)"},Yb=!0,Xb=!0;try{String.fromCharCode.apply(null,[0])}catch(t){Yb=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){Xb=!1}for(var Zb=new Gw.Buf8(256),qb=0;qb<256;qb++)Zb[qb]=qb>=252?6:qb>=248?5:qb>=240?4:qb>=224?3:qb>=192?2:1;Zb[254]=Zb[254]=1;function Jb(t,e){if(e<65534&&(t.subarray&&Xb||!t.subarray&&Yb))return String.fromCharCode.apply(null,Gw.shrinkBuf(t,e));for(var n="",r=0;r<e;r++)n+=String.fromCharCode(t[r]);return n}var $b=function(t){var e,n,r,o,i,a=t.length,s=0;for(o=0;o<a;o++)55296==(64512&(n=t.charCodeAt(o)))&&o+1<a&&56320==(64512&(r=t.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(r-56320),o++),s+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Gw.Buf8(s),i=0,o=0;i<s;o++)55296==(64512&(n=t.charCodeAt(o)))&&o+1<a&&56320==(64512&(r=t.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(r-56320),o++),n<128?e[i++]=n:n<2048?(e[i++]=192|n>>>6,e[i++]=128|63&n):n<65536?(e[i++]=224|n>>>12,e[i++]=128|n>>>6&63,e[i++]=128|63&n):(e[i++]=240|n>>>18,e[i++]=128|n>>>12&63,e[i++]=128|n>>>6&63,e[i++]=128|63&n);return e},Kb=function(t){return Jb(t,t.length)},Qb=function(t){for(var e=new Gw.Buf8(t.length),n=0,r=e.length;n<r;n++)e[n]=t.charCodeAt(n);return e},tS=function(t,e){var n,r,o,i,a=e||t.length,s=new Array(2*a);for(r=0,n=0;n<a;)if((o=t[n++])<128)s[r++]=o;else if((i=Zb[o])>4)s[r++]=65533,n+=i-1;else{for(o&=2===i?31:3===i?15:7;i>1&&n<a;)o=o<<6|63&t[n++],i--;i>1?s[r++]=65533:o<65536?s[r++]=o:(o-=65536,s[r++]=55296|o>>10&1023,s[r++]=56320|1023&o)}return Jb(s,r)},eS=function(t,e){var n;for((e=e||t.length)>t.length&&(e=t.length),n=e-1;n>=0&&128==(192&t[n]);)n--;return n<0||0===n?e:n+Zb[t[n]]>e?n:e};var nS=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},rS=Object.prototype.toString;function oS(t){if(!(this instanceof oS))return new oS(t);this.options=Gw.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new nS,this.strm.avail_out=0;var n=Ub.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(0!==n)throw new Error(Ib[n]);if(e.header&&Ub.deflateSetHeader(this.strm,e.header),e.dictionary){var r;if(r="string"==typeof e.dictionary?$b(e.dictionary):"[object ArrayBuffer]"===rS.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,0!==(n=Ub.deflateSetDictionary(this.strm,r)))throw new Error(Ib[n]);this._dict_set=!0}}function iS(t,e){var n=new oS(e);if(n.push(t,!0),n.err)throw n.msg||Ib[n.err];return n.result}oS.prototype.push=function(t,e){var n,r,o=this.strm,i=this.options.chunkSize;if(this.ended)return!1;r=e===~~e?e:!0===e?4:0,"string"==typeof t?o.input=$b(t):"[object ArrayBuffer]"===rS.call(t)?o.input=new Uint8Array(t):o.input=t,o.next_in=0,o.avail_in=o.input.length;do{if(0===o.avail_out&&(o.output=new Gw.Buf8(i),o.next_out=0,o.avail_out=i),1!==(n=Ub.deflate(o,r))&&0!==n)return this.onEnd(n),this.ended=!0,!1;0!==o.avail_out&&(0!==o.avail_in||4!==r&&2!==r)||("string"===this.options.to?this.onData(Kb(Gw.shrinkBuf(o.output,o.next_out))):this.onData(Gw.shrinkBuf(o.output,o.next_out)))}while((o.avail_in>0||0===o.avail_out)&&1!==n);return 4===r?(n=Ub.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,0===n):2!==r||(this.onEnd(0),o.avail_out=0,!0)},oS.prototype.onData=function(t){this.chunks.push(t)},oS.prototype.onEnd=function(t){0===t&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Gw.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var aS={Deflate:oS,deflate:iS,deflateRaw:function(t,e){return(e=e||{}).raw=!0,iS(t,e)},gzip:function(t,e){return(e=e||{}).gzip=!0,iS(t,e)}},sS=function(t,e){var n,r,o,i,a,s,l,u,c,h,p,d,f,m,g,v,y,w,b,S,E,P,x,_,T;n=t.state,r=t.next_in,_=t.input,o=r+(t.avail_in-5),i=t.next_out,T=t.output,a=i-(e-t.avail_out),s=i+(t.avail_out-257),l=n.dmax,u=n.wsize,c=n.whave,h=n.wnext,p=n.window,d=n.hold,f=n.bits,m=n.lencode,g=n.distcode,v=(1<<n.lenbits)-1,y=(1<<n.distbits)-1;t:do{f<15&&(d+=_[r++]<<f,f+=8,d+=_[r++]<<f,f+=8),w=m[d&v];e:for(;;){if(d>>>=b=w>>>24,f-=b,0===(b=w>>>16&255))T[i++]=65535&w;else{if(!(16&b)){if(0==(64&b)){w=m[(65535&w)+(d&(1<<b)-1)];continue e}if(32&b){n.mode=12;break t}t.msg="invalid literal/length code",n.mode=30;break t}S=65535&w,(b&=15)&&(f<b&&(d+=_[r++]<<f,f+=8),S+=d&(1<<b)-1,d>>>=b,f-=b),f<15&&(d+=_[r++]<<f,f+=8,d+=_[r++]<<f,f+=8),w=g[d&y];n:for(;;){if(d>>>=b=w>>>24,f-=b,!(16&(b=w>>>16&255))){if(0==(64&b)){w=g[(65535&w)+(d&(1<<b)-1)];continue n}t.msg="invalid distance code",n.mode=30;break t}if(E=65535&w,f<(b&=15)&&(d+=_[r++]<<f,(f+=8)<b&&(d+=_[r++]<<f,f+=8)),(E+=d&(1<<b)-1)>l){t.msg="invalid distance too far back",n.mode=30;break t}if(d>>>=b,f-=b,E>(b=i-a)){if((b=E-b)>c&&n.sane){t.msg="invalid distance too far back",n.mode=30;break t}if(P=0,x=p,0===h){if(P+=u-b,b<S){S-=b;do{T[i++]=p[P++]}while(--b);P=i-E,x=T}}else if(h<b){if(P+=u+h-b,(b-=h)<S){S-=b;do{T[i++]=p[P++]}while(--b);if(P=0,h<S){S-=b=h;do{T[i++]=p[P++]}while(--b);P=i-E,x=T}}}else if(P+=h-b,b<S){S-=b;do{T[i++]=p[P++]}while(--b);P=i-E,x=T}for(;S>2;)T[i++]=x[P++],T[i++]=x[P++],T[i++]=x[P++],S-=3;S&&(T[i++]=x[P++],S>1&&(T[i++]=x[P++]))}else{P=i-E;do{T[i++]=T[P++],T[i++]=T[P++],T[i++]=T[P++],S-=3}while(S>2);S&&(T[i++]=T[P++],S>1&&(T[i++]=T[P++]))}break}}break}}while(r<o&&i<s);r-=S=f>>3,d&=(1<<(f-=S<<3))-1,t.next_in=r,t.next_out=i,t.avail_in=r<o?o-r+5:5-(r-o),t.avail_out=i<s?s-i+257:257-(i-s),n.hold=d,n.bits=f},lS=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],uS=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],cS=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],hS=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],pS=function(t,e,n,r,o,i,a,s){var l,u,c,h,p,d,f,m,g,v=s.bits,y=0,w=0,b=0,S=0,E=0,P=0,x=0,_=0,T=0,C=0,I=null,D=0,k=new Gw.Buf16(16),M=new Gw.Buf16(16),R=null,A=0;for(y=0;y<=15;y++)k[y]=0;for(w=0;w<r;w++)k[e[n+w]]++;for(E=v,S=15;S>=1&&0===k[S];S--);if(E>S&&(E=S),0===S)return o[i++]=20971520,o[i++]=20971520,s.bits=1,0;for(b=1;b<S&&0===k[b];b++);for(E<b&&(E=b),_=1,y=1;y<=15;y++)if(_<<=1,(_-=k[y])<0)return-1;if(_>0&&(0===t||1!==S))return-1;for(M[1]=0,y=1;y<15;y++)M[y+1]=M[y]+k[y];for(w=0;w<r;w++)0!==e[n+w]&&(a[M[e[n+w]]++]=w);if(0===t?(I=R=a,d=19):1===t?(I=lS,D-=257,R=uS,A-=257,d=256):(I=cS,R=hS,d=-1),C=0,w=0,y=b,p=i,P=E,x=0,c=-1,h=(T=1<<E)-1,1===t&&T>852||2===t&&T>592)return 1;for(;;){f=y-x,a[w]<d?(m=0,g=a[w]):a[w]>d?(m=R[A+a[w]],g=I[D+a[w]]):(m=96,g=0),l=1<<y-x,b=u=1<<P;do{o[p+(C>>x)+(u-=l)]=f<<24|m<<16|g|0}while(0!==u);for(l=1<<y-1;C&l;)l>>=1;if(0!==l?(C&=l-1,C+=l):C=0,w++,0==--k[y]){if(y===S)break;y=e[n+a[w]]}if(y>E&&(C&h)!==c){for(0===x&&(x=E),p+=b,_=1<<(P=y-x);P+x<S&&!((_-=k[P+x])<=0);)P++,_<<=1;if(T+=1<<P,1===t&&T>852||2===t&&T>592)return 1;o[c=C&h]=E<<24|P<<16|p-i|0}}return 0!==C&&(o[p+C]=y-x<<24|64<<16|0),s.bits=E,0};function dS(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function fS(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Gw.Buf16(320),this.work=new Gw.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function mS(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Gw.Buf32(852),e.distcode=e.distdyn=new Gw.Buf32(592),e.sane=1,e.back=-1,0):-2}function gS(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,mS(t)):-2}function vS(t,e){var n,r;return t&&t.state?(r=t.state,e<0?(n=0,e=-e):(n=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?-2:(null!==r.window&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,gS(t))):-2}function yS(t,e){var n,r;return t?(r=new fS,t.state=r,r.window=null,0!==(n=vS(t,e))&&(t.state=null),n):-2}var wS,bS,SS=!0;function ES(t){if(SS){var e;for(wS=new Gw.Buf32(512),bS=new Gw.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(pS(1,t.lens,0,288,wS,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;pS(2,t.lens,0,32,bS,0,t.work,{bits:5}),SS=!1}t.lencode=wS,t.lenbits=9,t.distcode=bS,t.distbits=5}function PS(t,e,n,r){var o,i=t.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Gw.Buf8(i.wsize)),r>=i.wsize?(Gw.arraySet(i.window,e,n-i.wsize,i.wsize,0),i.wnext=0,i.whave=i.wsize):((o=i.wsize-i.wnext)>r&&(o=r),Gw.arraySet(i.window,e,n-r,o,i.wnext),(r-=o)?(Gw.arraySet(i.window,e,n-r,r,0),i.wnext=r,i.whave=i.wsize):(i.wnext+=o,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=o))),0}var xS={inflateReset:gS,inflateReset2:vS,inflateResetKeep:mS,inflateInit:function(t){return yS(t,15)},inflateInit2:yS,inflate:function(t,e){var n,r,o,i,a,s,l,u,c,h,p,d,f,m,g,v,y,w,b,S,E,P,x,_,T=0,C=new Gw.Buf8(4),I=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return-2;12===(n=t.state).mode&&(n.mode=13),a=t.next_out,o=t.output,l=t.avail_out,i=t.next_in,r=t.input,s=t.avail_in,u=n.hold,c=n.bits,h=s,p=l,P=0;t:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;c<16;){if(0===s)break t;s--,u+=r[i++]<<c,c+=8}if(2&n.wrap&&35615===u){n.check=0,C[0]=255&u,C[1]=u>>>8&255,n.check=Cb(n.check,C,2,0),u=0,c=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&u)<<8)+(u>>8))%31){t.msg="incorrect header check",n.mode=30;break}if(8!=(15&u)){t.msg="unknown compression method",n.mode=30;break}if(c-=4,E=8+(15&(u>>>=4)),0===n.wbits)n.wbits=E;else if(E>n.wbits){t.msg="invalid window size",n.mode=30;break}n.dmax=1<<E,t.adler=n.check=1,n.mode=512&u?10:12,u=0,c=0;break;case 2:for(;c<16;){if(0===s)break t;s--,u+=r[i++]<<c,c+=8}if(n.flags=u,8!=(255&n.flags)){t.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=u>>8&1),512&n.flags&&(C[0]=255&u,C[1]=u>>>8&255,n.check=Cb(n.check,C,2,0)),u=0,c=0,n.mode=3;case 3:for(;c<32;){if(0===s)break t;s--,u+=r[i++]<<c,c+=8}n.head&&(n.head.time=u),512&n.flags&&(C[0]=255&u,C[1]=u>>>8&255,C[2]=u>>>16&255,C[3]=u>>>24&255,n.check=Cb(n.check,C,4,0)),u=0,c=0,n.mode=4;case 4:for(;c<16;){if(0===s)break t;s--,u+=r[i++]<<c,c+=8}n.head&&(n.head.xflags=255&u,n.head.os=u>>8),512&n.flags&&(C[0]=255&u,C[1]=u>>>8&255,n.check=Cb(n.check,C,2,0)),u=0,c=0,n.mode=5;case 5:if(1024&n.flags){for(;c<16;){if(0===s)break t;s--,u+=r[i++]<<c,c+=8}n.length=u,n.head&&(n.head.extra_len=u),512&n.flags&&(C[0]=255&u,C[1]=u>>>8&255,n.check=Cb(n.check,C,2,0)),u=0,c=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((d=n.length)>s&&(d=s),d&&(n.head&&(E=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),Gw.arraySet(n.head.extra,r,i,d,E)),512&n.flags&&(n.check=Cb(n.check,r,d,i)),s-=d,i+=d,n.length-=d),n.length))break t;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===s)break t;d=0;do{E=r[i+d++],n.head&&E&&n.length<65536&&(n.head.name+=String.fromCharCode(E))}while(E&&d<s);if(512&n.flags&&(n.check=Cb(n.check,r,d,i)),s-=d,i+=d,E)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===s)break t;d=0;do{E=r[i+d++],n.head&&E&&n.length<65536&&(n.head.comment+=String.fromCharCode(E))}while(E&&d<s);if(512&n.flags&&(n.check=Cb(n.check,r,d,i)),s-=d,i+=d,E)break t}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;c<16;){if(0===s)break t;s--,u+=r[i++]<<c,c+=8}if(u!==(65535&n.check)){t.msg="header crc mismatch",n.mode=30;break}u=0,c=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=12;break;case 10:for(;c<32;){if(0===s)break t;s--,u+=r[i++]<<c,c+=8}t.adler=n.check=dS(u),u=0,c=0,n.mode=11;case 11:if(0===n.havedict)return t.next_out=a,t.avail_out=l,t.next_in=i,t.avail_in=s,n.hold=u,n.bits=c,2;t.adler=n.check=1,n.mode=12;case 12:if(5===e||6===e)break t;case 13:if(n.last){u>>>=7&c,c-=7&c,n.mode=27;break}for(;c<3;){if(0===s)break t;s--,u+=r[i++]<<c,c+=8}switch(n.last=1&u,c-=1,3&(u>>>=1)){case 0:n.mode=14;break;case 1:if(ES(n),n.mode=20,6===e){u>>>=2,c-=2;break t}break;case 2:n.mode=17;break;case 3:t.msg="invalid block type",n.mode=30}u>>>=2,c-=2;break;case 14:for(u>>>=7&c,c-=7&c;c<32;){if(0===s)break t;s--,u+=r[i++]<<c,c+=8}if((65535&u)!=(u>>>16^65535)){t.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&u,u=0,c=0,n.mode=15,6===e)break t;case 15:n.mode=16;case 16:if(d=n.length){if(d>s&&(d=s),d>l&&(d=l),0===d)break t;Gw.arraySet(o,r,i,d,a),s-=d,i+=d,l-=d,a+=d,n.length-=d;break}n.mode=12;break;case 17:for(;c<14;){if(0===s)break t;s--,u+=r[i++]<<c,c+=8}if(n.nlen=257+(31&u),u>>>=5,c-=5,n.ndist=1+(31&u),u>>>=5,c-=5,n.ncode=4+(15&u),u>>>=4,c-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;c<3;){if(0===s)break t;s--,u+=r[i++]<<c,c+=8}n.lens[I[n.have++]]=7&u,u>>>=3,c-=3}for(;n.have<19;)n.lens[I[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,x={bits:n.lenbits},P=pS(0,n.lens,0,19,n.lencode,0,n.work,x),n.lenbits=x.bits,P){t.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;v=(T=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,y=65535&T,!((g=T>>>24)<=c);){if(0===s)break t;s--,u+=r[i++]<<c,c+=8}if(y<16)u>>>=g,c-=g,n.lens[n.have++]=y;else{if(16===y){for(_=g+2;c<_;){if(0===s)break t;s--,u+=r[i++]<<c,c+=8}if(u>>>=g,c-=g,0===n.have){t.msg="invalid bit length repeat",n.mode=30;break}E=n.lens[n.have-1],d=3+(3&u),u>>>=2,c-=2}else if(17===y){for(_=g+3;c<_;){if(0===s)break t;s--,u+=r[i++]<<c,c+=8}c-=g,E=0,d=3+(7&(u>>>=g)),u>>>=3,c-=3}else{for(_=g+7;c<_;){if(0===s)break t;s--,u+=r[i++]<<c,c+=8}c-=g,E=0,d=11+(127&(u>>>=g)),u>>>=7,c-=7}if(n.have+d>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=30;break}for(;d--;)n.lens[n.have++]=E}}if(30===n.mode)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,x={bits:n.lenbits},P=pS(1,n.lens,0,n.nlen,n.lencode,0,n.work,x),n.lenbits=x.bits,P){t.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,x={bits:n.distbits},P=pS(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,x),n.distbits=x.bits,P){t.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===e)break t;case 20:n.mode=21;case 21:if(s>=6&&l>=258){t.next_out=a,t.avail_out=l,t.next_in=i,t.avail_in=s,n.hold=u,n.bits=c,sS(t,p),a=t.next_out,o=t.output,l=t.avail_out,i=t.next_in,r=t.input,s=t.avail_in,u=n.hold,c=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;v=(T=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,y=65535&T,!((g=T>>>24)<=c);){if(0===s)break t;s--,u+=r[i++]<<c,c+=8}if(v&&0==(240&v)){for(w=g,b=v,S=y;v=(T=n.lencode[S+((u&(1<<w+b)-1)>>w)])>>>16&255,y=65535&T,!(w+(g=T>>>24)<=c);){if(0===s)break t;s--,u+=r[i++]<<c,c+=8}u>>>=w,c-=w,n.back+=w}if(u>>>=g,c-=g,n.back+=g,n.length=y,0===v){n.mode=26;break}if(32&v){n.back=-1,n.mode=12;break}if(64&v){t.msg="invalid literal/length code",n.mode=30;break}n.extra=15&v,n.mode=22;case 22:if(n.extra){for(_=n.extra;c<_;){if(0===s)break t;s--,u+=r[i++]<<c,c+=8}n.length+=u&(1<<n.extra)-1,u>>>=n.extra,c-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;v=(T=n.distcode[u&(1<<n.distbits)-1])>>>16&255,y=65535&T,!((g=T>>>24)<=c);){if(0===s)break t;s--,u+=r[i++]<<c,c+=8}if(0==(240&v)){for(w=g,b=v,S=y;v=(T=n.distcode[S+((u&(1<<w+b)-1)>>w)])>>>16&255,y=65535&T,!(w+(g=T>>>24)<=c);){if(0===s)break t;s--,u+=r[i++]<<c,c+=8}u>>>=w,c-=w,n.back+=w}if(u>>>=g,c-=g,n.back+=g,64&v){t.msg="invalid distance code",n.mode=30;break}n.offset=y,n.extra=15&v,n.mode=24;case 24:if(n.extra){for(_=n.extra;c<_;){if(0===s)break t;s--,u+=r[i++]<<c,c+=8}n.offset+=u&(1<<n.extra)-1,u>>>=n.extra,c-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===l)break t;if(d=p-l,n.offset>d){if((d=n.offset-d)>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=30;break}d>n.wnext?(d-=n.wnext,f=n.wsize-d):f=n.wnext-d,d>n.length&&(d=n.length),m=n.window}else m=o,f=a-n.offset,d=n.length;d>l&&(d=l),l-=d,n.length-=d;do{o[a++]=m[f++]}while(--d);0===n.length&&(n.mode=21);break;case 26:if(0===l)break t;o[a++]=n.length,l--,n.mode=21;break;case 27:if(n.wrap){for(;c<32;){if(0===s)break t;s--,u|=r[i++]<<c,c+=8}if(p-=l,t.total_out+=p,n.total+=p,p&&(t.adler=n.check=n.flags?Cb(n.check,o,p,a-p):xb(n.check,o,p,a-p)),p=l,(n.flags?u:dS(u))!==n.check){t.msg="incorrect data check",n.mode=30;break}u=0,c=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;c<32;){if(0===s)break t;s--,u+=r[i++]<<c,c+=8}if(u!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=30;break}u=0,c=0}n.mode=29;case 29:P=1;break t;case 30:P=-3;break t;case 31:return-4;case 32:default:return-2}return t.next_out=a,t.avail_out=l,t.next_in=i,t.avail_in=s,n.hold=u,n.bits=c,(n.wsize||p!==t.avail_out&&n.mode<30&&(n.mode<27||4!==e))&&PS(t,t.output,t.next_out,p-t.avail_out),h-=t.avail_in,p-=t.avail_out,t.total_in+=h,t.total_out+=p,n.total+=p,n.wrap&&p&&(t.adler=n.check=n.flags?Cb(n.check,o,p,t.next_out-p):xb(n.check,o,p,t.next_out-p)),t.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0===h&&0===p||4===e)&&0===P&&(P=-5),P},inflateEnd:function(t){if(!t||!t.state)return-2;var e=t.state;return e.window&&(e.window=null),t.state=null,0},inflateGetHeader:function(t,e){var n;return t&&t.state?0==(2&(n=t.state).wrap)?-2:(n.head=e,e.done=!1,0):-2},inflateSetDictionary:function(t,e){var n,r=e.length;return t&&t.state?0!==(n=t.state).wrap&&11!==n.mode?-2:11===n.mode&&xb(1,e,r,0)!==n.check?-3:PS(t,e,r,r)?(n.mode=31,-4):(n.havedict=1,0):-2},inflateInfo:"pako inflate (from Nodeca project)"},_S={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};var TS=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},CS=Object.prototype.toString;function IS(t){if(!(this instanceof IS))return new IS(t);this.options=Gw.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new nS,this.strm.avail_out=0;var n=xS.inflateInit2(this.strm,e.windowBits);if(n!==_S.Z_OK)throw new Error(Ib[n]);if(this.header=new TS,xS.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=$b(e.dictionary):"[object ArrayBuffer]"===CS.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=xS.inflateSetDictionary(this.strm,e.dictionary))!==_S.Z_OK))throw new Error(Ib[n])}function DS(t,e){var n=new IS(e);if(n.push(t,!0),n.err)throw n.msg||Ib[n.err];return n.result}IS.prototype.push=function(t,e){var n,r,o,i,a,s=this.strm,l=this.options.chunkSize,u=this.options.dictionary,c=!1;if(this.ended)return!1;r=e===~~e?e:!0===e?_S.Z_FINISH:_S.Z_NO_FLUSH,"string"==typeof t?s.input=Qb(t):"[object ArrayBuffer]"===CS.call(t)?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new Gw.Buf8(l),s.next_out=0,s.avail_out=l),(n=xS.inflate(s,_S.Z_NO_FLUSH))===_S.Z_NEED_DICT&&u&&(n=xS.inflateSetDictionary(this.strm,u)),n===_S.Z_BUF_ERROR&&!0===c&&(n=_S.Z_OK,c=!1),n!==_S.Z_STREAM_END&&n!==_S.Z_OK)return this.onEnd(n),this.ended=!0,!1;s.next_out&&(0!==s.avail_out&&n!==_S.Z_STREAM_END&&(0!==s.avail_in||r!==_S.Z_FINISH&&r!==_S.Z_SYNC_FLUSH)||("string"===this.options.to?(o=eS(s.output,s.next_out),i=s.next_out-o,a=tS(s.output,o),s.next_out=i,s.avail_out=l-i,i&&Gw.arraySet(s.output,s.output,o,i,0),this.onData(a)):this.onData(Gw.shrinkBuf(s.output,s.next_out)))),0===s.avail_in&&0===s.avail_out&&(c=!0)}while((s.avail_in>0||0===s.avail_out)&&n!==_S.Z_STREAM_END);return n===_S.Z_STREAM_END&&(r=_S.Z_FINISH),r===_S.Z_FINISH?(n=xS.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===_S.Z_OK):r!==_S.Z_SYNC_FLUSH||(this.onEnd(_S.Z_OK),s.avail_out=0,!0)},IS.prototype.onData=function(t){this.chunks.push(t)},IS.prototype.onEnd=function(t){t===_S.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Gw.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var kS={Inflate:IS,inflate:DS,inflateRaw:function(t,e){return(e=e||{}).raw=!0,DS(t,e)},ungzip:DS},MS={};(0,Gw.assign)(MS,aS,kS,_S);var RS=MS,AS=r((function(t,r){
/*!

	JSZip v3.5.0 - A JavaScript class for generating and reading zip files
	<http://stuartk.com/jszip>

	(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
	Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/master/LICENSE.markdown.

	JSZip uses the library pako released under the MIT license :
	https://github.com/nodeca/pako/blob/master/LICENSE
	*/
t.exports=function t(e,r,o){function i(s,l){if(!r[s]){if(!e[s]){if(!l&&n)return n();if(a)return a(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=r[s]={exports:{}};e[s][0].call(c.exports,(function(t){var n=e[s][1][t];return i(n||t)}),c,c.exports,t,e,r,o)}return r[s].exports}for(var a=n,s=0;s<o.length;s++)i(o[s]);return i}({1:[function(t,e,n){var r=t("./utils"),o=t("./support"),i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(t){for(var e,n,o,a,s,l,u,c=[],h=0,p=t.length,d=p,f="string"!==r.getTypeOf(t);h<t.length;)d=p-h,f?(e=t[h++],n=h<p?t[h++]:0,o=h<p?t[h++]:0):(e=t.charCodeAt(h++),n=h<p?t.charCodeAt(h++):0,o=h<p?t.charCodeAt(h++):0),a=e>>2,s=(3&e)<<4|n>>4,l=d>1?(15&n)<<2|o>>6:64,u=d>2?63&o:64,c.push(i.charAt(a)+i.charAt(s)+i.charAt(l)+i.charAt(u));return c.join("")},n.decode=function(t){var e,n,r,a,s,l,u=0,c=0;if("data:"===t.substr(0,"data:".length))throw new Error("Invalid base64 input, it looks like a data url.");var h,p=3*(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(t.charAt(t.length-1)===i.charAt(64)&&p--,t.charAt(t.length-2)===i.charAt(64)&&p--,p%1!=0)throw new Error("Invalid base64 input, bad content length.");for(h=o.uint8array?new Uint8Array(0|p):new Array(0|p);u<t.length;)e=i.indexOf(t.charAt(u++))<<2|(a=i.indexOf(t.charAt(u++)))>>4,n=(15&a)<<4|(s=i.indexOf(t.charAt(u++)))>>2,r=(3&s)<<6|(l=i.indexOf(t.charAt(u++))),h[c++]=e,64!==s&&(h[c++]=n),64!==l&&(h[c++]=r);return h}},{"./support":30,"./utils":32}],2:[function(t,e,n){var r=t("./external"),o=t("./stream/DataWorker"),i=t("./stream/DataLengthProbe"),a=t("./stream/Crc32Probe");function s(t,e,n,r,o){this.compressedSize=t,this.uncompressedSize=e,this.crc32=n,this.compression=r,this.compressedContent=o}i=t("./stream/DataLengthProbe"),s.prototype={getContentWorker:function(){var t=new o(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new i("data_length")),e=this;return t.on("end",(function(){if(this.streamInfo.data_length!==e.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")})),t},getCompressedWorker:function(){return new o(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},s.createWorkerFrom=function(t,e,n){return t.pipe(new a).pipe(new i("uncompressedSize")).pipe(e.compressWorker(n)).pipe(new i("compressedSize")).withStreamInfo("compression",e)},e.exports=s},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,e,n){var r=t("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(t){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},n.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,e,n){var r=t("./utils"),o=function(){for(var t,e=[],n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e}();e.exports=function(t,e){return void 0!==t&&t.length?"string"!==r.getTypeOf(t)?function(t,e,n,r){var i=o,a=r+n;t^=-1;for(var s=r;s<a;s++)t=t>>>8^i[255&(t^e[s])];return-1^t}(0|e,t,t.length,0):function(t,e,n,r){var i=o,a=r+n;t^=-1;for(var s=r;s<a;s++)t=t>>>8^i[255&(t^e.charCodeAt(s))];return-1^t}(0|e,t,t.length,0):0}},{"./utils":32}],5:[function(t,e,n){n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(t,e,n){var r=null;r="undefined"!=typeof Promise?Promise:t("lie"),e.exports={Promise:r}},{lie:37}],7:[function(t,e,n){var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,o=t("pako"),i=t("./utils"),a=t("./stream/GenericWorker"),s=r?"uint8array":"array";function l(t,e){a.call(this,"FlateWorker/"+t),this._pako=null,this._pakoAction=t,this._pakoOptions=e,this.meta={}}n.magic="\b\0",i.inherits(l,a),l.prototype.processChunk=function(t){this.meta=t.meta,null===this._pako&&this._createPako(),this._pako.push(i.transformTo(s,t.data),!1)},l.prototype.flush=function(){a.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var t=this;this._pako.onData=function(e){t.push({data:e,meta:t.meta})}},n.compressWorker=function(t){return new l("Deflate",t)},n.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,e,n){var r=t("../utils"),o=t("../stream/GenericWorker"),i=t("../utf8"),a=t("../crc32"),s=t("../signature"),l=function(t,e){var n,r="";for(n=0;n<e;n++)r+=String.fromCharCode(255&t),t>>>=8;return r},u=function(t,e,n,o,u,c){var h,p,d=t.file,f=t.compression,m=c!==i.utf8encode,g=r.transformTo("string",c(d.name)),v=r.transformTo("string",i.utf8encode(d.name)),y=d.comment,w=r.transformTo("string",c(y)),b=r.transformTo("string",i.utf8encode(y)),S=v.length!==d.name.length,E=b.length!==y.length,P="",x="",_="",T=d.dir,C=d.date,I={crc32:0,compressedSize:0,uncompressedSize:0};e&&!n||(I.crc32=t.crc32,I.compressedSize=t.compressedSize,I.uncompressedSize=t.uncompressedSize);var D=0;e&&(D|=8),m||!S&&!E||(D|=2048);var k,M,R,A=0,H=0;T&&(A|=16),"UNIX"===u?(H=798,A|=(k=d.unixPermissions,M=T,R=k,k||(R=M?16893:33204),(65535&R)<<16)):(H=20,A|=63&(d.dosPermissions||0)),h=C.getUTCHours(),h<<=6,h|=C.getUTCMinutes(),h<<=5,h|=C.getUTCSeconds()/2,p=C.getUTCFullYear()-1980,p<<=4,p|=C.getUTCMonth()+1,p<<=5,p|=C.getUTCDate(),S&&(x=l(1,1)+l(a(g),4)+v,P+="up"+l(x.length,2)+x),E&&(_=l(1,1)+l(a(w),4)+b,P+="uc"+l(_.length,2)+_);var O="";return O+="\n\0",O+=l(D,2),O+=f.magic,O+=l(h,2),O+=l(p,2),O+=l(I.crc32,4),O+=l(I.compressedSize,4),O+=l(I.uncompressedSize,4),O+=l(g.length,2),O+=l(P.length,2),{fileRecord:s.LOCAL_FILE_HEADER+O+g+P,dirRecord:s.CENTRAL_FILE_HEADER+l(H,2)+O+l(w.length,2)+"\0\0\0\0"+l(A,4)+l(o,4)+g+P+w}},c=function(t){return s.DATA_DESCRIPTOR+l(t.crc32,4)+l(t.compressedSize,4)+l(t.uncompressedSize,4)};function h(t,e,n,r){o.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=e,this.zipPlatform=n,this.encodeFileName=r,this.streamFiles=t,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}r.inherits(h,o),h.prototype.push=function(t){var e=t.meta.percent||0,n=this.entriesCount,r=this._sources.length;this.accumulate?this.contentBuffer.push(t):(this.bytesWritten+=t.data.length,o.prototype.push.call(this,{data:t.data,meta:{currentFile:this.currentFile,percent:n?(e+100*(n-r-1))/n:100}}))},h.prototype.openedSource=function(t){this.currentSourceOffset=this.bytesWritten,this.currentFile=t.file.name;var e=this.streamFiles&&!t.file.dir;if(e){var n=u(t,e,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:n.fileRecord,meta:{percent:0}})}else this.accumulate=!0},h.prototype.closedSource=function(t){this.accumulate=!1;var e=this.streamFiles&&!t.file.dir,n=u(t,e,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(n.dirRecord),e)this.push({data:c(t),meta:{percent:100}});else for(this.push({data:n.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},h.prototype.flush=function(){for(var t=this.bytesWritten,e=0;e<this.dirRecords.length;e++)this.push({data:this.dirRecords[e],meta:{percent:100}});var n=this.bytesWritten-t,o=function(t,e,n,o,i){var a=r.transformTo("string",i(o));return s.CENTRAL_DIRECTORY_END+"\0\0\0\0"+l(t,2)+l(t,2)+l(e,4)+l(n,4)+l(a.length,2)+a}(this.dirRecords.length,n,t,this.zipComment,this.encodeFileName);this.push({data:o,meta:{percent:100}})},h.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},h.prototype.registerPrevious=function(t){this._sources.push(t);var e=this;return t.on("data",(function(t){e.processChunk(t)})),t.on("end",(function(){e.closedSource(e.previous.streamInfo),e._sources.length?e.prepareNextSource():e.end()})),t.on("error",(function(t){e.error(t)})),this},h.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},h.prototype.error=function(t){var e=this._sources;if(!o.prototype.error.call(this,t))return!1;for(var n=0;n<e.length;n++)try{e[n].error(t)}catch(t){}return!0},h.prototype.lock=function(){o.prototype.lock.call(this);for(var t=this._sources,e=0;e<t.length;e++)t[e].lock()},e.exports=h},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,e,n){var r=t("../compressions"),o=t("./ZipFileWorker");n.generateWorker=function(t,e,n){var i=new o(e.streamFiles,n,e.platform,e.encodeFileName),a=0;try{t.forEach((function(t,n){a++;var o=function(t,e){var n=t||e,o=r[n];if(!o)throw new Error(n+" is not a valid compression method !");return o}(n.options.compression,e.compression),s=n.options.compressionOptions||e.compressionOptions||{},l=n.dir,u=n.date;n._compressWorker(o,s).withStreamInfo("file",{name:t,dir:l,date:u,comment:n.comment||"",unixPermissions:n.unixPermissions,dosPermissions:n.dosPermissions}).pipe(i)})),i.entriesCount=a}catch(t){i.error(t)}return i}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,e,n){function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var t=new r;for(var e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t}}r.prototype=t("./object"),r.prototype.loadAsync=t("./load"),r.support=t("./support"),r.defaults=t("./defaults"),r.version="3.5.0",r.loadAsync=function(t,e){return(new r).loadAsync(t,e)},r.external=t("./external"),e.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,e,n){var r=t("./utils"),o=t("./external"),i=t("./utf8"),a=(r=t("./utils"),t("./zipEntries")),s=t("./stream/Crc32Probe"),l=t("./nodejsUtils");function u(t){return new o.Promise((function(e,n){var r=t.decompressed.getContentWorker().pipe(new s);r.on("error",(function(t){n(t)})).on("end",(function(){r.streamInfo.crc32!==t.decompressed.crc32?n(new Error("Corrupted zip : CRC32 mismatch")):e()})).resume()}))}e.exports=function(t,e){var n=this;return e=r.extend(e||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:i.utf8decode}),l.isNode&&l.isStream(t)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",t,!0,e.optimizedBinaryString,e.base64).then((function(t){var n=new a(e);return n.load(t),n})).then((function(t){var n=[o.Promise.resolve(t)],r=t.files;if(e.checkCRC32)for(var i=0;i<r.length;i++)n.push(u(r[i]));return o.Promise.all(n)})).then((function(t){for(var r=t.shift(),o=r.files,i=0;i<o.length;i++){var a=o[i];n.file(a.fileNameStr,a.decompressed,{binary:!0,optimizedBinaryString:!0,date:a.date,dir:a.dir,comment:a.fileCommentStr.length?a.fileCommentStr:null,unixPermissions:a.unixPermissions,dosPermissions:a.dosPermissions,createFolders:e.createFolders})}return r.zipComment.length&&(n.comment=r.zipComment),n}))}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,e,n){var r=t("../utils"),o=t("../stream/GenericWorker");function i(t,e){o.call(this,"Nodejs stream input adapter for "+t),this._upstreamEnded=!1,this._bindStream(e)}r.inherits(i,o),i.prototype._bindStream=function(t){var e=this;this._stream=t,t.pause(),t.on("data",(function(t){e.push({data:t,meta:{percent:0}})})).on("error",(function(t){e.isPaused?this.generatedError=t:e.error(t)})).on("end",(function(){e.isPaused?e._upstreamEnded=!0:e.end()}))},i.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},i.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},e.exports=i},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,e,n){var r=t("readable-stream").Readable;function o(t,e,n){r.call(this,e),this._helper=t;var o=this;t.on("data",(function(t,e){o.push(t)||o._helper.pause(),n&&n(e)})).on("error",(function(t){o.emit("error",t)})).on("end",(function(){o.push(null)}))}t("../utils").inherits(o,r),o.prototype._read=function(){this._helper.resume()},e.exports=o},{"../utils":32,"readable-stream":16}],14:[function(t,e,n){e.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(t,e){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(t,e);if("number"==typeof t)throw new Error('The "data" argument must not be a number');return new Buffer(t,e)},allocBuffer:function(t){if(Buffer.alloc)return Buffer.alloc(t);var e=new Buffer(t);return e.fill(0),e},isBuffer:function(t){return Buffer.isBuffer(t)},isStream:function(t){return t&&"function"==typeof t.on&&"function"==typeof t.pause&&"function"==typeof t.resume}}},{}],15:[function(t,e,n){var r=t("./utf8"),o=t("./utils"),i=t("./stream/GenericWorker"),a=t("./stream/StreamHelper"),s=t("./defaults"),l=t("./compressedObject"),u=t("./zipObject"),c=t("./generate"),h=t("./nodejsUtils"),p=t("./nodejs/NodejsStreamInputAdapter"),d=function(t,e,n){var r,a=o.getTypeOf(e),c=o.extend(n||{},s);c.date=c.date||new Date,null!==c.compression&&(c.compression=c.compression.toUpperCase()),"string"==typeof c.unixPermissions&&(c.unixPermissions=parseInt(c.unixPermissions,8)),c.unixPermissions&&16384&c.unixPermissions&&(c.dir=!0),c.dosPermissions&&16&c.dosPermissions&&(c.dir=!0),c.dir&&(t=m(t)),c.createFolders&&(r=f(t))&&g.call(this,r,!0);var d="string"===a&&!1===c.binary&&!1===c.base64;n&&void 0!==n.binary||(c.binary=!d),(e instanceof l&&0===e.uncompressedSize||c.dir||!e||0===e.length)&&(c.base64=!1,c.binary=!0,e="",c.compression="STORE",a="string");var v=null;v=e instanceof l||e instanceof i?e:h.isNode&&h.isStream(e)?new p(t,e):o.prepareContent(t,e,c.binary,c.optimizedBinaryString,c.base64);var y=new u(t,v,c);this.files[t]=y},f=function(t){"/"===t.slice(-1)&&(t=t.substring(0,t.length-1));var e=t.lastIndexOf("/");return e>0?t.substring(0,e):""},m=function(t){return"/"!==t.slice(-1)&&(t+="/"),t},g=function(t,e){return e=void 0!==e?e:s.createFolders,t=m(t),this.files[t]||d.call(this,t,null,{dir:!0,createFolders:e}),this.files[t]};function v(t){return"[object RegExp]"===Object.prototype.toString.call(t)}var y={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(t){var e,n,r;for(e in this.files)this.files.hasOwnProperty(e)&&(r=this.files[e],(n=e.slice(this.root.length,e.length))&&e.slice(0,this.root.length)===this.root&&t(n,r))},filter:function(t){var e=[];return this.forEach((function(n,r){t(n,r)&&e.push(r)})),e},file:function(t,e,n){if(1===arguments.length){if(v(t)){var r=t;return this.filter((function(t,e){return!e.dir&&r.test(t)}))}var o=this.files[this.root+t];return o&&!o.dir?o:null}return t=this.root+t,d.call(this,t,e,n),this},folder:function(t){if(!t)return this;if(v(t))return this.filter((function(e,n){return n.dir&&t.test(e)}));var e=this.root+t,n=g.call(this,e),r=this.clone();return r.root=n.name,r},remove:function(t){t=this.root+t;var e=this.files[t];if(e||("/"!==t.slice(-1)&&(t+="/"),e=this.files[t]),e&&!e.dir)delete this.files[t];else for(var n=this.filter((function(e,n){return n.name.slice(0,t.length)===t})),r=0;r<n.length;r++)delete this.files[n[r].name];return this},generate:function(t){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(t){var e,n={};try{if((n=o.extend(t||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=n.type.toLowerCase(),n.compression=n.compression.toUpperCase(),"binarystring"===n.type&&(n.type="string"),!n.type)throw new Error("No output type specified.");o.checkSupport(n.type),"darwin"!==n.platform&&"freebsd"!==n.platform&&"linux"!==n.platform&&"sunos"!==n.platform||(n.platform="UNIX"),"win32"===n.platform&&(n.platform="DOS");var s=n.comment||this.comment||"";e=c.generateWorker(this,n,s)}catch(t){(e=new i("error")).error(t)}return new a(e,n.type||"string",n.mimeType)},generateAsync:function(t,e){return this.generateInternalStream(t).accumulate(e)},generateNodeStream:function(t,e){return(t=t||{}).type||(t.type="nodebuffer"),this.generateInternalStream(t).toNodejsStream(e)}};e.exports=y},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,e,n){e.exports=t("stream")},{stream:void 0}],17:[function(t,e,n){var r=t("./DataReader");function o(t){r.call(this,t);for(var e=0;e<this.data.length;e++)t[e]=255&t[e]}t("../utils").inherits(o,r),o.prototype.byteAt=function(t){return this.data[this.zero+t]},o.prototype.lastIndexOfSignature=function(t){for(var e=t.charCodeAt(0),n=t.charCodeAt(1),r=t.charCodeAt(2),o=t.charCodeAt(3),i=this.length-4;i>=0;--i)if(this.data[i]===e&&this.data[i+1]===n&&this.data[i+2]===r&&this.data[i+3]===o)return i-this.zero;return-1},o.prototype.readAndCheckSignature=function(t){var e=t.charCodeAt(0),n=t.charCodeAt(1),r=t.charCodeAt(2),o=t.charCodeAt(3),i=this.readData(4);return e===i[0]&&n===i[1]&&r===i[2]&&o===i[3]},o.prototype.readData=function(t){if(this.checkOffset(t),0===t)return[];var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=o},{"../utils":32,"./DataReader":18}],18:[function(t,e,n){var r=t("../utils");function o(t){this.data=t,this.length=t.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<this.zero+t||t<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+t+"). Corrupted zip ?")},setIndex:function(t){this.checkIndex(t),this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(t){},readInt:function(t){var e,n=0;for(this.checkOffset(t),e=this.index+t-1;e>=this.index;e--)n=(n<<8)+this.byteAt(e);return this.index+=t,n},readString:function(t){return r.transformTo("string",this.readData(t))},readData:function(t){},lastIndexOfSignature:function(t){},readAndCheckSignature:function(t){},readDate:function(){var t=this.readInt(4);return new Date(Date.UTC(1980+(t>>25&127),(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1))}},e.exports=o},{"../utils":32}],19:[function(t,e,n){var r=t("./Uint8ArrayReader");function o(t){r.call(this,t)}t("../utils").inherits(o,r),o.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,e,n){var r=t("./DataReader");function o(t){r.call(this,t)}t("../utils").inherits(o,r),o.prototype.byteAt=function(t){return this.data.charCodeAt(this.zero+t)},o.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)-this.zero},o.prototype.readAndCheckSignature=function(t){return t===this.readData(4)},o.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=o},{"../utils":32,"./DataReader":18}],21:[function(t,e,n){var r=t("./ArrayReader");function o(t){r.call(this,t)}t("../utils").inherits(o,r),o.prototype.readData=function(t){if(this.checkOffset(t),0===t)return new Uint8Array(0);var e=this.data.subarray(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(t,e,n){var r=t("../utils"),o=t("../support"),i=t("./ArrayReader"),a=t("./StringReader"),s=t("./NodeBufferReader"),l=t("./Uint8ArrayReader");e.exports=function(t){var e=r.getTypeOf(t);return r.checkSupport(e),"string"!==e||o.uint8array?"nodebuffer"===e?new s(t):o.uint8array?new l(r.transformTo("uint8array",t)):new i(r.transformTo("array",t)):new a(t)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,e,n){n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\b"},{}],24:[function(t,e,n){var r=t("./GenericWorker"),o=t("../utils");function i(t){r.call(this,"ConvertWorker to "+t),this.destType=t}o.inherits(i,r),i.prototype.processChunk=function(t){this.push({data:o.transformTo(this.destType,t.data),meta:t.meta})},e.exports=i},{"../utils":32,"./GenericWorker":28}],25:[function(t,e,n){var r=t("./GenericWorker"),o=t("../crc32");function i(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(i,r),i.prototype.processChunk=function(t){this.streamInfo.crc32=o(t.data,this.streamInfo.crc32||0),this.push(t)},e.exports=i},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,e,n){var r=t("../utils"),o=t("./GenericWorker");function i(t){o.call(this,"DataLengthProbe for "+t),this.propName=t,this.withStreamInfo(t,0)}r.inherits(i,o),i.prototype.processChunk=function(t){if(t){var e=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=e+t.data.length}o.prototype.processChunk.call(this,t)},e.exports=i},{"../utils":32,"./GenericWorker":28}],27:[function(t,e,n){var r=t("../utils"),o=t("./GenericWorker");function i(t){o.call(this,"DataWorker");var e=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,t.then((function(t){e.dataIsReady=!0,e.data=t,e.max=t&&t.length||0,e.type=r.getTypeOf(t),e.isPaused||e._tickAndRepeat()}),(function(t){e.error(t)}))}r.inherits(i,o),i.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},i.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},i.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},i.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var t=null,e=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":t=this.data.substring(this.index,e);break;case"uint8array":t=this.data.subarray(this.index,e);break;case"array":case"nodebuffer":t=this.data.slice(this.index,e)}return this.index=e,this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})},e.exports=i},{"../utils":32,"./GenericWorker":28}],28:[function(t,e,n){function r(t){this.name=t||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(t){this.emit("data",t)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(t){this.emit("error",t)}return!0},error:function(t){return!this.isFinished&&(this.isPaused?this.generatedError=t:(this.isFinished=!0,this.emit("error",t),this.previous&&this.previous.error(t),this.cleanUp()),!0)},on:function(t,e){return this._listeners[t].push(e),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(t,e){if(this._listeners[t])for(var n=0;n<this._listeners[t].length;n++)this._listeners[t][n].call(this,e)},pipe:function(t){return t.registerPrevious(this)},registerPrevious:function(t){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=t.streamInfo,this.mergeStreamInfo(),this.previous=t;var e=this;return t.on("data",(function(t){e.processChunk(t)})),t.on("end",(function(){e.end()})),t.on("error",(function(t){e.error(t)})),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var t=!1;return this.generatedError&&(this.error(this.generatedError),t=!0),this.previous&&this.previous.resume(),!t},flush:function(){},processChunk:function(t){this.push(t)},withStreamInfo:function(t,e){return this.extraStreamInfo[t]=e,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var t in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(t)&&(this.streamInfo[t]=this.extraStreamInfo[t])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var t="Worker "+this.name;return this.previous?this.previous+" -> "+t:t}},e.exports=r},{}],29:[function(t,e,n){var r=t("../utils"),o=t("./ConvertWorker"),i=t("./GenericWorker"),a=t("../base64"),s=t("../support"),l=t("../external"),u=null;if(s.nodestream)try{u=t("../nodejs/NodejsStreamOutputAdapter")}catch(t){}function c(t,e){return new l.Promise((function(n,o){var i=[],s=t._internalType,l=t._outputType,u=t._mimeType;t.on("data",(function(t,n){i.push(t),e&&e(n)})).on("error",(function(t){i=[],o(t)})).on("end",(function(){try{var t=function(t,e,n){switch(t){case"blob":return r.newBlob(r.transformTo("arraybuffer",e),n);case"base64":return a.encode(e);default:return r.transformTo(t,e)}}(l,function(t,e){var n,r=0,o=null,i=0;for(n=0;n<e.length;n++)i+=e[n].length;switch(t){case"string":return e.join("");case"array":return Array.prototype.concat.apply([],e);case"uint8array":for(o=new Uint8Array(i),n=0;n<e.length;n++)o.set(e[n],r),r+=e[n].length;return o;case"nodebuffer":return Buffer.concat(e);default:throw new Error("concat : unsupported type '"+t+"'")}}(s,i),u);n(t)}catch(t){o(t)}i=[]})).resume()}))}function h(t,e,n){var a=e;switch(e){case"blob":case"arraybuffer":a="uint8array";break;case"base64":a="string"}try{this._internalType=a,this._outputType=e,this._mimeType=n,r.checkSupport(a),this._worker=t.pipe(new o(a)),t.lock()}catch(t){this._worker=new i("error"),this._worker.error(t)}}h.prototype={accumulate:function(t){return c(this,t)},on:function(t,e){var n=this;return"data"===t?this._worker.on(t,(function(t){e.call(n,t.data,t.meta)})):this._worker.on(t,(function(){r.delay(e,arguments,n)})),this},resume:function(){return r.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(t){if(r.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new u(this,{objectMode:"nodebuffer"!==this._outputType},t)}},e.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,e,n){if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,n.nodebuffer="undefined"!=typeof Buffer,n.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)n.blob=!1;else{var r=new ArrayBuffer(0);try{n.blob=0===new Blob([r],{type:"application/zip"}).size}catch(t){try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(r),n.blob=0===o.getBlob("application/zip").size}catch(t){n.blob=!1}}}try{n.nodestream=!!t("readable-stream").Readable}catch(t){n.nodestream=!1}},{"readable-stream":16}],31:[function(t,e,n){for(var r=t("./utils"),o=t("./support"),i=t("./nodejsUtils"),a=t("./stream/GenericWorker"),s=new Array(256),l=0;l<256;l++)s[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;function u(){a.call(this,"utf-8 decode"),this.leftOver=null}function c(){a.call(this,"utf-8 encode")}s[254]=s[254]=1,n.utf8encode=function(t){return o.nodebuffer?i.newBufferFrom(t,"utf-8"):function(t){var e,n,r,i,a,s=t.length,l=0;for(i=0;i<s;i++)55296==(64512&(n=t.charCodeAt(i)))&&i+1<s&&56320==(64512&(r=t.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(r-56320),i++),l+=n<128?1:n<2048?2:n<65536?3:4;for(e=o.uint8array?new Uint8Array(l):new Array(l),a=0,i=0;a<l;i++)55296==(64512&(n=t.charCodeAt(i)))&&i+1<s&&56320==(64512&(r=t.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(r-56320),i++),n<128?e[a++]=n:n<2048?(e[a++]=192|n>>>6,e[a++]=128|63&n):n<65536?(e[a++]=224|n>>>12,e[a++]=128|n>>>6&63,e[a++]=128|63&n):(e[a++]=240|n>>>18,e[a++]=128|n>>>12&63,e[a++]=128|n>>>6&63,e[a++]=128|63&n);return e}(t)},n.utf8decode=function(t){return o.nodebuffer?r.transformTo("nodebuffer",t).toString("utf-8"):function(t){var e,n,o,i,a=t.length,l=new Array(2*a);for(n=0,e=0;e<a;)if((o=t[e++])<128)l[n++]=o;else if((i=s[o])>4)l[n++]=65533,e+=i-1;else{for(o&=2===i?31:3===i?15:7;i>1&&e<a;)o=o<<6|63&t[e++],i--;i>1?l[n++]=65533:o<65536?l[n++]=o:(o-=65536,l[n++]=55296|o>>10&1023,l[n++]=56320|1023&o)}return l.length!==n&&(l.subarray?l=l.subarray(0,n):l.length=n),r.applyFromCharCode(l)}(t=r.transformTo(o.uint8array?"uint8array":"array",t))},r.inherits(u,a),u.prototype.processChunk=function(t){var e=r.transformTo(o.uint8array?"uint8array":"array",t.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var i=e;(e=new Uint8Array(i.length+this.leftOver.length)).set(this.leftOver,0),e.set(i,this.leftOver.length)}else e=this.leftOver.concat(e);this.leftOver=null}var a=function(t,e){var n;for((e=e||t.length)>t.length&&(e=t.length),n=e-1;n>=0&&128==(192&t[n]);)n--;return n<0||0===n?e:n+s[t[n]]>e?n:e}(e),l=e;a!==e.length&&(o.uint8array?(l=e.subarray(0,a),this.leftOver=e.subarray(a,e.length)):(l=e.slice(0,a),this.leftOver=e.slice(a,e.length))),this.push({data:n.utf8decode(l),meta:t.meta})},u.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=u,r.inherits(c,a),c.prototype.processChunk=function(t){this.push({data:n.utf8encode(t.data),meta:t.meta})},n.Utf8EncodeWorker=c},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,e,n){var r=t("./support"),o=t("./base64"),i=t("./nodejsUtils"),a=t("set-immediate-shim"),s=t("./external");function l(t){return t}function u(t,e){for(var n=0;n<t.length;++n)e[n]=255&t.charCodeAt(n);return e}n.newBlob=function(t,e){n.checkSupport("blob");try{return new Blob([t],{type:e})}catch(n){try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return r.append(t),r.getBlob(e)}catch(t){throw new Error("Bug : can't construct the Blob.")}}};var c={stringifyByChunk:function(t,e,n){var r=[],o=0,i=t.length;if(i<=n)return String.fromCharCode.apply(null,t);for(;o<i;)"array"===e||"nodebuffer"===e?r.push(String.fromCharCode.apply(null,t.slice(o,Math.min(o+n,i)))):r.push(String.fromCharCode.apply(null,t.subarray(o,Math.min(o+n,i)))),o+=n;return r.join("")},stringifyByChar:function(t){for(var e="",n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e},applyCanBeUsed:{uint8array:function(){try{return r.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(t){return!1}}(),nodebuffer:function(){try{return r.nodebuffer&&1===String.fromCharCode.apply(null,i.allocBuffer(1)).length}catch(t){return!1}}()}};function h(t){var e=65536,r=n.getTypeOf(t),o=!0;if("uint8array"===r?o=c.applyCanBeUsed.uint8array:"nodebuffer"===r&&(o=c.applyCanBeUsed.nodebuffer),o)for(;e>1;)try{return c.stringifyByChunk(t,r,e)}catch(t){e=Math.floor(e/2)}return c.stringifyByChar(t)}function p(t,e){for(var n=0;n<t.length;n++)e[n]=t[n];return e}n.applyFromCharCode=h;var d={};d.string={string:l,array:function(t){return u(t,new Array(t.length))},arraybuffer:function(t){return d.string.uint8array(t).buffer},uint8array:function(t){return u(t,new Uint8Array(t.length))},nodebuffer:function(t){return u(t,i.allocBuffer(t.length))}},d.array={string:h,array:l,arraybuffer:function(t){return new Uint8Array(t).buffer},uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return i.newBufferFrom(t)}},d.arraybuffer={string:function(t){return h(new Uint8Array(t))},array:function(t){return p(new Uint8Array(t),new Array(t.byteLength))},arraybuffer:l,uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return i.newBufferFrom(new Uint8Array(t))}},d.uint8array={string:h,array:function(t){return p(t,new Array(t.length))},arraybuffer:function(t){return t.buffer},uint8array:l,nodebuffer:function(t){return i.newBufferFrom(t)}},d.nodebuffer={string:h,array:function(t){return p(t,new Array(t.length))},arraybuffer:function(t){return d.nodebuffer.uint8array(t).buffer},uint8array:function(t){return p(t,new Uint8Array(t.length))},nodebuffer:l},n.transformTo=function(t,e){if(e||(e=""),!t)return e;n.checkSupport(t);var r=n.getTypeOf(e);return d[r][t](e)},n.getTypeOf=function(t){return"string"==typeof t?"string":"[object Array]"===Object.prototype.toString.call(t)?"array":r.nodebuffer&&i.isBuffer(t)?"nodebuffer":r.uint8array&&t instanceof Uint8Array?"uint8array":r.arraybuffer&&t instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(t){if(!r[t.toLowerCase()])throw new Error(t+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(t){var e,n,r="";for(n=0;n<(t||"").length;n++)r+="\\x"+((e=t.charCodeAt(n))<16?"0":"")+e.toString(16).toUpperCase();return r},n.delay=function(t,e,n){a((function(){t.apply(n||null,e||[])}))},n.inherits=function(t,e){var n=function(){};n.prototype=e.prototype,t.prototype=new n},n.extend=function(){var t,e,n={};for(t=0;t<arguments.length;t++)for(e in arguments[t])arguments[t].hasOwnProperty(e)&&void 0===n[e]&&(n[e]=arguments[t][e]);return n},n.prepareContent=function(t,e,i,a,l){return s.Promise.resolve(e).then((function(t){return r.blob&&(t instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(t)))&&"undefined"!=typeof FileReader?new s.Promise((function(e,n){var r=new FileReader;r.onload=function(t){e(t.target.result)},r.onerror=function(t){n(t.target.error)},r.readAsArrayBuffer(t)})):t})).then((function(e){var c,h=n.getTypeOf(e);return h?("arraybuffer"===h?e=n.transformTo("uint8array",e):"string"===h&&(l?e=o.decode(e):i&&!0!==a&&(e=u(c=e,r.uint8array?new Uint8Array(c.length):new Array(c.length)))),e):s.Promise.reject(new Error("Can't read the data of '"+t+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))}))}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"set-immediate-shim":54}],33:[function(t,e,n){var r=t("./reader/readerFor"),o=t("./utils"),i=t("./signature"),a=t("./zipEntry"),s=(t("./utf8"),t("./support"));function l(t){this.files=[],this.loadOptions=t}l.prototype={checkSignature:function(t){if(!this.reader.readAndCheckSignature(t)){this.reader.index-=4;var e=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(e)+", expected "+o.pretty(t)+")")}},isSignature:function(t,e){var n=this.reader.index;this.reader.setIndex(t);var r=this.reader.readString(4)===e;return this.reader.setIndex(n),r},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var t=this.reader.readData(this.zipCommentLength),e=s.uint8array?"uint8array":"array",n=o.transformTo(e,t);this.zipComment=this.loadOptions.decodeFileName(n)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var t,e,n,r=this.zip64EndOfCentralSize-44;0<r;)t=this.reader.readInt(2),e=this.reader.readInt(4),n=this.reader.readData(e),this.zip64ExtensibleData[t]={id:t,length:e,value:n}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var t,e;for(t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(i.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8(),e.processAttributes()},readCentralDir:function(){var t;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(i.CENTRAL_FILE_HEADER);)(t=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(t);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var t=this.reader.lastIndexOfSignature(i.CENTRAL_DIRECTORY_END);if(t<0)throw this.isSignature(0,i.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(t);var e=t;if(this.checkSignature(i.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(t=this.reader.lastIndexOfSignature(i.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(t),this.checkSignature(i.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,i.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(i.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(i.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var n=this.centralDirOffset+this.centralDirSize;this.zip64&&(n+=20,n+=12+this.zip64EndOfCentralSize);var r=e-n;if(r>0)this.isSignature(e,i.CENTRAL_FILE_HEADER)||(this.reader.zero=r);else if(r<0)throw new Error("Corrupted zip: missing "+Math.abs(r)+" bytes.")},prepareReader:function(t){this.reader=r(t)},load:function(t){this.prepareReader(t),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},e.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(t,e,n){var r=t("./reader/readerFor"),o=t("./utils"),i=t("./compressedObject"),a=t("./crc32"),s=t("./utf8"),l=t("./compressions"),u=t("./support");function c(t,e){this.options=t,this.loadOptions=e}c.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(t){var e,n;if(t.skip(22),this.fileNameLength=t.readInt(2),n=t.readInt(2),this.fileName=t.readData(this.fileNameLength),t.skip(n),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(e=function(t){for(var e in l)if(l.hasOwnProperty(e)&&l[e].magic===t)return l[e];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new i(this.compressedSize,this.uncompressedSize,this.crc32,e,t.readData(this.compressedSize))},readCentralPart:function(t){this.versionMadeBy=t.readInt(2),t.skip(2),this.bitFlag=t.readInt(2),this.compressionMethod=t.readString(2),this.date=t.readDate(),this.crc32=t.readInt(4),this.compressedSize=t.readInt(4),this.uncompressedSize=t.readInt(4);var e=t.readInt(2);if(this.extraFieldsLength=t.readInt(2),this.fileCommentLength=t.readInt(2),this.diskNumberStart=t.readInt(2),this.internalFileAttributes=t.readInt(2),this.externalFileAttributes=t.readInt(4),this.localHeaderOffset=t.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");t.skip(e),this.readExtraFields(t),this.parseZIP64ExtraField(t),this.fileComment=t.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var t=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0===t&&(this.dosPermissions=63&this.externalFileAttributes),3===t&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(t){if(this.extraFields[1]){var e=r(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(t){var e,n,r,o=t.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});t.index+4<o;)e=t.readInt(2),n=t.readInt(2),r=t.readData(n),this.extraFields[e]={id:e,length:n,value:r};t.setIndex(o)},handleUTF8:function(){var t=u.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=s.utf8decode(this.fileName),this.fileCommentStr=s.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();if(null!==e)this.fileNameStr=e;else{var n=o.transformTo(t,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(n)}var r=this.findExtraFieldUnicodeComment();if(null!==r)this.fileCommentStr=r;else{var i=o.transformTo(t,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(i)}}},findExtraFieldUnicodePath:function(){var t=this.extraFields[28789];if(t){var e=r(t.value);return 1!==e.readInt(1)||a(this.fileName)!==e.readInt(4)?null:s.utf8decode(e.readData(t.length-5))}return null},findExtraFieldUnicodeComment:function(){var t=this.extraFields[25461];if(t){var e=r(t.value);return 1!==e.readInt(1)||a(this.fileComment)!==e.readInt(4)?null:s.utf8decode(e.readData(t.length-5))}return null}},e.exports=c},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,e,n){var r=t("./stream/StreamHelper"),o=t("./stream/DataWorker"),i=t("./utf8"),a=t("./compressedObject"),s=t("./stream/GenericWorker"),l=function(t,e,n){this.name=t,this.dir=n.dir,this.date=n.date,this.comment=n.comment,this.unixPermissions=n.unixPermissions,this.dosPermissions=n.dosPermissions,this._data=e,this._dataBinary=n.binary,this.options={compression:n.compression,compressionOptions:n.compressionOptions}};l.prototype={internalStream:function(t){var e=null,n="string";try{if(!t)throw new Error("No output type specified.");var o="string"===(n=t.toLowerCase())||"text"===n;"binarystring"!==n&&"text"!==n||(n="string"),e=this._decompressWorker();var a=!this._dataBinary;a&&!o&&(e=e.pipe(new i.Utf8EncodeWorker)),!a&&o&&(e=e.pipe(new i.Utf8DecodeWorker))}catch(t){(e=new s("error")).error(t)}return new r(e,n,"")},async:function(t,e){return this.internalStream(t).accumulate(e)},nodeStream:function(t,e){return this.internalStream(t||"nodebuffer").toNodejsStream(e)},_compressWorker:function(t,e){if(this._data instanceof a&&this._data.compression.magic===t.magic)return this._data.getCompressedWorker();var n=this._decompressWorker();return this._dataBinary||(n=n.pipe(new i.Utf8EncodeWorker)),a.createWorkerFrom(n,t,e)},_decompressWorker:function(){return this._data instanceof a?this._data.getContentWorker():this._data instanceof s?this._data:new o(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],c=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<u.length;h++)l.prototype[u[h]]=c;e.exports=l},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,n,r){(function(t){var e,r,o=t.MutationObserver||t.WebKitMutationObserver;if(o){var i=0,a=new o(c),s=t.document.createTextNode("");a.observe(s,{characterData:!0}),e=function(){s.data=i=++i%2}}else if(t.setImmediate||void 0===t.MessageChannel)e="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){c(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(c,0)};else{var l=new t.MessageChannel;l.port1.onmessage=c,e=function(){l.port2.postMessage(0)}}var u=[];function c(){var t,e;r=!0;for(var n=u.length;n;){for(e=u,u=[],t=-1;++t<n;)e[t]();n=u.length}r=!1}n.exports=function(t){1!==u.push(t)||r||e()}}).call(this,void 0!==e?e:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(t,e,n){var r=t("immediate");function o(){}var i={},a=["REJECTED"],s=["FULFILLED"],l=["PENDING"];function u(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,t!==o&&d(this,t)}function c(t,e,n){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function h(t,e,n){r((function(){var r;try{r=e(n)}catch(e){return i.reject(t,e)}r===t?i.reject(t,new TypeError("Cannot resolve promise with itself")):i.resolve(t,r)}))}function p(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function d(t,e){var n=!1;function r(e){n||(n=!0,i.reject(t,e))}function o(e){n||(n=!0,i.resolve(t,e))}var a=f((function(){e(o,r)}));"error"===a.status&&r(a.value)}function f(t,e){var n={};try{n.value=t(e),n.status="success"}catch(t){n.status="error",n.value=t}return n}e.exports=u,u.prototype.finally=function(t){if("function"!=typeof t)return this;var e=this.constructor;return this.then((function(n){return e.resolve(t()).then((function(){return n}))}),(function(n){return e.resolve(t()).then((function(){throw n}))}))},u.prototype.catch=function(t){return this.then(null,t)},u.prototype.then=function(t,e){if("function"!=typeof t&&this.state===s||"function"!=typeof e&&this.state===a)return this;var n=new this.constructor(o);return this.state!==l?h(n,this.state===s?t:e,this.outcome):this.queue.push(new c(n,t,e)),n},c.prototype.callFulfilled=function(t){i.resolve(this.promise,t)},c.prototype.otherCallFulfilled=function(t){h(this.promise,this.onFulfilled,t)},c.prototype.callRejected=function(t){i.reject(this.promise,t)},c.prototype.otherCallRejected=function(t){h(this.promise,this.onRejected,t)},i.resolve=function(t,e){var n=f(p,e);if("error"===n.status)return i.reject(t,n.value);var r=n.value;if(r)d(t,r);else{t.state=s,t.outcome=e;for(var o=-1,a=t.queue.length;++o<a;)t.queue[o].callFulfilled(e)}return t},i.reject=function(t,e){t.state=a,t.outcome=e;for(var n=-1,r=t.queue.length;++n<r;)t.queue[n].callRejected(e);return t},u.resolve=function(t){return t instanceof this?t:i.resolve(new this(o),t)},u.reject=function(t){var e=new this(o);return i.reject(e,t)},u.all=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var n=t.length,r=!1;if(!n)return this.resolve([]);for(var a=new Array(n),s=0,l=-1,u=new this(o);++l<n;)c(t[l],l);return u;function c(t,o){e.resolve(t).then((function(t){a[o]=t,++s!==n||r||(r=!0,i.resolve(u,a))}),(function(t){r||(r=!0,i.reject(u,t))}))}},u.race=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var n=t.length,r=!1;if(!n)return this.resolve([]);for(var a,s=-1,l=new this(o);++s<n;)a=t[s],e.resolve(a).then((function(t){r||(r=!0,i.resolve(l,t))}),(function(t){r||(r=!0,i.reject(l,t))}));return l}},{immediate:36}],38:[function(t,e,n){var r={};(0,t("./lib/utils/common").assign)(r,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),e.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,e,n){var r=t("./zlib/deflate"),o=t("./utils/common"),i=t("./utils/strings"),a=t("./zlib/messages"),s=t("./zlib/zstream"),l=Object.prototype.toString;function u(t){if(!(this instanceof u))return new u(t);this.options=o.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var n=r.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(0!==n)throw new Error(a[n]);if(e.header&&r.deflateSetHeader(this.strm,e.header),e.dictionary){var c;if(c="string"==typeof e.dictionary?i.string2buf(e.dictionary):"[object ArrayBuffer]"===l.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,0!==(n=r.deflateSetDictionary(this.strm,c)))throw new Error(a[n]);this._dict_set=!0}}function c(t,e){var n=new u(e);if(n.push(t,!0),n.err)throw n.msg||a[n.err];return n.result}u.prototype.push=function(t,e){var n,a,s=this.strm,u=this.options.chunkSize;if(this.ended)return!1;a=e===~~e?e:!0===e?4:0,"string"==typeof t?s.input=i.string2buf(t):"[object ArrayBuffer]"===l.call(t)?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new o.Buf8(u),s.next_out=0,s.avail_out=u),1!==(n=r.deflate(s,a))&&0!==n)return this.onEnd(n),this.ended=!0,!1;0!==s.avail_out&&(0!==s.avail_in||4!==a&&2!==a)||("string"===this.options.to?this.onData(i.buf2binstring(o.shrinkBuf(s.output,s.next_out))):this.onData(o.shrinkBuf(s.output,s.next_out)))}while((s.avail_in>0||0===s.avail_out)&&1!==n);return 4===a?(n=r.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,0===n):2!==a||(this.onEnd(0),s.avail_out=0,!0)},u.prototype.onData=function(t){this.chunks.push(t)},u.prototype.onEnd=function(t){0===t&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},n.Deflate=u,n.deflate=c,n.deflateRaw=function(t,e){return(e=e||{}).raw=!0,c(t,e)},n.gzip=function(t,e){return(e=e||{}).gzip=!0,c(t,e)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,e,n){var r=t("./zlib/inflate"),o=t("./utils/common"),i=t("./utils/strings"),a=t("./zlib/constants"),s=t("./zlib/messages"),l=t("./zlib/zstream"),u=t("./zlib/gzheader"),c=Object.prototype.toString;function h(t){if(!(this instanceof h))return new h(t);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var n=r.inflateInit2(this.strm,e.windowBits);if(n!==a.Z_OK)throw new Error(s[n]);this.header=new u,r.inflateGetHeader(this.strm,this.header)}function p(t,e){var n=new h(e);if(n.push(t,!0),n.err)throw n.msg||s[n.err];return n.result}h.prototype.push=function(t,e){var n,s,l,u,h,p,d=this.strm,f=this.options.chunkSize,m=this.options.dictionary,g=!1;if(this.ended)return!1;s=e===~~e?e:!0===e?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof t?d.input=i.binstring2buf(t):"[object ArrayBuffer]"===c.call(t)?d.input=new Uint8Array(t):d.input=t,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new o.Buf8(f),d.next_out=0,d.avail_out=f),(n=r.inflate(d,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&m&&(p="string"==typeof m?i.string2buf(m):"[object ArrayBuffer]"===c.call(m)?new Uint8Array(m):m,n=r.inflateSetDictionary(this.strm,p)),n===a.Z_BUF_ERROR&&!0===g&&(n=a.Z_OK,g=!1),n!==a.Z_STREAM_END&&n!==a.Z_OK)return this.onEnd(n),this.ended=!0,!1;d.next_out&&(0!==d.avail_out&&n!==a.Z_STREAM_END&&(0!==d.avail_in||s!==a.Z_FINISH&&s!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(l=i.utf8border(d.output,d.next_out),u=d.next_out-l,h=i.buf2string(d.output,l),d.next_out=u,d.avail_out=f-u,u&&o.arraySet(d.output,d.output,l,u,0),this.onData(h)):this.onData(o.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(g=!0)}while((d.avail_in>0||0===d.avail_out)&&n!==a.Z_STREAM_END);return n===a.Z_STREAM_END&&(s=a.Z_FINISH),s===a.Z_FINISH?(n=r.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===a.Z_OK):s!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),d.avail_out=0,!0)},h.prototype.onData=function(t){this.chunks.push(t)},h.prototype.onEnd=function(t){t===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},n.Inflate=h,n.inflate=p,n.inflateRaw=function(t,e){return(e=e||{}).raw=!0,p(t,e)},n.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,e,n){var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;n.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var n=e.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])}}return t},n.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var o={arraySet:function(t,e,n,r,o){if(e.subarray&&t.subarray)t.set(e.subarray(n,n+r),o);else for(var i=0;i<r;i++)t[o+i]=e[n+i]},flattenChunks:function(t){var e,n,r,o,i,a;for(r=0,e=0,n=t.length;e<n;e++)r+=t[e].length;for(a=new Uint8Array(r),o=0,e=0,n=t.length;e<n;e++)i=t[e],a.set(i,o),o+=i.length;return a}},i={arraySet:function(t,e,n,r,o){for(var i=0;i<r;i++)t[o+i]=e[n+i]},flattenChunks:function(t){return[].concat.apply([],t)}};n.setTyped=function(t){t?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,o)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,i))},n.setTyped(r)},{}],42:[function(t,e,n){var r=t("./common"),o=!0,i=!0;try{String.fromCharCode.apply(null,[0])}catch(t){o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){i=!1}for(var a=new r.Buf8(256),s=0;s<256;s++)a[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;function l(t,e){if(e<65537&&(t.subarray&&i||!t.subarray&&o))return String.fromCharCode.apply(null,r.shrinkBuf(t,e));for(var n="",a=0;a<e;a++)n+=String.fromCharCode(t[a]);return n}a[254]=a[254]=1,n.string2buf=function(t){var e,n,o,i,a,s=t.length,l=0;for(i=0;i<s;i++)55296==(64512&(n=t.charCodeAt(i)))&&i+1<s&&56320==(64512&(o=t.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(o-56320),i++),l+=n<128?1:n<2048?2:n<65536?3:4;for(e=new r.Buf8(l),a=0,i=0;a<l;i++)55296==(64512&(n=t.charCodeAt(i)))&&i+1<s&&56320==(64512&(o=t.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(o-56320),i++),n<128?e[a++]=n:n<2048?(e[a++]=192|n>>>6,e[a++]=128|63&n):n<65536?(e[a++]=224|n>>>12,e[a++]=128|n>>>6&63,e[a++]=128|63&n):(e[a++]=240|n>>>18,e[a++]=128|n>>>12&63,e[a++]=128|n>>>6&63,e[a++]=128|63&n);return e},n.buf2binstring=function(t){return l(t,t.length)},n.binstring2buf=function(t){for(var e=new r.Buf8(t.length),n=0,o=e.length;n<o;n++)e[n]=t.charCodeAt(n);return e},n.buf2string=function(t,e){var n,r,o,i,s=e||t.length,u=new Array(2*s);for(r=0,n=0;n<s;)if((o=t[n++])<128)u[r++]=o;else if((i=a[o])>4)u[r++]=65533,n+=i-1;else{for(o&=2===i?31:3===i?15:7;i>1&&n<s;)o=o<<6|63&t[n++],i--;i>1?u[r++]=65533:o<65536?u[r++]=o:(o-=65536,u[r++]=55296|o>>10&1023,u[r++]=56320|1023&o)}return l(u,r)},n.utf8border=function(t,e){var n;for((e=e||t.length)>t.length&&(e=t.length),n=e-1;n>=0&&128==(192&t[n]);)n--;return n<0||0===n?e:n+a[t[n]]>e?n:e}},{"./common":41}],43:[function(t,e,n){e.exports=function(t,e,n,r){for(var o=65535&t|0,i=t>>>16&65535|0,a=0;0!==n;){n-=a=n>2e3?2e3:n;do{i=i+(o=o+e[r++]|0)|0}while(--a);o%=65521,i%=65521}return o|i<<16|0}},{}],44:[function(t,e,n){e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,e,n){var r=function(){for(var t,e=[],n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e}();e.exports=function(t,e,n,o){var i=r,a=o+n;t^=-1;for(var s=o;s<a;s++)t=t>>>8^i[255&(t^e[s])];return-1^t}},{}],46:[function(t,e,n){var r,o=t("../utils/common"),i=t("./trees"),a=t("./adler32"),s=t("./crc32"),l=t("./messages");function u(t,e){return t.msg=l[e],e}function c(t){return(t<<1)-(t>4?9:0)}function h(t){for(var e=t.length;--e>=0;)t[e]=0}function p(t){var e=t.state,n=e.pending;n>t.avail_out&&(n=t.avail_out),0!==n&&(o.arraySet(t.output,e.pending_buf,e.pending_out,n,t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,0===e.pending&&(e.pending_out=0))}function d(t,e){i._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,p(t.strm)}function f(t,e){t.pending_buf[t.pending++]=e}function m(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function g(t,e){var n,r,o=t.max_chain_length,i=t.strstart,a=t.prev_length,s=t.nice_match,l=t.strstart>t.w_size-262?t.strstart-(t.w_size-262):0,u=t.window,c=t.w_mask,h=t.prev,p=t.strstart+258,d=u[i+a-1],f=u[i+a];t.prev_length>=t.good_match&&(o>>=2),s>t.lookahead&&(s=t.lookahead);do{if(u[(n=e)+a]===f&&u[n+a-1]===d&&u[n]===u[i]&&u[++n]===u[i+1]){i+=2,n++;do{}while(u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&u[++i]===u[++n]&&i<p);if(r=258-(p-i),i=p-258,r>a){if(t.match_start=e,a=r,r>=s)break;d=u[i+a-1],f=u[i+a]}}}while((e=h[e&c])>l&&0!=--o);return a<=t.lookahead?a:t.lookahead}function v(t){var e,n,r,i,l,u,c,h,p,d,f=t.w_size;do{if(i=t.window_size-t.lookahead-t.strstart,t.strstart>=f+(f-262)){o.arraySet(t.window,t.window,f,f,0),t.match_start-=f,t.strstart-=f,t.block_start-=f,e=n=t.hash_size;do{r=t.head[--e],t.head[e]=r>=f?r-f:0}while(--n);e=n=f;do{r=t.prev[--e],t.prev[e]=r>=f?r-f:0}while(--n);i+=f}if(0===t.strm.avail_in)break;if(u=t.strm,c=t.window,h=t.strstart+t.lookahead,p=i,d=void 0,(d=u.avail_in)>p&&(d=p),n=0===d?0:(u.avail_in-=d,o.arraySet(c,u.input,u.next_in,d,h),1===u.state.wrap?u.adler=a(u.adler,c,d,h):2===u.state.wrap&&(u.adler=s(u.adler,c,d,h)),u.next_in+=d,u.total_in+=d,d),t.lookahead+=n,t.lookahead+t.insert>=3)for(l=t.strstart-t.insert,t.ins_h=t.window[l],t.ins_h=(t.ins_h<<t.hash_shift^t.window[l+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[l+3-1])&t.hash_mask,t.prev[l&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=l,l++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<262&&0!==t.strm.avail_in)}function y(t,e){for(var n,r;;){if(t.lookahead<262){if(v(t),t.lookahead<262&&0===e)return 1;if(0===t.lookahead)break}if(n=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==n&&t.strstart-n<=t.w_size-262&&(t.match_length=g(t,n)),t.match_length>=3)if(r=i._tr_tally(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else r=i._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(d(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,4===e?(d(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(d(t,!1),0===t.strm.avail_out)?1:2}function w(t,e){for(var n,r,o;;){if(t.lookahead<262){if(v(t),t.lookahead<262&&0===e)return 1;if(0===t.lookahead)break}if(n=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==n&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-262&&(t.match_length=g(t,n),t.match_length<=5&&(1===t.strategy||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){o=t.strstart+t.lookahead-3,r=i._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=o&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,r&&(d(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if((r=i._tr_tally(t,0,t.window[t.strstart-1]))&&d(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=i._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,4===e?(d(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(d(t,!1),0===t.strm.avail_out)?1:2}function b(t,e,n,r,o){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=r,this.func=o}function S(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(1146),this.dyn_dtree=new o.Buf16(122),this.bl_tree=new o.Buf16(78),h(this.dyn_ltree),h(this.dyn_dtree),h(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(16),this.heap=new o.Buf16(573),h(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(573),h(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function E(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=2,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?42:113,t.adler=2===e.wrap?0:1,e.last_flush=0,i._tr_init(e),0):u(t,-2)}function P(t){var e,n=E(t);return 0===n&&((e=t.state).window_size=2*e.w_size,h(e.head),e.max_lazy_match=r[e.level].max_lazy,e.good_match=r[e.level].good_length,e.nice_match=r[e.level].nice_length,e.max_chain_length=r[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0),n}function x(t,e,n,r,i,a){if(!t)return-2;var s=1;if(-1===e&&(e=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),i<1||i>9||8!==n||r<8||r>15||e<0||e>9||a<0||a>4)return u(t,-2);8===r&&(r=9);var l=new S;return t.state=l,l.strm=t,l.wrap=s,l.gzhead=null,l.w_bits=r,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=i+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new o.Buf8(2*l.w_size),l.head=new o.Buf16(l.hash_size),l.prev=new o.Buf16(l.w_size),l.lit_bufsize=1<<i+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new o.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=e,l.strategy=a,l.method=n,P(t)}r=[new b(0,0,0,0,(function(t,e){var n=65535;for(n>t.pending_buf_size-5&&(n=t.pending_buf_size-5);;){if(t.lookahead<=1){if(v(t),0===t.lookahead&&0===e)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var r=t.block_start+n;if((0===t.strstart||t.strstart>=r)&&(t.lookahead=t.strstart-r,t.strstart=r,d(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-262&&(d(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(d(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&(d(t,!1),t.strm.avail_out),1)})),new b(4,4,8,4,y),new b(4,5,16,8,y),new b(4,6,32,32,y),new b(4,4,16,16,w),new b(8,16,32,32,w),new b(8,16,128,128,w),new b(8,32,128,256,w),new b(32,128,258,1024,w),new b(32,258,258,4096,w)],n.deflateInit=function(t,e){return x(t,e,8,15,8,0)},n.deflateInit2=x,n.deflateReset=P,n.deflateResetKeep=E,n.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?-2:(t.state.gzhead=e,0):-2},n.deflate=function(t,e){var n,o,a,l;if(!t||!t.state||e>5||e<0)return t?u(t,-2):-2;if(o=t.state,!t.output||!t.input&&0!==t.avail_in||666===o.status&&4!==e)return u(t,0===t.avail_out?-5:-2);if(o.strm=t,n=o.last_flush,o.last_flush=e,42===o.status)if(2===o.wrap)t.adler=0,f(o,31),f(o,139),f(o,8),o.gzhead?(f(o,(o.gzhead.text?1:0)+(o.gzhead.hcrc?2:0)+(o.gzhead.extra?4:0)+(o.gzhead.name?8:0)+(o.gzhead.comment?16:0)),f(o,255&o.gzhead.time),f(o,o.gzhead.time>>8&255),f(o,o.gzhead.time>>16&255),f(o,o.gzhead.time>>24&255),f(o,9===o.level?2:o.strategy>=2||o.level<2?4:0),f(o,255&o.gzhead.os),o.gzhead.extra&&o.gzhead.extra.length&&(f(o,255&o.gzhead.extra.length),f(o,o.gzhead.extra.length>>8&255)),o.gzhead.hcrc&&(t.adler=s(t.adler,o.pending_buf,o.pending,0)),o.gzindex=0,o.status=69):(f(o,0),f(o,0),f(o,0),f(o,0),f(o,0),f(o,9===o.level?2:o.strategy>=2||o.level<2?4:0),f(o,3),o.status=113);else{var g=8+(o.w_bits-8<<4)<<8;g|=(o.strategy>=2||o.level<2?0:o.level<6?1:6===o.level?2:3)<<6,0!==o.strstart&&(g|=32),g+=31-g%31,o.status=113,m(o,g),0!==o.strstart&&(m(o,t.adler>>>16),m(o,65535&t.adler)),t.adler=1}if(69===o.status)if(o.gzhead.extra){for(a=o.pending;o.gzindex<(65535&o.gzhead.extra.length)&&(o.pending!==o.pending_buf_size||(o.gzhead.hcrc&&o.pending>a&&(t.adler=s(t.adler,o.pending_buf,o.pending-a,a)),p(t),a=o.pending,o.pending!==o.pending_buf_size));)f(o,255&o.gzhead.extra[o.gzindex]),o.gzindex++;o.gzhead.hcrc&&o.pending>a&&(t.adler=s(t.adler,o.pending_buf,o.pending-a,a)),o.gzindex===o.gzhead.extra.length&&(o.gzindex=0,o.status=73)}else o.status=73;if(73===o.status)if(o.gzhead.name){a=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>a&&(t.adler=s(t.adler,o.pending_buf,o.pending-a,a)),p(t),a=o.pending,o.pending===o.pending_buf_size)){l=1;break}l=o.gzindex<o.gzhead.name.length?255&o.gzhead.name.charCodeAt(o.gzindex++):0,f(o,l)}while(0!==l);o.gzhead.hcrc&&o.pending>a&&(t.adler=s(t.adler,o.pending_buf,o.pending-a,a)),0===l&&(o.gzindex=0,o.status=91)}else o.status=91;if(91===o.status)if(o.gzhead.comment){a=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>a&&(t.adler=s(t.adler,o.pending_buf,o.pending-a,a)),p(t),a=o.pending,o.pending===o.pending_buf_size)){l=1;break}l=o.gzindex<o.gzhead.comment.length?255&o.gzhead.comment.charCodeAt(o.gzindex++):0,f(o,l)}while(0!==l);o.gzhead.hcrc&&o.pending>a&&(t.adler=s(t.adler,o.pending_buf,o.pending-a,a)),0===l&&(o.status=103)}else o.status=103;if(103===o.status&&(o.gzhead.hcrc?(o.pending+2>o.pending_buf_size&&p(t),o.pending+2<=o.pending_buf_size&&(f(o,255&t.adler),f(o,t.adler>>8&255),t.adler=0,o.status=113)):o.status=113),0!==o.pending){if(p(t),0===t.avail_out)return o.last_flush=-1,0}else if(0===t.avail_in&&c(e)<=c(n)&&4!==e)return u(t,-5);if(666===o.status&&0!==t.avail_in)return u(t,-5);if(0!==t.avail_in||0!==o.lookahead||0!==e&&666!==o.status){var y=2===o.strategy?function(t,e){for(var n;;){if(0===t.lookahead&&(v(t),0===t.lookahead)){if(0===e)return 1;break}if(t.match_length=0,n=i._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(d(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(d(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(d(t,!1),0===t.strm.avail_out)?1:2}(o,e):3===o.strategy?function(t,e){for(var n,r,o,a,s=t.window;;){if(t.lookahead<=258){if(v(t),t.lookahead<=258&&0===e)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(r=s[o=t.strstart-1])===s[++o]&&r===s[++o]&&r===s[++o]){a=t.strstart+258;do{}while(r===s[++o]&&r===s[++o]&&r===s[++o]&&r===s[++o]&&r===s[++o]&&r===s[++o]&&r===s[++o]&&r===s[++o]&&o<a);t.match_length=258-(a-o),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(n=i._tr_tally(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=i._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(d(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(d(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(d(t,!1),0===t.strm.avail_out)?1:2}(o,e):r[o.level].func(o,e);if(3!==y&&4!==y||(o.status=666),1===y||3===y)return 0===t.avail_out&&(o.last_flush=-1),0;if(2===y&&(1===e?i._tr_align(o):5!==e&&(i._tr_stored_block(o,0,0,!1),3===e&&(h(o.head),0===o.lookahead&&(o.strstart=0,o.block_start=0,o.insert=0))),p(t),0===t.avail_out))return o.last_flush=-1,0}return 4!==e?0:o.wrap<=0?1:(2===o.wrap?(f(o,255&t.adler),f(o,t.adler>>8&255),f(o,t.adler>>16&255),f(o,t.adler>>24&255),f(o,255&t.total_in),f(o,t.total_in>>8&255),f(o,t.total_in>>16&255),f(o,t.total_in>>24&255)):(m(o,t.adler>>>16),m(o,65535&t.adler)),p(t),o.wrap>0&&(o.wrap=-o.wrap),0!==o.pending?0:1)},n.deflateEnd=function(t){var e;return t&&t.state?42!==(e=t.state.status)&&69!==e&&73!==e&&91!==e&&103!==e&&113!==e&&666!==e?u(t,-2):(t.state=null,113===e?u(t,-3):0):-2},n.deflateSetDictionary=function(t,e){var n,r,i,s,l,u,c,p,d=e.length;if(!t||!t.state)return-2;if(2===(s=(n=t.state).wrap)||1===s&&42!==n.status||n.lookahead)return-2;for(1===s&&(t.adler=a(t.adler,e,d,0)),n.wrap=0,d>=n.w_size&&(0===s&&(h(n.head),n.strstart=0,n.block_start=0,n.insert=0),p=new o.Buf8(n.w_size),o.arraySet(p,e,d-n.w_size,n.w_size,0),e=p,d=n.w_size),l=t.avail_in,u=t.next_in,c=t.input,t.avail_in=d,t.next_in=0,t.input=e,v(n);n.lookahead>=3;){r=n.strstart,i=n.lookahead-2;do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+3-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--i);n.strstart=r,n.lookahead=2,v(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,t.next_in=u,t.input=c,t.avail_in=l,n.wrap=s,0},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,e,n){e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,e,n){e.exports=function(t,e){var n,r,o,i,a,s,l,u,c,h,p,d,f,m,g,v,y,w,b,S,E,P,x,_,T;n=t.state,r=t.next_in,_=t.input,o=r+(t.avail_in-5),i=t.next_out,T=t.output,a=i-(e-t.avail_out),s=i+(t.avail_out-257),l=n.dmax,u=n.wsize,c=n.whave,h=n.wnext,p=n.window,d=n.hold,f=n.bits,m=n.lencode,g=n.distcode,v=(1<<n.lenbits)-1,y=(1<<n.distbits)-1;t:do{f<15&&(d+=_[r++]<<f,f+=8,d+=_[r++]<<f,f+=8),w=m[d&v];e:for(;;){if(d>>>=b=w>>>24,f-=b,0==(b=w>>>16&255))T[i++]=65535&w;else{if(!(16&b)){if(0==(64&b)){w=m[(65535&w)+(d&(1<<b)-1)];continue e}if(32&b){n.mode=12;break t}t.msg="invalid literal/length code",n.mode=30;break t}S=65535&w,(b&=15)&&(f<b&&(d+=_[r++]<<f,f+=8),S+=d&(1<<b)-1,d>>>=b,f-=b),f<15&&(d+=_[r++]<<f,f+=8,d+=_[r++]<<f,f+=8),w=g[d&y];n:for(;;){if(d>>>=b=w>>>24,f-=b,!(16&(b=w>>>16&255))){if(0==(64&b)){w=g[(65535&w)+(d&(1<<b)-1)];continue n}t.msg="invalid distance code",n.mode=30;break t}if(E=65535&w,f<(b&=15)&&(d+=_[r++]<<f,(f+=8)<b&&(d+=_[r++]<<f,f+=8)),(E+=d&(1<<b)-1)>l){t.msg="invalid distance too far back",n.mode=30;break t}if(d>>>=b,f-=b,E>(b=i-a)){if((b=E-b)>c&&n.sane){t.msg="invalid distance too far back",n.mode=30;break t}if(P=0,x=p,0===h){if(P+=u-b,b<S){S-=b;do{T[i++]=p[P++]}while(--b);P=i-E,x=T}}else if(h<b){if(P+=u+h-b,(b-=h)<S){S-=b;do{T[i++]=p[P++]}while(--b);if(P=0,h<S){S-=b=h;do{T[i++]=p[P++]}while(--b);P=i-E,x=T}}}else if(P+=h-b,b<S){S-=b;do{T[i++]=p[P++]}while(--b);P=i-E,x=T}for(;S>2;)T[i++]=x[P++],T[i++]=x[P++],T[i++]=x[P++],S-=3;S&&(T[i++]=x[P++],S>1&&(T[i++]=x[P++]))}else{P=i-E;do{T[i++]=T[P++],T[i++]=T[P++],T[i++]=T[P++],S-=3}while(S>2);S&&(T[i++]=T[P++],S>1&&(T[i++]=T[P++]))}break}}break}}while(r<o&&i<s);r-=S=f>>3,d&=(1<<(f-=S<<3))-1,t.next_in=r,t.next_out=i,t.avail_in=r<o?o-r+5:5-(r-o),t.avail_out=i<s?s-i+257:257-(i-s),n.hold=d,n.bits=f}},{}],49:[function(t,e,n){var r=t("../utils/common"),o=t("./adler32"),i=t("./crc32"),a=t("./inffast"),s=t("./inftrees");function l(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function u(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function c(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new r.Buf32(852),e.distcode=e.distdyn=new r.Buf32(592),e.sane=1,e.back=-1,0):-2}function h(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,c(t)):-2}function p(t,e){var n,r;return t&&t.state?(r=t.state,e<0?(n=0,e=-e):(n=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?-2:(null!==r.window&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,h(t))):-2}function d(t,e){var n,r;return t?(r=new u,t.state=r,r.window=null,0!==(n=p(t,e))&&(t.state=null),n):-2}var f,m,g=!0;function v(t){if(g){var e;for(f=new r.Buf32(512),m=new r.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(s(1,t.lens,0,288,f,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;s(2,t.lens,0,32,m,0,t.work,{bits:5}),g=!1}t.lencode=f,t.lenbits=9,t.distcode=m,t.distbits=5}function y(t,e,n,o){var i,a=t.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new r.Buf8(a.wsize)),o>=a.wsize?(r.arraySet(a.window,e,n-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((i=a.wsize-a.wnext)>o&&(i=o),r.arraySet(a.window,e,n-o,i,a.wnext),(o-=i)?(r.arraySet(a.window,e,n-o,o,0),a.wnext=o,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0}n.inflateReset=h,n.inflateReset2=p,n.inflateResetKeep=c,n.inflateInit=function(t){return d(t,15)},n.inflateInit2=d,n.inflate=function(t,e){var n,u,c,h,p,d,f,m,g,w,b,S,E,P,x,_,T,C,I,D,k,M,R,A,H=0,O=new r.Buf8(4),L=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return-2;12===(n=t.state).mode&&(n.mode=13),p=t.next_out,c=t.output,f=t.avail_out,h=t.next_in,u=t.input,d=t.avail_in,m=n.hold,g=n.bits,w=d,b=f,M=0;t:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;g<16;){if(0===d)break t;d--,m+=u[h++]<<g,g+=8}if(2&n.wrap&&35615===m){n.check=0,O[0]=255&m,O[1]=m>>>8&255,n.check=i(n.check,O,2,0),m=0,g=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&m)<<8)+(m>>8))%31){t.msg="incorrect header check",n.mode=30;break}if(8!=(15&m)){t.msg="unknown compression method",n.mode=30;break}if(g-=4,k=8+(15&(m>>>=4)),0===n.wbits)n.wbits=k;else if(k>n.wbits){t.msg="invalid window size",n.mode=30;break}n.dmax=1<<k,t.adler=n.check=1,n.mode=512&m?10:12,m=0,g=0;break;case 2:for(;g<16;){if(0===d)break t;d--,m+=u[h++]<<g,g+=8}if(n.flags=m,8!=(255&n.flags)){t.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=m>>8&1),512&n.flags&&(O[0]=255&m,O[1]=m>>>8&255,n.check=i(n.check,O,2,0)),m=0,g=0,n.mode=3;case 3:for(;g<32;){if(0===d)break t;d--,m+=u[h++]<<g,g+=8}n.head&&(n.head.time=m),512&n.flags&&(O[0]=255&m,O[1]=m>>>8&255,O[2]=m>>>16&255,O[3]=m>>>24&255,n.check=i(n.check,O,4,0)),m=0,g=0,n.mode=4;case 4:for(;g<16;){if(0===d)break t;d--,m+=u[h++]<<g,g+=8}n.head&&(n.head.xflags=255&m,n.head.os=m>>8),512&n.flags&&(O[0]=255&m,O[1]=m>>>8&255,n.check=i(n.check,O,2,0)),m=0,g=0,n.mode=5;case 5:if(1024&n.flags){for(;g<16;){if(0===d)break t;d--,m+=u[h++]<<g,g+=8}n.length=m,n.head&&(n.head.extra_len=m),512&n.flags&&(O[0]=255&m,O[1]=m>>>8&255,n.check=i(n.check,O,2,0)),m=0,g=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((S=n.length)>d&&(S=d),S&&(n.head&&(k=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,u,h,S,k)),512&n.flags&&(n.check=i(n.check,u,S,h)),d-=S,h+=S,n.length-=S),n.length))break t;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===d)break t;S=0;do{k=u[h+S++],n.head&&k&&n.length<65536&&(n.head.name+=String.fromCharCode(k))}while(k&&S<d);if(512&n.flags&&(n.check=i(n.check,u,S,h)),d-=S,h+=S,k)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===d)break t;S=0;do{k=u[h+S++],n.head&&k&&n.length<65536&&(n.head.comment+=String.fromCharCode(k))}while(k&&S<d);if(512&n.flags&&(n.check=i(n.check,u,S,h)),d-=S,h+=S,k)break t}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;g<16;){if(0===d)break t;d--,m+=u[h++]<<g,g+=8}if(m!==(65535&n.check)){t.msg="header crc mismatch",n.mode=30;break}m=0,g=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=12;break;case 10:for(;g<32;){if(0===d)break t;d--,m+=u[h++]<<g,g+=8}t.adler=n.check=l(m),m=0,g=0,n.mode=11;case 11:if(0===n.havedict)return t.next_out=p,t.avail_out=f,t.next_in=h,t.avail_in=d,n.hold=m,n.bits=g,2;t.adler=n.check=1,n.mode=12;case 12:if(5===e||6===e)break t;case 13:if(n.last){m>>>=7&g,g-=7&g,n.mode=27;break}for(;g<3;){if(0===d)break t;d--,m+=u[h++]<<g,g+=8}switch(n.last=1&m,g-=1,3&(m>>>=1)){case 0:n.mode=14;break;case 1:if(v(n),n.mode=20,6===e){m>>>=2,g-=2;break t}break;case 2:n.mode=17;break;case 3:t.msg="invalid block type",n.mode=30}m>>>=2,g-=2;break;case 14:for(m>>>=7&g,g-=7&g;g<32;){if(0===d)break t;d--,m+=u[h++]<<g,g+=8}if((65535&m)!=(m>>>16^65535)){t.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&m,m=0,g=0,n.mode=15,6===e)break t;case 15:n.mode=16;case 16:if(S=n.length){if(S>d&&(S=d),S>f&&(S=f),0===S)break t;r.arraySet(c,u,h,S,p),d-=S,h+=S,f-=S,p+=S,n.length-=S;break}n.mode=12;break;case 17:for(;g<14;){if(0===d)break t;d--,m+=u[h++]<<g,g+=8}if(n.nlen=257+(31&m),m>>>=5,g-=5,n.ndist=1+(31&m),m>>>=5,g-=5,n.ncode=4+(15&m),m>>>=4,g-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;g<3;){if(0===d)break t;d--,m+=u[h++]<<g,g+=8}n.lens[L[n.have++]]=7&m,m>>>=3,g-=3}for(;n.have<19;)n.lens[L[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,R={bits:n.lenbits},M=s(0,n.lens,0,19,n.lencode,0,n.work,R),n.lenbits=R.bits,M){t.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;_=(H=n.lencode[m&(1<<n.lenbits)-1])>>>16&255,T=65535&H,!((x=H>>>24)<=g);){if(0===d)break t;d--,m+=u[h++]<<g,g+=8}if(T<16)m>>>=x,g-=x,n.lens[n.have++]=T;else{if(16===T){for(A=x+2;g<A;){if(0===d)break t;d--,m+=u[h++]<<g,g+=8}if(m>>>=x,g-=x,0===n.have){t.msg="invalid bit length repeat",n.mode=30;break}k=n.lens[n.have-1],S=3+(3&m),m>>>=2,g-=2}else if(17===T){for(A=x+3;g<A;){if(0===d)break t;d--,m+=u[h++]<<g,g+=8}g-=x,k=0,S=3+(7&(m>>>=x)),m>>>=3,g-=3}else{for(A=x+7;g<A;){if(0===d)break t;d--,m+=u[h++]<<g,g+=8}g-=x,k=0,S=11+(127&(m>>>=x)),m>>>=7,g-=7}if(n.have+S>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=30;break}for(;S--;)n.lens[n.have++]=k}}if(30===n.mode)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,R={bits:n.lenbits},M=s(1,n.lens,0,n.nlen,n.lencode,0,n.work,R),n.lenbits=R.bits,M){t.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,R={bits:n.distbits},M=s(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,R),n.distbits=R.bits,M){t.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===e)break t;case 20:n.mode=21;case 21:if(d>=6&&f>=258){t.next_out=p,t.avail_out=f,t.next_in=h,t.avail_in=d,n.hold=m,n.bits=g,a(t,b),p=t.next_out,c=t.output,f=t.avail_out,h=t.next_in,u=t.input,d=t.avail_in,m=n.hold,g=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;_=(H=n.lencode[m&(1<<n.lenbits)-1])>>>16&255,T=65535&H,!((x=H>>>24)<=g);){if(0===d)break t;d--,m+=u[h++]<<g,g+=8}if(_&&0==(240&_)){for(C=x,I=_,D=T;_=(H=n.lencode[D+((m&(1<<C+I)-1)>>C)])>>>16&255,T=65535&H,!(C+(x=H>>>24)<=g);){if(0===d)break t;d--,m+=u[h++]<<g,g+=8}m>>>=C,g-=C,n.back+=C}if(m>>>=x,g-=x,n.back+=x,n.length=T,0===_){n.mode=26;break}if(32&_){n.back=-1,n.mode=12;break}if(64&_){t.msg="invalid literal/length code",n.mode=30;break}n.extra=15&_,n.mode=22;case 22:if(n.extra){for(A=n.extra;g<A;){if(0===d)break t;d--,m+=u[h++]<<g,g+=8}n.length+=m&(1<<n.extra)-1,m>>>=n.extra,g-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;_=(H=n.distcode[m&(1<<n.distbits)-1])>>>16&255,T=65535&H,!((x=H>>>24)<=g);){if(0===d)break t;d--,m+=u[h++]<<g,g+=8}if(0==(240&_)){for(C=x,I=_,D=T;_=(H=n.distcode[D+((m&(1<<C+I)-1)>>C)])>>>16&255,T=65535&H,!(C+(x=H>>>24)<=g);){if(0===d)break t;d--,m+=u[h++]<<g,g+=8}m>>>=C,g-=C,n.back+=C}if(m>>>=x,g-=x,n.back+=x,64&_){t.msg="invalid distance code",n.mode=30;break}n.offset=T,n.extra=15&_,n.mode=24;case 24:if(n.extra){for(A=n.extra;g<A;){if(0===d)break t;d--,m+=u[h++]<<g,g+=8}n.offset+=m&(1<<n.extra)-1,m>>>=n.extra,g-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===f)break t;if(S=b-f,n.offset>S){if((S=n.offset-S)>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=30;break}S>n.wnext?(S-=n.wnext,E=n.wsize-S):E=n.wnext-S,S>n.length&&(S=n.length),P=n.window}else P=c,E=p-n.offset,S=n.length;S>f&&(S=f),f-=S,n.length-=S;do{c[p++]=P[E++]}while(--S);0===n.length&&(n.mode=21);break;case 26:if(0===f)break t;c[p++]=n.length,f--,n.mode=21;break;case 27:if(n.wrap){for(;g<32;){if(0===d)break t;d--,m|=u[h++]<<g,g+=8}if(b-=f,t.total_out+=b,n.total+=b,b&&(t.adler=n.check=n.flags?i(n.check,c,b,p-b):o(n.check,c,b,p-b)),b=f,(n.flags?m:l(m))!==n.check){t.msg="incorrect data check",n.mode=30;break}m=0,g=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;g<32;){if(0===d)break t;d--,m+=u[h++]<<g,g+=8}if(m!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=30;break}m=0,g=0}n.mode=29;case 29:M=1;break t;case 30:M=-3;break t;case 31:return-4;case 32:default:return-2}return t.next_out=p,t.avail_out=f,t.next_in=h,t.avail_in=d,n.hold=m,n.bits=g,(n.wsize||b!==t.avail_out&&n.mode<30&&(n.mode<27||4!==e))&&y(t,t.output,t.next_out,b-t.avail_out),w-=t.avail_in,b-=t.avail_out,t.total_in+=w,t.total_out+=b,n.total+=b,n.wrap&&b&&(t.adler=n.check=n.flags?i(n.check,c,b,t.next_out-b):o(n.check,c,b,t.next_out-b)),t.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0===w&&0===b||4===e)&&0===M&&(M=-5),M},n.inflateEnd=function(t){if(!t||!t.state)return-2;var e=t.state;return e.window&&(e.window=null),t.state=null,0},n.inflateGetHeader=function(t,e){var n;return t&&t.state?0==(2&(n=t.state).wrap)?-2:(n.head=e,e.done=!1,0):-2},n.inflateSetDictionary=function(t,e){var n,r=e.length;return t&&t.state?0!==(n=t.state).wrap&&11!==n.mode?-2:11===n.mode&&o(1,e,r,0)!==n.check?-3:y(t,e,r,r)?(n.mode=31,-4):(n.havedict=1,0):-2},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,e,n){var r=t("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],i=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,n,l,u,c,h,p){var d,f,m,g,v,y,w,b,S,E=p.bits,P=0,x=0,_=0,T=0,C=0,I=0,D=0,k=0,M=0,R=0,A=null,H=0,O=new r.Buf16(16),L=new r.Buf16(16),B=null,F=0;for(P=0;P<=15;P++)O[P]=0;for(x=0;x<l;x++)O[e[n+x]]++;for(C=E,T=15;T>=1&&0===O[T];T--);if(C>T&&(C=T),0===T)return u[c++]=20971520,u[c++]=20971520,p.bits=1,0;for(_=1;_<T&&0===O[_];_++);for(C<_&&(C=_),k=1,P=1;P<=15;P++)if(k<<=1,(k-=O[P])<0)return-1;if(k>0&&(0===t||1!==T))return-1;for(L[1]=0,P=1;P<15;P++)L[P+1]=L[P]+O[P];for(x=0;x<l;x++)0!==e[n+x]&&(h[L[e[n+x]]++]=x);if(0===t?(A=B=h,y=19):1===t?(A=o,H-=257,B=i,F-=257,y=256):(A=a,B=s,y=-1),R=0,x=0,P=_,v=c,I=C,D=0,m=-1,g=(M=1<<C)-1,1===t&&M>852||2===t&&M>592)return 1;for(;;){w=P-D,h[x]<y?(b=0,S=h[x]):h[x]>y?(b=B[F+h[x]],S=A[H+h[x]]):(b=96,S=0),d=1<<P-D,_=f=1<<I;do{u[v+(R>>D)+(f-=d)]=w<<24|b<<16|S|0}while(0!==f);for(d=1<<P-1;R&d;)d>>=1;if(0!==d?(R&=d-1,R+=d):R=0,x++,0==--O[P]){if(P===T)break;P=e[n+h[x]]}if(P>C&&(R&g)!==m){for(0===D&&(D=C),v+=_,k=1<<(I=P-D);I+D<T&&!((k-=O[I+D])<=0);)I++,k<<=1;if(M+=1<<I,1===t&&M>852||2===t&&M>592)return 1;u[m=R&g]=C<<24|I<<16|v-c|0}}return 0!==R&&(u[v+R]=P-D<<24|64<<16|0),p.bits=C,0}},{"../utils/common":41}],51:[function(t,e,n){e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,e,n){var r=t("../utils/common");function o(t){for(var e=t.length;--e>=0;)t[e]=0}var i=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],a=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],l=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],u=new Array(576);o(u);var c=new Array(60);o(c);var h=new Array(512);o(h);var p=new Array(256);o(p);var d=new Array(29);o(d);var f,m,g,v=new Array(30);function y(t,e,n,r,o){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=r,this.max_length=o,this.has_stree=t&&t.length}function w(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function b(t){return t<256?h[t]:h[256+(t>>>7)]}function S(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function E(t,e,n){t.bi_valid>16-n?(t.bi_buf|=e<<t.bi_valid&65535,S(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=n-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)}function P(t,e,n){E(t,n[2*e],n[2*e+1])}function x(t,e){var n=0;do{n|=1&t,t>>>=1,n<<=1}while(--e>0);return n>>>1}function _(t,e,n){var r,o,i=new Array(16),a=0;for(r=1;r<=15;r++)i[r]=a=a+n[r-1]<<1;for(o=0;o<=e;o++){var s=t[2*o+1];0!==s&&(t[2*o]=x(i[s]++,s))}}function T(t){var e;for(e=0;e<286;e++)t.dyn_ltree[2*e]=0;for(e=0;e<30;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function C(t){t.bi_valid>8?S(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function I(t,e,n,r){var o=2*e,i=2*n;return t[o]<t[i]||t[o]===t[i]&&r[e]<=r[n]}function D(t,e,n){for(var r=t.heap[n],o=n<<1;o<=t.heap_len&&(o<t.heap_len&&I(e,t.heap[o+1],t.heap[o],t.depth)&&o++,!I(e,r,t.heap[o],t.depth));)t.heap[n]=t.heap[o],n=o,o<<=1;t.heap[n]=r}function k(t,e,n){var r,o,s,l,u=0;if(0!==t.last_lit)do{r=t.pending_buf[t.d_buf+2*u]<<8|t.pending_buf[t.d_buf+2*u+1],o=t.pending_buf[t.l_buf+u],u++,0===r?P(t,o,e):(P(t,(s=p[o])+256+1,e),0!==(l=i[s])&&E(t,o-=d[s],l),P(t,s=b(--r),n),0!==(l=a[s])&&E(t,r-=v[s],l))}while(u<t.last_lit);P(t,256,e)}function M(t,e){var n,r,o,i=e.dyn_tree,a=e.stat_desc.static_tree,s=e.stat_desc.has_stree,l=e.stat_desc.elems,u=-1;for(t.heap_len=0,t.heap_max=573,n=0;n<l;n++)0!==i[2*n]?(t.heap[++t.heap_len]=u=n,t.depth[n]=0):i[2*n+1]=0;for(;t.heap_len<2;)i[2*(o=t.heap[++t.heap_len]=u<2?++u:0)]=1,t.depth[o]=0,t.opt_len--,s&&(t.static_len-=a[2*o+1]);for(e.max_code=u,n=t.heap_len>>1;n>=1;n--)D(t,i,n);o=l;do{n=t.heap[1],t.heap[1]=t.heap[t.heap_len--],D(t,i,1),r=t.heap[1],t.heap[--t.heap_max]=n,t.heap[--t.heap_max]=r,i[2*o]=i[2*n]+i[2*r],t.depth[o]=(t.depth[n]>=t.depth[r]?t.depth[n]:t.depth[r])+1,i[2*n+1]=i[2*r+1]=o,t.heap[1]=o++,D(t,i,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function(t,e){var n,r,o,i,a,s,l=e.dyn_tree,u=e.max_code,c=e.stat_desc.static_tree,h=e.stat_desc.has_stree,p=e.stat_desc.extra_bits,d=e.stat_desc.extra_base,f=e.stat_desc.max_length,m=0;for(i=0;i<=15;i++)t.bl_count[i]=0;for(l[2*t.heap[t.heap_max]+1]=0,n=t.heap_max+1;n<573;n++)(i=l[2*l[2*(r=t.heap[n])+1]+1]+1)>f&&(i=f,m++),l[2*r+1]=i,r>u||(t.bl_count[i]++,a=0,r>=d&&(a=p[r-d]),s=l[2*r],t.opt_len+=s*(i+a),h&&(t.static_len+=s*(c[2*r+1]+a)));if(0!==m){do{for(i=f-1;0===t.bl_count[i];)i--;t.bl_count[i]--,t.bl_count[i+1]+=2,t.bl_count[f]--,m-=2}while(m>0);for(i=f;0!==i;i--)for(r=t.bl_count[i];0!==r;)(o=t.heap[--n])>u||(l[2*o+1]!==i&&(t.opt_len+=(i-l[2*o+1])*l[2*o],l[2*o+1]=i),r--)}}(t,e),_(i,u,t.bl_count)}function R(t,e,n){var r,o,i=-1,a=e[1],s=0,l=7,u=4;for(0===a&&(l=138,u=3),e[2*(n+1)+1]=65535,r=0;r<=n;r++)o=a,a=e[2*(r+1)+1],++s<l&&o===a||(s<u?t.bl_tree[2*o]+=s:0!==o?(o!==i&&t.bl_tree[2*o]++,t.bl_tree[32]++):s<=10?t.bl_tree[34]++:t.bl_tree[36]++,s=0,i=o,0===a?(l=138,u=3):o===a?(l=6,u=3):(l=7,u=4))}function A(t,e,n){var r,o,i=-1,a=e[1],s=0,l=7,u=4;for(0===a&&(l=138,u=3),r=0;r<=n;r++)if(o=a,a=e[2*(r+1)+1],!(++s<l&&o===a)){if(s<u)do{P(t,o,t.bl_tree)}while(0!=--s);else 0!==o?(o!==i&&(P(t,o,t.bl_tree),s--),P(t,16,t.bl_tree),E(t,s-3,2)):s<=10?(P(t,17,t.bl_tree),E(t,s-3,3)):(P(t,18,t.bl_tree),E(t,s-11,7));s=0,i=o,0===a?(l=138,u=3):o===a?(l=6,u=3):(l=7,u=4)}}o(v);var H=!1;function O(t,e,n,o){E(t,0+(o?1:0),3),function(t,e,n,o){C(t),o&&(S(t,n),S(t,~n)),r.arraySet(t.pending_buf,t.window,e,n,t.pending),t.pending+=n}(t,e,n,!0)}n._tr_init=function(t){H||(function(){var t,e,n,r,o,l=new Array(16);for(n=0,r=0;r<28;r++)for(d[r]=n,t=0;t<1<<i[r];t++)p[n++]=r;for(p[n-1]=r,o=0,r=0;r<16;r++)for(v[r]=o,t=0;t<1<<a[r];t++)h[o++]=r;for(o>>=7;r<30;r++)for(v[r]=o<<7,t=0;t<1<<a[r]-7;t++)h[256+o++]=r;for(e=0;e<=15;e++)l[e]=0;for(t=0;t<=143;)u[2*t+1]=8,t++,l[8]++;for(;t<=255;)u[2*t+1]=9,t++,l[9]++;for(;t<=279;)u[2*t+1]=7,t++,l[7]++;for(;t<=287;)u[2*t+1]=8,t++,l[8]++;for(_(u,287,l),t=0;t<30;t++)c[2*t+1]=5,c[2*t]=x(t,5);f=new y(u,i,257,286,15),m=new y(c,a,0,30,15),g=new y(new Array(0),s,0,19,7)}(),H=!0),t.l_desc=new w(t.dyn_ltree,f),t.d_desc=new w(t.dyn_dtree,m),t.bl_desc=new w(t.bl_tree,g),t.bi_buf=0,t.bi_valid=0,T(t)},n._tr_stored_block=O,n._tr_flush_block=function(t,e,n,r){var o,i,a=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,n=4093624447;for(e=0;e<=31;e++,n>>>=1)if(1&n&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<256;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0}(t)),M(t,t.l_desc),M(t,t.d_desc),a=function(t){var e;for(R(t,t.dyn_ltree,t.l_desc.max_code),R(t,t.dyn_dtree,t.d_desc.max_code),M(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*l[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),o=t.opt_len+3+7>>>3,(i=t.static_len+3+7>>>3)<=o&&(o=i)):o=i=n+5,n+4<=o&&-1!==e?O(t,e,n,r):4===t.strategy||i===o?(E(t,2+(r?1:0),3),k(t,u,c)):(E(t,4+(r?1:0),3),function(t,e,n,r){var o;for(E(t,e-257,5),E(t,n-1,5),E(t,r-4,4),o=0;o<r;o++)E(t,t.bl_tree[2*l[o]+1],3);A(t,t.dyn_ltree,e-1),A(t,t.dyn_dtree,n-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,a+1),k(t,t.dyn_ltree,t.dyn_dtree)),T(t),r&&C(t)},n._tr_tally=function(t,e,n){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&n,t.last_lit++,0===e?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(p[n]+256+1)]++,t.dyn_dtree[2*b(e)]++),t.last_lit===t.lit_bufsize-1},n._tr_align=function(t){E(t,2,3),P(t,256,u),function(t){16===t.bi_valid?(S(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},{"../utils/common":41}],53:[function(t,e,n){e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,e,n){e.exports="function"==typeof setImmediate?setImmediate:function(){var t=[].slice.apply(arguments);t.splice(1,0,0),setTimeout.apply(null,t)}},{}]},{},[10])(10)})),HS=r((function(t){
/*! FileSaver.js
	 *  A saveAs() FileSaver implementation.
	 *  2014-01-24
	 *
	 *  By Eli Grey, http://eligrey.com
	 *  License: X11/MIT
	 *    See LICENSE.md
	 */
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */
var n=n||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(t){if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var e=t.document,n=t.URL||t.webkitURL||t,r=e.createElementNS("http://www.w3.org/1999/xhtml","a"),o=!t.externalHost&&"download"in r,i=t.webkitRequestFileSystem,a=t.requestFileSystem||i||t.mozRequestFileSystem,s=function(e){(t.setImmediate||t.setTimeout)((function(){throw e}),0)},l=0,u=[],c=function(){for(var t=u.length;t--;){var e=u[t];"string"==typeof e?n.revokeObjectURL(e):e.remove()}u.length=0},h=function(t,e,n){for(var r=(e=[].concat(e)).length;r--;){var o=t["on"+e[r]];if("function"==typeof o)try{o.call(t,n||t)}catch(t){s(t)}}},p=function(n,s){var c,p,d,f=this,m=n.type,g=!1,v=function(){var e=(t.URL||t.webkitURL||t).createObjectURL(n);return u.push(e),e},y=function(){h(f,"writestart progress write writeend".split(" "))},w=function(){!g&&c||(c=v()),p?p.location.href=c:window.open(c,"_blank"),f.readyState=f.DONE,y()},b=function(t){return function(){if(f.readyState!==f.DONE)return t.apply(this,arguments)}},S={create:!0,exclusive:!1};if(f.readyState=f.INIT,s||(s="download"),o){c=v(),e=t.document,(r=e.createElementNS("http://www.w3.org/1999/xhtml","a")).href=c,r.download=s;var E=e.createEvent("MouseEvents");return E.initMouseEvent("click",!0,!1,t,0,0,0,0,0,!1,!1,!1,!1,0,null),r.dispatchEvent(E),f.readyState=f.DONE,void y()}t.chrome&&m&&"application/octet-stream"!==m&&(d=n.slice||n.webkitSlice,n=d.call(n,0,n.size,"application/octet-stream"),g=!0),i&&"download"!==s&&(s+=".download"),("application/octet-stream"===m||i)&&(p=t),a?(l+=n.size,a(t.TEMPORARY,l,b((function(t){t.root.getDirectory("saved",S,b((function(t){var e=function(){t.getFile(s,S,b((function(t){t.createWriter(b((function(e){e.onwriteend=function(e){p.location.href=t.toURL(),u.push(t),f.readyState=f.DONE,h(f,"writeend",e)},e.onerror=function(){var t=e.error;t.code!==t.ABORT_ERR&&w()},"writestart progress write abort".split(" ").forEach((function(t){e["on"+t]=f["on"+t]})),e.write(n),f.abort=function(){e.abort(),f.readyState=f.DONE},f.readyState=f.WRITING})),w)})),w)};t.getFile(s,{create:!1},b((function(t){t.remove(),e()})),b((function(t){t.code===t.NOT_FOUND_ERR?e():w()})))})),w)})),w)):w()},d=p.prototype,f=function(t,e){return new p(t,e)};return d.abort=function(){this.readyState=this.DONE,h(this,"abort")},d.readyState=d.INIT=0,d.WRITING=1,d.DONE=2,d.error=d.onwritestart=d.onprogress=d.onwrite=d.onabort=d.onerror=d.onwriteend=null,t.addEventListener("unload",c,!1),f.unload=function(){c(),t.removeEventListener("unload",c,!1)},f}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||e.content);t.exports=n})),OS=function(){function t(){Kf(this,t)}return tm(t,null,[{key:"initCryptoJS",value:function(){var t;this.isInitialized||(Ww.pad.ZeroPadding={pad:function(t,e){var n=4*e;t.clamp(),t.sigBytes+=n-(t.sigBytes%n||n)},unpad:function(t){for(var e=t.words,n=t.sigBytes-1;!(e[n>>>2]>>>24-n%4*8&255);)n--;t.sigBytes=n+1}},Ww.mode.ECB=((t=Ww.lib.BlockCipherMode.extend()).Encryptor=t.extend({processBlock:function(t,e){this._cipher.encryptBlock(t,e)}}),t.Decryptor=t.extend({processBlock:function(t,e){this._cipher.decryptBlock(t,e)}}),t),this.isInitialized=!0)}},{key:"decompressToString",value:function(e,n){try{t.initCryptoJS();n=Ww.enc.Utf8.parse(n);var r=Ww.AES.decrypt(e,n,{mode:Ww.mode.ECB,padding:Ww.pad.Pkcs7}),o=Ww.enc.Base64.stringify(r),i=atob(o),a=i.split("").map((function(t){return t.charCodeAt(0)})),s=new Uint8Array(a),l=RS.inflate(s);return i=t.decodeUtf8(l)}catch(t){console.log("decompressToString: "+t)}}},{key:"decodeUtf8",value:function(t){for(var e="",n=0;n<t.length;n++)e+="%"+t[n].toString(16);return decodeURIComponent(e)}},{key:"decodeToUTF8",value:function(e,n){t.initCryptoJS(),n=Ww.enc.Utf8.parse(n);var r=Ww.AES.decrypt(e,n,{mode:Ww.mode.ECB,padding:Ww.pad.Pkcs7});return Ww.enc.Utf8.stringify(r)}},{key:"zipAndEncrypt",value:function(e,n){try{t.initCryptoJS();var r=RS.gzip(e,{to:"string"});n=Ww.enc.Utf8.parse(n);var o=Ww.enc.Base64.parse(btoa(r));return Ww.AES.encrypt(o,n,{mode:Ww.mode.ECB,padding:Ww.pad.ZeroPadding}).toString()}catch(t){console.error("zipAndEncrypt: "+t)}}},{key:"zip",value:function(t,e,n){for(var r=n,o=new AS,i=o.folder(t.Name+"_FloorPlans"),a=[],s=0;s<t.Floors.length;s++){var l=t.Floors[s].ID,u=r+"FloorPlans/"+l+"_export.jpg";e&&(u=r+"FloorPlans/"+l+"_"+e+"_export.jpg"),a.push(u)}var c=0;a.forEach((function(e,n){HouseEditor.BaseAPI.getBase64(e,"jpeg").then((function(e){e=e.split("base64,")[1],i.file(t.Floors[n].Name+".jpg",e,{base64:!0}),c===a.length-1&&o.generateAsync({type:"blob"}).then((function(e){HS(e,t.Name+"_FloorPlans.zip")})),c++}),(function(t){console.log(t)}))}))}}]),t}();em(OS,"isInitialized",!1),em(OS,"saveAs",(function(t,e,n){HS(t,e,n)}));var LS={},BS=[],FS={},NS=function(){function t(e){Kf(this,t),this.dataUrl=(iw.getUrlParameter("domain")||"//vrhouse-test.oss-cn-shanghai.aliyuncs.com/")+(iw.getUrlParameter("m")?iw.getUrlParameter("m"):iw.getUrlParameter("hid"))+(e&&iw.getUrlParameter("style")?"_deco_"+iw.getUrlParameter("style")+"/":"/"),this.keys={DecorationData:"YQjyHSk2nky72BO2CW29OwRYQ8tKXFGw",ProcessData:"BDE3F559AE1442BB91907A6D5C77D48F",FloorPlaneData:"6239B45BF488435EBC036FE3D76FFB61"}}var e,n,r,o,i,a,s;return tm(t,[{key:"loadData",value:(s=$f(regeneratorRuntime.mark((function t(e,n){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.info(e),t.next=4,fetch(e,{cache:"no-store"}).then((function(t){return t.text()}));case 4:r=t.sent;try{r=Vw.toSmallCaseVector(r),r=JSON.parse(r)}catch(t){r=OS.decompressToString(r,n),r=Vw.toSmallCaseVector(r),r=JSON.parse(r)}return t.abrupt("return",r);case 7:case"end":return t.stop()}}),t)}))),function(t,e){return s.apply(this,arguments)})},{key:"loadMeshData",value:(a=$f(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadData(this.dataUrl+"MeshData.json",this.keys.DecorationData,!0);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)}))),function(){return a.apply(this,arguments)})},{key:"loadHouseMeshData",value:(i=$f(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadData(this.dataUrl+"StereoHouseMeshData.json",this.keys.DecorationData,iw.getUrlParameter("style"));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"loadDecorationData",value:(o=$f(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=null,t.prev=1,t.next=4,this.loadData(this.dataUrl+"DecorationData.json",this.keys.DecorationData,!0);case 4:e=t.sent,t.next=13;break;case 7:return t.prev=7,t.t0=t.catch(1),console.warn("DecorationData.json文件未加密！"),t.next=12,this.loadData(this.dataUrl+this.keys.DecorationData,"DecorationData.json");case 12:e=t.sent;case 13:return e.Rooms.forEach((function(t){t.Products.forEach((function(t){t.Position=new THREE.Vector3(t.Position.x,t.Position.y,t.Position.z),t.Scale=new THREE.Vector3(t.Scale.x||1,t.Scale.y||1,t.Scale.z||1)}))})),t.abrupt("return",e);case 15:case"end":return t.stop()}}),t,this,[[1,7]])}))),function(){return o.apply(this,arguments)})},{key:"loadStereoHouseData",value:(r=$f(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadData(this.dataUrl+"StereoHouseData.json",this.keys.DecorationData,!0);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"loadProcessData",value:(n=$f(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadData("https://vrhouse-test.oss-cn-shanghai.aliyuncs.com/thehouseclub_91ae95e9-baad-4704-938d-7396364198df_deco_Modern/ProcessData_right.txt",this.keys.ProcessData,!0);case 2:return e=t.sent,t.abrupt("return",OS.zipAndEncrypt(JSON.stringify(e),this.keys.ProcessData));case 4:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})}],[{key:"loadOBJModel",value:(e=$f(regeneratorRuntime.mark((function t(e){var n,r,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=function(t){var e=[],n=[],r=new THREE.Geometry;t.traverse((function(t){t.isMesh&&(e.push(t),n.push(t.material),r.name=t.name)}));for(var o=0;o<e.length;o++)e[o].updateMatrix(),r.merge((new THREE.Geometry).fromBufferGeometry(e[o].geometry),e[o].matrix,o);return new THREE.Mesh(r,n)},-1===BS.indexOf(e)){t.next=3;break}return t.abrupt("return");case 3:if(!LS[e]){t.next=7;break}return t.abrupt("return",new THREE.Mesh(LS[e].geometry,LS[e].material));case 7:return t.next=9,ResourcesLoader.loadGLTFScene(e);case 9:if("error"!==(n=t.sent)){t.next=13;break}return BS.push(e),t.abrupt("return",null);case 13:return LS[e]=o(n),LS[e].material instanceof Array?(r=[],LS[e].material.forEach((function(t){FS[t.name]?(r.push(FS[t.name]),t.dispose()):(FS[t.name]=t,r.push(t))})),LS[e].material=r):FS[LS[e].material.name]?(LS[e].material=FS[LS[e].material.name],LS[e].material.dispose()):FS[LS[e].material.name]=LS[e].material,n.children.slice().forEach((function(t){return t.dispose()})),n.dispose(),t.abrupt("return",LS[e]);case 18:case"end":return t.stop()}}),t)}))),function(t){return e.apply(this,arguments)})}]),t}(),jS=r((function(t){!function(){var e,n={version:"6.4.2.2",use_lines:!0,use_xyz:!1},r=!1;if(t.exports?(t.exports=n,r=!0):"undefined"!=typeof document?window.ClipperLib=n:self.ClipperLib=n,r){o="chrome";e="Netscape"}else{var o=navigator.userAgent.toString().toLowerCase();e=navigator.appName}var i,a={};function s(t,e,r){n.biginteger_used=1,null!=t&&("number"==typeof t&&void 0===e?this.fromInt(t):"number"==typeof t?this.fromNumber(t,e,r):null==e&&"string"!=typeof t?this.fromString(t,256):this.fromString(t,e))}function l(){return new s(null,void 0,void 0)}-1!=o.indexOf("chrome")&&-1==o.indexOf("chromium")?a.chrome=1:a.chrome=0,-1!=o.indexOf("chromium")?a.chromium=1:a.chromium=0,-1!=o.indexOf("safari")&&-1==o.indexOf("chrome")&&-1==o.indexOf("chromium")?a.safari=1:a.safari=0,-1!=o.indexOf("firefox")?a.firefox=1:a.firefox=0,-1!=o.indexOf("firefox/17")?a.firefox17=1:a.firefox17=0,-1!=o.indexOf("firefox/15")?a.firefox15=1:a.firefox15=0,-1!=o.indexOf("firefox/3")?a.firefox3=1:a.firefox3=0,-1!=o.indexOf("opera")?a.opera=1:a.opera=0,-1!=o.indexOf("msie 10")?a.msie10=1:a.msie10=0,-1!=o.indexOf("msie 9")?a.msie9=1:a.msie9=0,-1!=o.indexOf("msie 8")?a.msie8=1:a.msie8=0,-1!=o.indexOf("msie 7")?a.msie7=1:a.msie7=0,-1!=o.indexOf("msie ")?a.msie=1:a.msie=0,n.biginteger_used=null,"Microsoft Internet Explorer"==e?(s.prototype.am=function(t,e,n,r,o,i){for(var a=32767&e,s=e>>15;--i>=0;){var l=32767&this[t],u=this[t++]>>15,c=s*l+u*a;o=((l=a*l+((32767&c)<<15)+n[r]+(1073741823&o))>>>30)+(c>>>15)+s*u+(o>>>30),n[r++]=1073741823&l}return o},i=30):"Netscape"!=e?(s.prototype.am=function(t,e,n,r,o,i){for(;--i>=0;){var a=e*this[t++]+n[r]+o;o=Math.floor(a/67108864),n[r++]=67108863&a}return o},i=26):(s.prototype.am=function(t,e,n,r,o,i){for(var a=16383&e,s=e>>14;--i>=0;){var l=16383&this[t],u=this[t++]>>14,c=s*l+u*a;o=((l=a*l+((16383&c)<<14)+n[r]+o)>>28)+(c>>14)+s*u,n[r++]=268435455&l}return o},i=28),s.prototype.DB=i,s.prototype.DM=(1<<i)-1,s.prototype.DV=1<<i;s.prototype.FV=Math.pow(2,52),s.prototype.F1=52-i,s.prototype.F2=2*i-52;var u,c,h=new Array;for(u="0".charCodeAt(0),c=0;c<=9;++c)h[u++]=c;for(u="a".charCodeAt(0),c=10;c<36;++c)h[u++]=c;for(u="A".charCodeAt(0),c=10;c<36;++c)h[u++]=c;function p(t){return"0123456789abcdefghijklmnopqrstuvwxyz".charAt(t)}function d(t,e){var n=h[t.charCodeAt(e)];return null==n?-1:n}function f(t){var e=l();return e.fromInt(t),e}function m(t){var e,n=1;return 0!=(e=t>>>16)&&(t=e,n+=16),0!=(e=t>>8)&&(t=e,n+=8),0!=(e=t>>4)&&(t=e,n+=4),0!=(e=t>>2)&&(t=e,n+=2),0!=(e=t>>1)&&(t=e,n+=1),n}function g(t){this.m=t}function v(t){this.m=t,this.mp=t.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function y(t,e){return t&e}function w(t,e){return t|e}function b(t,e){return t^e}function S(t,e){return t&~e}function E(t){if(0==t)return-1;var e=0;return 0==(65535&t)&&(t>>=16,e+=16),0==(255&t)&&(t>>=8,e+=8),0==(15&t)&&(t>>=4,e+=4),0==(3&t)&&(t>>=2,e+=2),0==(1&t)&&++e,e}function P(t){for(var e=0;0!=t;)t&=t-1,++e;return e}function x(){}function _(t){return t}function T(t){this.r2=l(),this.q3=l(),s.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t),this.m=t}g.prototype.convert=function(t){return t.s<0||t.compareTo(this.m)>=0?t.mod(this.m):t},g.prototype.revert=function(t){return t},g.prototype.reduce=function(t){t.divRemTo(this.m,null,t)},g.prototype.mulTo=function(t,e,n){t.multiplyTo(e,n),this.reduce(n)},g.prototype.sqrTo=function(t,e){t.squareTo(e),this.reduce(e)},v.prototype.convert=function(t){var e=l();return t.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),t.s<0&&e.compareTo(s.ZERO)>0&&this.m.subTo(e,e),e},v.prototype.revert=function(t){var e=l();return t.copyTo(e),this.reduce(e),e},v.prototype.reduce=function(t){for(;t.t<=this.mt2;)t[t.t++]=0;for(var e=0;e<this.m.t;++e){var n=32767&t[e],r=n*this.mpl+((n*this.mph+(t[e]>>15)*this.mpl&this.um)<<15)&t.DM;for(t[n=e+this.m.t]+=this.m.am(0,r,t,e,0,this.m.t);t[n]>=t.DV;)t[n]-=t.DV,t[++n]++}t.clamp(),t.drShiftTo(this.m.t,t),t.compareTo(this.m)>=0&&t.subTo(this.m,t)},v.prototype.mulTo=function(t,e,n){t.multiplyTo(e,n),this.reduce(n)},v.prototype.sqrTo=function(t,e){t.squareTo(e),this.reduce(e)},s.prototype.copyTo=function(t){for(var e=this.t-1;e>=0;--e)t[e]=this[e];t.t=this.t,t.s=this.s},s.prototype.fromInt=function(t){this.t=1,this.s=t<0?-1:0,t>0?this[0]=t:t<-1?this[0]=t+this.DV:this.t=0},s.prototype.fromString=function(t,e){var n;if(16==e)n=4;else if(8==e)n=3;else if(256==e)n=8;else if(2==e)n=1;else if(32==e)n=5;else{if(4!=e)return void this.fromRadix(t,e);n=2}this.t=0,this.s=0;for(var r=t.length,o=!1,i=0;--r>=0;){var a=8==n?255&t[r]:d(t,r);a<0?"-"==t.charAt(r)&&(o=!0):(o=!1,0==i?this[this.t++]=a:i+n>this.DB?(this[this.t-1]|=(a&(1<<this.DB-i)-1)<<i,this[this.t++]=a>>this.DB-i):this[this.t-1]|=a<<i,(i+=n)>=this.DB&&(i-=this.DB))}8==n&&0!=(128&t[0])&&(this.s=-1,i>0&&(this[this.t-1]|=(1<<this.DB-i)-1<<i)),this.clamp(),o&&s.ZERO.subTo(this,this)},s.prototype.clamp=function(){for(var t=this.s&this.DM;this.t>0&&this[this.t-1]==t;)--this.t},s.prototype.dlShiftTo=function(t,e){var n;for(n=this.t-1;n>=0;--n)e[n+t]=this[n];for(n=t-1;n>=0;--n)e[n]=0;e.t=this.t+t,e.s=this.s},s.prototype.drShiftTo=function(t,e){for(var n=t;n<this.t;++n)e[n-t]=this[n];e.t=Math.max(this.t-t,0),e.s=this.s},s.prototype.lShiftTo=function(t,e){var n,r=t%this.DB,o=this.DB-r,i=(1<<o)-1,a=Math.floor(t/this.DB),s=this.s<<r&this.DM;for(n=this.t-1;n>=0;--n)e[n+a+1]=this[n]>>o|s,s=(this[n]&i)<<r;for(n=a-1;n>=0;--n)e[n]=0;e[a]=s,e.t=this.t+a+1,e.s=this.s,e.clamp()},s.prototype.rShiftTo=function(t,e){e.s=this.s;var n=Math.floor(t/this.DB);if(n>=this.t)e.t=0;else{var r=t%this.DB,o=this.DB-r,i=(1<<r)-1;e[0]=this[n]>>r;for(var a=n+1;a<this.t;++a)e[a-n-1]|=(this[a]&i)<<o,e[a-n]=this[a]>>r;r>0&&(e[this.t-n-1]|=(this.s&i)<<o),e.t=this.t-n,e.clamp()}},s.prototype.subTo=function(t,e){for(var n=0,r=0,o=Math.min(t.t,this.t);n<o;)r+=this[n]-t[n],e[n++]=r&this.DM,r>>=this.DB;if(t.t<this.t){for(r-=t.s;n<this.t;)r+=this[n],e[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;n<t.t;)r-=t[n],e[n++]=r&this.DM,r>>=this.DB;r-=t.s}e.s=r<0?-1:0,r<-1?e[n++]=this.DV+r:r>0&&(e[n++]=r),e.t=n,e.clamp()},s.prototype.multiplyTo=function(t,e){var n=this.abs(),r=t.abs(),o=n.t;for(e.t=o+r.t;--o>=0;)e[o]=0;for(o=0;o<r.t;++o)e[o+n.t]=n.am(0,r[o],e,o,0,n.t);e.s=0,e.clamp(),this.s!=t.s&&s.ZERO.subTo(e,e)},s.prototype.squareTo=function(t){for(var e=this.abs(),n=t.t=2*e.t;--n>=0;)t[n]=0;for(n=0;n<e.t-1;++n){var r=e.am(n,e[n],t,2*n,0,1);(t[n+e.t]+=e.am(n+1,2*e[n],t,2*n+1,r,e.t-n-1))>=e.DV&&(t[n+e.t]-=e.DV,t[n+e.t+1]=1)}t.t>0&&(t[t.t-1]+=e.am(n,e[n],t,2*n,0,1)),t.s=0,t.clamp()},s.prototype.divRemTo=function(t,e,n){var r=t.abs();if(!(r.t<=0)){var o=this.abs();if(o.t<r.t)return null!=e&&e.fromInt(0),void(null!=n&&this.copyTo(n));null==n&&(n=l());var i=l(),a=this.s,u=t.s,c=this.DB-m(r[r.t-1]);c>0?(r.lShiftTo(c,i),o.lShiftTo(c,n)):(r.copyTo(i),o.copyTo(n));var h=i.t,p=i[h-1];if(0!=p){var d=p*(1<<this.F1)+(h>1?i[h-2]>>this.F2:0),f=this.FV/d,g=(1<<this.F1)/d,v=1<<this.F2,y=n.t,w=y-h,b=null==e?l():e;for(i.dlShiftTo(w,b),n.compareTo(b)>=0&&(n[n.t++]=1,n.subTo(b,n)),s.ONE.dlShiftTo(h,b),b.subTo(i,i);i.t<h;)i[i.t++]=0;for(;--w>=0;){var S=n[--y]==p?this.DM:Math.floor(n[y]*f+(n[y-1]+v)*g);if((n[y]+=i.am(0,S,n,w,0,h))<S)for(i.dlShiftTo(w,b),n.subTo(b,n);n[y]<--S;)n.subTo(b,n)}null!=e&&(n.drShiftTo(h,e),a!=u&&s.ZERO.subTo(e,e)),n.t=h,n.clamp(),c>0&&n.rShiftTo(c,n),a<0&&s.ZERO.subTo(n,n)}}},s.prototype.invDigit=function(){if(this.t<1)return 0;var t=this[0];if(0==(1&t))return 0;var e=3&t;return(e=(e=(e=(e=e*(2-(15&t)*e)&15)*(2-(255&t)*e)&255)*(2-((65535&t)*e&65535))&65535)*(2-t*e%this.DV)%this.DV)>0?this.DV-e:-e},s.prototype.isEven=function(){return 0==(this.t>0?1&this[0]:this.s)},s.prototype.exp=function(t,e){if(t>4294967295||t<1)return s.ONE;var n=l(),r=l(),o=e.convert(this),i=m(t)-1;for(o.copyTo(n);--i>=0;)if(e.sqrTo(n,r),(t&1<<i)>0)e.mulTo(r,o,n);else{var a=n;n=r,r=a}return e.revert(n)},s.prototype.toString=function(t){if(this.s<0)return"-"+this.negate().toString(t);var e;if(16==t)e=4;else if(8==t)e=3;else if(2==t)e=1;else if(32==t)e=5;else{if(4!=t)return this.toRadix(t);e=2}var n,r=(1<<e)-1,o=!1,i="",a=this.t,s=this.DB-a*this.DB%e;if(a-- >0)for(s<this.DB&&(n=this[a]>>s)>0&&(o=!0,i=p(n));a>=0;)s<e?(n=(this[a]&(1<<s)-1)<<e-s,n|=this[--a]>>(s+=this.DB-e)):(n=this[a]>>(s-=e)&r,s<=0&&(s+=this.DB,--a)),n>0&&(o=!0),o&&(i+=p(n));return o?i:"0"},s.prototype.negate=function(){var t=l();return s.ZERO.subTo(this,t),t},s.prototype.abs=function(){return this.s<0?this.negate():this},s.prototype.compareTo=function(t){var e=this.s-t.s;if(0!=e)return e;var n=this.t;if(0!=(e=n-t.t))return this.s<0?-e:e;for(;--n>=0;)if(0!=(e=this[n]-t[n]))return e;return 0},s.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+m(this[this.t-1]^this.s&this.DM)},s.prototype.mod=function(t){var e=l();return this.abs().divRemTo(t,null,e),this.s<0&&e.compareTo(s.ZERO)>0&&t.subTo(e,e),e},s.prototype.modPowInt=function(t,e){var n;return n=t<256||e.isEven()?new g(e):new v(e),this.exp(t,n)},s.ZERO=f(0),s.ONE=f(1),x.prototype.convert=_,x.prototype.revert=_,x.prototype.mulTo=function(t,e,n){t.multiplyTo(e,n)},x.prototype.sqrTo=function(t,e){t.squareTo(e)},T.prototype.convert=function(t){if(t.s<0||t.t>2*this.m.t)return t.mod(this.m);if(t.compareTo(this.m)<0)return t;var e=l();return t.copyTo(e),this.reduce(e),e},T.prototype.revert=function(t){return t},T.prototype.reduce=function(t){for(t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);t.compareTo(this.r2)<0;)t.dAddOffset(1,this.m.t+1);for(t.subTo(this.r2,t);t.compareTo(this.m)>=0;)t.subTo(this.m,t)},T.prototype.mulTo=function(t,e,n){t.multiplyTo(e,n),this.reduce(n)},T.prototype.sqrTo=function(t,e){t.squareTo(e),this.reduce(e)};var C=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],I=(1<<26)/C[C.length-1];s.prototype.chunkSize=function(t){return Math.floor(Math.LN2*this.DB/Math.log(t))},s.prototype.toRadix=function(t){if(null==t&&(t=10),0==this.signum()||t<2||t>36)return"0";var e=this.chunkSize(t),n=Math.pow(t,e),r=f(n),o=l(),i=l(),a="";for(this.divRemTo(r,o,i);o.signum()>0;)a=(n+i.intValue()).toString(t).substr(1)+a,o.divRemTo(r,o,i);return i.intValue().toString(t)+a},s.prototype.fromRadix=function(t,e){this.fromInt(0),null==e&&(e=10);for(var n=this.chunkSize(e),r=Math.pow(e,n),o=!1,i=0,a=0,l=0;l<t.length;++l){var u=d(t,l);u<0?"-"==t.charAt(l)&&0==this.signum()&&(o=!0):(a=e*a+u,++i>=n&&(this.dMultiply(r),this.dAddOffset(a,0),i=0,a=0))}i>0&&(this.dMultiply(Math.pow(e,i)),this.dAddOffset(a,0)),o&&s.ZERO.subTo(this,this)},s.prototype.fromNumber=function(t,e,n){if("number"==typeof e)if(t<2)this.fromInt(1);else for(this.fromNumber(t,n),this.testBit(t-1)||this.bitwiseTo(s.ONE.shiftLeft(t-1),w,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(s.ONE.shiftLeft(t-1),this);else{var r=new Array,o=7&t;r.length=1+(t>>3),e.nextBytes(r),o>0?r[0]&=(1<<o)-1:r[0]=0,this.fromString(r,256)}},s.prototype.bitwiseTo=function(t,e,n){var r,o,i=Math.min(t.t,this.t);for(r=0;r<i;++r)n[r]=e(this[r],t[r]);if(t.t<this.t){for(o=t.s&this.DM,r=i;r<this.t;++r)n[r]=e(this[r],o);n.t=this.t}else{for(o=this.s&this.DM,r=i;r<t.t;++r)n[r]=e(o,t[r]);n.t=t.t}n.s=e(this.s,t.s),n.clamp()},s.prototype.changeBit=function(t,e){var n=s.ONE.shiftLeft(t);return this.bitwiseTo(n,e,n),n},s.prototype.addTo=function(t,e){for(var n=0,r=0,o=Math.min(t.t,this.t);n<o;)r+=this[n]+t[n],e[n++]=r&this.DM,r>>=this.DB;if(t.t<this.t){for(r+=t.s;n<this.t;)r+=this[n],e[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;n<t.t;)r+=t[n],e[n++]=r&this.DM,r>>=this.DB;r+=t.s}e.s=r<0?-1:0,r>0?e[n++]=r:r<-1&&(e[n++]=this.DV+r),e.t=n,e.clamp()},s.prototype.dMultiply=function(t){this[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()},s.prototype.dAddOffset=function(t,e){if(0!=t){for(;this.t<=e;)this[this.t++]=0;for(this[e]+=t;this[e]>=this.DV;)this[e]-=this.DV,++e>=this.t&&(this[this.t++]=0),++this[e]}},s.prototype.multiplyLowerTo=function(t,e,n){var r,o=Math.min(this.t+t.t,e);for(n.s=0,n.t=o;o>0;)n[--o]=0;for(r=n.t-this.t;o<r;++o)n[o+this.t]=this.am(0,t[o],n,o,0,this.t);for(r=Math.min(t.t,e);o<r;++o)this.am(0,t[o],n,o,0,e-o);n.clamp()},s.prototype.multiplyUpperTo=function(t,e,n){--e;var r=n.t=this.t+t.t-e;for(n.s=0;--r>=0;)n[r]=0;for(r=Math.max(e-this.t,0);r<t.t;++r)n[this.t+r-e]=this.am(e-r,t[r],n,0,0,this.t+r-e);n.clamp(),n.drShiftTo(1,n)},s.prototype.modInt=function(t){if(t<=0)return 0;var e=this.DV%t,n=this.s<0?t-1:0;if(this.t>0)if(0==e)n=this[0]%t;else for(var r=this.t-1;r>=0;--r)n=(e*n+this[r])%t;return n},s.prototype.millerRabin=function(t){var e=this.subtract(s.ONE),n=e.getLowestSetBit();if(n<=0)return!1;var r=e.shiftRight(n);(t=t+1>>1)>C.length&&(t=C.length);for(var o=l(),i=0;i<t;++i){o.fromInt(C[Math.floor(Math.random()*C.length)]);var a=o.modPow(r,this);if(0!=a.compareTo(s.ONE)&&0!=a.compareTo(e)){for(var u=1;u++<n&&0!=a.compareTo(e);)if(0==(a=a.modPowInt(2,this)).compareTo(s.ONE))return!1;if(0!=a.compareTo(e))return!1}}return!0},s.prototype.clone=function(){var t=l();return this.copyTo(t),t},s.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},s.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24},s.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16},s.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},s.prototype.toByteArray=function(){var t=this.t,e=new Array;e[0]=this.s;var n,r=this.DB-t*this.DB%8,o=0;if(t-- >0)for(r<this.DB&&(n=this[t]>>r)!=(this.s&this.DM)>>r&&(e[o++]=n|this.s<<this.DB-r);t>=0;)r<8?(n=(this[t]&(1<<r)-1)<<8-r,n|=this[--t]>>(r+=this.DB-8)):(n=this[t]>>(r-=8)&255,r<=0&&(r+=this.DB,--t)),0!=(128&n)&&(n|=-256),0==o&&(128&this.s)!=(128&n)&&++o,(o>0||n!=this.s)&&(e[o++]=n);return e},s.prototype.equals=function(t){return 0==this.compareTo(t)},s.prototype.min=function(t){return this.compareTo(t)<0?this:t},s.prototype.max=function(t){return this.compareTo(t)>0?this:t},s.prototype.and=function(t){var e=l();return this.bitwiseTo(t,y,e),e},s.prototype.or=function(t){var e=l();return this.bitwiseTo(t,w,e),e},s.prototype.xor=function(t){var e=l();return this.bitwiseTo(t,b,e),e},s.prototype.andNot=function(t){var e=l();return this.bitwiseTo(t,S,e),e},s.prototype.not=function(){for(var t=l(),e=0;e<this.t;++e)t[e]=this.DM&~this[e];return t.t=this.t,t.s=~this.s,t},s.prototype.shiftLeft=function(t){var e=l();return t<0?this.rShiftTo(-t,e):this.lShiftTo(t,e),e},s.prototype.shiftRight=function(t){var e=l();return t<0?this.lShiftTo(-t,e):this.rShiftTo(t,e),e},s.prototype.getLowestSetBit=function(){for(var t=0;t<this.t;++t)if(0!=this[t])return t*this.DB+E(this[t]);return this.s<0?this.t*this.DB:-1},s.prototype.bitCount=function(){for(var t=0,e=this.s&this.DM,n=0;n<this.t;++n)t+=P(this[n]^e);return t},s.prototype.testBit=function(t){var e=Math.floor(t/this.DB);return e>=this.t?0!=this.s:0!=(this[e]&1<<t%this.DB)},s.prototype.setBit=function(t){return this.changeBit(t,w)},s.prototype.clearBit=function(t){return this.changeBit(t,S)},s.prototype.flipBit=function(t){return this.changeBit(t,b)},s.prototype.add=function(t){var e=l();return this.addTo(t,e),e},s.prototype.subtract=function(t){var e=l();return this.subTo(t,e),e},s.prototype.multiply=function(t){var e=l();return this.multiplyTo(t,e),e},s.prototype.divide=function(t){var e=l();return this.divRemTo(t,e,null),e},s.prototype.remainder=function(t){var e=l();return this.divRemTo(t,null,e),e},s.prototype.divideAndRemainder=function(t){var e=l(),n=l();return this.divRemTo(t,e,n),new Array(e,n)},s.prototype.modPow=function(t,e){var n,r,o=t.bitLength(),i=f(1);if(o<=0)return i;n=o<18?1:o<48?3:o<144?4:o<768?5:6,r=o<8?new g(e):e.isEven()?new T(e):new v(e);var a=new Array,s=3,u=n-1,c=(1<<n)-1;if(a[1]=r.convert(this),n>1){var h=l();for(r.sqrTo(a[1],h);s<=c;)a[s]=l(),r.mulTo(h,a[s-2],a[s]),s+=2}var p,d,y=t.t-1,w=!0,b=l();for(o=m(t[y])-1;y>=0;){for(o>=u?p=t[y]>>o-u&c:(p=(t[y]&(1<<o+1)-1)<<u-o,y>0&&(p|=t[y-1]>>this.DB+o-u)),s=n;0==(1&p);)p>>=1,--s;if((o-=s)<0&&(o+=this.DB,--y),w)a[p].copyTo(i),w=!1;else{for(;s>1;)r.sqrTo(i,b),r.sqrTo(b,i),s-=2;s>0?r.sqrTo(i,b):(d=i,i=b,b=d),r.mulTo(b,a[p],i)}for(;y>=0&&0==(t[y]&1<<o);)r.sqrTo(i,b),d=i,i=b,b=d,--o<0&&(o=this.DB-1,--y)}return r.revert(i)},s.prototype.modInverse=function(t){var e=t.isEven();if(this.isEven()&&e||0==t.signum())return s.ZERO;for(var n=t.clone(),r=this.clone(),o=f(1),i=f(0),a=f(0),l=f(1);0!=n.signum();){for(;n.isEven();)n.rShiftTo(1,n),e?(o.isEven()&&i.isEven()||(o.addTo(this,o),i.subTo(t,i)),o.rShiftTo(1,o)):i.isEven()||i.subTo(t,i),i.rShiftTo(1,i);for(;r.isEven();)r.rShiftTo(1,r),e?(a.isEven()&&l.isEven()||(a.addTo(this,a),l.subTo(t,l)),a.rShiftTo(1,a)):l.isEven()||l.subTo(t,l),l.rShiftTo(1,l);n.compareTo(r)>=0?(n.subTo(r,n),e&&o.subTo(a,o),i.subTo(l,i)):(r.subTo(n,r),e&&a.subTo(o,a),l.subTo(i,l))}return 0!=r.compareTo(s.ONE)?s.ZERO:l.compareTo(t)>=0?l.subtract(t):l.signum()<0?(l.addTo(t,l),l.signum()<0?l.add(t):l):l},s.prototype.pow=function(t){return this.exp(t,new x)},s.prototype.gcd=function(t){var e=this.s<0?this.negate():this.clone(),n=t.s<0?t.negate():t.clone();if(e.compareTo(n)<0){var r=e;e=n,n=r}var o=e.getLowestSetBit(),i=n.getLowestSetBit();if(i<0)return e;for(o<i&&(i=o),i>0&&(e.rShiftTo(i,e),n.rShiftTo(i,n));e.signum()>0;)(o=e.getLowestSetBit())>0&&e.rShiftTo(o,e),(o=n.getLowestSetBit())>0&&n.rShiftTo(o,n),e.compareTo(n)>=0?(e.subTo(n,e),e.rShiftTo(1,e)):(n.subTo(e,n),n.rShiftTo(1,n));return i>0&&n.lShiftTo(i,n),n},s.prototype.isProbablePrime=function(t){var e,n=this.abs();if(1==n.t&&n[0]<=C[C.length-1]){for(e=0;e<C.length;++e)if(n[0]==C[e])return!0;return!1}if(n.isEven())return!1;for(e=1;e<C.length;){for(var r=C[e],o=e+1;o<C.length&&r<I;)r*=C[o++];for(r=n.modInt(r);e<o;)if(r%C[e++]==0)return!1}return n.millerRabin(t)},s.prototype.square=function(){var t=l();return this.squareTo(t),t};var D=s;D.prototype.IsNegative=function(){return-1==this.compareTo(D.ZERO)},D.op_Equality=function(t,e){return 0==t.compareTo(e)},D.op_Inequality=function(t,e){return 0!=t.compareTo(e)},D.op_GreaterThan=function(t,e){return t.compareTo(e)>0},D.op_LessThan=function(t,e){return t.compareTo(e)<0},D.op_Addition=function(t,e){return new D(t,void 0,void 0).add(new D(e,void 0,void 0))},D.op_Subtraction=function(t,e){return new D(t,void 0,void 0).subtract(new D(e,void 0,void 0))},D.Int128Mul=function(t,e){return new D(t,void 0,void 0).multiply(new D(e,void 0,void 0))},D.op_Division=function(t,e){return t.divide(e)},D.prototype.ToDouble=function(){return parseFloat(this.toString())};var k=function(t,e){var n;if(void 0===Object.getOwnPropertyNames){for(n in e.prototype)void 0!==t.prototype[n]&&t.prototype[n]!==Object.prototype[n]||(t.prototype[n]=e.prototype[n]);for(n in e)void 0===t[n]&&(t[n]=e[n]);t.$baseCtor=e}else{for(var r=Object.getOwnPropertyNames(e.prototype),o=0;o<r.length;o++)void 0===Object.getOwnPropertyDescriptor(t.prototype,r[o])&&Object.defineProperty(t.prototype,r[o],Object.getOwnPropertyDescriptor(e.prototype,r[o]));for(n in e)void 0===t[n]&&(t[n]=e[n]);t.$baseCtor=e}};n.Path=function(){return[]},n.Path.prototype.push=Array.prototype.push,n.Paths=function(){return[]},n.Paths.prototype.push=Array.prototype.push,n.DoublePoint=function(){var t=arguments;this.X=0,this.Y=0,1===t.length?(this.X=t[0].X,this.Y=t[0].Y):2===t.length&&(this.X=t[0],this.Y=t[1])},n.DoublePoint0=function(){this.X=0,this.Y=0},n.DoublePoint0.prototype=n.DoublePoint.prototype,n.DoublePoint1=function(t){this.X=t.X,this.Y=t.Y},n.DoublePoint1.prototype=n.DoublePoint.prototype,n.DoublePoint2=function(t,e){this.X=t,this.Y=e},n.DoublePoint2.prototype=n.DoublePoint.prototype,n.PolyNode=function(){this.m_Parent=null,this.m_polygon=new n.Path,this.m_Index=0,this.m_jointype=0,this.m_endtype=0,this.m_Childs=[],this.IsOpen=!1},n.PolyNode.prototype.IsHoleNode=function(){for(var t=!0,e=this.m_Parent;null!==e;)t=!t,e=e.m_Parent;return t},n.PolyNode.prototype.ChildCount=function(){return this.m_Childs.length},n.PolyNode.prototype.Contour=function(){return this.m_polygon},n.PolyNode.prototype.AddChild=function(t){var e=this.m_Childs.length;this.m_Childs.push(t),t.m_Parent=this,t.m_Index=e},n.PolyNode.prototype.GetNext=function(){return this.m_Childs.length>0?this.m_Childs[0]:this.GetNextSiblingUp()},n.PolyNode.prototype.GetNextSiblingUp=function(){return null===this.m_Parent?null:this.m_Index===this.m_Parent.m_Childs.length-1?this.m_Parent.GetNextSiblingUp():this.m_Parent.m_Childs[this.m_Index+1]},n.PolyNode.prototype.Childs=function(){return this.m_Childs},n.PolyNode.prototype.Parent=function(){return this.m_Parent},n.PolyNode.prototype.IsHole=function(){return this.IsHoleNode()},n.PolyTree=function(){this.m_AllPolys=[],n.PolyNode.call(this)},n.PolyTree.prototype.Clear=function(){for(var t=0,e=this.m_AllPolys.length;t<e;t++)this.m_AllPolys[t]=null;this.m_AllPolys.length=0,this.m_Childs.length=0},n.PolyTree.prototype.GetFirst=function(){return this.m_Childs.length>0?this.m_Childs[0]:null},n.PolyTree.prototype.Total=function(){var t=this.m_AllPolys.length;return t>0&&this.m_Childs[0]!==this.m_AllPolys[0]&&t--,t},k(n.PolyTree,n.PolyNode),n.Math_Abs_Int64=n.Math_Abs_Int32=n.Math_Abs_Double=function(t){return Math.abs(t)},n.Math_Max_Int32_Int32=function(t,e){return Math.max(t,e)},a.msie||a.opera||a.safari?n.Cast_Int32=function(t){return 0|t}:n.Cast_Int32=function(t){return~~t},void 0===Number.toInteger&&(Number.toInteger=null),a.chrome?n.Cast_Int64=function(t){return t<-2147483648||t>2147483647?t<0?Math.ceil(t):Math.floor(t):~~t}:a.firefox&&"function"==typeof Number.toInteger?n.Cast_Int64=function(t){return Number.toInteger(t)}:a.msie7||a.msie8?n.Cast_Int64=function(t){return parseInt(t,10)}:a.msie?n.Cast_Int64=function(t){return t<-2147483648||t>2147483647?t<0?Math.ceil(t):Math.floor(t):0|t}:n.Cast_Int64=function(t){return t<0?Math.ceil(t):Math.floor(t)},n.Clear=function(t){t.length=0},n.PI=3.141592653589793,n.PI2=6.283185307179586,n.IntPoint=function(){var t=arguments,e=t.length;if(this.X=0,this.Y=0,n.use_xyz)if(this.Z=0,3===e)this.X=t[0],this.Y=t[1],this.Z=t[2];else if(2===e)this.X=t[0],this.Y=t[1],this.Z=0;else if(1===e)if(t[0]instanceof n.DoublePoint){var r=t[0];this.X=n.Clipper.Round(r.X),this.Y=n.Clipper.Round(r.Y),this.Z=0}else{void 0===(o=t[0]).Z&&(o.Z=0),this.X=o.X,this.Y=o.Y,this.Z=o.Z}else this.X=0,this.Y=0,this.Z=0;else if(2===e)this.X=t[0],this.Y=t[1];else if(1===e)if(t[0]instanceof n.DoublePoint){r=t[0];this.X=n.Clipper.Round(r.X),this.Y=n.Clipper.Round(r.Y)}else{var o=t[0];this.X=o.X,this.Y=o.Y}else this.X=0,this.Y=0},n.IntPoint.op_Equality=function(t,e){return t.X===e.X&&t.Y===e.Y},n.IntPoint.op_Inequality=function(t,e){return t.X!==e.X||t.Y!==e.Y},n.IntPoint0=function(){this.X=0,this.Y=0,n.use_xyz&&(this.Z=0)},n.IntPoint0.prototype=n.IntPoint.prototype,n.IntPoint1=function(t){this.X=t.X,this.Y=t.Y,n.use_xyz&&(void 0===t.Z?this.Z=0:this.Z=t.Z)},n.IntPoint1.prototype=n.IntPoint.prototype,n.IntPoint1dp=function(t){this.X=n.Clipper.Round(t.X),this.Y=n.Clipper.Round(t.Y),n.use_xyz&&(this.Z=0)},n.IntPoint1dp.prototype=n.IntPoint.prototype,n.IntPoint2=function(t,e,r){this.X=t,this.Y=e,n.use_xyz&&(this.Z=void 0===r?0:r)},n.IntPoint2.prototype=n.IntPoint.prototype,n.IntRect=function(){var t=arguments,e=t.length;if(4===e)this.left=t[0],this.top=t[1],this.right=t[2],this.bottom=t[3];else if(1===e){var n=t[0];this.left=n.left,this.top=n.top,this.right=n.right,this.bottom=n.bottom}else this.left=0,this.top=0,this.right=0,this.bottom=0},n.IntRect0=function(){this.left=0,this.top=0,this.right=0,this.bottom=0},n.IntRect0.prototype=n.IntRect.prototype,n.IntRect1=function(t){this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom},n.IntRect1.prototype=n.IntRect.prototype,n.IntRect4=function(t,e,n,r){this.left=t,this.top=e,this.right=n,this.bottom=r},n.IntRect4.prototype=n.IntRect.prototype,n.ClipType={ctIntersection:0,ctUnion:1,ctDifference:2,ctXor:3},n.PolyType={ptSubject:0,ptClip:1},n.PolyFillType={pftEvenOdd:0,pftNonZero:1,pftPositive:2,pftNegative:3},n.JoinType={jtSquare:0,jtRound:1,jtMiter:2},n.EndType={etOpenSquare:0,etOpenRound:1,etOpenButt:2,etClosedLine:3,etClosedPolygon:4},n.EdgeSide={esLeft:0,esRight:1},n.Direction={dRightToLeft:0,dLeftToRight:1},n.TEdge=function(){this.Bot=new n.IntPoint0,this.Curr=new n.IntPoint0,this.Top=new n.IntPoint0,this.Delta=new n.IntPoint0,this.Dx=0,this.PolyTyp=n.PolyType.ptSubject,this.Side=n.EdgeSide.esLeft,this.WindDelta=0,this.WindCnt=0,this.WindCnt2=0,this.OutIdx=0,this.Next=null,this.Prev=null,this.NextInLML=null,this.NextInAEL=null,this.PrevInAEL=null,this.NextInSEL=null,this.PrevInSEL=null},n.IntersectNode=function(){this.Edge1=null,this.Edge2=null,this.Pt=new n.IntPoint0},n.MyIntersectNodeSort=function(){},n.MyIntersectNodeSort.Compare=function(t,e){var n=e.Pt.Y-t.Pt.Y;return n>0?1:n<0?-1:0},n.LocalMinima=function(){this.Y=0,this.LeftBound=null,this.RightBound=null,this.Next=null},n.Scanbeam=function(){this.Y=0,this.Next=null},n.Maxima=function(){this.X=0,this.Next=null,this.Prev=null},n.OutRec=function(){this.Idx=0,this.IsHole=!1,this.IsOpen=!1,this.FirstLeft=null,this.Pts=null,this.BottomPt=null,this.PolyNode=null},n.OutPt=function(){this.Idx=0,this.Pt=new n.IntPoint0,this.Next=null,this.Prev=null},n.Join=function(){this.OutPt1=null,this.OutPt2=null,this.OffPt=new n.IntPoint0},n.ClipperBase=function(){this.m_MinimaList=null,this.m_CurrentLM=null,this.m_edges=new Array,this.m_UseFullRange=!1,this.m_HasOpenPaths=!1,this.PreserveCollinear=!1,this.m_Scanbeam=null,this.m_PolyOuts=null,this.m_ActiveEdges=null},n.ClipperBase.horizontal=-9007199254740992,n.ClipperBase.Skip=-2,n.ClipperBase.Unassigned=-1,n.ClipperBase.tolerance=1e-20,n.ClipperBase.loRange=47453132,n.ClipperBase.hiRange=0xfffffffffffff,n.ClipperBase.near_zero=function(t){return t>-n.ClipperBase.tolerance&&t<n.ClipperBase.tolerance},n.ClipperBase.IsHorizontal=function(t){return 0===t.Delta.Y},n.ClipperBase.prototype.PointIsVertex=function(t,e){var r=e;do{if(n.IntPoint.op_Equality(r.Pt,t))return!0;r=r.Next}while(r!==e);return!1},n.ClipperBase.prototype.PointOnLineSegment=function(t,e,n,r){return r?t.X===e.X&&t.Y===e.Y||t.X===n.X&&t.Y===n.Y||t.X>e.X==t.X<n.X&&t.Y>e.Y==t.Y<n.Y&&D.op_Equality(D.Int128Mul(t.X-e.X,n.Y-e.Y),D.Int128Mul(n.X-e.X,t.Y-e.Y)):t.X===e.X&&t.Y===e.Y||t.X===n.X&&t.Y===n.Y||t.X>e.X==t.X<n.X&&t.Y>e.Y==t.Y<n.Y&&(t.X-e.X)*(n.Y-e.Y)==(n.X-e.X)*(t.Y-e.Y)},n.ClipperBase.prototype.PointOnPolygon=function(t,e,n){for(var r=e;;){if(this.PointOnLineSegment(t,r.Pt,r.Next.Pt,n))return!0;if((r=r.Next)===e)break}return!1},n.ClipperBase.prototype.SlopesEqual=n.ClipperBase.SlopesEqual=function(){var t,e,r,o,i,a,s=arguments,l=s.length;return 3===l?(t=s[0],e=s[1],s[2]?D.op_Equality(D.Int128Mul(t.Delta.Y,e.Delta.X),D.Int128Mul(t.Delta.X,e.Delta.Y)):n.Cast_Int64(t.Delta.Y*e.Delta.X)===n.Cast_Int64(t.Delta.X*e.Delta.Y)):4===l?(r=s[0],o=s[1],i=s[2],s[3]?D.op_Equality(D.Int128Mul(r.Y-o.Y,o.X-i.X),D.Int128Mul(r.X-o.X,o.Y-i.Y)):n.Cast_Int64((r.Y-o.Y)*(o.X-i.X))-n.Cast_Int64((r.X-o.X)*(o.Y-i.Y))==0):(r=s[0],o=s[1],i=s[2],a=s[3],s[4]?D.op_Equality(D.Int128Mul(r.Y-o.Y,i.X-a.X),D.Int128Mul(r.X-o.X,i.Y-a.Y)):n.Cast_Int64((r.Y-o.Y)*(i.X-a.X))-n.Cast_Int64((r.X-o.X)*(i.Y-a.Y))==0)},n.ClipperBase.SlopesEqual3=function(t,e,r){return r?D.op_Equality(D.Int128Mul(t.Delta.Y,e.Delta.X),D.Int128Mul(t.Delta.X,e.Delta.Y)):n.Cast_Int64(t.Delta.Y*e.Delta.X)===n.Cast_Int64(t.Delta.X*e.Delta.Y)},n.ClipperBase.SlopesEqual4=function(t,e,r,o){return o?D.op_Equality(D.Int128Mul(t.Y-e.Y,e.X-r.X),D.Int128Mul(t.X-e.X,e.Y-r.Y)):n.Cast_Int64((t.Y-e.Y)*(e.X-r.X))-n.Cast_Int64((t.X-e.X)*(e.Y-r.Y))==0},n.ClipperBase.SlopesEqual5=function(t,e,r,o,i){return i?D.op_Equality(D.Int128Mul(t.Y-e.Y,r.X-o.X),D.Int128Mul(t.X-e.X,r.Y-o.Y)):n.Cast_Int64((t.Y-e.Y)*(r.X-o.X))-n.Cast_Int64((t.X-e.X)*(r.Y-o.Y))==0},n.ClipperBase.prototype.Clear=function(){this.DisposeLocalMinimaList();for(var t=0,e=this.m_edges.length;t<e;++t){for(var r=0,o=this.m_edges[t].length;r<o;++r)this.m_edges[t][r]=null;n.Clear(this.m_edges[t])}n.Clear(this.m_edges),this.m_UseFullRange=!1,this.m_HasOpenPaths=!1},n.ClipperBase.prototype.DisposeLocalMinimaList=function(){for(;null!==this.m_MinimaList;){var t=this.m_MinimaList.Next;this.m_MinimaList=null,this.m_MinimaList=t}this.m_CurrentLM=null},n.ClipperBase.prototype.RangeTest=function(t,e){e.Value?(t.X>n.ClipperBase.hiRange||t.Y>n.ClipperBase.hiRange||-t.X>n.ClipperBase.hiRange||-t.Y>n.ClipperBase.hiRange)&&n.Error("Coordinate outside allowed range in RangeTest()."):(t.X>n.ClipperBase.loRange||t.Y>n.ClipperBase.loRange||-t.X>n.ClipperBase.loRange||-t.Y>n.ClipperBase.loRange)&&(e.Value=!0,this.RangeTest(t,e))},n.ClipperBase.prototype.InitEdge=function(t,e,r,o){t.Next=e,t.Prev=r,t.Curr.X=o.X,t.Curr.Y=o.Y,n.use_xyz&&(t.Curr.Z=o.Z),t.OutIdx=-1},n.ClipperBase.prototype.InitEdge2=function(t,e){t.Curr.Y>=t.Next.Curr.Y?(t.Bot.X=t.Curr.X,t.Bot.Y=t.Curr.Y,n.use_xyz&&(t.Bot.Z=t.Curr.Z),t.Top.X=t.Next.Curr.X,t.Top.Y=t.Next.Curr.Y,n.use_xyz&&(t.Top.Z=t.Next.Curr.Z)):(t.Top.X=t.Curr.X,t.Top.Y=t.Curr.Y,n.use_xyz&&(t.Top.Z=t.Curr.Z),t.Bot.X=t.Next.Curr.X,t.Bot.Y=t.Next.Curr.Y,n.use_xyz&&(t.Bot.Z=t.Next.Curr.Z)),this.SetDx(t),t.PolyTyp=e},n.ClipperBase.prototype.FindNextLocMin=function(t){for(var e;;){for(;n.IntPoint.op_Inequality(t.Bot,t.Prev.Bot)||n.IntPoint.op_Equality(t.Curr,t.Top);)t=t.Next;if(t.Dx!==n.ClipperBase.horizontal&&t.Prev.Dx!==n.ClipperBase.horizontal)break;for(;t.Prev.Dx===n.ClipperBase.horizontal;)t=t.Prev;for(e=t;t.Dx===n.ClipperBase.horizontal;)t=t.Next;if(t.Top.Y!==t.Prev.Bot.Y){e.Prev.Bot.X<t.Bot.X&&(t=e);break}}return t},n.ClipperBase.prototype.ProcessBound=function(t,e){var r,o,i=t;if(i.OutIdx===n.ClipperBase.Skip){if(t=i,e){for(;t.Top.Y===t.Next.Bot.Y;)t=t.Next;for(;t!==i&&t.Dx===n.ClipperBase.horizontal;)t=t.Prev}else{for(;t.Top.Y===t.Prev.Bot.Y;)t=t.Prev;for(;t!==i&&t.Dx===n.ClipperBase.horizontal;)t=t.Next}if(t===i)i=e?t.Next:t.Prev;else{t=e?i.Next:i.Prev;var a=new n.LocalMinima;a.Next=null,a.Y=t.Bot.Y,a.LeftBound=null,a.RightBound=t,t.WindDelta=0,i=this.ProcessBound(t,e),this.InsertLocalMinima(a)}return i}if(t.Dx===n.ClipperBase.horizontal&&((r=e?t.Prev:t.Next).Dx===n.ClipperBase.horizontal?r.Bot.X!==t.Bot.X&&r.Top.X!==t.Bot.X&&this.ReverseHorizontal(t):r.Bot.X!==t.Bot.X&&this.ReverseHorizontal(t)),r=t,e){for(;i.Top.Y===i.Next.Bot.Y&&i.Next.OutIdx!==n.ClipperBase.Skip;)i=i.Next;if(i.Dx===n.ClipperBase.horizontal&&i.Next.OutIdx!==n.ClipperBase.Skip){for(o=i;o.Prev.Dx===n.ClipperBase.horizontal;)o=o.Prev;o.Prev.Top.X>i.Next.Top.X&&(i=o.Prev)}for(;t!==i;)t.NextInLML=t.Next,t.Dx===n.ClipperBase.horizontal&&t!==r&&t.Bot.X!==t.Prev.Top.X&&this.ReverseHorizontal(t),t=t.Next;t.Dx===n.ClipperBase.horizontal&&t!==r&&t.Bot.X!==t.Prev.Top.X&&this.ReverseHorizontal(t),i=i.Next}else{for(;i.Top.Y===i.Prev.Bot.Y&&i.Prev.OutIdx!==n.ClipperBase.Skip;)i=i.Prev;if(i.Dx===n.ClipperBase.horizontal&&i.Prev.OutIdx!==n.ClipperBase.Skip){for(o=i;o.Next.Dx===n.ClipperBase.horizontal;)o=o.Next;(o.Next.Top.X===i.Prev.Top.X||o.Next.Top.X>i.Prev.Top.X)&&(i=o.Next)}for(;t!==i;)t.NextInLML=t.Prev,t.Dx===n.ClipperBase.horizontal&&t!==r&&t.Bot.X!==t.Next.Top.X&&this.ReverseHorizontal(t),t=t.Prev;t.Dx===n.ClipperBase.horizontal&&t!==r&&t.Bot.X!==t.Next.Top.X&&this.ReverseHorizontal(t),i=i.Prev}return i},n.ClipperBase.prototype.AddPath=function(t,e,r){n.use_lines?r||e!==n.PolyType.ptClip||n.Error("AddPath: Open paths must be subject."):r||n.Error("AddPath: Open paths have been disabled.");var o=t.length-1;if(r)for(;o>0&&n.IntPoint.op_Equality(t[o],t[0]);)--o;for(;o>0&&n.IntPoint.op_Equality(t[o],t[o-1]);)--o;if(r&&o<2||!r&&o<1)return!1;for(var i=new Array,a=0;a<=o;a++)i.push(new n.TEdge);var s=!0;i[1].Curr.X=t[1].X,i[1].Curr.Y=t[1].Y,n.use_xyz&&(i[1].Curr.Z=t[1].Z);var l={Value:this.m_UseFullRange};this.RangeTest(t[0],l),this.m_UseFullRange=l.Value,l.Value=this.m_UseFullRange,this.RangeTest(t[o],l),this.m_UseFullRange=l.Value,this.InitEdge(i[0],i[1],i[o],t[0]),this.InitEdge(i[o],i[0],i[o-1],t[o]);for(a=o-1;a>=1;--a)l.Value=this.m_UseFullRange,this.RangeTest(t[a],l),this.m_UseFullRange=l.Value,this.InitEdge(i[a],i[a+1],i[a-1],t[a]);for(var u,c=i[0],h=c,p=c;;)if(h.Curr!==h.Next.Curr||!r&&h.Next===c){if(h.Prev===h.Next)break;if(!r||!n.ClipperBase.SlopesEqual4(h.Prev.Curr,h.Curr,h.Next.Curr,this.m_UseFullRange)||this.PreserveCollinear&&this.Pt2IsBetweenPt1AndPt3(h.Prev.Curr,h.Curr,h.Next.Curr)){if((h=h.Next)===p||!r&&h.Next===c)break}else h===c&&(c=h.Next),p=h=(h=this.RemoveEdge(h)).Prev}else{if(h===h.Next)break;h===c&&(c=h.Next),p=h=this.RemoveEdge(h)}if(!r&&h===h.Next||r&&h.Prev===h.Next)return!1;r||(this.m_HasOpenPaths=!0,c.Prev.OutIdx=n.ClipperBase.Skip),h=c;do{this.InitEdge2(h,e),h=h.Next,s&&h.Curr.Y!==c.Curr.Y&&(s=!1)}while(h!==c);if(s){if(r)return!1;for(h.Prev.OutIdx=n.ClipperBase.Skip,(f=new n.LocalMinima).Next=null,f.Y=h.Bot.Y,f.LeftBound=null,f.RightBound=h,f.RightBound.Side=n.EdgeSide.esRight,f.RightBound.WindDelta=0;h.Bot.X!==h.Prev.Top.X&&this.ReverseHorizontal(h),h.Next.OutIdx!==n.ClipperBase.Skip;)h.NextInLML=h.Next,h=h.Next;return this.InsertLocalMinima(f),this.m_edges.push(i),!0}this.m_edges.push(i);var d=null;for(n.IntPoint.op_Equality(h.Prev.Bot,h.Prev.Top)&&(h=h.Next);(h=this.FindNextLocMin(h))!==d;){var f;null===d&&(d=h),(f=new n.LocalMinima).Next=null,f.Y=h.Bot.Y,h.Dx<h.Prev.Dx?(f.LeftBound=h.Prev,f.RightBound=h,u=!1):(f.LeftBound=h,f.RightBound=h.Prev,u=!0),f.LeftBound.Side=n.EdgeSide.esLeft,f.RightBound.Side=n.EdgeSide.esRight,r?f.LeftBound.Next===f.RightBound?f.LeftBound.WindDelta=-1:f.LeftBound.WindDelta=1:f.LeftBound.WindDelta=0,f.RightBound.WindDelta=-f.LeftBound.WindDelta,(h=this.ProcessBound(f.LeftBound,u)).OutIdx===n.ClipperBase.Skip&&(h=this.ProcessBound(h,u));var m=this.ProcessBound(f.RightBound,!u);m.OutIdx===n.ClipperBase.Skip&&(m=this.ProcessBound(m,!u)),f.LeftBound.OutIdx===n.ClipperBase.Skip?f.LeftBound=null:f.RightBound.OutIdx===n.ClipperBase.Skip&&(f.RightBound=null),this.InsertLocalMinima(f),u||(h=m)}return!0},n.ClipperBase.prototype.AddPaths=function(t,e,n){for(var r=!1,o=0,i=t.length;o<i;++o)this.AddPath(t[o],e,n)&&(r=!0);return r},n.ClipperBase.prototype.Pt2IsBetweenPt1AndPt3=function(t,e,r){return!(n.IntPoint.op_Equality(t,r)||n.IntPoint.op_Equality(t,e)||n.IntPoint.op_Equality(r,e))&&(t.X!==r.X?e.X>t.X==e.X<r.X:e.Y>t.Y==e.Y<r.Y)},n.ClipperBase.prototype.RemoveEdge=function(t){t.Prev.Next=t.Next,t.Next.Prev=t.Prev;var e=t.Next;return t.Prev=null,e},n.ClipperBase.prototype.SetDx=function(t){t.Delta.X=t.Top.X-t.Bot.X,t.Delta.Y=t.Top.Y-t.Bot.Y,0===t.Delta.Y?t.Dx=n.ClipperBase.horizontal:t.Dx=t.Delta.X/t.Delta.Y},n.ClipperBase.prototype.InsertLocalMinima=function(t){if(null===this.m_MinimaList)this.m_MinimaList=t;else if(t.Y>=this.m_MinimaList.Y)t.Next=this.m_MinimaList,this.m_MinimaList=t;else{for(var e=this.m_MinimaList;null!==e.Next&&t.Y<e.Next.Y;)e=e.Next;t.Next=e.Next,e.Next=t}},n.ClipperBase.prototype.PopLocalMinima=function(t,e){return e.v=this.m_CurrentLM,null!==this.m_CurrentLM&&this.m_CurrentLM.Y===t&&(this.m_CurrentLM=this.m_CurrentLM.Next,!0)},n.ClipperBase.prototype.ReverseHorizontal=function(t){var e=t.Top.X;t.Top.X=t.Bot.X,t.Bot.X=e,n.use_xyz&&(e=t.Top.Z,t.Top.Z=t.Bot.Z,t.Bot.Z=e)},n.ClipperBase.prototype.Reset=function(){if(this.m_CurrentLM=this.m_MinimaList,null!==this.m_CurrentLM){this.m_Scanbeam=null;for(var t=this.m_MinimaList;null!==t;){this.InsertScanbeam(t.Y);var e=t.LeftBound;null!==e&&(e.Curr.X=e.Bot.X,e.Curr.Y=e.Bot.Y,n.use_xyz&&(e.Curr.Z=e.Bot.Z),e.OutIdx=n.ClipperBase.Unassigned),null!==(e=t.RightBound)&&(e.Curr.X=e.Bot.X,e.Curr.Y=e.Bot.Y,n.use_xyz&&(e.Curr.Z=e.Bot.Z),e.OutIdx=n.ClipperBase.Unassigned),t=t.Next}this.m_ActiveEdges=null}},n.ClipperBase.prototype.InsertScanbeam=function(t){if(null===this.m_Scanbeam)this.m_Scanbeam=new n.Scanbeam,this.m_Scanbeam.Next=null,this.m_Scanbeam.Y=t;else if(t>this.m_Scanbeam.Y){var e=new n.Scanbeam;e.Y=t,e.Next=this.m_Scanbeam,this.m_Scanbeam=e}else{for(var r=this.m_Scanbeam;null!==r.Next&&t<=r.Next.Y;)r=r.Next;if(t===r.Y)return;var o=new n.Scanbeam;o.Y=t,o.Next=r.Next,r.Next=o}},n.ClipperBase.prototype.PopScanbeam=function(t){return null===this.m_Scanbeam?(t.v=0,!1):(t.v=this.m_Scanbeam.Y,this.m_Scanbeam=this.m_Scanbeam.Next,!0)},n.ClipperBase.prototype.LocalMinimaPending=function(){return null!==this.m_CurrentLM},n.ClipperBase.prototype.CreateOutRec=function(){var t=new n.OutRec;return t.Idx=n.ClipperBase.Unassigned,t.IsHole=!1,t.IsOpen=!1,t.FirstLeft=null,t.Pts=null,t.BottomPt=null,t.PolyNode=null,this.m_PolyOuts.push(t),t.Idx=this.m_PolyOuts.length-1,t},n.ClipperBase.prototype.DisposeOutRec=function(t){var e=this.m_PolyOuts[t];e.Pts=null,e=null,this.m_PolyOuts[t]=null},n.ClipperBase.prototype.UpdateEdgeIntoAEL=function(t){null===t.NextInLML&&n.Error("UpdateEdgeIntoAEL: invalid call");var e=t.PrevInAEL,r=t.NextInAEL;return t.NextInLML.OutIdx=t.OutIdx,null!==e?e.NextInAEL=t.NextInLML:this.m_ActiveEdges=t.NextInLML,null!==r&&(r.PrevInAEL=t.NextInLML),t.NextInLML.Side=t.Side,t.NextInLML.WindDelta=t.WindDelta,t.NextInLML.WindCnt=t.WindCnt,t.NextInLML.WindCnt2=t.WindCnt2,(t=t.NextInLML).Curr.X=t.Bot.X,t.Curr.Y=t.Bot.Y,t.PrevInAEL=e,t.NextInAEL=r,n.ClipperBase.IsHorizontal(t)||this.InsertScanbeam(t.Top.Y),t},n.ClipperBase.prototype.SwapPositionsInAEL=function(t,e){if(t.NextInAEL!==t.PrevInAEL&&e.NextInAEL!==e.PrevInAEL){if(t.NextInAEL===e){var n=e.NextInAEL;null!==n&&(n.PrevInAEL=t);var r=t.PrevInAEL;null!==r&&(r.NextInAEL=e),e.PrevInAEL=r,e.NextInAEL=t,t.PrevInAEL=e,t.NextInAEL=n}else if(e.NextInAEL===t){var o=t.NextInAEL;null!==o&&(o.PrevInAEL=e);var i=e.PrevInAEL;null!==i&&(i.NextInAEL=t),t.PrevInAEL=i,t.NextInAEL=e,e.PrevInAEL=t,e.NextInAEL=o}else{var a=t.NextInAEL,s=t.PrevInAEL;t.NextInAEL=e.NextInAEL,null!==t.NextInAEL&&(t.NextInAEL.PrevInAEL=t),t.PrevInAEL=e.PrevInAEL,null!==t.PrevInAEL&&(t.PrevInAEL.NextInAEL=t),e.NextInAEL=a,null!==e.NextInAEL&&(e.NextInAEL.PrevInAEL=e),e.PrevInAEL=s,null!==e.PrevInAEL&&(e.PrevInAEL.NextInAEL=e)}null===t.PrevInAEL?this.m_ActiveEdges=t:null===e.PrevInAEL&&(this.m_ActiveEdges=e)}},n.ClipperBase.prototype.DeleteFromAEL=function(t){var e=t.PrevInAEL,n=t.NextInAEL;null===e&&null===n&&t!==this.m_ActiveEdges||(null!==e?e.NextInAEL=n:this.m_ActiveEdges=n,null!==n&&(n.PrevInAEL=e),t.NextInAEL=null,t.PrevInAEL=null)},n.Clipper=function(t){void 0===t&&(t=0),this.m_PolyOuts=null,this.m_ClipType=n.ClipType.ctIntersection,this.m_Scanbeam=null,this.m_Maxima=null,this.m_ActiveEdges=null,this.m_SortedEdges=null,this.m_IntersectList=null,this.m_IntersectNodeComparer=null,this.m_ExecuteLocked=!1,this.m_ClipFillType=n.PolyFillType.pftEvenOdd,this.m_SubjFillType=n.PolyFillType.pftEvenOdd,this.m_Joins=null,this.m_GhostJoins=null,this.m_UsingPolyTree=!1,this.ReverseSolution=!1,this.StrictlySimple=!1,n.ClipperBase.call(this),this.m_Scanbeam=null,this.m_Maxima=null,this.m_ActiveEdges=null,this.m_SortedEdges=null,this.m_IntersectList=new Array,this.m_IntersectNodeComparer=n.MyIntersectNodeSort.Compare,this.m_ExecuteLocked=!1,this.m_UsingPolyTree=!1,this.m_PolyOuts=new Array,this.m_Joins=new Array,this.m_GhostJoins=new Array,this.ReverseSolution=0!=(1&t),this.StrictlySimple=0!=(2&t),this.PreserveCollinear=0!=(4&t),n.use_xyz&&(this.ZFillFunction=null)},n.Clipper.ioReverseSolution=1,n.Clipper.ioStrictlySimple=2,n.Clipper.ioPreserveCollinear=4,n.Clipper.prototype.Clear=function(){0!==this.m_edges.length&&(this.DisposeAllPolyPts(),n.ClipperBase.prototype.Clear.call(this))},n.Clipper.prototype.InsertMaxima=function(t){var e=new n.Maxima;if(e.X=t,null===this.m_Maxima)this.m_Maxima=e,this.m_Maxima.Next=null,this.m_Maxima.Prev=null;else if(t<this.m_Maxima.X)e.Next=this.m_Maxima,e.Prev=null,this.m_Maxima=e;else{for(var r=this.m_Maxima;null!==r.Next&&t>=r.Next.X;)r=r.Next;if(t===r.X)return;e.Next=r.Next,e.Prev=r,null!==r.Next&&(r.Next.Prev=e),r.Next=e}},n.Clipper.prototype.Execute=function(){var t=arguments,e=t.length,r=t[1]instanceof n.PolyTree;if(4===e&&!r){var o=t[0],i=t[1],a=t[2],s=t[3];if(this.m_ExecuteLocked)return!1;this.m_HasOpenPaths&&n.Error("Error: PolyTree struct is needed for open path clipping."),this.m_ExecuteLocked=!0,n.Clear(i),this.m_SubjFillType=a,this.m_ClipFillType=s,this.m_ClipType=o,this.m_UsingPolyTree=!1;try{(u=this.ExecuteInternal())&&this.BuildResult(i)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return u}if(4===e&&r){o=t[0];var l=t[1];a=t[2],s=t[3];if(this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0,this.m_SubjFillType=a,this.m_ClipFillType=s,this.m_ClipType=o,this.m_UsingPolyTree=!0;try{var u;(u=this.ExecuteInternal())&&this.BuildResult2(l)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return u}if(2===e&&!r){o=t[0],i=t[1];return this.Execute(o,i,n.PolyFillType.pftEvenOdd,n.PolyFillType.pftEvenOdd)}if(2===e&&r){o=t[0],l=t[1];return this.Execute(o,l,n.PolyFillType.pftEvenOdd,n.PolyFillType.pftEvenOdd)}},n.Clipper.prototype.FixHoleLinkage=function(t){if(null!==t.FirstLeft&&(t.IsHole===t.FirstLeft.IsHole||null===t.FirstLeft.Pts)){for(var e=t.FirstLeft;null!==e&&(e.IsHole===t.IsHole||null===e.Pts);)e=e.FirstLeft;t.FirstLeft=e}},n.Clipper.prototype.ExecuteInternal=function(){try{this.Reset(),this.m_SortedEdges=null,this.m_Maxima=null;var t,e,n,r={},o={};if(!this.PopScanbeam(r))return!1;for(this.InsertLocalMinimaIntoAEL(r.v);this.PopScanbeam(o)||this.LocalMinimaPending();){if(this.ProcessHorizontals(),this.m_GhostJoins.length=0,!this.ProcessIntersections(o.v))return!1;this.ProcessEdgesAtTopOfScanbeam(o.v),r.v=o.v,this.InsertLocalMinimaIntoAEL(r.v)}for(e=0,n=this.m_PolyOuts.length;e<n;e++)null===(t=this.m_PolyOuts[e]).Pts||t.IsOpen||(t.IsHole^this.ReverseSolution)==this.Area$1(t)>0&&this.ReversePolyPtLinks(t.Pts);for(this.JoinCommonEdges(),e=0,n=this.m_PolyOuts.length;e<n;e++)null!==(t=this.m_PolyOuts[e]).Pts&&(t.IsOpen?this.FixupOutPolyline(t):this.FixupOutPolygon(t));return this.StrictlySimple&&this.DoSimplePolygons(),!0}finally{this.m_Joins.length=0,this.m_GhostJoins.length=0}},n.Clipper.prototype.DisposeAllPolyPts=function(){for(var t=0,e=this.m_PolyOuts.length;t<e;++t)this.DisposeOutRec(t);n.Clear(this.m_PolyOuts)},n.Clipper.prototype.AddJoin=function(t,e,r){var o=new n.Join;o.OutPt1=t,o.OutPt2=e,o.OffPt.X=r.X,o.OffPt.Y=r.Y,n.use_xyz&&(o.OffPt.Z=r.Z),this.m_Joins.push(o)},n.Clipper.prototype.AddGhostJoin=function(t,e){var r=new n.Join;r.OutPt1=t,r.OffPt.X=e.X,r.OffPt.Y=e.Y,n.use_xyz&&(r.OffPt.Z=e.Z),this.m_GhostJoins.push(r)},n.Clipper.prototype.SetZ=function(t,e,r){if(null!==this.ZFillFunction){if(0!==t.Z||null===this.ZFillFunction)return;n.IntPoint.op_Equality(t,e.Bot)?t.Z=e.Bot.Z:n.IntPoint.op_Equality(t,e.Top)?t.Z=e.Top.Z:n.IntPoint.op_Equality(t,r.Bot)?t.Z=r.Bot.Z:n.IntPoint.op_Equality(t,r.Top)?t.Z=r.Top.Z:this.ZFillFunction(e.Bot,e.Top,r.Bot,r.Top,t)}},n.Clipper.prototype.InsertLocalMinimaIntoAEL=function(t){for(var e,r,o={};this.PopLocalMinima(t,o);){e=o.v.LeftBound,r=o.v.RightBound;var i=null;if(null===e?(this.InsertEdgeIntoAEL(r,null),this.SetWindingCount(r),this.IsContributing(r)&&(i=this.AddOutPt(r,r.Bot))):null===r?(this.InsertEdgeIntoAEL(e,null),this.SetWindingCount(e),this.IsContributing(e)&&(i=this.AddOutPt(e,e.Bot)),this.InsertScanbeam(e.Top.Y)):(this.InsertEdgeIntoAEL(e,null),this.InsertEdgeIntoAEL(r,e),this.SetWindingCount(e),r.WindCnt=e.WindCnt,r.WindCnt2=e.WindCnt2,this.IsContributing(e)&&(i=this.AddLocalMinPoly(e,r,e.Bot)),this.InsertScanbeam(e.Top.Y)),null!==r&&(n.ClipperBase.IsHorizontal(r)?(null!==r.NextInLML&&this.InsertScanbeam(r.NextInLML.Top.Y),this.AddEdgeToSEL(r)):this.InsertScanbeam(r.Top.Y)),null!==e&&null!==r){if(null!==i&&n.ClipperBase.IsHorizontal(r)&&this.m_GhostJoins.length>0&&0!==r.WindDelta)for(var a=0,s=this.m_GhostJoins.length;a<s;a++){var l=this.m_GhostJoins[a];this.HorzSegmentsOverlap(l.OutPt1.Pt.X,l.OffPt.X,r.Bot.X,r.Top.X)&&this.AddJoin(l.OutPt1,i,l.OffPt)}if(e.OutIdx>=0&&null!==e.PrevInAEL&&e.PrevInAEL.Curr.X===e.Bot.X&&e.PrevInAEL.OutIdx>=0&&n.ClipperBase.SlopesEqual5(e.PrevInAEL.Curr,e.PrevInAEL.Top,e.Curr,e.Top,this.m_UseFullRange)&&0!==e.WindDelta&&0!==e.PrevInAEL.WindDelta){var u=this.AddOutPt(e.PrevInAEL,e.Bot);this.AddJoin(i,u,e.Top)}if(e.NextInAEL!==r){if(r.OutIdx>=0&&r.PrevInAEL.OutIdx>=0&&n.ClipperBase.SlopesEqual5(r.PrevInAEL.Curr,r.PrevInAEL.Top,r.Curr,r.Top,this.m_UseFullRange)&&0!==r.WindDelta&&0!==r.PrevInAEL.WindDelta){u=this.AddOutPt(r.PrevInAEL,r.Bot);this.AddJoin(i,u,r.Top)}var c=e.NextInAEL;if(null!==c)for(;c!==r;)this.IntersectEdges(r,c,e.Curr),c=c.NextInAEL}}}},n.Clipper.prototype.InsertEdgeIntoAEL=function(t,e){if(null===this.m_ActiveEdges)t.PrevInAEL=null,t.NextInAEL=null,this.m_ActiveEdges=t;else if(null===e&&this.E2InsertsBeforeE1(this.m_ActiveEdges,t))t.PrevInAEL=null,t.NextInAEL=this.m_ActiveEdges,this.m_ActiveEdges.PrevInAEL=t,this.m_ActiveEdges=t;else{for(null===e&&(e=this.m_ActiveEdges);null!==e.NextInAEL&&!this.E2InsertsBeforeE1(e.NextInAEL,t);)e=e.NextInAEL;t.NextInAEL=e.NextInAEL,null!==e.NextInAEL&&(e.NextInAEL.PrevInAEL=t),t.PrevInAEL=e,e.NextInAEL=t}},n.Clipper.prototype.E2InsertsBeforeE1=function(t,e){return e.Curr.X===t.Curr.X?e.Top.Y>t.Top.Y?e.Top.X<n.Clipper.TopX(t,e.Top.Y):t.Top.X>n.Clipper.TopX(e,t.Top.Y):e.Curr.X<t.Curr.X},n.Clipper.prototype.IsEvenOddFillType=function(t){return t.PolyTyp===n.PolyType.ptSubject?this.m_SubjFillType===n.PolyFillType.pftEvenOdd:this.m_ClipFillType===n.PolyFillType.pftEvenOdd},n.Clipper.prototype.IsEvenOddAltFillType=function(t){return t.PolyTyp===n.PolyType.ptSubject?this.m_ClipFillType===n.PolyFillType.pftEvenOdd:this.m_SubjFillType===n.PolyFillType.pftEvenOdd},n.Clipper.prototype.IsContributing=function(t){var e,r;switch(t.PolyTyp===n.PolyType.ptSubject?(e=this.m_SubjFillType,r=this.m_ClipFillType):(e=this.m_ClipFillType,r=this.m_SubjFillType),e){case n.PolyFillType.pftEvenOdd:if(0===t.WindDelta&&1!==t.WindCnt)return!1;break;case n.PolyFillType.pftNonZero:if(1!==Math.abs(t.WindCnt))return!1;break;case n.PolyFillType.pftPositive:if(1!==t.WindCnt)return!1;break;default:if(-1!==t.WindCnt)return!1}switch(this.m_ClipType){case n.ClipType.ctIntersection:switch(r){case n.PolyFillType.pftEvenOdd:case n.PolyFillType.pftNonZero:return 0!==t.WindCnt2;case n.PolyFillType.pftPositive:return t.WindCnt2>0;default:return t.WindCnt2<0}case n.ClipType.ctUnion:switch(r){case n.PolyFillType.pftEvenOdd:case n.PolyFillType.pftNonZero:return 0===t.WindCnt2;case n.PolyFillType.pftPositive:return t.WindCnt2<=0;default:return t.WindCnt2>=0}case n.ClipType.ctDifference:if(t.PolyTyp===n.PolyType.ptSubject)switch(r){case n.PolyFillType.pftEvenOdd:case n.PolyFillType.pftNonZero:return 0===t.WindCnt2;case n.PolyFillType.pftPositive:return t.WindCnt2<=0;default:return t.WindCnt2>=0}else switch(r){case n.PolyFillType.pftEvenOdd:case n.PolyFillType.pftNonZero:return 0!==t.WindCnt2;case n.PolyFillType.pftPositive:return t.WindCnt2>0;default:return t.WindCnt2<0}case n.ClipType.ctXor:if(0!==t.WindDelta)return!0;switch(r){case n.PolyFillType.pftEvenOdd:case n.PolyFillType.pftNonZero:return 0===t.WindCnt2;case n.PolyFillType.pftPositive:return t.WindCnt2<=0;default:return t.WindCnt2>=0}}return!0},n.Clipper.prototype.SetWindingCount=function(t){for(var e=t.PrevInAEL;null!==e&&(e.PolyTyp!==t.PolyTyp||0===e.WindDelta);)e=e.PrevInAEL;if(null===e){var r=t.PolyTyp===n.PolyType.ptSubject?this.m_SubjFillType:this.m_ClipFillType;0===t.WindDelta?t.WindCnt=r===n.PolyFillType.pftNegative?-1:1:t.WindCnt=t.WindDelta,t.WindCnt2=0,e=this.m_ActiveEdges}else if(0===t.WindDelta&&this.m_ClipType!==n.ClipType.ctUnion)t.WindCnt=1,t.WindCnt2=e.WindCnt2,e=e.NextInAEL;else if(this.IsEvenOddFillType(t)){if(0===t.WindDelta){for(var o=!0,i=e.PrevInAEL;null!==i;)i.PolyTyp===e.PolyTyp&&0!==i.WindDelta&&(o=!o),i=i.PrevInAEL;t.WindCnt=o?0:1}else t.WindCnt=t.WindDelta;t.WindCnt2=e.WindCnt2,e=e.NextInAEL}else e.WindCnt*e.WindDelta<0?Math.abs(e.WindCnt)>1?e.WindDelta*t.WindDelta<0?t.WindCnt=e.WindCnt:t.WindCnt=e.WindCnt+t.WindDelta:t.WindCnt=0===t.WindDelta?1:t.WindDelta:0===t.WindDelta?t.WindCnt=e.WindCnt<0?e.WindCnt-1:e.WindCnt+1:e.WindDelta*t.WindDelta<0?t.WindCnt=e.WindCnt:t.WindCnt=e.WindCnt+t.WindDelta,t.WindCnt2=e.WindCnt2,e=e.NextInAEL;if(this.IsEvenOddAltFillType(t))for(;e!==t;)0!==e.WindDelta&&(t.WindCnt2=0===t.WindCnt2?1:0),e=e.NextInAEL;else for(;e!==t;)t.WindCnt2+=e.WindDelta,e=e.NextInAEL},n.Clipper.prototype.AddEdgeToSEL=function(t){null===this.m_SortedEdges?(this.m_SortedEdges=t,t.PrevInSEL=null,t.NextInSEL=null):(t.NextInSEL=this.m_SortedEdges,t.PrevInSEL=null,this.m_SortedEdges.PrevInSEL=t,this.m_SortedEdges=t)},n.Clipper.prototype.PopEdgeFromSEL=function(t){if(t.v=this.m_SortedEdges,null===t.v)return!1;var e=t.v;return this.m_SortedEdges=t.v.NextInSEL,null!==this.m_SortedEdges&&(this.m_SortedEdges.PrevInSEL=null),e.NextInSEL=null,e.PrevInSEL=null,!0},n.Clipper.prototype.CopyAELToSEL=function(){var t=this.m_ActiveEdges;for(this.m_SortedEdges=t;null!==t;)t.PrevInSEL=t.PrevInAEL,t.NextInSEL=t.NextInAEL,t=t.NextInAEL},n.Clipper.prototype.SwapPositionsInSEL=function(t,e){if(!(null===t.NextInSEL&&null===t.PrevInSEL||null===e.NextInSEL&&null===e.PrevInSEL)){if(t.NextInSEL===e)null!==(n=e.NextInSEL)&&(n.PrevInSEL=t),null!==(r=t.PrevInSEL)&&(r.NextInSEL=e),e.PrevInSEL=r,e.NextInSEL=t,t.PrevInSEL=e,t.NextInSEL=n;else if(e.NextInSEL===t){null!==(n=t.NextInSEL)&&(n.PrevInSEL=e),null!==(r=e.PrevInSEL)&&(r.NextInSEL=t),t.PrevInSEL=r,t.NextInSEL=e,e.PrevInSEL=t,e.NextInSEL=n}else{var n=t.NextInSEL,r=t.PrevInSEL;t.NextInSEL=e.NextInSEL,null!==t.NextInSEL&&(t.NextInSEL.PrevInSEL=t),t.PrevInSEL=e.PrevInSEL,null!==t.PrevInSEL&&(t.PrevInSEL.NextInSEL=t),e.NextInSEL=n,null!==e.NextInSEL&&(e.NextInSEL.PrevInSEL=e),e.PrevInSEL=r,null!==e.PrevInSEL&&(e.PrevInSEL.NextInSEL=e)}null===t.PrevInSEL?this.m_SortedEdges=t:null===e.PrevInSEL&&(this.m_SortedEdges=e)}},n.Clipper.prototype.AddLocalMaxPoly=function(t,e,n){this.AddOutPt(t,n),0===e.WindDelta&&this.AddOutPt(e,n),t.OutIdx===e.OutIdx?(t.OutIdx=-1,e.OutIdx=-1):t.OutIdx<e.OutIdx?this.AppendPolygon(t,e):this.AppendPolygon(e,t)},n.Clipper.prototype.AddLocalMinPoly=function(t,e,r){var o,i,a;if(n.ClipperBase.IsHorizontal(e)||t.Dx>e.Dx?(o=this.AddOutPt(t,r),e.OutIdx=t.OutIdx,t.Side=n.EdgeSide.esLeft,e.Side=n.EdgeSide.esRight,a=(i=t).PrevInAEL===e?e.PrevInAEL:i.PrevInAEL):(o=this.AddOutPt(e,r),t.OutIdx=e.OutIdx,t.Side=n.EdgeSide.esRight,e.Side=n.EdgeSide.esLeft,a=(i=e).PrevInAEL===t?t.PrevInAEL:i.PrevInAEL),null!==a&&a.OutIdx>=0&&a.Top.Y<r.Y&&i.Top.Y<r.Y){var s=n.Clipper.TopX(a,r.Y),l=n.Clipper.TopX(i,r.Y);if(s===l&&0!==i.WindDelta&&0!==a.WindDelta&&n.ClipperBase.SlopesEqual5(new n.IntPoint2(s,r.Y),a.Top,new n.IntPoint2(l,r.Y),i.Top,this.m_UseFullRange)){var u=this.AddOutPt(a,r);this.AddJoin(o,u,i.Top)}}return o},n.Clipper.prototype.AddOutPt=function(t,e){if(t.OutIdx<0){(o=this.CreateOutRec()).IsOpen=0===t.WindDelta;var r=new n.OutPt;return o.Pts=r,r.Idx=o.Idx,r.Pt.X=e.X,r.Pt.Y=e.Y,n.use_xyz&&(r.Pt.Z=e.Z),r.Next=r,r.Prev=r,o.IsOpen||this.SetHoleState(t,o),t.OutIdx=o.Idx,r}var o,i=(o=this.m_PolyOuts[t.OutIdx]).Pts,a=t.Side===n.EdgeSide.esLeft;return a&&n.IntPoint.op_Equality(e,i.Pt)?i:!a&&n.IntPoint.op_Equality(e,i.Prev.Pt)?i.Prev:((r=new n.OutPt).Idx=o.Idx,r.Pt.X=e.X,r.Pt.Y=e.Y,n.use_xyz&&(r.Pt.Z=e.Z),r.Next=i,r.Prev=i.Prev,r.Prev.Next=r,i.Prev=r,a&&(o.Pts=r),r)},n.Clipper.prototype.GetLastOutPt=function(t){var e=this.m_PolyOuts[t.OutIdx];return t.Side===n.EdgeSide.esLeft?e.Pts:e.Pts.Prev},n.Clipper.prototype.SwapPoints=function(t,e){var r=new n.IntPoint1(t.Value);t.Value.X=e.Value.X,t.Value.Y=e.Value.Y,n.use_xyz&&(t.Value.Z=e.Value.Z),e.Value.X=r.X,e.Value.Y=r.Y,n.use_xyz&&(e.Value.Z=r.Z)},n.Clipper.prototype.HorzSegmentsOverlap=function(t,e,n,r){var o;return t>e&&(o=t,t=e,e=o),n>r&&(o=n,n=r,r=o),t<r&&n<e},n.Clipper.prototype.SetHoleState=function(t,e){for(var n=t.PrevInAEL,r=null;null!==n;)n.OutIdx>=0&&0!==n.WindDelta&&(null===r?r=n:r.OutIdx===n.OutIdx&&(r=null)),n=n.PrevInAEL;null===r?(e.FirstLeft=null,e.IsHole=!1):(e.FirstLeft=this.m_PolyOuts[r.OutIdx],e.IsHole=!e.FirstLeft.IsHole)},n.Clipper.prototype.GetDx=function(t,e){return t.Y===e.Y?n.ClipperBase.horizontal:(e.X-t.X)/(e.Y-t.Y)},n.Clipper.prototype.FirstIsBottomPt=function(t,e){for(var r=t.Prev;n.IntPoint.op_Equality(r.Pt,t.Pt)&&r!==t;)r=r.Prev;var o=Math.abs(this.GetDx(t.Pt,r.Pt));for(r=t.Next;n.IntPoint.op_Equality(r.Pt,t.Pt)&&r!==t;)r=r.Next;var i=Math.abs(this.GetDx(t.Pt,r.Pt));for(r=e.Prev;n.IntPoint.op_Equality(r.Pt,e.Pt)&&r!==e;)r=r.Prev;var a=Math.abs(this.GetDx(e.Pt,r.Pt));for(r=e.Next;n.IntPoint.op_Equality(r.Pt,e.Pt)&&r!==e;)r=r.Next;var s=Math.abs(this.GetDx(e.Pt,r.Pt));return Math.max(o,i)===Math.max(a,s)&&Math.min(o,i)===Math.min(a,s)?this.Area(t)>0:o>=a&&o>=s||i>=a&&i>=s},n.Clipper.prototype.GetBottomPt=function(t){for(var e=null,r=t.Next;r!==t;)r.Pt.Y>t.Pt.Y?(t=r,e=null):r.Pt.Y===t.Pt.Y&&r.Pt.X<=t.Pt.X&&(r.Pt.X<t.Pt.X?(e=null,t=r):r.Next!==t&&r.Prev!==t&&(e=r)),r=r.Next;if(null!==e)for(;e!==r;)for(this.FirstIsBottomPt(r,e)||(t=e),e=e.Next;n.IntPoint.op_Inequality(e.Pt,t.Pt);)e=e.Next;return t},n.Clipper.prototype.GetLowermostRec=function(t,e){null===t.BottomPt&&(t.BottomPt=this.GetBottomPt(t.Pts)),null===e.BottomPt&&(e.BottomPt=this.GetBottomPt(e.Pts));var n=t.BottomPt,r=e.BottomPt;return n.Pt.Y>r.Pt.Y?t:n.Pt.Y<r.Pt.Y?e:n.Pt.X<r.Pt.X?t:n.Pt.X>r.Pt.X||n.Next===n?e:r.Next===r||this.FirstIsBottomPt(n,r)?t:e},n.Clipper.prototype.OutRec1RightOfOutRec2=function(t,e){do{if((t=t.FirstLeft)===e)return!0}while(null!==t);return!1},n.Clipper.prototype.GetOutRec=function(t){for(var e=this.m_PolyOuts[t];e!==this.m_PolyOuts[e.Idx];)e=this.m_PolyOuts[e.Idx];return e},n.Clipper.prototype.AppendPolygon=function(t,e){var r,o=this.m_PolyOuts[t.OutIdx],i=this.m_PolyOuts[e.OutIdx];r=this.OutRec1RightOfOutRec2(o,i)?i:this.OutRec1RightOfOutRec2(i,o)?o:this.GetLowermostRec(o,i);var a=o.Pts,s=a.Prev,l=i.Pts,u=l.Prev;t.Side===n.EdgeSide.esLeft?e.Side===n.EdgeSide.esLeft?(this.ReversePolyPtLinks(l),l.Next=a,a.Prev=l,s.Next=u,u.Prev=s,o.Pts=u):(u.Next=a,a.Prev=u,l.Prev=s,s.Next=l,o.Pts=l):e.Side===n.EdgeSide.esRight?(this.ReversePolyPtLinks(l),s.Next=u,u.Prev=s,l.Next=a,a.Prev=l):(s.Next=l,l.Prev=s,a.Prev=u,u.Next=a),o.BottomPt=null,r===i&&(i.FirstLeft!==o&&(o.FirstLeft=i.FirstLeft),o.IsHole=i.IsHole),i.Pts=null,i.BottomPt=null,i.FirstLeft=o;var c=t.OutIdx,h=e.OutIdx;t.OutIdx=-1,e.OutIdx=-1;for(var p=this.m_ActiveEdges;null!==p;){if(p.OutIdx===h){p.OutIdx=c,p.Side=t.Side;break}p=p.NextInAEL}i.Idx=o.Idx},n.Clipper.prototype.ReversePolyPtLinks=function(t){if(null!==t){var e,n;e=t;do{n=e.Next,e.Next=e.Prev,e.Prev=n,e=n}while(e!==t)}},n.Clipper.SwapSides=function(t,e){var n=t.Side;t.Side=e.Side,e.Side=n},n.Clipper.SwapPolyIndexes=function(t,e){var n=t.OutIdx;t.OutIdx=e.OutIdx,e.OutIdx=n},n.Clipper.prototype.IntersectEdges=function(t,e,r){var o=t.OutIdx>=0,i=e.OutIdx>=0;if(n.use_xyz&&this.SetZ(r,t,e),!n.use_lines||0!==t.WindDelta&&0!==e.WindDelta){if(t.PolyTyp===e.PolyTyp)if(this.IsEvenOddFillType(t)){var a=t.WindCnt;t.WindCnt=e.WindCnt,e.WindCnt=a}else t.WindCnt+e.WindDelta===0?t.WindCnt=-t.WindCnt:t.WindCnt+=e.WindDelta,e.WindCnt-t.WindDelta==0?e.WindCnt=-e.WindCnt:e.WindCnt-=t.WindDelta;else this.IsEvenOddFillType(e)?t.WindCnt2=0===t.WindCnt2?1:0:t.WindCnt2+=e.WindDelta,this.IsEvenOddFillType(t)?e.WindCnt2=0===e.WindCnt2?1:0:e.WindCnt2-=t.WindDelta;var s,l,u,c,h,p;switch(t.PolyTyp===n.PolyType.ptSubject?(s=this.m_SubjFillType,u=this.m_ClipFillType):(s=this.m_ClipFillType,u=this.m_SubjFillType),e.PolyTyp===n.PolyType.ptSubject?(l=this.m_SubjFillType,c=this.m_ClipFillType):(l=this.m_ClipFillType,c=this.m_SubjFillType),s){case n.PolyFillType.pftPositive:h=t.WindCnt;break;case n.PolyFillType.pftNegative:h=-t.WindCnt;break;default:h=Math.abs(t.WindCnt)}switch(l){case n.PolyFillType.pftPositive:p=e.WindCnt;break;case n.PolyFillType.pftNegative:p=-e.WindCnt;break;default:p=Math.abs(e.WindCnt)}if(o&&i)0!==h&&1!==h||0!==p&&1!==p||t.PolyTyp!==e.PolyTyp&&this.m_ClipType!==n.ClipType.ctXor?this.AddLocalMaxPoly(t,e,r):(this.AddOutPt(t,r),this.AddOutPt(e,r),n.Clipper.SwapSides(t,e),n.Clipper.SwapPolyIndexes(t,e));else if(o)0!==p&&1!==p||(this.AddOutPt(t,r),n.Clipper.SwapSides(t,e),n.Clipper.SwapPolyIndexes(t,e));else if(i)0!==h&&1!==h||(this.AddOutPt(e,r),n.Clipper.SwapSides(t,e),n.Clipper.SwapPolyIndexes(t,e));else if(!(0!==h&&1!==h||0!==p&&1!==p)){var d,f;switch(u){case n.PolyFillType.pftPositive:d=t.WindCnt2;break;case n.PolyFillType.pftNegative:d=-t.WindCnt2;break;default:d=Math.abs(t.WindCnt2)}switch(c){case n.PolyFillType.pftPositive:f=e.WindCnt2;break;case n.PolyFillType.pftNegative:f=-e.WindCnt2;break;default:f=Math.abs(e.WindCnt2)}if(t.PolyTyp!==e.PolyTyp)this.AddLocalMinPoly(t,e,r);else if(1===h&&1===p)switch(this.m_ClipType){case n.ClipType.ctIntersection:d>0&&f>0&&this.AddLocalMinPoly(t,e,r);break;case n.ClipType.ctUnion:d<=0&&f<=0&&this.AddLocalMinPoly(t,e,r);break;case n.ClipType.ctDifference:(t.PolyTyp===n.PolyType.ptClip&&d>0&&f>0||t.PolyTyp===n.PolyType.ptSubject&&d<=0&&f<=0)&&this.AddLocalMinPoly(t,e,r);break;case n.ClipType.ctXor:this.AddLocalMinPoly(t,e,r)}else n.Clipper.SwapSides(t,e)}}else{if(0===t.WindDelta&&0===e.WindDelta)return;t.PolyTyp===e.PolyTyp&&t.WindDelta!==e.WindDelta&&this.m_ClipType===n.ClipType.ctUnion?0===t.WindDelta?i&&(this.AddOutPt(t,r),o&&(t.OutIdx=-1)):o&&(this.AddOutPt(e,r),i&&(e.OutIdx=-1)):t.PolyTyp!==e.PolyTyp&&(0!==t.WindDelta||1!==Math.abs(e.WindCnt)||this.m_ClipType===n.ClipType.ctUnion&&0!==e.WindCnt2?0!==e.WindDelta||1!==Math.abs(t.WindCnt)||this.m_ClipType===n.ClipType.ctUnion&&0!==t.WindCnt2||(this.AddOutPt(e,r),i&&(e.OutIdx=-1)):(this.AddOutPt(t,r),o&&(t.OutIdx=-1)))}},n.Clipper.prototype.DeleteFromSEL=function(t){var e=t.PrevInSEL,n=t.NextInSEL;null===e&&null===n&&t!==this.m_SortedEdges||(null!==e?e.NextInSEL=n:this.m_SortedEdges=n,null!==n&&(n.PrevInSEL=e),t.NextInSEL=null,t.PrevInSEL=null)},n.Clipper.prototype.ProcessHorizontals=function(){for(var t={};this.PopEdgeFromSEL(t);)this.ProcessHorizontal(t.v)},n.Clipper.prototype.GetHorzDirection=function(t,e){t.Bot.X<t.Top.X?(e.Left=t.Bot.X,e.Right=t.Top.X,e.Dir=n.Direction.dLeftToRight):(e.Left=t.Top.X,e.Right=t.Bot.X,e.Dir=n.Direction.dRightToLeft)},n.Clipper.prototype.ProcessHorizontal=function(t){var e={Dir:null,Left:null,Right:null};this.GetHorzDirection(t,e);for(var r=e.Dir,o=e.Left,i=e.Right,a=0===t.WindDelta,s=t,l=null;null!==s.NextInLML&&n.ClipperBase.IsHorizontal(s.NextInLML);)s=s.NextInLML;null===s.NextInLML&&(l=this.GetMaximaPair(s));var u=this.m_Maxima;if(null!==u)if(r===n.Direction.dLeftToRight){for(;null!==u&&u.X<=t.Bot.X;)u=u.Next;null!==u&&u.X>=s.Top.X&&(u=null)}else{for(;null!==u.Next&&u.Next.X<t.Bot.X;)u=u.Next;u.X<=s.Top.X&&(u=null)}for(var c=null;;){for(var h=t===s,p=this.GetNextInAEL(t,r);null!==p;){if(null!==u)if(r===n.Direction.dLeftToRight)for(;null!==u&&u.X<p.Curr.X;)t.OutIdx>=0&&!a&&this.AddOutPt(t,new n.IntPoint2(u.X,t.Bot.Y)),u=u.Next;else for(;null!==u&&u.X>p.Curr.X;)t.OutIdx>=0&&!a&&this.AddOutPt(t,new n.IntPoint2(u.X,t.Bot.Y)),u=u.Prev;if(r===n.Direction.dLeftToRight&&p.Curr.X>i||r===n.Direction.dRightToLeft&&p.Curr.X<o)break;if(p.Curr.X===t.Top.X&&null!==t.NextInLML&&p.Dx<t.NextInLML.Dx)break;if(t.OutIdx>=0&&!a){n.use_xyz&&(r===n.Direction.dLeftToRight?this.SetZ(p.Curr,t,p):this.SetZ(p.Curr,p,t)),c=this.AddOutPt(t,p.Curr);for(var d=this.m_SortedEdges;null!==d;){if(d.OutIdx>=0&&this.HorzSegmentsOverlap(t.Bot.X,t.Top.X,d.Bot.X,d.Top.X)){var f=this.GetLastOutPt(d);this.AddJoin(f,c,d.Top)}d=d.NextInSEL}this.AddGhostJoin(c,t.Bot)}if(p===l&&h)return t.OutIdx>=0&&this.AddLocalMaxPoly(t,l,t.Top),this.DeleteFromAEL(t),void this.DeleteFromAEL(l);if(r===n.Direction.dLeftToRight){var m=new n.IntPoint2(p.Curr.X,t.Curr.Y);this.IntersectEdges(t,p,m)}else{m=new n.IntPoint2(p.Curr.X,t.Curr.Y);this.IntersectEdges(p,t,m)}var g=this.GetNextInAEL(p,r);this.SwapPositionsInAEL(t,p),p=g}if(null===t.NextInLML||!n.ClipperBase.IsHorizontal(t.NextInLML))break;(t=this.UpdateEdgeIntoAEL(t)).OutIdx>=0&&this.AddOutPt(t,t.Bot),e={Dir:r,Left:o,Right:i},this.GetHorzDirection(t,e),r=e.Dir,o=e.Left,i=e.Right}if(t.OutIdx>=0&&null===c){c=this.GetLastOutPt(t);for(d=this.m_SortedEdges;null!==d;){if(d.OutIdx>=0&&this.HorzSegmentsOverlap(t.Bot.X,t.Top.X,d.Bot.X,d.Top.X)){f=this.GetLastOutPt(d);this.AddJoin(f,c,d.Top)}d=d.NextInSEL}this.AddGhostJoin(c,t.Top)}if(null!==t.NextInLML)if(t.OutIdx>=0){if(c=this.AddOutPt(t,t.Top),0===(t=this.UpdateEdgeIntoAEL(t)).WindDelta)return;var v=t.PrevInAEL;g=t.NextInAEL;if(null!==v&&v.Curr.X===t.Bot.X&&v.Curr.Y===t.Bot.Y&&0===v.WindDelta&&v.OutIdx>=0&&v.Curr.Y>v.Top.Y&&n.ClipperBase.SlopesEqual3(t,v,this.m_UseFullRange)){f=this.AddOutPt(v,t.Bot);this.AddJoin(c,f,t.Top)}else if(null!==g&&g.Curr.X===t.Bot.X&&g.Curr.Y===t.Bot.Y&&0!==g.WindDelta&&g.OutIdx>=0&&g.Curr.Y>g.Top.Y&&n.ClipperBase.SlopesEqual3(t,g,this.m_UseFullRange)){f=this.AddOutPt(g,t.Bot);this.AddJoin(c,f,t.Top)}}else t=this.UpdateEdgeIntoAEL(t);else t.OutIdx>=0&&this.AddOutPt(t,t.Top),this.DeleteFromAEL(t)},n.Clipper.prototype.GetNextInAEL=function(t,e){return e===n.Direction.dLeftToRight?t.NextInAEL:t.PrevInAEL},n.Clipper.prototype.IsMinima=function(t){return null!==t&&t.Prev.NextInLML!==t&&t.Next.NextInLML!==t},n.Clipper.prototype.IsMaxima=function(t,e){return null!==t&&t.Top.Y===e&&null===t.NextInLML},n.Clipper.prototype.IsIntermediate=function(t,e){return t.Top.Y===e&&null!==t.NextInLML},n.Clipper.prototype.GetMaximaPair=function(t){return n.IntPoint.op_Equality(t.Next.Top,t.Top)&&null===t.Next.NextInLML?t.Next:n.IntPoint.op_Equality(t.Prev.Top,t.Top)&&null===t.Prev.NextInLML?t.Prev:null},n.Clipper.prototype.GetMaximaPairEx=function(t){var e=this.GetMaximaPair(t);return null===e||e.OutIdx===n.ClipperBase.Skip||e.NextInAEL===e.PrevInAEL&&!n.ClipperBase.IsHorizontal(e)?null:e},n.Clipper.prototype.ProcessIntersections=function(t){if(null===this.m_ActiveEdges)return!0;try{if(this.BuildIntersectList(t),0===this.m_IntersectList.length)return!0;if(1!==this.m_IntersectList.length&&!this.FixupIntersectionOrder())return!1;this.ProcessIntersectList()}catch(t){this.m_SortedEdges=null,this.m_IntersectList.length=0,n.Error("ProcessIntersections error")}return this.m_SortedEdges=null,!0},n.Clipper.prototype.BuildIntersectList=function(t){if(null!==this.m_ActiveEdges){var e=this.m_ActiveEdges;for(this.m_SortedEdges=e;null!==e;)e.PrevInSEL=e.PrevInAEL,e.NextInSEL=e.NextInAEL,e.Curr.X=n.Clipper.TopX(e,t),e=e.NextInAEL;for(var r=!0;r&&null!==this.m_SortedEdges;){for(r=!1,e=this.m_SortedEdges;null!==e.NextInSEL;){var o=e.NextInSEL,i=new n.IntPoint0;if(e.Curr.X>o.Curr.X){this.IntersectPoint(e,o,i),i.Y<t&&(i=new n.IntPoint2(n.Clipper.TopX(e,t),t));var a=new n.IntersectNode;a.Edge1=e,a.Edge2=o,a.Pt.X=i.X,a.Pt.Y=i.Y,n.use_xyz&&(a.Pt.Z=i.Z),this.m_IntersectList.push(a),this.SwapPositionsInSEL(e,o),r=!0}else e=o}if(null===e.PrevInSEL)break;e.PrevInSEL.NextInSEL=null}this.m_SortedEdges=null}},n.Clipper.prototype.EdgesAdjacent=function(t){return t.Edge1.NextInSEL===t.Edge2||t.Edge1.PrevInSEL===t.Edge2},n.Clipper.IntersectNodeSort=function(t,e){return e.Pt.Y-t.Pt.Y},n.Clipper.prototype.FixupIntersectionOrder=function(){this.m_IntersectList.sort(this.m_IntersectNodeComparer),this.CopyAELToSEL();for(var t=this.m_IntersectList.length,e=0;e<t;e++){if(!this.EdgesAdjacent(this.m_IntersectList[e])){for(var n=e+1;n<t&&!this.EdgesAdjacent(this.m_IntersectList[n]);)n++;if(n===t)return!1;var r=this.m_IntersectList[e];this.m_IntersectList[e]=this.m_IntersectList[n],this.m_IntersectList[n]=r}this.SwapPositionsInSEL(this.m_IntersectList[e].Edge1,this.m_IntersectList[e].Edge2)}return!0},n.Clipper.prototype.ProcessIntersectList=function(){for(var t=0,e=this.m_IntersectList.length;t<e;t++){var n=this.m_IntersectList[t];this.IntersectEdges(n.Edge1,n.Edge2,n.Pt),this.SwapPositionsInAEL(n.Edge1,n.Edge2)}this.m_IntersectList.length=0};a.msie?n.Clipper.Round=function(t){return t<0?Math.ceil(t-.5):Math.round(t)}:a.chromium?n.Clipper.Round=function(t){return t<0?-Math.round(Math.abs(t)):Math.round(t)}:a.safari?n.Clipper.Round=function(t){return t<0?(t-=.5)<-2147483648?Math.ceil(t):0|t:(t+=.5)>2147483647?Math.floor(t):0|t}:n.Clipper.Round=function(t){return t<0?Math.ceil(t-.5):Math.floor(t+.5)},n.Clipper.TopX=function(t,e){return e===t.Top.Y?t.Top.X:t.Bot.X+n.Clipper.Round(t.Dx*(e-t.Bot.Y))},n.Clipper.prototype.IntersectPoint=function(t,e,r){var o,i;if(r.X=0,r.Y=0,t.Dx===e.Dx)return r.Y=t.Curr.Y,void(r.X=n.Clipper.TopX(t,r.Y));if(0===t.Delta.X)r.X=t.Bot.X,n.ClipperBase.IsHorizontal(e)?r.Y=e.Bot.Y:(i=e.Bot.Y-e.Bot.X/e.Dx,r.Y=n.Clipper.Round(r.X/e.Dx+i));else if(0===e.Delta.X)r.X=e.Bot.X,n.ClipperBase.IsHorizontal(t)?r.Y=t.Bot.Y:(o=t.Bot.Y-t.Bot.X/t.Dx,r.Y=n.Clipper.Round(r.X/t.Dx+o));else{o=t.Bot.X-t.Bot.Y*t.Dx;var a=((i=e.Bot.X-e.Bot.Y*e.Dx)-o)/(t.Dx-e.Dx);r.Y=n.Clipper.Round(a),Math.abs(t.Dx)<Math.abs(e.Dx)?r.X=n.Clipper.Round(t.Dx*a+o):r.X=n.Clipper.Round(e.Dx*a+i)}if(r.Y<t.Top.Y||r.Y<e.Top.Y){if(t.Top.Y>e.Top.Y)return r.Y=t.Top.Y,r.X=n.Clipper.TopX(e,t.Top.Y),r.X<t.Top.X;r.Y=e.Top.Y,Math.abs(t.Dx)<Math.abs(e.Dx)?r.X=n.Clipper.TopX(t,r.Y):r.X=n.Clipper.TopX(e,r.Y)}r.Y>t.Curr.Y&&(r.Y=t.Curr.Y,Math.abs(t.Dx)>Math.abs(e.Dx)?r.X=n.Clipper.TopX(e,r.Y):r.X=n.Clipper.TopX(t,r.Y))},n.Clipper.prototype.ProcessEdgesAtTopOfScanbeam=function(t){for(var e=this.m_ActiveEdges;null!==e;){var r=this.IsMaxima(e,t);if(r){var o=this.GetMaximaPairEx(e);r=null===o||!n.ClipperBase.IsHorizontal(o)}if(r){this.StrictlySimple&&this.InsertMaxima(e.Top.X);var i=e.PrevInAEL;this.DoMaxima(e),e=null===i?this.m_ActiveEdges:i.NextInAEL}else{if(this.IsIntermediate(e,t)&&n.ClipperBase.IsHorizontal(e.NextInLML)?((e=this.UpdateEdgeIntoAEL(e)).OutIdx>=0&&this.AddOutPt(e,e.Bot),this.AddEdgeToSEL(e)):(e.Curr.X=n.Clipper.TopX(e,t),e.Curr.Y=t),n.use_xyz&&(e.Top.Y===t?e.Curr.Z=e.Top.Z:e.Bot.Y===t?e.Curr.Z=e.Bot.Z:e.Curr.Z=0),this.StrictlySimple){i=e.PrevInAEL;if(e.OutIdx>=0&&0!==e.WindDelta&&null!==i&&i.OutIdx>=0&&i.Curr.X===e.Curr.X&&0!==i.WindDelta){var a=new n.IntPoint1(e.Curr);n.use_xyz&&this.SetZ(a,i,e);var s=this.AddOutPt(i,a),l=this.AddOutPt(e,a);this.AddJoin(s,l,a)}}e=e.NextInAEL}}for(this.ProcessHorizontals(),this.m_Maxima=null,e=this.m_ActiveEdges;null!==e;){if(this.IsIntermediate(e,t)){s=null;e.OutIdx>=0&&(s=this.AddOutPt(e,e.Top));i=(e=this.UpdateEdgeIntoAEL(e)).PrevInAEL;var u=e.NextInAEL;if(null!==i&&i.Curr.X===e.Bot.X&&i.Curr.Y===e.Bot.Y&&null!==s&&i.OutIdx>=0&&i.Curr.Y===i.Top.Y&&n.ClipperBase.SlopesEqual5(e.Curr,e.Top,i.Curr,i.Top,this.m_UseFullRange)&&0!==e.WindDelta&&0!==i.WindDelta){l=this.AddOutPt(ePrev2,e.Bot);this.AddJoin(s,l,e.Top)}else if(null!==u&&u.Curr.X===e.Bot.X&&u.Curr.Y===e.Bot.Y&&null!==s&&u.OutIdx>=0&&u.Curr.Y===u.Top.Y&&n.ClipperBase.SlopesEqual5(e.Curr,e.Top,u.Curr,u.Top,this.m_UseFullRange)&&0!==e.WindDelta&&0!==u.WindDelta){l=this.AddOutPt(u,e.Bot);this.AddJoin(s,l,e.Top)}}e=e.NextInAEL}},n.Clipper.prototype.DoMaxima=function(t){var e=this.GetMaximaPairEx(t);if(null===e)return t.OutIdx>=0&&this.AddOutPt(t,t.Top),void this.DeleteFromAEL(t);for(var r=t.NextInAEL;null!==r&&r!==e;)this.IntersectEdges(t,r,t.Top),this.SwapPositionsInAEL(t,r),r=t.NextInAEL;-1===t.OutIdx&&-1===e.OutIdx?(this.DeleteFromAEL(t),this.DeleteFromAEL(e)):t.OutIdx>=0&&e.OutIdx>=0?(t.OutIdx>=0&&this.AddLocalMaxPoly(t,e,t.Top),this.DeleteFromAEL(t),this.DeleteFromAEL(e)):n.use_lines&&0===t.WindDelta?(t.OutIdx>=0&&(this.AddOutPt(t,t.Top),t.OutIdx=n.ClipperBase.Unassigned),this.DeleteFromAEL(t),e.OutIdx>=0&&(this.AddOutPt(e,t.Top),e.OutIdx=n.ClipperBase.Unassigned),this.DeleteFromAEL(e)):n.Error("DoMaxima error")},n.Clipper.ReversePaths=function(t){for(var e=0,n=t.length;e<n;e++)t[e].reverse()},n.Clipper.Orientation=function(t){return n.Clipper.Area(t)>=0},n.Clipper.prototype.PointCount=function(t){if(null===t)return 0;var e=0,n=t;do{e++,n=n.Next}while(n!==t);return e},n.Clipper.prototype.BuildResult=function(t){n.Clear(t);for(var e=0,r=this.m_PolyOuts.length;e<r;e++){var o=this.m_PolyOuts[e];if(null!==o.Pts){var i=o.Pts.Prev,a=this.PointCount(i);if(!(a<2)){for(var s=new Array(a),l=0;l<a;l++)s[l]=i.Pt,i=i.Prev;t.push(s)}}}},n.Clipper.prototype.BuildResult2=function(t){t.Clear();for(var e=0,r=this.m_PolyOuts.length;e<r;e++){var o=this.m_PolyOuts[e],i=this.PointCount(o.Pts);if(!(o.IsOpen&&i<2||!o.IsOpen&&i<3)){this.FixHoleLinkage(o);var a=new n.PolyNode;t.m_AllPolys.push(a),o.PolyNode=a,a.m_polygon.length=i;for(var s=o.Pts.Prev,l=0;l<i;l++)a.m_polygon[l]=s.Pt,s=s.Prev}}for(e=0,r=this.m_PolyOuts.length;e<r;e++){null!==(o=this.m_PolyOuts[e]).PolyNode&&(o.IsOpen?(o.PolyNode.IsOpen=!0,t.AddChild(o.PolyNode)):null!==o.FirstLeft&&null!==o.FirstLeft.PolyNode?o.FirstLeft.PolyNode.AddChild(o.PolyNode):t.AddChild(o.PolyNode))}},n.Clipper.prototype.FixupOutPolyline=function(t){for(var e=t.Pts,r=e.Prev;e!==r;)if(e=e.Next,n.IntPoint.op_Equality(e.Pt,e.Prev.Pt)){e===r&&(r=e.Prev);var o=e.Prev;o.Next=e.Next,e.Next.Prev=o,e=o}e===e.Prev&&(t.Pts=null)},n.Clipper.prototype.FixupOutPolygon=function(t){var e=null;t.BottomPt=null;for(var r=t.Pts,o=this.PreserveCollinear||this.StrictlySimple;;){if(r.Prev===r||r.Prev===r.Next)return void(t.Pts=null);if(n.IntPoint.op_Equality(r.Pt,r.Next.Pt)||n.IntPoint.op_Equality(r.Pt,r.Prev.Pt)||n.ClipperBase.SlopesEqual4(r.Prev.Pt,r.Pt,r.Next.Pt,this.m_UseFullRange)&&(!o||!this.Pt2IsBetweenPt1AndPt3(r.Prev.Pt,r.Pt,r.Next.Pt)))e=null,r.Prev.Next=r.Next,r.Next.Prev=r.Prev,r=r.Prev;else{if(r===e)break;null===e&&(e=r),r=r.Next}}t.Pts=r},n.Clipper.prototype.DupOutPt=function(t,e){var r=new n.OutPt;return r.Pt.X=t.Pt.X,r.Pt.Y=t.Pt.Y,n.use_xyz&&(r.Pt.Z=t.Pt.Z),r.Idx=t.Idx,e?(r.Next=t.Next,r.Prev=t,t.Next.Prev=r,t.Next=r):(r.Prev=t.Prev,r.Next=t,t.Prev.Next=r,t.Prev=r),r},n.Clipper.prototype.GetOverlap=function(t,e,n,r,o){return t<e?n<r?(o.Left=Math.max(t,n),o.Right=Math.min(e,r)):(o.Left=Math.max(t,r),o.Right=Math.min(e,n)):n<r?(o.Left=Math.max(e,n),o.Right=Math.min(t,r)):(o.Left=Math.max(e,r),o.Right=Math.min(t,n)),o.Left<o.Right},n.Clipper.prototype.JoinHorz=function(t,e,r,o,i,a){var s=t.Pt.X>e.Pt.X?n.Direction.dRightToLeft:n.Direction.dLeftToRight,l=r.Pt.X>o.Pt.X?n.Direction.dRightToLeft:n.Direction.dLeftToRight;if(s===l)return!1;if(s===n.Direction.dLeftToRight){for(;t.Next.Pt.X<=i.X&&t.Next.Pt.X>=t.Pt.X&&t.Next.Pt.Y===i.Y;)t=t.Next;a&&t.Pt.X!==i.X&&(t=t.Next),e=this.DupOutPt(t,!a),n.IntPoint.op_Inequality(e.Pt,i)&&((t=e).Pt.X=i.X,t.Pt.Y=i.Y,n.use_xyz&&(t.Pt.Z=i.Z),e=this.DupOutPt(t,!a))}else{for(;t.Next.Pt.X>=i.X&&t.Next.Pt.X<=t.Pt.X&&t.Next.Pt.Y===i.Y;)t=t.Next;a||t.Pt.X===i.X||(t=t.Next),e=this.DupOutPt(t,a),n.IntPoint.op_Inequality(e.Pt,i)&&((t=e).Pt.X=i.X,t.Pt.Y=i.Y,n.use_xyz&&(t.Pt.Z=i.Z),e=this.DupOutPt(t,a))}if(l===n.Direction.dLeftToRight){for(;r.Next.Pt.X<=i.X&&r.Next.Pt.X>=r.Pt.X&&r.Next.Pt.Y===i.Y;)r=r.Next;a&&r.Pt.X!==i.X&&(r=r.Next),o=this.DupOutPt(r,!a),n.IntPoint.op_Inequality(o.Pt,i)&&((r=o).Pt.X=i.X,r.Pt.Y=i.Y,n.use_xyz&&(r.Pt.Z=i.Z),o=this.DupOutPt(r,!a))}else{for(;r.Next.Pt.X>=i.X&&r.Next.Pt.X<=r.Pt.X&&r.Next.Pt.Y===i.Y;)r=r.Next;a||r.Pt.X===i.X||(r=r.Next),o=this.DupOutPt(r,a),n.IntPoint.op_Inequality(o.Pt,i)&&((r=o).Pt.X=i.X,r.Pt.Y=i.Y,n.use_xyz&&(r.Pt.Z=i.Z),o=this.DupOutPt(r,a))}return s===n.Direction.dLeftToRight===a?(t.Prev=r,r.Next=t,e.Next=o,o.Prev=e):(t.Next=r,r.Prev=t,e.Prev=o,o.Next=e),!0},n.Clipper.prototype.JoinPoints=function(t,e,r){var o=t.OutPt1,i=new n.OutPt,a=t.OutPt2,s=new n.OutPt,l=t.OutPt1.Pt.Y===t.OffPt.Y;if(l&&n.IntPoint.op_Equality(t.OffPt,t.OutPt1.Pt)&&n.IntPoint.op_Equality(t.OffPt,t.OutPt2.Pt)){if(e!==r)return!1;for(i=t.OutPt1.Next;i!==o&&n.IntPoint.op_Equality(i.Pt,t.OffPt);)i=i.Next;var u=i.Pt.Y>t.OffPt.Y;for(s=t.OutPt2.Next;s!==a&&n.IntPoint.op_Equality(s.Pt,t.OffPt);)s=s.Next;return u!==s.Pt.Y>t.OffPt.Y&&(u?(i=this.DupOutPt(o,!1),s=this.DupOutPt(a,!0),o.Prev=a,a.Next=o,i.Next=s,s.Prev=i,t.OutPt1=o,t.OutPt2=i,!0):(i=this.DupOutPt(o,!0),s=this.DupOutPt(a,!1),o.Next=a,a.Prev=o,i.Prev=s,s.Next=i,t.OutPt1=o,t.OutPt2=i,!0))}if(l){for(i=o;o.Prev.Pt.Y===o.Pt.Y&&o.Prev!==i&&o.Prev!==a;)o=o.Prev;for(;i.Next.Pt.Y===i.Pt.Y&&i.Next!==o&&i.Next!==a;)i=i.Next;if(i.Next===o||i.Next===a)return!1;for(s=a;a.Prev.Pt.Y===a.Pt.Y&&a.Prev!==s&&a.Prev!==i;)a=a.Prev;for(;s.Next.Pt.Y===s.Pt.Y&&s.Next!==a&&s.Next!==o;)s=s.Next;if(s.Next===a||s.Next===o)return!1;var c={Left:null,Right:null};if(!this.GetOverlap(o.Pt.X,i.Pt.X,a.Pt.X,s.Pt.X,c))return!1;var h,p=c.Left,d=c.Right,f=new n.IntPoint0;return o.Pt.X>=p&&o.Pt.X<=d?(f.X=o.Pt.X,f.Y=o.Pt.Y,n.use_xyz&&(f.Z=o.Pt.Z),h=o.Pt.X>i.Pt.X):a.Pt.X>=p&&a.Pt.X<=d?(f.X=a.Pt.X,f.Y=a.Pt.Y,n.use_xyz&&(f.Z=a.Pt.Z),h=a.Pt.X>s.Pt.X):i.Pt.X>=p&&i.Pt.X<=d?(f.X=i.Pt.X,f.Y=i.Pt.Y,n.use_xyz&&(f.Z=i.Pt.Z),h=i.Pt.X>o.Pt.X):(f.X=s.Pt.X,f.Y=s.Pt.Y,n.use_xyz&&(f.Z=s.Pt.Z),h=s.Pt.X>a.Pt.X),t.OutPt1=o,t.OutPt2=a,this.JoinHorz(o,i,a,s,f,h)}for(i=o.Next;n.IntPoint.op_Equality(i.Pt,o.Pt)&&i!==o;)i=i.Next;var m=i.Pt.Y>o.Pt.Y||!n.ClipperBase.SlopesEqual4(o.Pt,i.Pt,t.OffPt,this.m_UseFullRange);if(m){for(i=o.Prev;n.IntPoint.op_Equality(i.Pt,o.Pt)&&i!==o;)i=i.Prev;if(i.Pt.Y>o.Pt.Y||!n.ClipperBase.SlopesEqual4(o.Pt,i.Pt,t.OffPt,this.m_UseFullRange))return!1}for(s=a.Next;n.IntPoint.op_Equality(s.Pt,a.Pt)&&s!==a;)s=s.Next;var g=s.Pt.Y>a.Pt.Y||!n.ClipperBase.SlopesEqual4(a.Pt,s.Pt,t.OffPt,this.m_UseFullRange);if(g){for(s=a.Prev;n.IntPoint.op_Equality(s.Pt,a.Pt)&&s!==a;)s=s.Prev;if(s.Pt.Y>a.Pt.Y||!n.ClipperBase.SlopesEqual4(a.Pt,s.Pt,t.OffPt,this.m_UseFullRange))return!1}return i!==o&&s!==a&&i!==s&&(e!==r||m!==g)&&(m?(i=this.DupOutPt(o,!1),s=this.DupOutPt(a,!0),o.Prev=a,a.Next=o,i.Next=s,s.Prev=i,t.OutPt1=o,t.OutPt2=i,!0):(i=this.DupOutPt(o,!0),s=this.DupOutPt(a,!1),o.Next=a,a.Prev=o,i.Prev=s,s.Next=i,t.OutPt1=o,t.OutPt2=i,!0))},n.Clipper.GetBounds=function(t){for(var e=0,r=t.length;e<r&&0===t[e].length;)e++;if(e===r)return new n.IntRect(0,0,0,0);var o=new n.IntRect;for(o.left=t[e][0].X,o.right=o.left,o.top=t[e][0].Y,o.bottom=o.top;e<r;e++)for(var i=0,a=t[e].length;i<a;i++)t[e][i].X<o.left?o.left=t[e][i].X:t[e][i].X>o.right&&(o.right=t[e][i].X),t[e][i].Y<o.top?o.top=t[e][i].Y:t[e][i].Y>o.bottom&&(o.bottom=t[e][i].Y);return o},n.Clipper.prototype.GetBounds2=function(t){var e=t,r=new n.IntRect;for(r.left=t.Pt.X,r.right=t.Pt.X,r.top=t.Pt.Y,r.bottom=t.Pt.Y,t=t.Next;t!==e;)t.Pt.X<r.left&&(r.left=t.Pt.X),t.Pt.X>r.right&&(r.right=t.Pt.X),t.Pt.Y<r.top&&(r.top=t.Pt.Y),t.Pt.Y>r.bottom&&(r.bottom=t.Pt.Y),t=t.Next;return r},n.Clipper.PointInPolygon=function(t,e){var n=0,r=e.length;if(r<3)return 0;for(var o=e[0],i=1;i<=r;++i){var a=i===r?e[0]:e[i];if(a.Y===t.Y&&(a.X===t.X||o.Y===t.Y&&a.X>t.X==o.X<t.X))return-1;if(o.Y<t.Y!=a.Y<t.Y)if(o.X>=t.X)if(a.X>t.X)n=1-n;else{if(0===(s=(o.X-t.X)*(a.Y-t.Y)-(a.X-t.X)*(o.Y-t.Y)))return-1;s>0==a.Y>o.Y&&(n=1-n)}else if(a.X>t.X){var s;if(0===(s=(o.X-t.X)*(a.Y-t.Y)-(a.X-t.X)*(o.Y-t.Y)))return-1;s>0==a.Y>o.Y&&(n=1-n)}o=a}return n},n.Clipper.prototype.PointInPolygon=function(t,e){var n=0,r=e,o=t.X,i=t.Y,a=e.Pt.X,s=e.Pt.Y;do{var l=(e=e.Next).Pt.X,u=e.Pt.Y;if(u===i&&(l===o||s===i&&l>o==a<o))return-1;if(s<i!=u<i)if(a>=o)if(l>o)n=1-n;else{if(0===(c=(a-o)*(u-i)-(l-o)*(s-i)))return-1;c>0==u>s&&(n=1-n)}else if(l>o){var c;if(0===(c=(a-o)*(u-i)-(l-o)*(s-i)))return-1;c>0==u>s&&(n=1-n)}a=l,s=u}while(r!==e);return n},n.Clipper.prototype.Poly2ContainsPoly1=function(t,e){var n=t;do{var r=this.PointInPolygon(n.Pt,e);if(r>=0)return r>0;n=n.Next}while(n!==t);return!0},n.Clipper.prototype.FixupFirstLefts1=function(t,e){for(var r,o,i=0,a=this.m_PolyOuts.length;i<a;i++)r=this.m_PolyOuts[i],o=n.Clipper.ParseFirstLeft(r.FirstLeft),null!==r.Pts&&o===t&&this.Poly2ContainsPoly1(r.Pts,e.Pts)&&(r.FirstLeft=e)},n.Clipper.prototype.FixupFirstLefts2=function(t,e){for(var r,o,i=e.FirstLeft,a=0,s=this.m_PolyOuts.length;a<s;a++)null!==(r=this.m_PolyOuts[a]).Pts&&r!==e&&r!==t&&((o=n.Clipper.ParseFirstLeft(r.FirstLeft))!==i&&o!==t&&o!==e||(this.Poly2ContainsPoly1(r.Pts,t.Pts)?r.FirstLeft=t:this.Poly2ContainsPoly1(r.Pts,e.Pts)?r.FirstLeft=e:r.FirstLeft!==t&&r.FirstLeft!==e||(r.FirstLeft=i)))},n.Clipper.prototype.FixupFirstLefts3=function(t,e){for(var r,o,i=0,a=this.m_PolyOuts.length;i<a;i++)r=this.m_PolyOuts[i],o=n.Clipper.ParseFirstLeft(r.FirstLeft),null!==r.Pts&&o===t&&(r.FirstLeft=e)},n.Clipper.ParseFirstLeft=function(t){for(;null!==t&&null===t.Pts;)t=t.FirstLeft;return t},n.Clipper.prototype.JoinCommonEdges=function(){for(var t=0,e=this.m_Joins.length;t<e;t++){var n,r=this.m_Joins[t],o=this.GetOutRec(r.OutPt1.Idx),i=this.GetOutRec(r.OutPt2.Idx);if(null!==o.Pts&&null!==i.Pts)if(!o.IsOpen&&!i.IsOpen)n=o===i?o:this.OutRec1RightOfOutRec2(o,i)?i:this.OutRec1RightOfOutRec2(i,o)?o:this.GetLowermostRec(o,i),this.JoinPoints(r,o,i)&&(o===i?(o.Pts=r.OutPt1,o.BottomPt=null,(i=this.CreateOutRec()).Pts=r.OutPt2,this.UpdateOutPtIdxs(i),this.Poly2ContainsPoly1(i.Pts,o.Pts)?(i.IsHole=!o.IsHole,i.FirstLeft=o,this.m_UsingPolyTree&&this.FixupFirstLefts2(i,o),(i.IsHole^this.ReverseSolution)==this.Area$1(i)>0&&this.ReversePolyPtLinks(i.Pts)):this.Poly2ContainsPoly1(o.Pts,i.Pts)?(i.IsHole=o.IsHole,o.IsHole=!i.IsHole,i.FirstLeft=o.FirstLeft,o.FirstLeft=i,this.m_UsingPolyTree&&this.FixupFirstLefts2(o,i),(o.IsHole^this.ReverseSolution)==this.Area$1(o)>0&&this.ReversePolyPtLinks(o.Pts)):(i.IsHole=o.IsHole,i.FirstLeft=o.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(o,i))):(i.Pts=null,i.BottomPt=null,i.Idx=o.Idx,o.IsHole=n.IsHole,n===i&&(o.FirstLeft=i.FirstLeft),i.FirstLeft=o,this.m_UsingPolyTree&&this.FixupFirstLefts3(i,o)))}},n.Clipper.prototype.UpdateOutPtIdxs=function(t){var e=t.Pts;do{e.Idx=t.Idx,e=e.Prev}while(e!==t.Pts)},n.Clipper.prototype.DoSimplePolygons=function(){for(var t=0;t<this.m_PolyOuts.length;){var e=this.m_PolyOuts[t++],r=e.Pts;if(null!==r&&!e.IsOpen)do{for(var o=r.Next;o!==e.Pts;){if(n.IntPoint.op_Equality(r.Pt,o.Pt)&&o.Next!==r&&o.Prev!==r){var i=r.Prev,a=o.Prev;r.Prev=a,a.Next=r,o.Prev=i,i.Next=o,e.Pts=r;var s=this.CreateOutRec();s.Pts=o,this.UpdateOutPtIdxs(s),this.Poly2ContainsPoly1(s.Pts,e.Pts)?(s.IsHole=!e.IsHole,s.FirstLeft=e,this.m_UsingPolyTree&&this.FixupFirstLefts2(s,e)):this.Poly2ContainsPoly1(e.Pts,s.Pts)?(s.IsHole=e.IsHole,e.IsHole=!s.IsHole,s.FirstLeft=e.FirstLeft,e.FirstLeft=s,this.m_UsingPolyTree&&this.FixupFirstLefts2(e,s)):(s.IsHole=e.IsHole,s.FirstLeft=e.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(e,s)),o=r}o=o.Next}r=r.Next}while(r!==e.Pts)}},n.Clipper.Area=function(t){if(!Array.isArray(t))return 0;var e=t.length;if(e<3)return 0;for(var n=0,r=0,o=e-1;r<e;++r)n+=(t[o].X+t[r].X)*(t[o].Y-t[r].Y),o=r;return.5*-n},n.Clipper.prototype.Area=function(t){var e=t;if(null===t)return 0;var n=0;do{n+=(t.Prev.Pt.X+t.Pt.X)*(t.Prev.Pt.Y-t.Pt.Y),t=t.Next}while(t!==e);return.5*n},n.Clipper.prototype.Area$1=function(t){return this.Area(t.Pts)},n.Clipper.SimplifyPolygon=function(t,e){var r=new Array,o=new n.Clipper(0);return o.StrictlySimple=!0,o.AddPath(t,n.PolyType.ptSubject,!0),o.Execute(n.ClipType.ctUnion,r,e,e),r},n.Clipper.SimplifyPolygons=function(t,e){void 0===e&&(e=n.PolyFillType.pftEvenOdd);var r=new Array,o=new n.Clipper(0);return o.StrictlySimple=!0,o.AddPaths(t,n.PolyType.ptSubject,!0),o.Execute(n.ClipType.ctUnion,r,e,e),r},n.Clipper.DistanceSqrd=function(t,e){var n=t.X-e.X,r=t.Y-e.Y;return n*n+r*r},n.Clipper.DistanceFromLineSqrd=function(t,e,n){var r=e.Y-n.Y,o=n.X-e.X,i=r*e.X+o*e.Y;return(i=r*t.X+o*t.Y-i)*i/(r*r+o*o)},n.Clipper.SlopesNearCollinear=function(t,e,r,o){return Math.abs(t.X-e.X)>Math.abs(t.Y-e.Y)?t.X>e.X==t.X<r.X?n.Clipper.DistanceFromLineSqrd(t,e,r)<o:e.X>t.X==e.X<r.X?n.Clipper.DistanceFromLineSqrd(e,t,r)<o:n.Clipper.DistanceFromLineSqrd(r,t,e)<o:t.Y>e.Y==t.Y<r.Y?n.Clipper.DistanceFromLineSqrd(t,e,r)<o:e.Y>t.Y==e.Y<r.Y?n.Clipper.DistanceFromLineSqrd(e,t,r)<o:n.Clipper.DistanceFromLineSqrd(r,t,e)<o},n.Clipper.PointsAreClose=function(t,e,n){var r=t.X-e.X,o=t.Y-e.Y;return r*r+o*o<=n},n.Clipper.ExcludeOp=function(t){var e=t.Prev;return e.Next=t.Next,t.Next.Prev=e,e.Idx=0,e},n.Clipper.CleanPolygon=function(t,e){void 0===e&&(e=1.415);var r=t.length;if(0===r)return new Array;for(var o=new Array(r),i=0;i<r;++i)o[i]=new n.OutPt;for(i=0;i<r;++i)o[i].Pt=t[i],o[i].Next=o[(i+1)%r],o[i].Next.Prev=o[i],o[i].Idx=0;for(var a=e*e,s=o[0];0===s.Idx&&s.Next!==s.Prev;)n.Clipper.PointsAreClose(s.Pt,s.Prev.Pt,a)?(s=n.Clipper.ExcludeOp(s),r--):n.Clipper.PointsAreClose(s.Prev.Pt,s.Next.Pt,a)?(n.Clipper.ExcludeOp(s.Next),s=n.Clipper.ExcludeOp(s),r-=2):n.Clipper.SlopesNearCollinear(s.Prev.Pt,s.Pt,s.Next.Pt,a)?(s=n.Clipper.ExcludeOp(s),r--):(s.Idx=1,s=s.Next);r<3&&(r=0);var l=new Array(r);for(i=0;i<r;++i)l[i]=new n.IntPoint1(s.Pt),s=s.Next;return o=null,l},n.Clipper.CleanPolygons=function(t,e){for(var r=new Array(t.length),o=0,i=t.length;o<i;o++)r[o]=n.Clipper.CleanPolygon(t[o],e);return r},n.Clipper.Minkowski=function(t,e,r,o){var i=o?1:0,a=t.length,s=e.length,l=new Array;if(r)for(var u=0;u<s;u++){for(var c=new Array(a),h=0,p=t.length,d=t[h];h<p;d=t[++h])c[h]=new n.IntPoint2(e[u].X+d.X,e[u].Y+d.Y);l.push(c)}else for(u=0;u<s;u++){for(c=new Array(a),h=0,p=t.length,d=t[h];h<p;d=t[++h])c[h]=new n.IntPoint2(e[u].X-d.X,e[u].Y-d.Y);l.push(c)}var f=new Array;for(u=0;u<s-1+i;u++)for(h=0;h<a;h++){var m=new Array;m.push(l[u%s][h%a]),m.push(l[(u+1)%s][h%a]),m.push(l[(u+1)%s][(h+1)%a]),m.push(l[u%s][(h+1)%a]),n.Clipper.Orientation(m)||m.reverse(),f.push(m)}return f},n.Clipper.MinkowskiSum=function(t,e,r){if(e[0]instanceof Array){u=e;for(var o=new n.Paths,i=(s=new n.Clipper,0);i<u.length;++i){var a=n.Clipper.Minkowski(t,u[i],!0,r);if(s.AddPaths(a,n.PolyType.ptSubject,!0),r){l=n.Clipper.TranslatePath(u[i],t[0]);s.AddPath(l,n.PolyType.ptClip,!0)}}return s.Execute(n.ClipType.ctUnion,o,n.PolyFillType.pftNonZero,n.PolyFillType.pftNonZero),o}var s,l=e,u=n.Clipper.Minkowski(t,l,!0,r);return(s=new n.Clipper).AddPaths(u,n.PolyType.ptSubject,!0),s.Execute(n.ClipType.ctUnion,u,n.PolyFillType.pftNonZero,n.PolyFillType.pftNonZero),u},n.Clipper.TranslatePath=function(t,e){for(var r=new n.Path,o=0;o<t.length;o++)r.push(new n.IntPoint2(t[o].X+e.X,t[o].Y+e.Y));return r},n.Clipper.MinkowskiDiff=function(t,e){var r=n.Clipper.Minkowski(t,e,!1,!0),o=new n.Clipper;return o.AddPaths(r,n.PolyType.ptSubject,!0),o.Execute(n.ClipType.ctUnion,r,n.PolyFillType.pftNonZero,n.PolyFillType.pftNonZero),r},n.Clipper.PolyTreeToPaths=function(t){var e=new Array;return n.Clipper.AddPolyNodeToPaths(t,n.Clipper.NodeType.ntAny,e),e},n.Clipper.AddPolyNodeToPaths=function(t,e,r){var o=!0;switch(e){case n.Clipper.NodeType.ntOpen:return;case n.Clipper.NodeType.ntClosed:o=!t.IsOpen}t.m_polygon.length>0&&o&&r.push(t.m_polygon);for(var i=0,a=t.Childs(),s=a.length,l=a[i];i<s;l=a[++i])n.Clipper.AddPolyNodeToPaths(l,e,r)},n.Clipper.OpenPathsFromPolyTree=function(t){for(var e=new n.Paths,r=0,o=t.ChildCount();r<o;r++)t.Childs()[r].IsOpen&&e.push(t.Childs()[r].m_polygon);return e},n.Clipper.ClosedPathsFromPolyTree=function(t){var e=new n.Paths;return n.Clipper.AddPolyNodeToPaths(t,n.Clipper.NodeType.ntClosed,e),e},k(n.Clipper,n.ClipperBase),n.Clipper.NodeType={ntAny:0,ntOpen:1,ntClosed:2},n.ClipperOffset=function(t,e){void 0===t&&(t=2),void 0===e&&(e=n.ClipperOffset.def_arc_tolerance),this.m_destPolys=new n.Paths,this.m_srcPoly=new n.Path,this.m_destPoly=new n.Path,this.m_normals=new Array,this.m_delta=0,this.m_sinA=0,this.m_sin=0,this.m_cos=0,this.m_miterLim=0,this.m_StepsPerRad=0,this.m_lowest=new n.IntPoint0,this.m_polyNodes=new n.PolyNode,this.MiterLimit=t,this.ArcTolerance=e,this.m_lowest.X=-1},n.ClipperOffset.two_pi=6.28318530717959,n.ClipperOffset.def_arc_tolerance=.25,n.ClipperOffset.prototype.Clear=function(){n.Clear(this.m_polyNodes.Childs()),this.m_lowest.X=-1},n.ClipperOffset.Round=n.Clipper.Round,n.ClipperOffset.prototype.AddPath=function(t,e,r){var o=t.length-1;if(!(o<0)){var i=new n.PolyNode;if(i.m_jointype=e,i.m_endtype=r,r===n.EndType.etClosedLine||r===n.EndType.etClosedPolygon)for(;o>0&&n.IntPoint.op_Equality(t[0],t[o]);)o--;i.m_polygon.push(t[0]);for(var a=0,s=0,l=1;l<=o;l++)n.IntPoint.op_Inequality(i.m_polygon[a],t[l])&&(a++,i.m_polygon.push(t[l]),(t[l].Y>i.m_polygon[s].Y||t[l].Y===i.m_polygon[s].Y&&t[l].X<i.m_polygon[s].X)&&(s=a));if(!(r===n.EndType.etClosedPolygon&&a<2)&&(this.m_polyNodes.AddChild(i),r===n.EndType.etClosedPolygon))if(this.m_lowest.X<0)this.m_lowest=new n.IntPoint2(this.m_polyNodes.ChildCount()-1,s);else{var u=this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon[this.m_lowest.Y];(i.m_polygon[s].Y>u.Y||i.m_polygon[s].Y===u.Y&&i.m_polygon[s].X<u.X)&&(this.m_lowest=new n.IntPoint2(this.m_polyNodes.ChildCount()-1,s))}}},n.ClipperOffset.prototype.AddPaths=function(t,e,n){for(var r=0,o=t.length;r<o;r++)this.AddPath(t[r],e,n)},n.ClipperOffset.prototype.FixOrientations=function(){if(this.m_lowest.X>=0&&!n.Clipper.Orientation(this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon))for(var t=0;t<this.m_polyNodes.ChildCount();t++){((e=this.m_polyNodes.Childs()[t]).m_endtype===n.EndType.etClosedPolygon||e.m_endtype===n.EndType.etClosedLine&&n.Clipper.Orientation(e.m_polygon))&&e.m_polygon.reverse()}else for(t=0;t<this.m_polyNodes.ChildCount();t++){var e;(e=this.m_polyNodes.Childs()[t]).m_endtype!==n.EndType.etClosedLine||n.Clipper.Orientation(e.m_polygon)||e.m_polygon.reverse()}},n.ClipperOffset.GetUnitNormal=function(t,e){var r=e.X-t.X,o=e.Y-t.Y;if(0===r&&0===o)return new n.DoublePoint2(0,0);var i=1/Math.sqrt(r*r+o*o);return r*=i,o*=i,new n.DoublePoint2(o,-r)},n.ClipperOffset.prototype.DoOffset=function(t){if(this.m_destPolys=new Array,this.m_delta=t,n.ClipperBase.near_zero(t))for(var e=0;e<this.m_polyNodes.ChildCount();e++){(i=this.m_polyNodes.Childs()[e]).m_endtype===n.EndType.etClosedPolygon&&this.m_destPolys.push(i.m_polygon)}else{var r;this.MiterLimit>2?this.m_miterLim=2/(this.MiterLimit*this.MiterLimit):this.m_miterLim=.5,r=this.ArcTolerance<=0?n.ClipperOffset.def_arc_tolerance:this.ArcTolerance>Math.abs(t)*n.ClipperOffset.def_arc_tolerance?Math.abs(t)*n.ClipperOffset.def_arc_tolerance:this.ArcTolerance;var o=3.14159265358979/Math.acos(1-r/Math.abs(t));this.m_sin=Math.sin(n.ClipperOffset.two_pi/o),this.m_cos=Math.cos(n.ClipperOffset.two_pi/o),this.m_StepsPerRad=o/n.ClipperOffset.two_pi,t<0&&(this.m_sin=-this.m_sin);for(e=0;e<this.m_polyNodes.ChildCount();e++){var i=this.m_polyNodes.Childs()[e];this.m_srcPoly=i.m_polygon;var a=this.m_srcPoly.length;if(!(0===a||t<=0&&(a<3||i.m_endtype!==n.EndType.etClosedPolygon)))if(this.m_destPoly=new Array,1!==a){this.m_normals.length=0;for(p=0;p<a-1;p++)this.m_normals.push(n.ClipperOffset.GetUnitNormal(this.m_srcPoly[p],this.m_srcPoly[p+1]));if(i.m_endtype===n.EndType.etClosedLine||i.m_endtype===n.EndType.etClosedPolygon?this.m_normals.push(n.ClipperOffset.GetUnitNormal(this.m_srcPoly[a-1],this.m_srcPoly[0])):this.m_normals.push(new n.DoublePoint1(this.m_normals[a-2])),i.m_endtype===n.EndType.etClosedPolygon){var s=a-1;for(p=0;p<a;p++)s=this.OffsetPoint(p,s,i.m_jointype);this.m_destPolys.push(this.m_destPoly)}else if(i.m_endtype===n.EndType.etClosedLine){for(s=a-1,p=0;p<a;p++)s=this.OffsetPoint(p,s,i.m_jointype);this.m_destPolys.push(this.m_destPoly),this.m_destPoly=new Array;var l=this.m_normals[a-1];for(p=a-1;p>0;p--)this.m_normals[p]=new n.DoublePoint2(-this.m_normals[p-1].X,-this.m_normals[p-1].Y);this.m_normals[0]=new n.DoublePoint2(-l.X,-l.Y),s=0;for(p=a-1;p>=0;p--)s=this.OffsetPoint(p,s,i.m_jointype);this.m_destPolys.push(this.m_destPoly)}else{var u;for(s=0,p=1;p<a-1;++p)s=this.OffsetPoint(p,s,i.m_jointype);if(i.m_endtype===n.EndType.etOpenButt){p=a-1;u=new n.IntPoint2(n.ClipperOffset.Round(this.m_srcPoly[p].X+this.m_normals[p].X*t),n.ClipperOffset.Round(this.m_srcPoly[p].Y+this.m_normals[p].Y*t)),this.m_destPoly.push(u),u=new n.IntPoint2(n.ClipperOffset.Round(this.m_srcPoly[p].X-this.m_normals[p].X*t),n.ClipperOffset.Round(this.m_srcPoly[p].Y-this.m_normals[p].Y*t)),this.m_destPoly.push(u)}else{p=a-1;s=a-2,this.m_sinA=0,this.m_normals[p]=new n.DoublePoint2(-this.m_normals[p].X,-this.m_normals[p].Y),i.m_endtype===n.EndType.etOpenSquare?this.DoSquare(p,s):this.DoRound(p,s)}for(p=a-1;p>0;p--)this.m_normals[p]=new n.DoublePoint2(-this.m_normals[p-1].X,-this.m_normals[p-1].Y);this.m_normals[0]=new n.DoublePoint2(-this.m_normals[1].X,-this.m_normals[1].Y);for(p=(s=a-1)-1;p>0;--p)s=this.OffsetPoint(p,s,i.m_jointype);i.m_endtype===n.EndType.etOpenButt?(u=new n.IntPoint2(n.ClipperOffset.Round(this.m_srcPoly[0].X-this.m_normals[0].X*t),n.ClipperOffset.Round(this.m_srcPoly[0].Y-this.m_normals[0].Y*t)),this.m_destPoly.push(u),u=new n.IntPoint2(n.ClipperOffset.Round(this.m_srcPoly[0].X+this.m_normals[0].X*t),n.ClipperOffset.Round(this.m_srcPoly[0].Y+this.m_normals[0].Y*t)),this.m_destPoly.push(u)):(s=1,this.m_sinA=0,i.m_endtype===n.EndType.etOpenSquare?this.DoSquare(0,1):this.DoRound(0,1)),this.m_destPolys.push(this.m_destPoly)}}else{if(i.m_jointype===n.JoinType.jtRound)for(var c=1,h=0,p=1;p<=o;p++){this.m_destPoly.push(new n.IntPoint2(n.ClipperOffset.Round(this.m_srcPoly[0].X+c*t),n.ClipperOffset.Round(this.m_srcPoly[0].Y+h*t)));var d=c;c=c*this.m_cos-this.m_sin*h,h=d*this.m_sin+h*this.m_cos}else{c=-1,h=-1;for(var p=0;p<4;++p)this.m_destPoly.push(new n.IntPoint2(n.ClipperOffset.Round(this.m_srcPoly[0].X+c*t),n.ClipperOffset.Round(this.m_srcPoly[0].Y+h*t))),c<0?c=1:h<0?h=1:c=-1}this.m_destPolys.push(this.m_destPoly)}}}},n.ClipperOffset.prototype.Execute=function(){var t=arguments,e=t[0]instanceof n.PolyTree;if(e){a=t[0],s=t[1];if(a.Clear(),this.FixOrientations(),this.DoOffset(s),(i=new n.Clipper(0)).AddPaths(this.m_destPolys,n.PolyType.ptSubject,!0),s>0)i.Execute(n.ClipType.ctUnion,a,n.PolyFillType.pftPositive,n.PolyFillType.pftPositive);else{u=n.Clipper.GetBounds(this.m_destPolys);if((l=new n.Path).push(new n.IntPoint2(u.left-10,u.bottom+10)),l.push(new n.IntPoint2(u.right+10,u.bottom+10)),l.push(new n.IntPoint2(u.right+10,u.top-10)),l.push(new n.IntPoint2(u.left-10,u.top-10)),i.AddPath(l,n.PolyType.ptSubject,!0),i.ReverseSolution=!0,i.Execute(n.ClipType.ctUnion,a,n.PolyFillType.pftNegative,n.PolyFillType.pftNegative),1===a.ChildCount()&&a.Childs()[0].ChildCount()>0){var r=a.Childs()[0];a.Childs()[0]=r.Childs()[0],a.Childs()[0].m_Parent=a;for(var o=1;o<r.ChildCount();o++)a.AddChild(r.Childs()[o])}else a.Clear()}}else{var i,a=t[0],s=t[1];if(n.Clear(a),this.FixOrientations(),this.DoOffset(s),(i=new n.Clipper(0)).AddPaths(this.m_destPolys,n.PolyType.ptSubject,!0),s>0)i.Execute(n.ClipType.ctUnion,a,n.PolyFillType.pftPositive,n.PolyFillType.pftPositive);else{var l,u=n.Clipper.GetBounds(this.m_destPolys);(l=new n.Path).push(new n.IntPoint2(u.left-10,u.bottom+10)),l.push(new n.IntPoint2(u.right+10,u.bottom+10)),l.push(new n.IntPoint2(u.right+10,u.top-10)),l.push(new n.IntPoint2(u.left-10,u.top-10)),i.AddPath(l,n.PolyType.ptSubject,!0),i.ReverseSolution=!0,i.Execute(n.ClipType.ctUnion,a,n.PolyFillType.pftNegative,n.PolyFillType.pftNegative),a.length>0&&a.splice(0,1)}}},n.ClipperOffset.prototype.OffsetPoint=function(t,e,r){if(this.m_sinA=this.m_normals[e].X*this.m_normals[t].Y-this.m_normals[t].X*this.m_normals[e].Y,Math.abs(this.m_sinA*this.m_delta)<1){if(this.m_normals[e].X*this.m_normals[t].X+this.m_normals[t].Y*this.m_normals[e].Y>0)return this.m_destPoly.push(new n.IntPoint2(n.ClipperOffset.Round(this.m_srcPoly[t].X+this.m_normals[e].X*this.m_delta),n.ClipperOffset.Round(this.m_srcPoly[t].Y+this.m_normals[e].Y*this.m_delta))),e}else this.m_sinA>1?this.m_sinA=1:this.m_sinA<-1&&(this.m_sinA=-1);if(this.m_sinA*this.m_delta<0)this.m_destPoly.push(new n.IntPoint2(n.ClipperOffset.Round(this.m_srcPoly[t].X+this.m_normals[e].X*this.m_delta),n.ClipperOffset.Round(this.m_srcPoly[t].Y+this.m_normals[e].Y*this.m_delta))),this.m_destPoly.push(new n.IntPoint1(this.m_srcPoly[t])),this.m_destPoly.push(new n.IntPoint2(n.ClipperOffset.Round(this.m_srcPoly[t].X+this.m_normals[t].X*this.m_delta),n.ClipperOffset.Round(this.m_srcPoly[t].Y+this.m_normals[t].Y*this.m_delta)));else switch(r){case n.JoinType.jtMiter:var o=this.m_normals[t].X*this.m_normals[e].X+this.m_normals[t].Y*this.m_normals[e].Y+1;o>=this.m_miterLim?this.DoMiter(t,e,o):this.DoSquare(t,e);break;case n.JoinType.jtSquare:this.DoSquare(t,e);break;case n.JoinType.jtRound:this.DoRound(t,e)}return e=t},n.ClipperOffset.prototype.DoSquare=function(t,e){var r=Math.tan(Math.atan2(this.m_sinA,this.m_normals[e].X*this.m_normals[t].X+this.m_normals[e].Y*this.m_normals[t].Y)/4);this.m_destPoly.push(new n.IntPoint2(n.ClipperOffset.Round(this.m_srcPoly[t].X+this.m_delta*(this.m_normals[e].X-this.m_normals[e].Y*r)),n.ClipperOffset.Round(this.m_srcPoly[t].Y+this.m_delta*(this.m_normals[e].Y+this.m_normals[e].X*r)))),this.m_destPoly.push(new n.IntPoint2(n.ClipperOffset.Round(this.m_srcPoly[t].X+this.m_delta*(this.m_normals[t].X+this.m_normals[t].Y*r)),n.ClipperOffset.Round(this.m_srcPoly[t].Y+this.m_delta*(this.m_normals[t].Y-this.m_normals[t].X*r))))},n.ClipperOffset.prototype.DoMiter=function(t,e,r){var o=this.m_delta/r;this.m_destPoly.push(new n.IntPoint2(n.ClipperOffset.Round(this.m_srcPoly[t].X+(this.m_normals[e].X+this.m_normals[t].X)*o),n.ClipperOffset.Round(this.m_srcPoly[t].Y+(this.m_normals[e].Y+this.m_normals[t].Y)*o)))},n.ClipperOffset.prototype.DoRound=function(t,e){for(var r,o=Math.atan2(this.m_sinA,this.m_normals[e].X*this.m_normals[t].X+this.m_normals[e].Y*this.m_normals[t].Y),i=Math.max(n.Cast_Int32(n.ClipperOffset.Round(this.m_StepsPerRad*Math.abs(o))),1),a=this.m_normals[e].X,s=this.m_normals[e].Y,l=0;l<i;++l)this.m_destPoly.push(new n.IntPoint2(n.ClipperOffset.Round(this.m_srcPoly[t].X+a*this.m_delta),n.ClipperOffset.Round(this.m_srcPoly[t].Y+s*this.m_delta))),r=a,a=a*this.m_cos-this.m_sin*s,s=r*this.m_sin+s*this.m_cos;this.m_destPoly.push(new n.IntPoint2(n.ClipperOffset.Round(this.m_srcPoly[t].X+this.m_normals[t].X*this.m_delta),n.ClipperOffset.Round(this.m_srcPoly[t].Y+this.m_normals[t].Y*this.m_delta)))},n.Error=function(t){try{throw new Error(t)}catch(t){alert(t.message)}},n.JS={},n.JS.AreaOfPolygon=function(t,e){return e||(e=1),n.Clipper.Area(t)/(e*e)},n.JS.AreaOfPolygons=function(t,e){e||(e=1);for(var r=0,o=0;o<t.length;o++)r+=n.Clipper.Area(t[o]);return r/(e*e)},n.JS.BoundsOfPath=function(t,e){return n.JS.BoundsOfPaths([t],e)},n.JS.BoundsOfPaths=function(t,e){e||(e=1);var r=n.Clipper.GetBounds(t);return r.left/=e,r.bottom/=e,r.right/=e,r.top/=e,r},n.JS.Clean=function(t,e){if(!(t instanceof Array))return[];var r=t[0]instanceof Array;t=n.JS.Clone(t);if("number"!=typeof e||null===e)return n.Error("Delta is not a number in Clean()."),t;if(0===t.length||1===t.length&&0===t[0].length||e<0)return t;r||(t=[t]);for(var o,i,a,s,l,u,c,h=t.length,p=[],d=0;d<h;d++)if(0!==(o=(i=t[d]).length))if(o<3)a=i,p.push(a);else{for(a=i,s=e*e,l=i[0],u=1,c=1;c<o;c++)(i[c].X-l.X)*(i[c].X-l.X)+(i[c].Y-l.Y)*(i[c].Y-l.Y)<=s||(a[u]=i[c],l=i[c],u++);l=i[u-1],(i[0].X-l.X)*(i[0].X-l.X)+(i[0].Y-l.Y)*(i[0].Y-l.Y)<=s&&u--,u<o&&a.splice(u,o-u),a.length&&p.push(a)}return!r&&p.length?p=p[0]:r||0!==p.length?r&&0===p.length&&(p=[[]]):p=[],p},n.JS.Clone=function(t){if(!(t instanceof Array))return[];if(0===t.length)return[];if(1===t.length&&0===t[0].length)return[[]];var e=t[0]instanceof Array;e||(t=[t]);var n,r,o,i,a=t.length,s=new Array(a);for(r=0;r<a;r++){for(n=t[r].length,i=new Array(n),o=0;o<n;o++)i[o]={X:t[r][o].X,Y:t[r][o].Y};s[r]=i}return e||(s=s[0]),s},n.JS.Lighten=function(t,e){if(!(t instanceof Array))return[];if("number"!=typeof e||null===e)return n.Error("Tolerance is not a number in Lighten()."),n.JS.Clone(t);if(0===t.length||1===t.length&&0===t[0].length||e<0)return n.JS.Clone(t);var r,o,i,a,s,l,u,c,h,p,d,f,m,g,v,y,w=t[0]instanceof Array;w||(t=[t]);var b=t.length,S=e*e,E=[];for(r=0;r<b;r++)if(0!==(l=(i=t[r]).length)){for(a=0;a<1e6;a++){for(s=[],i[(l=i.length)-1].X!==i[0].X||i[l-1].Y!==i[0].Y?(d=1,i.push({X:i[0].X,Y:i[0].Y}),l=i.length):d=0,p=[],o=0;o<l-2;o++)u=i[o],h=i[o+1],c=i[o+2],v=u.X,y=u.Y,f=c.X-v,m=c.Y-y,0===f&&0===m||((g=((h.X-v)*f+(h.Y-y)*m)/(f*f+m*m))>1?(v=c.X,y=c.Y):g>0&&(v+=f*g,y+=m*g)),(f=h.X-v)*f+(m=h.Y-y)*m<=S&&(p[o+1]=1,o++);for(s.push({X:i[0].X,Y:i[0].Y}),o=1;o<l-1;o++)p[o]||s.push({X:i[o].X,Y:i[o].Y});if(s.push({X:i[l-1].X,Y:i[l-1].Y}),d&&i.pop(),!p.length)break;i=s}s[(l=s.length)-1].X===s[0].X&&s[l-1].Y===s[0].Y&&s.pop(),s.length>2&&E.push(s)}return w||(E=E[0]),void 0===E&&(E=[]),E},n.JS.PerimeterOfPath=function(t,e,n){if(void 0===t)return 0;var r,o,i=Math.sqrt,a=0,s=0,l=0,u=0,c=0,h=t.length;if(h<2)return 0;for(e&&(t[h]=t[0],h++);--h;)s=(r=t[h]).X,l=r.Y,a+=i((s-(u=(o=t[h-1]).X))*(s-u)+(l-(c=o.Y))*(l-c));return e&&t.pop(),a/n},n.JS.PerimeterOfPaths=function(t,e,r){r||(r=1);for(var o=0,i=0;i<t.length;i++)o+=n.JS.PerimeterOfPath(t[i],e,r);return o},n.JS.ScaleDownPath=function(t,e){var n,r;for(e||(e=1),n=t.length;n--;)(r=t[n]).X=r.X/e,r.Y=r.Y/e},n.JS.ScaleDownPaths=function(t,e){var n,r,o;for(e||(e=1),n=t.length;n--;)for(r=t[n].length;r--;)(o=t[n][r]).X=o.X/e,o.Y=o.Y/e},n.JS.ScaleUpPath=function(t,e){var n,r,o=Math.round;for(e||(e=1),n=t.length;n--;)(r=t[n]).X=o(r.X*e),r.Y=o(r.Y*e)},n.JS.ScaleUpPaths=function(t,e){var n,r,o,i=Math.round;for(e||(e=1),n=t.length;n--;)for(r=t[n].length;r--;)(o=t[n][r]).X=i(o.X*e),o.Y=i(o.Y*e)},n.ExPolygons=function(){return[]},n.ExPolygon=function(){this.outer=null,this.holes=null},n.JS.AddOuterPolyNodeToExPolygons=function(t,e){var r=new n.ExPolygon;r.outer=t.Contour();var o,i,a,s,l,u,c=t.Childs(),h=c.length;for(r.holes=new Array(h),a=0;a<h;a++)for(o=c[a],r.holes[a]=o.Contour(),s=0,u=(l=o.Childs()).length;s<u;s++)i=l[s],n.JS.AddOuterPolyNodeToExPolygons(i,e);e.push(r)},n.JS.ExPolygonsToPaths=function(t){var e,r,o,i,a=new n.Paths;for(e=0,o=t.length;e<o;e++)for(a.push(t[e].outer),r=0,i=t[e].holes.length;r<i;r++)a.push(t[e].holes[r]);return a},n.JS.PolyTreeToExPolygons=function(t){var e,r,o,i,a=new n.ExPolygons;for(r=0,i=(o=t.Childs()).length;r<i;r++)e=o[r],n.JS.AddOuterPolyNodeToExPolygons(e,a);return a}}()})),VS=function(){function t(){Kf(this,t)}return tm(t,null,[{key:"denoise",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.TOLERANCE,n=new this.ClipperLib.Paths,r=new this.ClipperLib.ClipperOffset;return r.AddPaths(this.toClipperPolygon(t),this.ClipperLib.JoinType.jtMiter,this.ClipperLib.EndType.etClosedPolygon),r.Execute(n,this.OFFSET_SCALE*-e),r.Execute(n,this.OFFSET_SCALE*e*2),r.Execute(n,this.OFFSET_SCALE*-e),r.Clear(),this.fromClipperPolygon(n)}},{key:"offset",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.ClipperLib.EndType.etClosedPolygon,r=new this.ClipperLib.Paths,o=new this.ClipperLib.ClipperOffset;return o.AddPaths(this.toClipperPolygon(t),this.ClipperLib.JoinType.jtMiter,n),console.time("offset.execute"),o.Execute(r,this.OFFSET_SCALE*e),console.timeEnd("offset.execute"),o.Clear(),this.fromClipperPolygon(r)}},{key:"difference",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.OFFSET_SCALE,r=[],o=new this.ClipperLib.Clipper;return o.AddPaths(this.toClipperPolygon(t,n),this.ClipperLib.PolyType.ptSubject,!0),o.AddPaths(this.toClipperPolygon(e,n),this.ClipperLib.PolyType.ptClip,!0),o.Execute(this.ClipperLib.ClipType.ctDifference,r,this.ClipperLib.PolyFillType.pftNonZero,this.ClipperLib.PolyFillType.pftNonZero),o.Clear(),this.fromClipperPolygon(r,n)}},{key:"union",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.OFFSET_SCALE,n=[],r=new this.ClipperLib.Clipper;return r.AddPaths(this.toClipperPolygon(t,e),this.ClipperLib.PolyType.ptSubject,!0),r.Execute(this.ClipperLib.ClipType.ctUnion,n,this.ClipperLib.PolyFillType.pftNonZero,this.ClipperLib.PolyFillType.pftNonZero),r.Clear(),this.fromClipperPolygon(n,e)}},{key:"toClipperPolygon",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.OFFSET_SCALE;return t.map((function(t){return t.map((function(t){return{X:t.x*e,Y:t.y*e}}))}))}},{key:"fromClipperPolygon",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.OFFSET_SCALE;return t.map((function(t){return t.map((function(t){return new THREE.Vector2(t.X/e,t.Y/e)}))}))}},{key:"isPolygonsCrashed",value:function(t,e){var n=new this.ClipperLib.Paths,r=new this.ClipperLib.Clipper;return r.AddPaths(this.toClipperPolygon(t),this.ClipperLib.PolyType.ptSubject,!0),r.AddPaths(this.toClipperPolygon(e),this.ClipperLib.PolyType.ptClip,!0),r.Execute(this.ClipperLib.ClipType.ctIntersection,n,this.ClipperLib.PolyFillType.pftNonZero,this.ClipperLib.PolyFillType.pftNonZero),r.Clear(),n.length>0}}]),t}();em(VS,"TOLERANCE",.01),em(VS,"OFFSET_SCALE",10),em(VS,"ClipperLib",jS);var zS={VRApp:vw,VRObject:yw,ResourcesLoader:ww,EventListener:Dw,Animation:kw,TextHelper:Mw,Mathf:Rw,MathHelper:Aw,NameConverter:null,Segment:Hw,PanoramaMaterial:Ow,PanoramaCubeMaterial:Lw,CubeBufferGeometry:Bw,PanoramaControls:function(t,e){this.enabled=!0,this.isAutoPlay=!1,this.isAutoPlayWhenIdle=!0,this.autoPlayDelay=0,this.autoRotateSpeed=1,this.speed=1,this.minPolarAngle=THREE.Math.degToRad(-85),this.maxPolarAngle=THREE.Math.degToRad(85),this.zoomSpeed=.5,this.disableMenu=!0,this.state=-1,this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.maxFov=80,this.minFov=50,this.enableInertia=!0,this.inertiaMovingFactor=.05,this.inertiaFactor=.25,this.touchMovingSensitive=.01,this.diyMode="",this.enablePointEdit=!0,this.target=new THREE.Vector3,this.setDiyMode=function(t){this.diyMode=t},this.maxFovLimit=function(){return 1.3*this.maxFov},this.onFovChanged=function(){},this.onCameraRotated=function(){},this.onCameraRotationChanged=function(){},this.onTouchOrMouseDown=function(){},this.onFovLimitExceed=function(){},this.onLookAtChange=function(t){},this.changeFov=function(e,n){var r;r="+"===e?t.fov+n:t.fov-n,(r=Math.max(v.minFov,Math.min(v.maxFovLimit(),r)))>=v.maxFovLimit()&&v.onFovLimitExceed?v.onFovLimitExceed():(clearTimeout(this.timeoutId),this.timeoutId=setTimeout((function(){t.fov=Math.min(v.maxFov,t.fov),t.updateProjectionMatrix()}),150),t.fov=r,t.updateProjectionMatrix(),v.onFovChanged&&v.onFovChanged(r))};var n,r=!1,o=new THREE.Vector2,i=!1,a=-1,s=-1,l=0,u=0,c=0,h=0,p=0,d=0,f=[],m={theta:0,phi:0},g=(new THREE.Euler,new THREE.Spherical),v=this;function y(e,o){r=!0,function(e,n){l=e,u=n,h=t.rotation.y,d=t.rotation.x,m.theta=t.rotation.y,m.phi=t.rotation.x,f.splice(0,f.length),g.theta=0,g.phi=0}(e,o),v.isAutoPlay=!1,clearTimeout(n),v.onTouchOrMouseDown&&v.onTouchOrMouseDown()}function w(t,e){if(r&&v.enabled){var n=(t-l)*v.speed*.003+h,o=(e-u)*v.speed*.003+d;if(iw.checkIsPhone()){var i=function(t,e){var n={theta:0,phi:0};f.length>=6&&f.shift();f.push({theta:t,phi:e});for(var r=0;r<f.length;r++)n.theta+=f[r].theta,n.phi+=f[r].phi;return n.theta/=f.length,n.phi/=f.length,n}(n,o);n=i.theta,o=i.phi}o=Math.max(v.minPolarAngle,Math.min(v.maxPolarAngle,o));g.theta+=.6*(n-m.theta),g.phi+=.6*(o-m.phi),m.theta=n,m.phi=o}}function b(){r=!1,v.onLookAtChange(v.target),S()}function S(){v.isAutoPlayWhenIdle&&(n&&clearTimeout(n),n=setTimeout((function(){v.isAutoPlayWhenIdle&&(v.isAutoPlay=!1),n=void 0}),v.autoPlayDelay))}function E(e){switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:y(e.touches[0].pageX*D(),e.touches[0].pageY*D()),o.set(e.touches[0].pageX,e.touches[0].pageY),i=!1;break;case 2:o.set(e.touches[0].pageX,e.touches[0].pageY);var n=new THREE.Vector2(e.touches[1].pageX,e.touches[1].pageY);a=o.distanceTo(n),s=t.fov}}function P(n){if(v.enabled&&"outdoor"!==v.diyMode)switch(n.preventDefault(),n.stopPropagation(),n.touches.length){case 1:if(!i){var r=(n.touches[0].pageX-o.x)/e.clientWidth,l=(n.touches[0].pageY-o.y)/e.clientHeight;(Math.abs(r)>v.touchMovingSensitive||Math.abs(l)>v.touchMovingSensitive)&&(i=!0)}i&&w(n.touches[0].pageX*D(),n.touches[0].pageY*D());break;case 2:if(v.diyMode)return;var u=new THREE.Vector2(n.touches[0].pageX,n.touches[0].pageY),c=new THREE.Vector2(n.touches[1].pageX,n.touches[1].pageY),h=u.distanceTo(c),p=a/h-1;p=1+p*v.zoomSpeed;var d=s*p;(d=Math.max(v.minFov,Math.min(v.maxFovLimit(),d)))>=v.maxFovLimit()&&v.enabled?v.onFovLimitExceed():(t.fov=d,t.updateProjectionMatrix()),(d<=v.minFov||d>=v.maxFovLimit())&&(s=d,a=h)}}function x(e){e.preventDefault(),e.stopPropagation(),t.fov=Math.min(v.maxFov,t.fov),t.updateProjectionMatrix(),b(),i=!1}function _(t){t.preventDefault(),y(t.clientX*D(),t.clientY*D()),v.state=t.button}function T(t){v.enabled&&"outdoor"!==v.diyMode&&("indoor"===v.diyMode&&v.state===THREE.MOUSE.PAN||(t.preventDefault(),w(t.clientX*D(),t.clientY*D())))}function C(t){t.preventDefault(),b(),v.state=-1,"outdoor"!==v.diyMode&&("indoor"!==v.diyMode||(v.state,THREE.MOUSE.PAN))}function I(e){if(!v.diyMode&&v.enabled){var n=t.fov+.05*e.deltaY;(n=Math.max(v.minFov,Math.min(v.maxFovLimit(),n)))>=v.maxFovLimit()&&v.onFovLimitExceed?v.onFovLimitExceed():(clearTimeout(this.timeoutId),this.timeoutId=setTimeout((function(){t.fov=Math.min(v.maxFov,t.fov),t.updateProjectionMatrix()}),150),t.fov=n,t.updateProjectionMatrix(),v.onFovChanged&&v.onFovChanged(n))}}function D(){return v.speed*(t.fov/100)*(1e3/e.clientWidth)}!function(t){t||(t=document);var e=iw.checkIsPhone()?t:window;t.addEventListener("mousedown",_,!1),e.addEventListener("mousemove",T,!1),e.addEventListener("mouseup",C,!1),t.addEventListener("wheel",I,!1),t.addEventListener("touchstart",E,{passive:!1}),e.addEventListener("touchend",x,{passive:!1}),e.addEventListener("touchmove",P,{passive:!1}),v.disableMenu&&(e.oncontextmenu=function(t){return!1})}(e),function e(){requestAnimationFrame(e),function(){if(!v.enabled)return g.theta=0,void(g.phi=0);var e=t.rotation.clone();!v.enableInertia||0===g.theta&&0===g.phi||(o=r?v.inertiaMovingFactor:v.inertiaFactor,0===g.theta&&0===g.phi||(g.theta*=o,g.phi*=o,Math.abs(g.theta)<1e-6&&(g.theta=0),Math.abs(g.phi)<1e-6&&(g.phi=0)),c=t.rotation.y+g.theta,p=t.rotation.x+g.phi,function(e,n){n=Math.max(v.minPolarAngle,Math.min(v.maxPolarAngle,n)),t.rotation.x=n,t.rotation.y=e}(c,p));var o;!v.isAutoPlayWhenIdle||v.isAutoPlay||n||S();if(v.isAutoPlay&&!r){var i=.001*v.autoRotateSpeed;t.rotation.y-=i,t.rotation.x>0&&t.rotation.x-i>=0?t.rotation.x-=i:t.rotation.x<0&&t.rotation.x+i<=0?t.rotation.x+=i:t.rotation.x=0}v.isAutoPlay||e.approxEquals(t.rotation,.001745)||v.onCameraRotated(t.rotation);v.lastCameraRotation&&v.lastCameraRotation.approxEquals(t.rotation,.001745)||v.onCameraRotationChanged(t.rotation);v.lastCameraRotation=t.rotation.clone()}()}()},MeshData:Fw,MeshSection:Nw,MeshFace:jw,ModelLoader:NS,ClipperUtils:VS},WS={},GS=function(t){im(n,THREE.Group);var e=cm(n);function n(){return Kf(this,n),e.call(this)}return tm(n,null,[{key:"loadResource",value:function(t){return WS[t]||(WS[t]=zS.ResourcesLoader.loadResource(t)),WS[t]}}]),n}(),US=function(t){im(n,t);var e=cm(n);function n(t,r,o){Kf(this,n);var i={duration:0,framesCount:o=o||25,atlas:t,frame:r};return e.call(this,i,i.duration)}return tm(n,[{key:"updateAtlas",value:function(t){this.params.atlas=t}},{key:"onUpdate",value:function(t){var e=Date.now()/1e3,n=Math.floor(e*t.frame)%t.framesCount;t.atlas.repeat.x=1,t.atlas.repeat.y=1/t.framesCount,t.atlas.offset.x=0,t.atlas.offset.y=1-(n+1)/t.framesCount}},{key:"onFinish",value:function(t){t.onFinish&&t.onFinish()}}]),n}(zS.Animation),YS=hw.hotSpotHeight,XS=function(t){im(n,t);var e=cm(n);function n(t){var r;return Kf(this,n),(r=e.call(this)).hotSpotData=t,r}return tm(n,[{key:"init",value:function(){window.appConfig.isOutScene?(this._addTShapeBackground(window.appConfig.isOutScene),this._addHotSpotName(window.appConfig.isOutScene),this._setPosition()):(this._addTShapeBackground(),this._addHotSpotAnimation(),this._addHotSpotName(),this._setPosition())}},{key:"_setPosition",value:function(){this.position.copy(this.hotSpotData.Position.clone().addY(YS))}},{key:"_addHotSpotName",value:function(t){var e=zS.TextHelper.cropString(this.hotSpotData.Name,8),n=zS.TextHelper.createTextSprite(e,{fontSize:24,backgroundColor:t?{r:0,g:0,b:0,a:.5}:{r:0,g:0,b:0,a:0},textColor:t?{r:242,g:170,b:54,a:1}:{r:255,g:255,b:255,a:1},spriteScale:.5,textMargin:t?25:50,fontFace:aw.textFontFamily2D,sizeAttenuation:!1,cornerWidth:t?5:0});n.name="hotSpotNameSprite",n.hotSpotData=this.hotSpotData,n.renderOrder=12,n.eventOrder=1,n.position.y=t?45:0,this.hotSpotNameSprite=n,this.add(n)}},{key:"_addTShapeBackground",value:function(t){var e=t?GS.loadResource(mw.path.hotSpotOutScene):GS.loadResource(mw.path.labelRoomBg);e.minFilter=THREE.LinearFilter;var n=new THREE.SpriteMaterial({map:e,transparent:!0,alphaTest:.1,sizeAttenuation:!1}),r=new THREE.Sprite(n);r.scale.multiply(t?new THREE.Vector3(40,20,1):new THREE.Vector3(60,41,1)),r.position.y=10,r.position.z=0,r.renderOrder=13,r.eventOrder=1,this.add(r)}},{key:"_addHotSpotAnimation",value:function(){var t=GS.loadResource(mw.path.animateArrow),e=new US(t,25,25);t.minFilter=THREE.LinearFilter;var n=new THREE.Group;n.name="hotSpotAnimation",n.animation=e;var r=new THREE.SpriteMaterial({transparent:!0,alphaTest:.1,opacity:.9}),o=new THREE.Sprite(r);o.scale.multiplyScalar(55),o.name="hotSpotAnimationSprite",o.material.map=t,o.material.sizeAttenuation=!1,o.renderOrder=11,n.add(o),n.position.y=2,this.add(n)}},{key:"animation",get:function(){var t;return null===(t=this.getObjectByName("hotSpotAnimation"))||void 0===t?void 0:t.animation}}]),n}(GS),ZS="PROVIDE_URL",qS="ORIENTATION",JS="ORIENTATION_WITH_COMPANY_NAME",$S="NO_ORIENTATION",KS="NO_ORIENTATION_WITH_COMPANY_NAME",QS=function(t){im(n,THREE.Group);var e=cm(n);function n(t){var r;return Kf(this,n),(r=e.call(this)).houseOrientation=t.houseOrientation,r.companyName=t.companyName,r.logoUrl=t.logoUrl,r.logoType=n._getLogoType(t),r}return tm(n,[{key:"init",value:function(){var t=this._createLogoSprite();return[JS,KS].includes(this.logoType)&&!window.appConfig.panoLogoUrl&&this.add(this._createCompanyNameSprite()),this.add(t),this.rotateY(-(this.houseOrientation||0)),this}},{key:"_createLogoSprite",value:function(){var t=this._loadLogoResource();t.minFilter=THREE.LinearFilter;var e=new THREE.SpriteMaterial({transparent:!0,map:t,opacity:hw.logoOpacity}),n=new THREE.Sprite(e);return n.name="logoSprite",n.scale.set(hw.logoSize,hw.logoSize,1),this.position.y=hw.logoHeight,n}},{key:"_loadLogoResource",value:function(){var t;switch(this.logoType){case qS:t=mw.path.pcCompassEmpty;break;case JS:t=mw.path.pcCompass;break;case $S:t=mw.path.pcCompassEmptyNoDirection;break;case KS:t=mw.path.pcCompassNoDirection;break;case ZS:t=this.logoUrl;break;default:t=mw.path.pcCompassEmptyNoDirection}return t=window.appConfig.panoLogoUrl?window.appConfig.panoLogoUrl:t,zS.ResourcesLoader.loadResource(t)}},{key:"_createCompanyNameSprite",value:function(){var t,e=0===hw.companyNameSize?hw.logoSize/3:hw.companyNameSize,n=zS.ResourcesLoader.loadResource(mw.path.pcCompassLogo,(function(n){n.needsUpdate=!0,t.scale.set(e,n.image.height/n.image.width*e,e)}));n.minFilter=THREE.LinearFilter;var r=new THREE.SpriteMaterial({transparent:!0,map:n,opacity:hw.logoOpacity,depthWrite:!hw.logoDepthWrite,alphaTest:.005});return(t=new THREE.Sprite(r)).name="companyNameSprite",t.position.y=1,t}},{key:"setRotation",value:function(t){this.getObjectByName("logoSprite").material.rotation=t,this.getObjectByName("companyNameSprite")&&!hw.companyNameStatic&&(this.getObjectByName("companyNameSprite").material.rotation=t)}},{key:"setPosition",value:function(t,e,n){this.position.set(t,e,n)}}],[{key:"_getLogoType",value:function(t){var e=t.houseOrientation,n=t.companyName;return t.logoUrl?ZS:e?n?JS:qS:n?KS:$S}}]),n}();function tE(){var t={duration:800},e=this;this.defaultDuration=t.duration,this.fadeIn=function(t,e){e*=2,THREE.Util.setCubeOpacity(t.visibleCube,1-e),t.camera.fov=t.beginFov+(t.fadeInFov-t.beginFov)*e},this.fadeOut=function(t,e){t.invisibleCube&&(t.invisibleCube.visible=!0),THREE.Util.setCubeOpacity(t.invisibleCube,e),t.camera.fov=t.fadeOutFov+(t.targetZoomFov-t.fadeOutFov)*e,e>.1&&!t.isHotSpotsShowed&&(t.isHotSpotsShowed=!0,t.onShowHotSpots&&t.onShowHotSpots()),t.isStartFadeOut||(t.isStartFadeOut=!0,t.onStartFadeOut&&t.onStartFadeOut())},this.setTargetZoomFov=function(t){e.params.targetZoomFov=t},zS.Animation.call(this,t,t.duration)}function eE(){var t={duration:450};zS.Animation.call(this,t,t.duration)}function nE(){var t={timePerMetre:100,minimumTime:1e3,maximumTime:2e3};zS.Animation.call(this,t,t.duration)}function rE(t){var e={duration:800,msPerRadians:t||1e3,minimumTime:1e3,minimumDegree:20};zS.Animation.call(this,e,e.duration)}tE.prototype=new zS.Animation,tE.prototype.play=function(t,e,n,r,o,i,a,s,l,u){var c={beginFov:r.fov,fadeInFov:o,fadeOutFov:i,targetZoomFov:a,camera:r,visibleCube:e,invisibleCube:n,isHotSpotsShowed:!1,isStartFadeOut:!1,onStartFadeOut:s,onShowHotSpots:l,onFinish:u};this.duration=t,this.params=nm(this.params,c),zS.Animation.prototype.play.call(this)},tE.prototype.onUpdate=function(t,e){e<=.5?this.fadeIn(t,e):(e=2*(e-.5),this.fadeOut(t,e)),t.camera.updateProjectionMatrix()},tE.prototype.onFinish=function(t){t.camera.fov=t.targetZoomFov,t.camera.updateProjectionMatrix(),t.onFinish&&t.onFinish()},eE.prototype=new zS.Animation,eE.prototype.play=function(t,e,n,r){var o={panoramaCubeCurrent:t,panoramaCubeHD:e,startOpacity:1,onFinish:r};this.params=nm(this.params,o),this.params.duration=n*this.params.duration,this.params.panoramaCubeCurrent.visible=!0,o.panoramaCubeHD.visible=!0,o.panoramaCubeHD.rotation.copy(o.panoramaCubeCurrent.rotation),o.panoramaCubeHD.position.copy(o.panoramaCubeCurrent.position),THREE.Util.setCubeTransparent(o.panoramaCubeCurrent,!0),THREE.Util.setCubeTransparent(o.panoramaCubeHD,!1),THREE.Util.setCubeOpacity(o.panoramaCubeHD,1),zS.Animation.prototype.play.call(this)},eE.prototype.onUpdate=function(t,e){var n=t.startOpacity*(1-e);THREE.Util.setCubeOpacity(t.panoramaCubeCurrent,n)},eE.prototype.onFinish=function(t,e,n){THREE.Util.setCubeTransparent(t.panoramaCubeCurrent,!0),THREE.Util.setCubeTransparent(t.panoramaCubeHD,!0),n&&(THREE.Util.copyCubeTexture(t.panoramaCubeHD,t.panoramaCubeCurrent),THREE.Util.setCubeOpacity(t.panoramaCubeCurrent,1)),THREE.Util.clearCubeTexture(t.panoramaCubeHD),t.panoramaCubeCurrent.visible=!0,t.panoramaCubeHD.visible=!1,t.onFinish&&t.onFinish(t)},nE.prototype=new zS.Animation,nE.prototype.play=function(t,e,n,r,o,i,a){var s={camera:t,startPosition:e,endPosition:n,onUpdate:o,onFinish:i,onCloseToTarget:r};a&&(s.timePerMetre=a),this.params=nm(this.params,s),this.duration=e.distanceTo(n)/aw.unitPerMetre*this.params.timePerMetre,this.duration=Math.max(this.duration,this.params.minimumTime),this.duration=Math.min(this.duration,this.params.maximumTime),zS.Animation.prototype.play.call(this),s.camera.layers.enable(pw.PanoramaRoverLayer)},nE.prototype.onUpdate=function(t,e){var n=t.startPosition.clone(),r=(Math.sin((e-.5)*Math.PI)+1)/2;r=Math.sqrt(r),n=n.lerp(t.endPosition,r),t.camera.position.copy(n),t.onUpdate&&t.onUpdate(e)},nE.prototype.onFinish=function(t){t.camera.layers.disable(pw.PanoramaRoverLayer),t.onFinish&&t.onFinish()},rE.prototype=new zS.Animation,rE.prototype.play=function(t,e,n,r){var o=2*Math.PI;e.y=(e.y+o)%o,n.y=(n.y+o)%o;for(var i=n.y-e.y;i<-Math.PI;)i+=o;for(;i>Math.PI;)i-=o;for(var a=n.x-e.x;a<-Math.PI;)a+=o;for(;a>Math.PI;)a=i-o;if(Math.abs(i)<this.params.minimumDegree*Math.PI/180&&Math.abs(a)<this.params.minimumDegree*Math.PI/180)r&&r();else{this.params.onFinish=r,this.params.angle=i,this.duration=this.params.msPerRadians*Math.abs(i),this.duration=Math.max(this.duration,this.params.minimumTime);var s={camera:t,startRotation:e.clone(),endRotation:n.clone()};this.params=nm(this.params,s),zS.Animation.prototype.play.call(this)}},rE.prototype.onUpdate=function(t,e){e=(Math.sin((e-.5)*Math.PI)+1)/2,e=Math.sqrt(e);var n=t.startRotation.x+(t.endRotation.x-t.startRotation.x)*e,r=t.startRotation.y+this.params.angle*e;t.camera.rotation.x=n,t.camera.rotation.y=r},rE.prototype.onFinish=function(t){t.onFinish&&t.onFinish()};var oE=function(){function t(){Kf(this,t)}var e;return tm(t,[{key:"loadPanoramaImage",value:(e=$f(regeneratorRuntime.mark((function t(e,n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,r){zS.ResourcesLoader.loadCubeTexture(e,t,n,r)})));case 1:case"end":return t.stop()}}),t)}))),function(t,n){return e.apply(this,arguments)})},{key:"createPanoramaCube",value:function(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PanoramaImageViewer",r=[],o=0;o<6;o++)r.push(new zS.PanoramaCubeMaterial);var i=new THREE.Mesh(new zS.CubeBufferGeometry(t,t,t,1,1,1),r);return i.name=n,e?r.forEach((function(t){return t.side=THREE.BackSide})):i.geometry.scale(-1,1,1),i}},{key:"setCubeTexture",value:function(t,e,n,r,o){t.material.forEach((function(t){var i=t.uniforms;i.onlyPanoramaCube1.value=1,i.panoramaMatrix1.value=r.toRotationMatrix4(aw.rotationOrder),i.panoramaCube1.value=e,i.panoramaPos1.value=n,i.blurPanorama1.value=o.IsDecorating,i.needsUpdate=!0}))}},{key:"disposeCubeTexture",value:function(t){t&&(t.image.forEach((function(e,n){t.image[n]=null})),t.dispose())}}]),t}();
/** @license
	 * JS Signals <http://millermedeiros.github.com/js-signals/>
	 * Released under the MIT license
	 * Author: Miller Medeiros
	 * Version: 1.0.0 - Build: 268 (2012/11/29 05:48 PM)
	 */function iE(t,e,n,r,o){this._listener=e,this._isOnce=n,this.context=r,this._signal=t,this._priority=o||0}function aE(t,e){if("function"!=typeof t)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",e))}function sE(){this._bindings=[],this._prevParams=null;var t=this;this.dispatch=function(){sE.prototype.dispatch.apply(t,arguments)}}iE.prototype={active:!0,params:null,execute:function(t){var e,n;return this.active&&this._listener&&(n=this.params?this.params.concat(t):t,e=this._listener.apply(this.context,n),this._isOnce&&this.detach()),e},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},sE.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(t,e,n,r){var o,i=this._indexOfListener(t,n);if(-1!==i){if((o=this._bindings[i]).isOnce()!==e)throw new Error("You cannot add"+(e?"":"Once")+"() then add"+(e?"Once":"")+"() the same listener without removing the relationship first.")}else o=new iE(this,t,e,n,r),this._addBinding(o);return this.memorize&&this._prevParams&&o.execute(this._prevParams),o},_addBinding:function(t){var e=this._bindings.length;do{--e}while(this._bindings[e]&&t._priority<=this._bindings[e]._priority);this._bindings.splice(e+1,0,t)},_indexOfListener:function(t,e){for(var n,r=this._bindings.length;r--;)if((n=this._bindings[r])._listener===t&&n.context===e)return r;return-1},has:function(t,e){return-1!==this._indexOfListener(t,e)},add:function(t,e,n){return aE(t,"add"),this._registerListener(t,!1,e,n)},addOnce:function(t,e,n){return aE(t,"addOnce"),this._registerListener(t,!0,e,n)},bind:function(t){this.add((function(){return t.dispatch.apply(t,arguments)}))},remove:function(t,e){aE(t,"remove");var n=this._indexOfListener(t,e);return-1!==n&&(this._bindings[n]._destroy(),this._bindings.splice(n,1)),t},removeAll:function(){for(var t=this._bindings.length;t--;)this._bindings[t]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(t){if(this.active){var e,n=Array.prototype.slice.call(arguments),r=this._bindings.length;if(this.memorize&&(this._prevParams=n),r){e=this._bindings.slice(),this._shouldPropagate=!0;do{r--}while(e[r]&&this._shouldPropagate&&!1!==e[r].execute(n))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var lE=function(t){im(n,t);var e=cm(n);function n(t,r){var o;return Kf(this,n),em(lm(o=e.call(this)),"isLoadingPanoramaImage",!1),em(lm(o),"previousHotSpot",void 0),em(lm(o),"currentHotSpot",void 0),em(lm(o),"cacheTime",216e5),em(lm(o),"cacheLength",4),em(lm(o),"cachedHotSpotIds",[]),em(lm(o),"signals",{panoramaImageLoaded:new sE,showHotSpots:new sE,switchHotSpotAnimationProgress:new sE,onStartLoadPanoramaImage:new sE,hotSpotLoaded:new sE}),Object.bindFunctions(lm(o)),o.panoramaManager=t,o.panoramaImageViewer=new oE,o.viewData=r,o}return tm(n,[{key:"start",value:function(){this.app=this.getApp(),this.panoramaManager.signals.targetZoomFovChanged.add(this.onTargetZoomFovChanged);var t=1.2*this.viewData.HouseSize.length(),e=!this.viewData.CaptureVersion||this.viewData.CaptureVersion<"2018061301";e=e&&(!this.viewData.ClientVersion||this.viewData.ClientVersion<"2018051401"||"2018062201"===this.viewData.ClientVersion),this.panoramaCubeCurrent=this.panoramaImageViewer.createPanoramaCube(t,e),this.panoramaCubeHD=this.panoramaImageViewer.createPanoramaCube(t,e),this.camera=this.panoramaManager.camera,this.highQualityTextures=null,this.isHighQualityTexturesLoaded=!1,this.currentHotSpot=null,this.previousHotSpot=null,this.object3D.add(this.panoramaCubeCurrent),this.object3D.add(this.panoramaCubeHD),this.panoramaCubeCurrent.visible=!0,this.panoramaCubeHD.visible=!0,this.fadeAnimation=new tE,this.blurLoadingAnimation=new eE,this.hotSpotSwitchAnimation=new nE,this.cameraRotateAnimation=new rE(window.appConfig.AutoWalkRotateSpeed)}},{key:"loadPanoramaImage",value:function(t){var e=this,n=t.hotSpotData;if(this.currentHotSpot===n)return this.panoramaManager.showVisibleHotSpotGroups(n),t.onPanoramaImageLoaded&&t.onPanoramaImageLoaded(),void t.onAnimationFinished();this.app.anchorManager&&this.app.anchorManager.hideAllAnchors(),this.previousHotSpot=this.currentHotSpot,this.currentHotSpot=n,this.getApp().currentHotSpot=n,this.isLoadingPanoramaImage=!0,this.signals.onStartLoadPanoramaImage.dispatch(n.ID),this.highQualityTextures&&(this.highQualityTextures=null),this.isHighQualityTexturesLoaded=!1;var r=document.createEvent("HTMLEvents");r.initEvent("LoadingPanoramaCubeTexture",!1,!1),zS.ResourcesLoader.cache[n.ID]||(r.status=!0,document.dispatchEvent(r),this.isInSceneSwitch=!0);var o=aw.enableBlurLoading;this.checked&&(o=this.shouldBlurLoad);var i=o?n.BlurTileImagesPath:n.TileImagesPath;if(!this.checked&&o)if(window.ActiveXObject||"ActiveXObject"in window)o=!1,this.checked=!0,this.shouldBlurLoad=!1,i=n.TileImagesPath,this.loadPanoramaImageAfterCheck(t,i,o,r);else{var a=new XMLHttpRequest;a.open("get",i[0],!0),a.responseType="blob",a.onload=function(){e.checked=!0,200===a.status||0===a.status?(e.shouldBlurLoad=!0,e.loadPanoramaImageAfterCheck(t,i,o,r)):(o=!1,e.shouldBlurLoad=!1,i=n.TileImagesPath,e.loadPanoramaImageAfterCheck(t,i,o,r))},a.send()}else this.loadPanoramaImageAfterCheck(t,i,o,r)}},{key:"loadPanoramaImageAfterCheck",value:function(t,e,n,r){var o=this,i=t.hotSpotData,a=function(t){console.info("加载进度提示",t)}.bind(this);i.cubeTexture?(this.onPanoramaImageLoad(i.cubeTexture,n,t),t.onPanoramaImageLoaded&&t.onPanoramaImageLoaded(),r.status=!1,this.isInSceneSwitch=!1,window.appConfig.preLoadAllCubeImage&&this.loadVisiblePanoramaImage(i,n),this.preloadParams={hotSpotData:i,shouldBlurLoad:n}):(this.panoramaCubeHD.visible=!1,this.panoramaImageViewer.loadPanoramaImage(e,a).then(function(e){(window.ActiveXObject||"ActiveXObject"in window)&&this.turnCubeImageSizeTo2Power(e),this.onPanoramaImageLoad(e,n,t),t.onPanoramaImageLoaded&&t.onPanoramaImageLoaded(),r.status=!1,document.dispatchEvent(r),this.isInSceneSwitch=!1,window.appConfig.preLoadAllCubeImage&&this.loadVisiblePanoramaImage(i,n),this.preloadParams={hotSpotData:i,shouldBlurLoad:n}}.bind(this)).catch((function(e){console.log(e),zS.ResourcesLoader.loadResource(i.ImagePath,function(e){var n=new zS.PanoramaMaterial;e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,e.generateMipmaps=!1,e.magFilter=THREE.LinearFilter,e.minFilter=THREE.LinearFilter,e.format=THREE.RGBAFormat,n.uniforms.panoramaMatrix.value=i.Rotation.toRotationMatrix4(aw.rotationOrder),n.uniforms.panoramaCenter.value=i.Position.clone(),n.uniforms.panoramaTexture.value=e,this.panoramaCubeCurrent.material=n,t.onPanoramaImageLoaded&&t.onPanoramaImageLoaded(),r.status=!1,document.dispatchEvent(r),this.isInSceneSwitch=!1,this.panoramaManager.panoramaControls.enabled=!0}.bind(o))})))}},{key:"turnCubeImageSizeTo2Power",value:function(t){var e=t.image[0].width;if(0!=(e-1&e)){for(var n=0;0!=(e-1&e);)n++,e>>=1;e<<=n,t.image.forEach((function(t){var n=document.createElement("canvas"),r=n.getContext("2d");n.width=e,n.height=e,r.drawImage(t,0,0,e,e),t.src=n.toDataURL()}))}}},{key:"loadVisiblePanoramaImage",value:function(t,e){var n=this;if(t||(t=this.preloadParams&&this.preloadParams.hotSpotData,e=this.preloadParams&&this.preloadParams.shouldBlurLoad,t)){var r=t.VisibleHotSpotIds.lengh;t.VisibleHotSpotIds.forEach((function(t){n.panoramaImageViewer.loadPanoramaImage(e?n.viewData.getHotSpotById(t).BlurTileImagesPath:n.viewData.getHotSpotById(t).TileImagesPath).then((function(o){zS.ResourcesLoader.cache[t]=!0,--r||n.viewData.HotSpots.forEach((function(t){zS.ResourcesLoader.cache[t.ID]||n.panoramaImageViewer.loadPanoramaImage(e?t.BlurTileImagesPath:t.TileImagesPath).then(zS.ResourcesLoader.cache[t.ID]=!0)}))}))}))}}},{key:"onPanoramaImageLoad",value:function(t,e,n){var r=n.hotSpotData;if(clearTimeout(this.showLoadingTipTimeout),this.panoramaManager.setTargetZoomFov(hw.defaultFov),this.panoramaManager.stopPanoramaAutoPlay(),this.fadeAnimation.stop(),this.blurLoadingAnimation.stop(),this.hotSpotSwitchAnimation.stop(),this.cameraRotateAnimation.stop(),zS.ResourcesLoader.cache[r.ID]=!0,e&&(!zS.ResourcesLoader.cache[r.ID]||!r.cubeTexture)){var o=function(t){this.isHighQualityTexturesLoaded=!0,this.cubeTextureHD=t,this.fadeAnimation.isPlaying||this.hotSpotSwitchAnimation.isPlaying||(r.cubeTexture=t,this.switchFromBlurToHighQualityTextures(this.panoramaCubeCurrent,this.panoramaCubeHD,t,r))}.bind(this);this.highQualityTextures=zS.ResourcesLoader.loadCubeTexture(r.TileImagesPath,o)}this.panoramaManager.hideAllHotSpotGroups(),this.signals.showHotSpots.dispatch(!1),e&&r.blurCubeTexture&&r.cubeTexture?this.panoramaImageViewer.setCubeTexture(this.panoramaCubeCurrent,r.blurCubeTexture,r.Position,r.Rotation,r):(r.cubeTexture=t,e&&!r.blurCubeTexture&&(r.blurCubeTexture=t),r.cubeTextureTimeStamp=(new Date).getTime(),!this.cachedHotSpotIds.includes(r.ID)&&this.cachedHotSpotIds.push(r.ID),this.panoramaImageViewer.setCubeTexture(this.panoramaCubeCurrent,r.cubeTexture,r.Position,r.Rotation,r)),this.viewData.isSingleMode||this.signals.panoramaImageLoaded.dispatch(r);var i=this.camera.rotation.clone();r.Position&&this.camera.lookAt(r.Position),this.camera.rotation.copy(i),this.panoramaCubeCurrent.position.copy(new THREE.Vector3),this.hotSpotGroups&&(this.clickedHotSpotGroup=this.hotSpotGroups[r.ID]),this.isLoadingPanoramaImage=!1;var a=function(){var t=this;this.panoramaManager.showVisibleHotSpotGroups(r),this.signals.showHotSpots.dispatch(!0);var e=this.app.anchorManager;e&&(e.productAnchors?e.showProductAnchors(r.ID,!0):!this.isInShot&&e.showAnchors(r,!0)),this.isInBestView&&HouseEditor.BaseAPI.updateBestViewGroupHotSpot();var n=0,o=setInterval((function(){n++,t.panoramaManager.rotateHotSpotGroups(),n>10&&clearInterval(o)}),100)}.bind(this),s=function(){this.autoRotateTimeout&&clearTimeout(this.autoRotateTimeout),this.setCameraAndPanoPositions(r.Position),this.camera.layers.enable(pw.PanoramaManager),this.autoRotateTimeout=setTimeout(function(){this.panoramaManager.panoramaControls.isAutoPlayWhenIdle=!1,this.panoramaManager.panoramaControls.autoPlayDelay=n.autoRotateDelay}.bind(this),n.autoRotateDelay),this.panoramaCubeCurrent.visible=!0,this.app.autoWalkManager&&this.app.autoWalkManager.onSwitchSpotFinished(),this.signals.hotSpotLoaded.dispatch(),n.onAnimationFinished&&n.onAnimationFinished()}.bind(this);if((n.isPlayFadeAnimation||n.isCameraWalk)&&this.previousHotSpot){var l=this.previousHotSpot.Position,u=this.currentHotSpot.Position,c=function(t){this.signals.switchHotSpotAnimationProgress.dispatch(t,n.isPlayFadeAnimation,this.previousHotSpot,this.currentHotSpot)}.bind(this),h=function(){n.showBestCameraView&&this.panoramaManager.setBestCameraView(r),a(),s(),e&&(this.isHighQualityTexturesLoaded?this.switchFromBlurToHighQualityTextures(this.panoramaCubeCurrent,this.panoramaCubeHD,this.cubeTextureHD,r):r.blurCubeTexture&&r.cubeTexture&&this.switchFromBlurToHighQualityTextures(this.panoramaCubeCurrent,this.panoramaCubeHD,r.cubeTexture,r)),this.signals.switchHotSpotAnimationProgress.dispatch(1,n.isPlayFadeAnimation,this.previousHotSpot,this.currentHotSpot),this.panoramaManager.panoramaLogoGroup.visible=!0,this.checkCache(r),this.panoramaManager.loadHotSpotTextureInScreen()}.bind(this);this.panoramaManager.panoramaLogoGroup.visible=!1,this.signals.switchHotSpotAnimationProgress.dispatch(0,n.isPlayFadeAnimation,this.previousHotSpot,this.currentHotSpot);var p=this.currentHotSpot.BehindWallConnectDoor[this.previousHotSpot.ID],d=this.app.autoWalkManager&&this.app.autoWalkManager.isAutoWalk?window.appConfig.AutoWalkWalkSpeed:null;if(p&&window.appConfig&&window.appConfig.useRoamArrow&&!window.appConfig.allowRoamThroughWall){u=p.middleDownPos.setY(u.y);var f=new THREE.Vector3,m=p.Start.Down.clone().sub(p.End.Down).cross(new THREE.Vector3(0,1,0)).normalize();f.y=Math.atan2(m.x,m.z),this.hotSpotSwitchAnimation.play(this.camera,l,u,null,null,function(){l=u,u=this.currentHotSpot.Position,this.hotSpotSwitchAnimation.play(this.camera,l,u,null,c,h,d)}.bind(this),d)}else this.hotSpotSwitchAnimation.play(this.camera,l,u,null,c,h,d);n.isPlayFadeAnimation&&this.camera.layers.disable(pw.PanoramaManager)}else n.showBestCameraView&&this.panoramaManager.setBestCameraView(r),a(),s()}},{key:"checkCache",value:function(t){for(var e=this,n=(new Date).getTime(),r=this.viewData.HotSpots.filter((function(n){return n.ID!==t.ID&&(!e.previousHotSpot||n.ID!==e.previousHotSpot.ID)&&n.cubeTexture&&n.cubeTextureTimeStamp})).sort((function(t,e){return t.cubeTextureTimeStamp-e.cubeTextureTimeStamp}));r.length>this.cacheLength;){var o=r.splice(0,1)[0];this.disposeCubeTexture(o),zS.ResourcesLoader.cache[o.ID]=!1}r.forEach((function(t){n-t.cubeTextureTimeStamp>e.cacheTime&&t.cubeTexture&&(e.disposeCubeTexture(t),zS.ResourcesLoader.cache[t.ID]=!1)}))}},{key:"cacheHotSpots",value:function(t){var e=this;if(t&&t.length&&!(t.length<1)){var n=this.currentHotSpot.Position.clone().toVector2();if(t.sort((function(t,e){return t.Position.clone().toVector2().distanceTo(n)-e.Position.clone().toVector2().distanceTo(n)})),t.length>this.cacheLength&&(t=t.slice(0,this.cacheLength)),t.length>this.cacheLength+2-this.cachedHotSpotIds.length){for(var r=t.length-(this.cacheLength+2-this.cachedHotSpotIds.length),o=[],i=t.map((function(t){return t.ID})),a=0;a<r;a++)i.includes(this.cachedHotSpotIds[a])||this.previousHotSpot&&this.cachedHotSpotIds[a]===this.previousHotSpot.ID||this.cachedHotSpotIds[a]===this.currentHotSpot.ID||o.push(this.cachedHotSpotIds[a]);o.forEach((function(t){var n=e.cachedHotSpotIds.findIndex((function(e){return e===t}));t>-1&&e.cachedHotSpotIds.splice(n,1),e.disposeCubeTexture(e.viewData.getHotSpotById(t)),zS.ResourcesLoader.cache[t]=!1}))}this.cacheHotSpotCubeTexture(t,0)}}},{key:"cacheHotSpotCubeTexture",value:function(t,e){var n=this;if(!(e>=t.length||e>=this.cacheLength)){var r=t[e];if(zS.ResourcesLoader.cache[r.ID])this.cacheHotSpotCubeTexture(t,e+1);else{zS.ResourcesLoader.cache[r.ID]=!0,!this.cachedHotSpotIds.includes(r.ID)&&this.cachedHotSpotIds.push(r.ID);var o=r.TileImagesPath,i=r.BlurTileImagesPath;this.shouldBlurLoad?this.panoramaImageViewer.loadPanoramaImage(i).then((function(i){r.blurCubeTexture=i,n.panoramaImageViewer.loadPanoramaImage(o).then((function(o){n.cacheHotSpotCubeTexture(t,e+1),(window.ActiveXObject||"ActiveXObject"in window)&&n.turnCubeImageSizeTo2Power(o),r.cubeTexture=o,r.cubeTextureTimeStamp=(new Date).getTime()}))})):this.panoramaImageViewer.loadPanoramaImage(o).then((function(o){n.cacheHotSpotCubeTexture(t,e+1),(window.ActiveXObject||"ActiveXObject"in window)&&n.turnCubeImageSizeTo2Power(o),r.cubeTexture=o,r.cubeTextureTimeStamp=(new Date).getTime()}))}}}},{key:"playCameraRotationAnimation",value:function(t,e){this.cameraRotateAnimation.play(this.camera,this.camera.rotation,t,e)}},{key:"getHotSpotPrepareResources",value:function(t){if(t&&!zS.ResourcesLoader.cache[t.ID])return aw.enableBlurLoading?t.BlurTileImagesPath:t.TileImagesPath}},{key:"setCameraAndPanoPositions",value:function(t){t&&(this.camera.position.copy(t),this.panoramaCubeCurrent.position.copy(t),this.panoramaManager.panoramaLogoGroup.setPosition(t.x,t.y+hw.logoHeight,t.z))}},{key:"switchFromBlurToHighQualityTextures",value:function(t,e,n,r){this.panoramaImageViewer.setCubeTexture(e,n,r.Position,r.Rotation,r),r.cubeTexture=n,r.cubeTextureTimeStamp=(new Date).getTime(),this.highQualityTextures=null,t.material.forEach((function(n,r){t.material[r]=e.material[r]})),this.panoramaCubeHD.material.forEach((function(t){return null})),this.panoramaManager.loadHotSpotTextureInScreen()}},{key:"disposeCubeTexture",value:function(t){if(t&&t.cubeTexture){this.panoramaImageViewer.disposeCubeTexture(t.cubeTexture),t.blurCubeTexture&&this.panoramaImageViewer.disposeCubeTexture(t.blurCubeTexture),t.blurCubeTexture=null,t.cubeTexture=null;var e=this.cachedHotSpotIds.findIndex((function(e){return e===t.ID}));e>-1&&this.cachedHotSpotIds.splice(e,1)}}},{key:"onTargetZoomFovChanged",value:function(t){this.fadeAnimation.setTargetZoomFov(t)}}]),n}(zS.VRObject),uE=function(t){im(n,t);var e=cm(n);function n(t,r,o){var i;return Kf(this,n),(i=e.call(this)).hotSpotData=t,i.roomDownPosition=i._getRoomDownPosition(t,r),i.timer=null,i.isStair=o,i}return tm(n,[{key:"init",value:function(){this._addCircleOnGround(),this.hotSpotData.IsDecorating&&this._addLoadCircleOnGround(this.hotSpotData),this._setPosition(),this.createHotSpotNameSprite(this.hotSpotData,this.isStair)}},{key:"_setPosition",value:function(){this.position.copy(this.hotSpotData.Position.clone().setY(this.roomDownPosition.y))}},{key:"_addCircleOnGround",value:function(){var t=GS.loadResource(mw.path.hotSpotStatic),e=GS.loadResource(mw.path.hotSpotClicked),n=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0,opacity:.5,depthTest:!1});n.map=e;var r=new THREE.Mesh(new THREE.RingBufferGeometry(.1,13,60),n);r.staticMap=t,r.clickedMap=e,r.rotation.x=Math.PI/2,r.name="circle",r.eventOrder=1,this.add(r)}},{key:"_addLoadCircleOnGround",value:function(){var t=GS.loadResource(mw.path.hotSpotLoadStatic),e=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0,opacity:.5,depthTest:!1,map:t}),n=new THREE.Mesh(new THREE.RingBufferGeometry(0,13,60),e);n.rotation.x=Math.PI/2,n.position.y=.5,n.name="loadCircle",n.eventOrder=1,this.add(n),this.timer=setInterval((function(){var t=n.rotation.z;n.rotation.z=t+.2}),16.67)}},{key:"_deleteLoadCircleOnGround",value:function(){clearInterval(this.timer);var t=this.getObjectByName("loadCircle");t&&t.dispose()}},{key:"_clicked",value:function(){var t=this.getObjectById("circle");t.material.map=t.staticMap}},{key:"_getRoomDownPosition",value:function(t,e){var n,r=e.getRoomByHotSpotId(t.ID);if(r&&(r.Walls[0]&&(n={y:r.Walls[0].End.Down.y}),r.Doors[0]&&(!n||n.y>r.Doors[0].End.Down.y)&&(n={y:r.Doors[0].End.Down.y})),r){var o=r.Walls.map((function(t){return[t.Start.Down,t.End.Down]})).flat().sort((function(t,e){return t.y-e.y}));if(o.length>0){var i=o[0],a=o[o.length-1];if(Math.abs(i.y-a.y)>100)n={y:Math.pow(t.Position.x-i.x,2)+Math.pow(t.Position.z-i.z,2)>Math.pow(t.Position.x-a.x,2)+Math.pow(t.Position.z-a.z,2)?a.y:i.y}}}return n||{y:t.Position.y-140}}},{key:"createStairArrow",value:function(){var t=GS.loadResource(mw.path.stairArrow),e=new THREE.SpriteMaterial({map:t,depthTest:!1,transparent:!0});e.map=t;var n=new THREE.Sprite(e);return n.staticMap=t,n.name="stairArrow",n.position.x=-.25,n}},{key:"updateArrowScale",value:function(){this.stairArrow.scale.set(.5*this.nameSpriteScaleRatio,.5,1)}},{key:"turnArrowUp",value:function(){this.stairArrow.material.rotation=0,this.updateArrowScale()}},{key:"turnArrowDown",value:function(){this.stairArrow.material.rotation=Math.PI,this.updateArrowScale()}},{key:"createHotSpotNameSprite",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=zS.TextHelper.cropString(t.Name,8);if(e){var r=zS.TextHelper.createTextSprite(n,{fontSize:iw.checkIsPhone()?60:50,backgroundColor:{r:0,g:0,b:0,a:.3},cornerWidth:30,textMargin:50,fontFace:aw.textFontFamily2D,sizeAttenuation:!1,leftIco:!0});return r.scale.multiplyScalar(.25),r.ID=t.ID,r.hotSpotData=t,r.name="hotSpotNameSprite_behind",r.renderOrder=12,this.stairArrow=this.createStairArrow(),r.position.set(t.Position.x,this.roomDownPosition.y+25,t.Position.z),r.hotspotGroup=this,this.hotSpotNameSprite=r,this.hotSpotNameSprite.add(this.stairArrow),void this.turnArrowUp()}var o=zS.TextHelper.createTextSprite(n,{fontSize:iw.checkIsPhone()?60:50,backgroundColor:{r:0,g:0,b:0,a:.5},cornerWidth:14,textMargin:40,textAlign:"center",fontFace:aw.textFontFamily2D,sizeAttenuation:!1});o.scale.multiplyScalar(.25),o.ID=t.ID,o.hotSpotData=t,o.name="hotSpotNameSprite",o.renderOrder=12,o.eventOrder=1,o.position.set(t.Position.x,this.roomDownPosition.y+25,t.Position.z),o.hotspotGroup=this,this.hotSpotNameSprite=o}},{key:"animation",get:function(){var t;return null===(t=this.getObjectByName("hotSpotAnimation"))||void 0===t?void 0:t.animation}},{key:"nameSpriteScaleRatio",get:function(){return this.hotSpotNameSprite.scale.y/this.hotSpotNameSprite.scale.x}}]),n}(GS),cE=function t(){Kf(this,t)};em(cE,"LEFT",0),em(cE,"FRONT",1),em(cE,"RIGHT",2);var hE=function(t){im(n,t);var e=cm(n);function n(t,r,o){var i,a,s;return Kf(this,n),(s=e.call(this)).hotSpotData=t,s.connectDoor=o,s.roomDownPosition=(null===(i=r.getRoomByHotSpotId(t.ID).Walls[0])||void 0===i?void 0:i.End.Down)||(null===(a=r.getRoomByHotSpotId(t.ID))||void 0===a?void 0:a.Doors[0].End.Down)||0,s}return tm(n,[{key:"init",value:function(){this._setPosition(),this.createHotSpotNameSprite(this.hotSpotData)}},{key:"_setPosition",value:function(){this.position.copy(this.hotSpotData.Position.clone().setY(this.roomDownPosition.y))}},{key:"updateNameSpritePosition",value:function(){if(this.connectDoor){var t=this.connectDoor.Start.Down.clone().add(this.connectDoor.End.Down).multiplyScalar(.5);this.hotSpotNameSprite.position.set(t.x,this.roomDownPosition.y+25,t.z)}else this.hotSpotNameSprite.position.set(this.hotSpotData.Position.x,this.roomDownPosition.y+25,this.hotSpotData.Position.z)}},{key:"createRoamArrow",value:function(){var t=GS.loadResource(mw.path.roamArrow),e=new THREE.SpriteMaterial({map:t,depthTest:!1,transparent:!0});e.map=t;var n=new THREE.Sprite(e);return n.staticMap=t,n.name="roamArrow",n.eventOrder=1,n.position.x=this.arrowOffsetX,n}},{key:"updateArrowScale",value:function(){this.roamArrow.scale.set(.5*this.nameSpriteScaleRatio,.5,1)}},{key:"turnArrowLeft",value:function(){this.roamArrow.material.rotation=Math.PI/2,this.updateArrowScale()}},{key:"turnArrowRight",value:function(){this.roamArrow.material.rotation=-Math.PI/2,this.updateArrowScale()}},{key:"turnArrowFront",value:function(){this.roamArrow.material.rotation=0,this.updateArrowScale()}},{key:"createHotSpotNameSprite",value:function(){var t=this.hotSpotData,e=zS.TextHelper.cropString(t.Name,8),n=zS.TextHelper.createTextSprite(e,{fontSize:iw.checkIsPhone()?60:50,backgroundColor:{r:0,g:0,b:0,a:.5},cornerWidth:30,textMargin:60,fontFace:aw.textFontFamily2D,sizeAttenuation:!1,leftIco:!0});n.scale.multiplyScalar(.25),n.ID=t.ID,n.hotSpotData=t,n.name="hotSpotNameSprite_behind",n.renderOrder=12,n.hotspotGroup=this,this.hotSpotNameSprite=n,this.roamArrow=this.createRoamArrow(),this.hotSpotNameSprite.add(this.roamArrow),this.turnArrowFront(),this.updateNameSpritePosition()}},{key:"arrowOffsetX",get:function(){return-.3}},{key:"nameSpriteScaleRatio",get:function(){return this.hotSpotNameSprite.scale.y/this.hotSpotNameSprite.scale.x}}]),n}(GS),pE=function(){function t(e,n){Kf(this,t),em(this,"init",(function(){var t=this;this.viewData.isSingleMode||this.hotSpotsData.forEach((function(e){t.drawNormalHotSpotGroup(e),window.appConfig&&window.appConfig.useRoamArrow&&t.drawBehindWallHotSpot(e.ID,e.BehindWallHotSpotIds,e.BehindWallConnectDoor)}))})),this.hotSpotsData=Array.isArray(n)?n:[],this.hotSpotGroups={},this.viewData=e}return tm(t,[{key:"drawNormalHotSpotGroup",value:function(t){var e,n=this.viewData;if(1!=window.appConfig.hotSpotPosition||window.appConfig.isOutScene)e=new XS(t,n);else{var r=-1!==t.Name.indexOf("楼梯");e=new uE(t,n,r)}e.name="Panorama_"+t.Name,e.init(),this.hotSpotGroups[t.ID]=e}},{key:"deleteLoadCircleOnGround",value:function(t){for(var e=0,n=Object.keys(this.hotSpotGroups);e<n.length;e++){var r=n[e];if(t===r&&this.hotSpotGroups[r].hotSpotData.IsDecorating)return this.hotSpotGroups[r]._deleteLoadCircleOnGround(),void(this.hotSpotGroups[r].hotSpotData.IsDecorating=!1)}}},{key:"deleteAllLoadCircleOnGround",value:function(){for(var t=0,e=Object.keys(this.hotSpotGroups);t<e.length;t++){var n=e[t];this.hotSpotGroups[n].hotSpotData.IsDecorating&&(this.hotSpotGroups[n].hotSpotData.IsDecorating=!1,this.hotSpotGroups[n]._deleteLoadCircleOnGround())}}},{key:"addAllLoadCircleOnGround",value:function(){for(var t=0,e=Object.keys(this.hotSpotGroups);t<e.length;t++){var n=e[t];this.hotSpotGroups[n].hotSpotData.IsDecorating||(this.hotSpotGroups[n].hotSpotData.IsDecorating=!0,this.hotSpotGroups[n]._addLoadCircleOnGround())}}},{key:"drawBehindWallHotSpot",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e.forEach(function(e){var r=this.viewData.getHotSpotById(e),o=new hE(r,this.viewData,n[e]);o.init(),this.hotSpotGroups[t+"_"+e+"_behind"]=o}.bind(this))}}]),t}(),dE=function(t){im(n,t);var e=cm(n);function n(t,r){var o;return Kf(this,n),(o=e.call(this)).layer=r,o.layers=new THREE.Layers,o.layers.set(r),o.camera=o.createCamera(),o.targetCamera=t,o.projectionObjects=[],o.object3D.add(o.camera),o.setLayer(o.layer),o.onWindowResize(),o}return tm(n,[{key:"createCamera",value:function(){var t=new THREE.OrthographicCamera(1,1,1,1,0,1);return t.position.z=1,t.renderOrder=0,t}},{key:"updateObjectsProjection",value:function(){var t=this;this.projectionObjects.forEach((function(e){e.visible&&(e.layers.test(t.layers)||e.setLayer(t.layer),t.projectOnScreen(e,e.realPosition))}))}},{key:"addProjectionObject",value:function(t,e){this.projectionObjects.includes(t)?this.updateProjectionObject(t,e):(t.realPosition=e.clone(),t.setLayer(this.layer),this.projectionObjects.push(t))}},{key:"updateProjectionObject",value:function(t,e){t.realPosition=e.clone()}},{key:"projectOnScreen",value:function(t,e){var n=e.clone().project(this.targetCamera);t.position.set(n.x*this.screenWidth/2,n.y*this.screenHeight/2,n.z)}},{key:"updateInVrMode",value:function(t){var e=new THREE.Vector2;this.renderer.getSize(e),this.projectionObjects.forEach((function(n){if(n.visible){var r=n.realPosition.clone().project(t.cameraL);n.position.set(r.x*e.width/4,r.y*e.height/2,r.z)}})),this.camera.left=-e.width/4,this.camera.right=e.width/4,this.camera.top=e.height/2,this.camera.bottom=-e.height/2,this.camera.updateProjectionMatrix(),this.renderer.setViewport(0,0,e.width/2,e.height),this.renderer.render(this.scene,this.camera),this.renderer.setViewport(e.width/2,0,e.width/2,e.height),this.renderer.render(this.scene,this.camera)}},{key:"update",value:function(){this.renderer.setViewport(0,0,this.screenWidth,this.screenHeight),this.renderer.render(this.scene,this.camera)}},{key:"onWindowResize",value:function(){this.camera.left=-this.screenWidth/2,this.camera.right=this.screenWidth/2,this.camera.top=this.screenHeight/2,this.camera.bottom=-this.screenHeight/2,this.camera.updateProjectionMatrix()}}]),n}(zS.VRObject),fE=function(t){im(n,THREE.Group);var e=cm(n);function n(){var t;return Kf(this,n),(t=e.call(this)).sprite=null,t}return tm(n,[{key:"init",value:function(){return this.sprite=this.createMouse(),this.add(this.sprite),this}},{key:"createMouse",value:function(){var t=new THREE.RingBufferGeometry(100,200,64),e=new THREE.MeshBasicMaterial({color:window.appConfig.panoramaMouseColor||3785599,side:THREE.DoubleSide,transparent:!1,opacity:1}),n=new THREE.Mesh(t,e);return n.scale.set(.8,.8,.8),n}},{key:"updateMousePosition",value:function(t){this.position.copy(t.point),this.lookAt(t.point.clone().add(t.face.normal))}}]),n}(),mE=function(t){im(n,THREE.Group);var e=cm(n);function n(t){var r;return Kf(this,n),em(lm(r=e.call(this)),"params",{CommonDoor:{color:255},CommonWindow:{color:16776960},OpenSpace:{color:65280}}),r.room=t,r.name=t.fullName,r.Doors=t.Doors.filter((function(t){return"Door"===t.Type||"NormalDoor"===t.Type})),r.CommonWindows=t.Windows.filter((function(t){return 0===t.Depth})),r.BayWindows=t.Windows.filter((function(t){return 0!==t.Depth})),r.OpenSpaces=t.Doors.filter((function(t){return"OpenSpace"===t.Type})),r.Stairs=t.Stairs,r.StairEntrances=t.Doors.filter((function(t){return"StairEntrance"===t.Type})),r.Fences=t.Doors.filter((function(t){return"Fence"===t.Type})),r.draw(),r}return tm(n,[{key:"drawDoors",value:function(){var t=this;if(0!==this.Doors.length){var e=new THREE.Group;e.name="doorGroup",this.Doors.forEach((function(n){return e.add(t.createLine(n.vertexes,{color:t.params.CommonDoor.color}))})),this.add(e)}}},{key:"drawWindows",value:function(t){var e=this;if(0!==this.CommonWindows.length){var n=new THREE.Group;n.name="windowGroup",this.CommonWindows.forEach((function(t){return n.add(e.createLine(t.vertexes,{color:e.params.CommonWindow.color}))})),this.add(n)}}},{key:"drawBayWindows",value:function(t){}},{key:"drawOpenSpaces",value:function(t){var e=this;if(0!==this.OpenSpaces.length){var n=new THREE.Group;n.name="openSpaceGroup",this.OpenSpaces.forEach((function(t){return n.add(e.createLine(t.vertexes,{color:e.params.OpenSpace.color}))})),this.add(n)}}},{key:"drawStairs",value:function(t){}},{key:"drawStairEntrances",value:function(t){}},{key:"drawFences",value:function(t){}},{key:"createLine",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new THREE.Line2(new THREE.LineGeometry,new THREE.LineMaterial({color:e.color||16776960,linewidth:e.lineWidth||1.2,resolution:new THREE.Vector2(window.innerWidth,window.innerHeight)}));return t[0].equals(t[t.length-1])||t.push(t[0]),n.geometry.setPositions(t.flatMap((function(t){return t.toArray()}))),n.computeLineDistances(),n}},{key:"draw",value:function(){this.drawDoors(),this.drawWindows(),this.drawBayWindows(),this.drawOpenSpaces(),this.drawStairs(),this.drawStairEntrances(),this.drawFences()}}]),n}(),gE=function(){function t(e){Kf(this,t),this.viewData=e,this.wallElementsGroup=new THREE.Group,this.wallElementsGroup.name="wallElementsGroup",this.wallElementsGroupList={}}return tm(t,[{key:"start",value:function(t){var e=new mE(t);e.name=t.fullName,this.wallElementsGroup.add(e),this.wallElementsGroupList[t.fullName]=e}},{key:"show",value:function(t){this.wallElementsGroup.children.forEach((function(t){return t.setVisible(!1)})),this.wallElementsGroup.getObjectByName(t.fullName).setVisible(!0)}},{key:"onPanoramaImageLoaded",value:function(t){var e=this.viewData.getRoomByHotSpotId(t.ID);e&&(this.wallElementsGroupList[e.fullName]||this.start(e),this.show(e))}}]),t}(),vE=function(t){im(n,t);var e=cm(n);function n(){var t;return Kf(this,n),em(lm(t=e.call(this,"PanoramaManager")),"signals",{targetZoomFovChanged:new sE,onCameraUpdated:new sE,onCameraRotationChanged:new sE,onCameraFovLimitExceed:new sE,onHotSpotChanged:new sE,hideMouse:new sE,hoverHotspotCircle:new sE,onTouchOrMouseDown:new sE,onMouseMove:new sE,onMouseDown:new sE,onMouseUp:new sE,onClick:new sE}),em(lm(t),"showBehindWallHotSpotGroups",iw.throttle((function(t){var e=this;if(this.hotSpotManager){var n=this.hotSpotManager.hotSpotGroups;if(!n)return;t||(t=this.panoramaImageLoader.currentHotSpot),t&&t.BehindWallHotSpotIds.forEach((function(r){var o=n[t.ID+"_"+r+"_behind"];if(o){o.animation&&o.animation.play(),o.setVisible(!0);var i=o.connectDoor;if(o.hotSpotNameSprite&&i){var a=i.middleDownPos;o.hotSpotNameSprite.visible=!0;var s=a.clone().project(e.camera),l=e.screenWidth*(1+s.x)/2,u=e.screenHeight*(1-s.y)/2;l>0&&l<e.screenWidth/3&&u>0&&u<e.screenHeight?o.turnArrowLeft():l>2*e.screenWidth/3&&l<e.screenWidth&&u>0&&u<e.screenHeight?o.turnArrowRight():o.turnArrowFront()}else if(o.hotSpotNameSprite&&!i){o.hotSpotNameSprite.visible=!0;var c=o.position.clone().project(e.camera),h=e.screenWidth*(1+c.x)/2,p=e.screenHeight*(1-c.y)/2;h>0&&h<e.screenWidth/3&&p>0&&p<e.screenHeight?o.turnArrowLeft():h>2*e.screenWidth/3&&h<e.screenWidth&&p>0&&p<e.screenHeight?o.turnArrowRight():o.turnArrowFront()}}}))}}),200)),t.firstVertex={},t.vertexArr=[],t.videoName="",t.videoUrl="",t.moveType="",t.defaultUrl="http://video.699pic.com/videos/15/50/59/b_QbMrNQTi1nBH1600155059_10s.mp4",Object.bindFunctions(lm(t)),t}return tm(n,[{key:"init",value:function(t,e){this.app=e,this.camera=this.createCamera(),this.viewData=t,this.loadPanoramaLogoGroup(),this.panoramaControls=this.addPanoramaControlsToCamera(this.camera),this.panoramaControls.autoRotateSpeed=hw.autoRotateSpeed,this.targetZoomFov=hw.defaultFov,this.zoomDelta=(hw.maxFov-hw.minFov)/hw.zoomSteps,this.isLoadingPanoramaImage=!1,this.cameraZoomAnimation=null,this.showLoadingTipTimeout=null,this.autoRotateTimeout=null,this.inExploration=!1,this.panoramaImageLoader=new lE(this,t),this.panoramaImageLoader.signals.hotSpotLoaded.add(this.loadHotSpotTextureInScreen),this.addChild(this.panoramaImageLoader),this.object3D.add(this.camera),!hw.panoramaMouseEnabled||iw.checkIsPhone()||window.appConfig.isOutScene||this.loadPanoramaMouse(),this.setLayer(pw.PanoramaManager),this.videoObj={};var n=window.appConfig&&window.appConfig.hiddenHotSpots;this.viewData.isSingleMode||this.viewData.isSingleView||(this.orthographicLayer=new dE(this.camera,pw.OrthographicLayer),this.addChild(this.orthographicLayer),this.orthographicLayer.onWindowResize(),this.clickedHotSpotGroup=null,n||(this.loadHotSpotManager(),this.registEventListener())),"1"==iw.getUrlParameter("review")&&this.loadReviewManager(this.viewData)}},{key:"onStartLoadPanoramaImage",value:function(t){}},{key:"getHotSpotPrepareResources",value:function(t){return this.panoramaImageLoader.getHotSpotPrepareResources(t)}},{key:"stopPanoramaAutoPlay",value:function(){this.panoramaControls.isAutoPlay=!1,this.panoramaControls.isAutoPlayWhenIdle=!1}},{key:"createCamera",value:function(){var t=this.screenWidth/this.screenHeight,e=new THREE.PerspectiveCamera(hw.defaultFov,t,.01,1e5);return e.name="PanoramaManager",e.rotation.reorder(aw.rotationOrder),e.renderOrder=0,e}},{key:"addPanoramaControlsToCamera",value:function(t){var e=this,n=new zS.PanoramaControls(t,this.renderer.domElement);return n.maxFov=hw.maxFov,n.minFov=hw.minFov,n.inertiaFactor=hw.inertiaFactor,n.inertiaMovingFactor=hw.inertiaMovingFactor,n.speed=hw.controlSpeed,n.zoomSpeed=hw.zoomSpeed,n.isAutoPlayWhenIdle=!1,n.minPolarAngle=THREE.Math.degToRad(-60),n.maxPolarAngle=THREE.Math.degToRad(60),n.onFovChanged=function(){e.setTargetZoomFov(),e.signals.onCameraUpdated.dispatch(e.camera)},n.onCameraRotated=function(){e.signals.onCameraUpdated.dispatch(e.camera),e.rotateHotSpotGroups(),e.loadHotSpotTextureInScreen(),e.showBehindWallHotSpotGroups()},n.onCameraRotationChanged=function(){e.signals.onCameraRotationChanged.dispatch(e.camera)},n.onTouchOrMouseDown=function(){this.signals.onTouchOrMouseDown.dispatch(),this.autoRotateTimeout&&(clearTimeout(this.autoRotateTimeout),this.autoRotateTimeout=null)}.bind(this),n.onFovLimitExceed=this.signals.onCameraFovLimitExceed.dispatch,n}},{key:"destroyHotSpotGroup",value:function(t){this.hotSpotManager&&(THREE.Util.disposeObject3D(this.hotSpotManager.hotSpotGroups[t]),delete this.hotSpotManager.hotSpotGroups[t])}},{key:"createHotSpotAnimation",value:function(t){var e=new THREE.Group;e.name="hotSpotAnimation";var n=new THREE.SpriteMaterial({transparent:!0,alphaTest:.1,opacity:.9}),r=new THREE.Sprite(n);return r.scale.multiplyScalar(55),r.name="hotSpotAnimationSprite",e.add(r),t.minFilter=THREE.LinearFilter,r.material.map=t,e.animation=new US(t,30),e}},{key:"loadHotSpotAnimationAtlas",value:function(t){var e;switch(t){case 1:e=mw.path.animateArrow;break;case 2:e=mw.path.animateCircular}return zS.ResourcesLoader.loadResource(e)}},{key:"projectOnScreen",value:function(t){var e;null===(e=this.orthographicLayer)||void 0===e||e.addProjectionObject(t,t.position)}},{key:"projectOnScreenWithPosition",value:function(t,e){var n;null===(n=this.orthographicLayer)||void 0===n||n.addProjectionObject(t,e)}},{key:"enablePanoramaControls",value:function(t){this.panoramaControls.enabled=t}},{key:"ondblclick",value:function(){this.camera.fov<=hw.minFov?this.onZoomBtnClicked(!1,hw.maxFov):this.onZoomInClicked()}},{key:"onMouseHover",value:function(t,e){this.panoramaMouse&&this.signals.hideMouse.dispatch(),this.signals.hoverHotspotCircle.dispatch(t,e),iw.setCursorOnHover(this.renderer.domElement,e,mw.path.hand)}},{key:"registEventListener",value:function(){var t=this;zS.EventListener.get(this.panoramaLogoGroup).onHover=this.onMouseHover;var e=this.hotSpotManager.hotSpotGroups;for(var n in e)zS.EventListener.get(e[n]).onclick=this.onHotSpotClicked,zS.EventListener.get(e[n]).onHover=this.onMouseHover,e[n].hotSpotNameSprite&&(zS.EventListener.get(e[n].hotSpotNameSprite).onclick=this.onHotSpotClicked,zS.EventListener.get(e[n].hotSpotNameSprite).onHover=this.onMouseHover);this.object3D.eventOrder=-1,zS.EventListener.get(this.object3D).onclick=this.click,zS.EventListener.get(this.object3D).ondblclick=this.ondblclick,zS.EventListener.get(this.object3D).onMouseMove=function(e,n){t.signals.onMouseMove.dispatch(n)},zS.EventListener.get(this.object3D).onMouseDown=function(e,n){t.signals.onMouseDown.dispatch(n)},zS.EventListener.get(this.object3D).onMouseUp=function(e,n){t.signals.onMouseUp.dispatch(n)}}},{key:"click",value:function(t,e){if(t&&e&&!this.inExploration){var n=this.getClosestVisibleHotSpot(this.panoramaImageLoader.currentHotSpot,this.camera,e);n&&this.onHotSpotClicked(this.hotSpotManager.hotSpotGroups[n.ID])}}},{key:"getClosestVisibleHotSpot",value:function(t,e,n){var r=this;try{var o=null,i=!1;if(Math.abs(n.face.normal.y)<.01){var a=this.renderer.domElement.width/this.renderer.domElement.height,s=new THREE.Vector3(0,1,0),l=new THREE.Vector3(0,-1,0),u=t.VisibleHotSpotIds.map((function(t){return r.hotSpotManager.hotSpotGroups[t]})).map((function(t){return new Object({visibleHotSpot:t.hotSpotData,position:t.realPosition?t.realPosition.clone().project(e):t.position.clone().project(e)})})).filter((function(t){return t.position.toArray().every((function(t){return Math.abs(t)<1}))})),c=u.filter((function(t){return t.position.clone().setX(t.position.x*a).setZ(0).sub(l).angleTo(s)<Math.PI/4}));c.length<1&&(c=u.filter((function(t){return t.position.clone().setX(t.position.x*a).setZ(0).sub(l).angleTo(s)<Math.PI/3}))),c.length<1?i=!0:o=c.sort((function(t,r){return t.position.distanceTo(n.point.clone().project(e))-r.position.distanceTo(n.point.clone().project(e))}))[0]}else i=!0;if(i&&!(o=t.VisibleHotSpotIds.map((function(t){return r.hotSpotManager.hotSpotGroups[t]})).map((function(t){return new Object({visibleHotSpot:t.hotSpotData,position:t.realPosition?t.realPosition.clone().project(e):t.position.clone().project(e)})})).filter((function(t){return t.position.toArray().every((function(t){return Math.abs(t)<1}))})).sort((function(t,r){return t.position.distanceTo(n.point.clone().project(e))-r.position.distanceTo(n.point.clone().project(e))}))[0])){var h=t.BehindWallConnectDoor;o=t.BehindWallHotSpotIds.map((function(t){return r.viewData.getHotSpotById(t)})).map((function(t){return new Object({visibleHotSpot:t,position:h?h[t.ID].middleDownPos.clone().setY(t.Position.y).project(e):t.Position.clone().project(e)})})).filter((function(t){return t.position.toArray().every((function(t){return Math.abs(t)<1}))})).sort((function(t,r){return t.position.distanceTo(n.point.clone().project(e))-r.position.distanceTo(n.point.clone().project(e))}))[0]}if(o)return o.visibleHotSpot}catch(t){}}},{key:"onHotSpotClicked",value:function(t){if(t&&!this.inExploration){var e=document.createEvent("HTMLEvents");e.initEvent("pauseAudio",!1,!1),document.dispatchEvent(e);var n=t.getObjectByName("circle");n&&(n.material.opacity=1,setTimeout((function(t){t.material.opacity=.5}),2e3,n)),this.onHotSpotClick(t.hotSpotData)}}},{key:"hideAllHotSpotGroups",value:function(){if(this.hotSpotManager){var t=this.hotSpotManager.hotSpotGroups;for(var e in t)t[e].animation&&t[e].animation.stop(),t[e].setVisible(!1),t[e].hotSpotNameSprite&&(t[e].hotSpotNameSprite.visible=!1)}}},{key:"showVisibleHotSpotGroups",value:function(t){var e=this,n=window.appConfig&&window.appConfig.hiddenHotSpotName;if(this.hotSpotManager){var r=this.hotSpotManager.hotSpotGroups;if(!r)return;var o=this.viewData.getRoomByHotSpotId(t.ID),i={};for(var a in t.VisibleHotSpotIds.forEach((function(a){var s=r[a],l=e.viewData.getRoomByHotSpotId(a);if(l||(l=e.viewData.getDefaultRoom()),s)if(s.animation&&s.animation.play(),s.setVisible(!0),s.hotSpotNameSprite&&!n&&o&&l.ID!==o.ID){var u=e.viewData.getHotSpotById(a).Position.distanceTo(e.viewData.getHotSpotById(t.ID).Position);i.hasOwnProperty(l.ID)?u<i[l.ID].distance&&(i[l.ID]={hotSpotId:a,distance:u}):i[l.ID]={hotSpotId:a,distance:u}}else{var c=e.viewData.getHotSpotById(a),h=o.HotSpotIds[0]===a;s.hotSpotNameSprite.visible=h||!!c.isMergedRoom}})),i){var s=r[i[a].hotSpotId];s.hotSpotNameSprite.visible=!0,s.isStair&&(s.hotSpotData.Position.y>t.Position.y?s.turnArrowUp():s.turnArrowDown())}}this.showBehindWallHotSpotGroups(t)}},{key:"showHotSpotGroup",value:function(t,e){this.hotSpotManager&&(this.hotSpotManager.hotSpotGroups[t].visible=e,this.hotSpotManager.hotSpotGroups[t].hotSpotNameSprite.visible=e)}},{key:"rotateHotSpotGroups",value:function(){var t=this;try{if(1==window.appConfig.hotSpotPosition&&!window.appConfig.isOutScene)return;var e=this.panoramaImageLoader.currentHotSpot.VisibleHotSpotIds.map((function(e){return t.hotSpotManager.hotSpotGroups[e]})).map((function(e){return new Object({visibleHotSpot:e.hotSpotData,position:e.realPosition.clone().project(t.camera)})})).filter((function(t){return t.position.toArray().every((function(t){return Math.abs(t)<1}))})),n=this.renderer.domElement.width/this.renderer.domElement.height,r=new THREE.Vector3(0,1,0),o=new THREE.Vector3(0,-1,0);e.forEach((function(e){var i=t.hotSpotManager.hotSpotGroups[e.visibleHotSpot.ID],a=e.position.clone().setX(e.position.x*n).setZ(0).sub(o).angleTo(r);e.position.x>0&&(a=-a),i.children[1].children[0].material.rotation=a,i.children[1].children[0].position.x=15*Math.sin(a),i.children[1].children[0].position.y=20*(1-Math.cos(a))}))}catch(t){}}},{key:"getIntersectPoint",value:function(t){var e=this.panoramaImageLoader.panoramaCubeCurrent,n=new THREE.Raycaster;n.setFromCamera(t,this.camera);var r=n.intersectObject(e);return r.length>0?r[0].point:null}},{key:"removeVisibleHotSpotOfCurrent",value:function(t){this.currentHotSpot&&t&&(iw.remove(this.currentHotSpot.VisibleHotSpotIds,t.ID),iw.remove(t.VisibleHotSpotIds,this.currentHotSpot.ID),this.showHotSpotGroup(t.ID,!1))}},{key:"onZoomInClicked",value:function(){var t=this.camera.fov-this.zoomDelta;return this.onZoomBtnClicked(!0,t)}},{key:"onZoomOutClicked",value:function(){var t=this.camera.fov+this.zoomDelta;return this.onZoomBtnClicked(!1,t)}},{key:"onZoomBtnClicked",value:function(t,e){return!(t&&this.camera.fov<=hw.minFov)&&(!(!t&&this.camera.fov>=hw.maxFov)&&((!this.cameraZoomAnimation||!this.cameraZoomAnimation.isPlaying)&&(n=(e=Math.max(hw.minFov,Math.min(hw.maxFov,e)))!==hw.maxFov&&e!==hw.minFov,this.setTargetZoomFov(e),this.playCameraZoomAnimation(this.camera.fov),n)));var n}},{key:"setBestCameraView",value:function(t,e){e=e||this.camera,t.BestCameraView&&(e.rotation.x=t.BestCameraView.x,e.rotation.y=t.BestCameraView.y)}},{key:"playCameraZoomAnimation",value:function(t){var e={beginFov:t};if(this.cameraZoomAnimation)this.cameraZoomAnimation.params=e;else{this.cameraZoomAnimation=new zS.Animation(e,350),this.cameraZoomAnimation.onUpdate=function(t,e){this.camera.fov=t.beginFov+(this.targetZoomFov-t.beginFov)*e,this.camera.updateProjectionMatrix()}.bind(this),this.cameraZoomAnimation.onFinish=function(){this.camera.fov=this.targetZoomFov,this.camera.updateProjectionMatrix(),this.signals.onCameraUpdated.dispatch(this.camera)}.bind(this)}this.cameraZoomAnimation.play()}},{key:"updateCameraRotation",value:function(t){this.camera.rotation.setFromVector3(t)}},{key:"setTargetZoomFov",value:function(t){t&&(this.targetZoomFov=t,this.signals.targetZoomFovChanged.dispatch(t))}},{key:"setCameraFov",value:function(t){t!==this.camera.fov&&(this.setTargetZoomFov(t),this.camera.fov=this.targetZoomFov,this.camera.updateProjectionMatrix())}},{key:"updateHotSpotRotation",value:function(){this.clickedHotSpotGroup&&this.hotSpotManager&&this.clickedHotSpotGroup.hotSpotData.VisibleHotSpotIds.forEach(function(t){var e=this.hotSpotManager.hotSpotGroups[t];if(e){var n=e.getObjectByName("hotSpotNameSprite");n&&(n.material.rotation=-this.camera.rotation.z);var r=e.getObjectByName("hotSpotAnimation");if(r){r.position.x=r.y*Math.sin(this.camera.rotation.z),r.position.y=r.y*Math.cos(this.camera.rotation.z);var o=r.getObjectByName("hotSpotAnimationSprite");o&&(o.material.rotation=-this.camera.rotation.z)}}}.bind(this))}},{key:"onHotSpotClick",value:function(t){}},{key:"onPanoramaImageLoaded",value:function(){}},{key:"loadHotSpotManager",value:function(){for(var t in this.hotSpotManager=new pE(this.viewData,this.viewData.HotSpots),this.hotSpotManager.init(),this.hotSpotManager.hotSpotGroups){var e=this.hotSpotManager.hotSpotGroups[t];this.object3D.add(e),e instanceof XS?this.projectOnScreen(e):(this.object3D.add(e.hotSpotNameSprite),this.projectOnScreen(e.hotSpotNameSprite))}}},{key:"loadReviewManager",value:function(t){this.reviewManager=new gE(t),this.panoramaImageLoader.signals.panoramaImageLoaded.add(this.reviewManager.onPanoramaImageLoaded.bind(this.reviewManager)),this.object3D.add(this.reviewManager.wallElementsGroup)}},{key:"update",value:function(){this.renderer.setViewport(0,0,this.screenWidth,this.screenHeight),this.renderer.render(this.scene,this.camera),this.setBestViewManager&&this.setBestViewManager.enable&&this.setBestViewManager.update(),this.updateHotSpotRotation(),this.orthographicLayer&&this.orthographicLayer.updateObjectsProjection();var t=this.viewData.Orientation-this.camera.rotation.y;this.viewData.StandardEntranceDirection!==Math.PI/4&&this.viewData.StandardEntranceDirection!==-Math.PI/4&&this.viewData.StandardEntranceDirection!==Math.PI/4*3&&this.viewData.StandardEntranceDirection!==-Math.PI/4*3||(t+=Math.PI/4),this.panoramaLogoGroup.setRotation(t)}},{key:"onWindowResize",value:function(){this.camera.aspect=this.screenWidth/this.screenHeight,this.camera.updateProjectionMatrix()}},{key:"hide",value:function(){this.object3D.visible=!1,this.enablePanoramaControls(!1),this.hideAllHotSpotGroups()}},{key:"show",value:function(t){this.showVisibleHotSpotGroups(t),this.object3D.visible=!0,this.enablePanoramaControls(!0)}},{key:"loadPanoramaLogoGroup",value:function(){var t=new QS({houseOrientation:this.viewData.Orientation,companyName:hw.companyName,logoUrl:hw.logoUrl});t.init(),this.panoramaLogoGroup=t,this.object3D.add(t)}},{key:"loadPanoramaMouse",value:function(){var t=new fE;t.init(),t.position.set(400,-30,-300),t.scale.set(.07,.07,1),this.panoramaMouse=t,this.object3D.add(t)}},{key:"updateMouse",value:function(t,e,n){this.panoramaMouse&&this.signals.updateMousePos.dispatch(t,e,n)}},{key:"hideHotSpotsByIDs",value:function(t){var e=this;this.ignoredHotSpotGroups=this.ignoredHotSpotGroups||{},t&&t.forEach((function(t){e.hotSpotManager.hotSpotGroups[t]&&(e.ignoredHotSpotGroups[t]=e.hotSpotManager.hotSpotGroups[t],e.hotSpotManager.hotSpotGroups[t].visible=!1,e.hotSpotManager.hotSpotGroups[t].hotSpotNameSprite.visible=!1,delete e.hotSpotManager.hotSpotGroups[t])}))}},{key:"cancelHideHotSpotsByIDs",value:function(){if(this.ignoredHotSpotGroups)for(var t in this.ignoredHotSpotGroups)this.ignoredHotSpotGroups[t].visible=!0,this.ignoredHotSpotGroups[t].hotSpotNameSprite.visible=!0,this.hotSpotManager.hotSpotGroups[t]=this.ignoredHotSpotGroups[t],delete this.ignoredHotSpotGroups[t]}},{key:"loadHotSpotTextureInScreen",value:function(){var t=this;try{var e=this.camera,n=this.panoramaImageLoader.currentHotSpot.VisibleHotSpotIds.filter((function(n){var r=t.hotSpotManager.hotSpotGroups[n];return(r.realPosition?r.realPosition.clone().project(e):r.position.clone().project(e)).toArray().every((function(t){return Math.abs(t)<1}))})).map((function(e){return t.viewData.getHotSpotById(e)}));this.panoramaImageLoader.cacheHotSpots(n)}catch(t){}}},{key:"isInExploration",value:function(t){this.inExploration=t}},{key:"updateHotSpotName",value:function(t,e){if(this.hotSpotManager){var n=this.hotSpotManager.hotSpotGroups[t].hotSpotNameSprite,r=n.scale.clone();zS.TextHelper.updateTextSprite(n,e),n.scale.copy(r)}}}]),n}(zS.VRObject);vE.getPanoramaImageUrls=function(t,e){var n=[];return t.TileImagesPath.forEach((function(e,r){aw.enableBlurLoading&&!zS.ResourcesLoader.cache[t.ID]?n.push(t.BlurTileImagesPath[r]):n.push(e)})),n},vE.getPrepareResourceUrls=function(t,e){return t.BlurTileImagesPath&&t.BlurTileImagesPath.length>=6||(aw.enableBlurLoading=!1),vE.getPanoramaImageUrls(t,e)};var yE=function(){function t(e,n){Kf(this,t),this.viewData=e,this.app=n,this.videoObj={},this.drawVertexCallback=null,this.vertexNameArr=["first-vertex","second-vertex","three-vertex","four-vertex"],this.firstVertex={},this.vertices=[],this.screenPoint=[],this.normal=null,this.videoName="",this.videoUrl="",this.moveType="";var r=window.appConfig.videoUrls;r&&r.length>0?this.defaultUrl=r[0].url:this.defaultUrl="https://vrhouse-web.oss-cn-shanghai.aliyuncs.com/test/20201016/video/video01.mp4",this.initVideo()}var e,n;return tm(t,[{key:"initVideo",value:function(t){this.viewPort=HouseViewer.BaseAPI.app.renderer.domElement.viewPort,t||(t=this.app.getCurrentHotSpotId());var e=this.viewData.HotSpots.find((function(e){return e.ID===t}));if(e){var n=e.VideoData;!n||n.length<=0||(this.app.isDecoView?this.loadDecoVideo(n,0):this.loadVideo(n,0))}}},{key:"loadDecoVideo",value:(n=$f(regeneratorRuntime.mark((function t(e,n){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(!e||e.length<=0||n>=e.length)){t.next=2;break}return t.abrupt("return");case 2:return r=e[n],t.next=5,this.addDecoVideo(r.Position,r.Rotation,r.Size,r.ID);case 5:this.loadDecoVideo(e,++n);case 6:case"end":return t.stop()}}),t,this)}))),function(t,e){return n.apply(this,arguments)})},{key:"addDecoVideo",value:function(t,e,n,r){var o="https://vrhouse-web.oss-cn-shanghai.aliyuncs.com/test/20201016/video/video01.mp4",i=window.appConfig.videoUrls;i&&i.length>0&&(o=i[Math.round(Math.random()*(i.length-1))].url);var a=this.app.panoramaManager.object3D.getObjectByName(r);if(a)return a.position.set(t.x,t.y,t.z),a.scale.set(n.x/a.geometry.parameters.width,n.y/a.geometry.parameters.height,1),a.rotation.set(e.x,e.y,e.z),void(a.visible=!0);var s=this.videoObj[o],l=null;if(s){var u=new THREE.VideoTexture(s),c=new THREE.MeshBasicMaterial({map:u}),h=new THREE.PlaneGeometry(n.x,n.y);l=new THREE.Mesh(h,c),s.play()}else{var p=document.createElement("video");p.crossOrigin="anonymous",p.oncanplay=function(t){p.oncanplay=null,p.play()},p.src=o,p.preload="auto",p.muted=!0,p.autoplay="autoplay",p.loop=!0;var d=new THREE.VideoTexture(p),f=new THREE.MeshBasicMaterial({map:d}),m=new THREE.PlaneGeometry(n.x,n.y);l=new THREE.Mesh(m,f),this.videoObj[o]=p}l.eventOrder=100,l.renderOrder=0,l.position.set(t.x,t.y,t.z),l.rotation.set(e.x,e.y,e.z),l.name=r,l.visible=!0,this.app.panoramaManager.object3D.add(l)}},{key:"loadVideo",value:(e=$f(regeneratorRuntime.mark((function t(e,n){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(!e||e.length<=0||n>=e.length)){t.next=2;break}return t.abrupt("return");case 2:return r=e[n],t.next=5,this.addVideo(r.videoUrl,r.id,r.vertices,r.normal);case 5:this.loadVideo(e,++n);case 6:case"end":return t.stop()}}),t,this)}))),function(t,n){return e.apply(this,arguments)})},{key:"addVideo",value:function(t,e,n,r){var o=this,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=this,s=new THREE.Vector3(n[0].x,n[0].y,n[0].z),l=new THREE.Vector3(n[1].x,n[1].y,n[1].z),u=new THREE.Vector3(n[2].x,n[2].y,n[2].z),c=u.distanceTo(l),h=s.distanceTo(l),p=(n[0].x+n[2].x)/2,d=(n[0].y+n[2].y)/2,f=(n[0].z+n[2].z)/2,m=(new THREE.Quaternion).setFromUnitVectors(new THREE.Vector3(0,0,1),r),g=this.app.panoramaManager.object3D.getObjectByName(e);if(g){g.position.set(p,d,f),g.scale.set(c/g.geometry.parameters.width,h/g.geometry.parameters.height,1);var v=(new THREE.Quaternion).setFromUnitVectors(new THREE.Vector3(0,0,1),r);return g.rotation.setFromQuaternion(v),void(g.visible=!0)}var y=null,w=this.videoObj[t];if(w){var b=new THREE.VideoTexture(w),S=new THREE.MeshBasicMaterial({map:b}),E=new THREE.PlaneGeometry(c,h);y=new THREE.Mesh(E,S)}else{var P=(new THREE.TextureLoader).load("https://vrhouse-web.oss-cn-shanghai.aliyuncs.com/test/20201016/video/poster.jpg");P.minFilter=THREE.LinearFilter,P.magFilter=THREE.LinearFilter;var x=new THREE.MeshBasicMaterial({map:P}),_=new THREE.PlaneGeometry(c,h);y=new THREE.Mesh(_,x),(w=document.createElement("video")).setAttribute("crossOrigin","anonymous"),w.setAttribute("muted","muted"),w.setAttribute("preload","preload"),w.setAttribute("autoplay","autoplay"),w.setAttribute("loop","loop"),w.setAttribute("playsinline","true"),w.setAttribute("webkit-playsinline","true"),w.setAttribute("x5-video-player-type","h5"),w.setAttribute("x-webkit-airplay","allow"),w.setAttribute("x5-playsinline","true");var T=function e(){var n=new THREE.VideoTexture(w);n.format=THREE.RGBFormat,n.minFilter=THREE.LinearFilter,n.magFilter=THREE.LinearFilter,y.material.map=n,a.videoObj[t]=w,w.removeEventListener("loadeddata",e,!1)};w.addEventListener("loadeddata",T,!1),w.setAttribute("src",t)}y.position.set(p,d,f),y.rotation.setFromQuaternion(m),y.name=e,y.renderOrder=100,y.eventOrder=100,y.visible=i,a.app.panoramaManager.object3D.add(y),zS.EventListener.get(y).onMouseDown=function(t,e){a.drawVertexCallback&&(a.moveType="videoMove")},zS.EventListener.get(y).onMouseUp=function(t,e){if("videoMove"===a.moveType){a.moveType="",a.deleteDashedLine(),a.deleteVertex(),o.videoName=t.name;var n=t.geometry.vertices.map((function(e,n){return t.localToWorld(e.clone())})),r=t.material.map.image.currentSrc.replace("http:","");o.videoUrl=r,a.vertices[0]=n[0],a.screenPoint[0]=a.getPositionBy3D(n[0],o.viewPort),a.vertices[1]=n[2],a.screenPoint[1]=a.getPositionBy3D(n[2],o.viewPort),a.vertices[2]=n[3],a.screenPoint[2]=a.getPositionBy3D(n[3],o.viewPort),a.vertices[3]=n[1],a.screenPoint[3]=a.getPositionBy3D(n[1],o.viewPort),a.drawDashedLine(o.vertices),a.drawVertex(o.vertices),a.drawVertexCallback("clickVideo",a.vertices,a.normal,a.screenPoint,a.videoName,a.videoUrl)}}}},{key:"setBoxChooseEvent",value:function(t){var e=this;this.drawVertexCallback=t,this.app.panoramaManager.signals.onMouseDown.add((function(t){e.deleteDashedLine(),e.deleteVertex(),e.initData(),e.moveType="boxChoose";var n=e.getDataByEvent(t);n&&(e.firstVertex=om({},n),e.drawVertex([n.point]))})),this.app.panoramaManager.signals.onMouseMove.add((function(t){if(e.moveType){var n=e.getDataByEvent(t);if(n){var r=n.point,o=(n.normal,n.screenPoint);if("boxChoose"===e.moveType)if(e.firstVertex){var i=e.firstVertex.point;if(e.getDistance(i,r)<=10)return;e.vertices[0]=e.firstVertex.point,e.normal=e.firstVertex.normal,e.screenPoint[0]=e.firstVertex.screenPoint,e.firstVertex=null}else{e.videoName||(e.videoName=e.markVideoName());var a=e.vertices[0],s=new THREE.Vector3(a.x,r.y,a.z),l=new THREE.Vector3(r.x,a.y,r.z);e.vertices[1]=s,e.screenPoint[1]=e.getPositionBy3D(s,e.viewPort),e.vertices[2]=r,e.screenPoint[2]=o,e.vertices[3]=l,e.screenPoint[3]=e.getPositionBy3D(l,e.viewPort),e.drawVertex(e.vertices),e.drawDashedLine(e.vertices),e.drawVertexCallback("move",e.vertices,e.normal,e.screenPoint,e.videoName,e.videoUrl)}else{var u=e.vertexNameArr.findIndex((function(t){return t===e.moveType}));if(-1===u)return;e.vertices[u]=r;var c=e.vertices[(u+2)%4];e.vertices[(u+1)%4]=new THREE.Vector3(r.x,c.y,r.z),e.vertices[(u+3)%4]=new THREE.Vector3(c.x,r.y,c.z),e.drawVertex(e.vertices),e.drawDashedLine(e.vertices)}}}}))}},{key:"initData",value:function(){this.firstVertex=null,this.vertices=[],this.screenPoint=[],this.normal=null,this.videoName="",this.videoUrl=""}},{key:"getDistance",value:function(t,e){var n=new THREE.Vector3(t.x,t.y,t.z),r=new THREE.Vector3(e.x,e.y,e.z);return n.distanceTo(r)}},{key:"getDataByEvent",value:function(t){var e=this.app.panoramaManager.camera,n=g_.app.stereoHouseManager.getCurrentFloor().floorObject;t.camera=e;var r=t.getIntersectOnObject(n);if(r){var o=r.point;return{point:o,normal:r.face.normal,screenPoint:this.getPositionBy3D(o,this.viewPort)}}return null}},{key:"drawDashedLine",value:function(t){var e,n=hm(t);n.push(t[0]);var r=this.app.panoramaManager.object3D.getObjectByName("video-line");r&&this.deleteDashedLine();var o=new THREE.Geometry;(e=o.vertices).push.apply(e,hm(n));var i=new THREE.LineDashedMaterial({color:16711680,dashSize:1,gapSize:1});(r=new THREE.Line(o,i)).name="video-line",r.computeLineDistances(),this.app.panoramaManager.object3D.add(r)}},{key:"drawVertex",value:function(t){var e=this;t.forEach((function(t,n){var r=e.vertexNameArr[n],o=e.app.panoramaManager.object3D.getObjectByName(r);if(o)o.position.set(t.x,t.y,t.z),o.visible=!0;else{var i=new THREE.SpriteMaterial({color:16777215,sizeAttenuation:!1,depthTest:!1}),a=new THREE.Sprite(i);a.position.set(t.x,t.y,t.z),a.scale.multiplyScalar(.03),a.renderOrder=14,a.eventOrder=12,a.name=r,zS.EventListener.get(a).onMouseDown=function(t,n){e.setVideoInvisible(e.videoName),e.vertexNameArr.findIndex((function(e){return e===t.name}))>-1&&(e.moveType=t.name)},zS.EventListener.get(a).onMouseMove=function(t,n){if(e.moveType){var r=t.name;if(!("boxChoose"===e.moveType&&"first-vertex"===r||e.vertexNameArr.includes(e.moveType)&&e.moveType!==r)){e.moveType;var o=e.getDataByEvent(n);if(o){var i=o.point,a=(o.normal,o.screenPoint),s=e.vertexNameArr.findIndex((function(t){return t===r}));if(-1!==s){e.vertices[s]=i,e.screenPoint[s]=a;var l=e.vertices[(s+2)%4],u=new THREE.Vector3(i.x,l.y,i.z),c=new THREE.Vector3(l.x,i.y,l.z),h=e.getPositionBy3D(u,e.viewPort),p=e.getPositionBy3D(c,e.viewPort);0===s||2===s?(e.vertices[(s+1)%4]=u,e.screenPoint[(s+1)%4]=h,e.vertices[(s+3)%4]=c,e.screenPoint[(s+3)%4]=p):(e.vertices[(s+1)%4]=c,e.screenPoint[(s+1)%4]=p,e.vertices[(s+3)%4]=u,e.screenPoint[(s+3)%4]=h),e.drawDashedLine(e.vertices),e.drawVertex(e.vertices),e.drawVertexCallback("move",e.vertices,e.normal,e.screenPoint,e.videoName,e.videoUrl)}}}}},zS.EventListener.get(a).onMouseUp=function(t,n){var r=t.name,o=e.getDataByEvent(n);if(o){var i=o.point,a=o.normal,s=o.screenPoint;if("boxChoose"===e.moveType&&e.firstVertex)return e.deleteVertex(),e.deleteDashedLine(),e.firstVertex=null,e.vertices=[],e.normal=null,e.screenPoint=[],e.videoName="",e.videoUrl=e.defaultUrl,e.moveType="",void e.drawVertexCallback("click",e.vertices,e.normal,e.screenPoint,e.videoName,e.videoUrl);e.normal=a;var l=e.vertexNameArr.findIndex((function(t){return t===r}));if(-1!==l){e.vertices[l]=i,e.screenPoint[l]=s;var u=e.vertices[(l+2)%4],c=new THREE.Vector3(i.x,u.y,i.z),h=new THREE.Vector3(u.x,i.y,u.z);0===l||2===l?(e.vertices[(l+1)%4]=c,e.screenPoint[(l+1)%4]=e.getPositionBy3D(c,e.viewPort),e.vertices[(l+3)%4]=h,e.screenPoint[(l+3)%4]=e.getPositionBy3D(h,e.viewPort)):(e.vertices[(l+1)%4]=h,e.screenPoint[(l+1)%4]=e.getPositionBy3D(h,e.viewPort),e.vertices[(l+3)%4]=c,e.screenPoint[(l+3)%4]=e.getPositionBy3D(c,e.viewPort)),e.drawDashedLine(e.vertices),e.drawVertex(e.vertices),"boxChoose"===e.moveType&&(e.videoUrl=e.defaultUrl),e.moveType="",e.addVideo(e.videoUrl,e.videoName,e.vertices,e.normal),e.drawVertexCallback("boxChoose",e.vertices,e.normal,e.screenPoint,e.videoName,e.videoUrl)}}},e.app.panoramaManager.object3D.add(a)}}))}},{key:"markVideoName",value:function(){return"video-"+Math.random().toString(16).substring(2)}},{key:"getPositionBy3D",value:function(t,e){var n=t.clone().project(HouseViewer.BaseAPI.app.panoramaManager.camera);return{x:(n.x+1)*e.width/2,y:(1-n.y)*e.height/2}}},{key:"initBoxChooseEvent",value:function(){this.app.panoramaManager.enablePanoramaControls(!1),zS.EventListener.get(this.app.panoramaManager.object3D).onclick=function(){}}},{key:"deleteBoxChooseEvent",value:function(){this.firstVertex=null,this.vertices=[],this.normal=null,this.screenPoint=[],this.videoName="",this.videoUrl="",this.moveType="",this.drawVertexCallback=null,this.app.panoramaManager.signals.onMouseDown=new sE,this.app.panoramaManager.signals.onMouseMove=new sE,this.app.panoramaManager.signals.onMouseUp=new sE,this.app.panoramaManager.enablePanoramaControls(!0),zS.EventListener.get(this.app.panoramaManager.object3D).onclick=this.app.panoramaManager.click()}},{key:"setAllVideoInvisible",value:function(){for(var t=this.app.panoramaManager.object3D.children.length-1;t>=0;t--){var e=this.app.panoramaManager.object3D.children[t];e.name.startsWith("video-")&&(e.visible=!1)}}},{key:"setVideoInvisible",value:function(t){var e=this.app.panoramaManager.object3D.getObjectByName(t);e&&(e.visible=!1)}},{key:"deleteVideo",value:function(t){var e=this.app.panoramaManager.object3D.getObjectByName(t);e&&e.dispose(),(e=this.app.panoramaManager.object3D.getObjectByName(t))&&this.deleteVideo(t)}},{key:"deleteVertex",value:function(){var t=this;["first-vertex","second-vertex","three-vertex","four-vertex"].forEach((function(e){var n=t.app.panoramaManager.object3D.getObjectByName(e);n&&(n.visible=!1)}))}},{key:"deleteDashedLine",value:function(){var t=this.app.panoramaManager.object3D.getObjectByName("video-line");t&&t.dispose()}}]),t}(),wE=function(t){im(n,t);var e=cm(n);function n(t){var r;return Kf(this,n),(r=e.call(this)).app=t.app,r.viewData=t.viewData,r.object3D=t.object3D,r.camera=t.camera,r.drawOnScreen=t.drawOnScreen,r}return tm(n,[{key:"drawOnScreen",value:function(){}},{key:"createFurnitureAnchor",value:function(t){var e=this;if(t){this.removeFurnitureAnchor();var n=this.viewData.getRoomByHotSpotId(this.app.getCurrentHotSpotId());t.Rooms.forEach((function(t){var r=new THREE.Group;r.Name="FurnitureAnchorGroup",r.RoomID=t.ID,r.visible=t.ID===n.ID,e.object3D.add(r),t.Anchors.forEach((function(t){t.Sprite||(t.Sprite=e.createSprite(t.Position)),t.Sprite.renderOrder=12,t.Sprite.position.set(t.Position.x,t.Position.y-140,t.Position.z),t.Sprite.visible=!0,e.drawOnScreen(t.Sprite),r.add(t.Sprite)}))}))}}},{key:"removeFurnitureAnchor",value:function(){for(var t=0;t<this.object3D.children.length;t++)"FurnitureAnchorGroup"===this.object3D.children[t].Name&&(this.object3D.children.splice(t,1),t--)}},{key:"switchFurnitureAnchors",value:function(t){for(var e=0;e<this.object3D.children.length;e++){var n=this.object3D.children[e];"FurnitureAnchorGroup"===n.Name&&(n.visible=n.RoomID===t.ID)}}},{key:"createSprite",value:function(t){var e=new THREE.Sprite;return e.renderOrder=12,e.position.set(t.x,t.y-140,t.z),e.visible=!0,this.drawOnScreen(e),e}},{key:"setSpriteTextureByCanvas",value:function(t,e){var n=new THREE.CanvasTexture(e);n.scaleX=e.width,n.scaleY=e.height,t.scale.set(.11*n.scaleX,.11*n.scaleY,1),t.material=new THREE.SpriteMaterial({map:n,color:16777215,transparent:!0})}},{key:"setSpriteTextureByImageUrl",value:function(t,e,n,r){var o=(new THREE.TextureLoader).load(e);o.needsUpdate=!0,o.scaleX=n,o.scaleY=r,t.scale.set(.16*o.scaleX,.16*o.scaleY,1),t.material=new THREE.SpriteMaterial({map:o,color:16777215,transparent:!0})}},{key:"setAnchorClick",value:function(t,e){var n=t;HouseViewer.EventListener.get(n.Sprite).onclick=function(t){e(n)}}},{key:"setKFSpriteTexture",value:function(t,e,n){var r=document.createElement("canvas"),o=r.getContext("2d");t.canvas=r,t.ctx=o;var i=200,a=40;if(r.height=i+1,r.width=i+1,n&&n.height>i&&(a=n.height-120-10,i=n.height,r.height=i+1,r.width=i+1),n&&n.image){o.fillStyle="green",o.strokeStyle="white";var s=n.height,l=n.height/15;o.moveTo(l,0),o.lineTo(s-l,0),o.arcTo(s,0,s,l,l),o.lineTo(s,s-l),o.arcTo(s,s,s-l,s,l),o.lineTo(l,s),o.arcTo(0,s,0,s-l,l),o.lineTo(0,l),o.arcTo(0,0,l,0,l),o.fill(),o.globalCompositeOperation="source-in",o.drawImage(n.image,0,0,n.width,n.height),o.globalCompositeOperation="source-over",o.lineWidth=5,o.moveTo(l,0),o.lineTo(s-l,0),o.arcTo(s,0,s,l,l),o.lineTo(s,s-l),o.arcTo(s,s,s-l,s,l),o.lineTo(l,s),o.arcTo(0,s,0,s-l,l),o.lineTo(0,l),o.arcTo(0,0,l,0,l),o.stroke(),o.lineWidth=1,o.translate(a,a),o.drawImage(e,0,0,120,120),r.toDataURL("image/png"),this.setSpriteTextureByCanvas(t.Sprite,r)}else o.fillStyle="rgba(255,255,255,0.5)",o.beginPath(),o.arc(i/2,i/2,i/2-1,0,2*Math.PI),o.fill(),console.info(a),o.translate(a,a),o.drawImage(e,0,0,120,120),this.setSpriteTextureByCanvas(t.Sprite,r)}}]),n}(zS.VRObject),bE=function(t){im(r,t);var e,n=cm(r);function r(t,e){var o;Kf(this,r),em(lm(o=n.call(this)),"signals",{onCameraUpdated:new sE,hotSpotClicked:new sE,addMergedHotSpot:new sE}),em(lm(o),"hotSpotNameColor",cw.hotSpotNameColor.black),Object.bindFunctions(lm(o)),o.viewData=t,o.largeViewBackground=new THREE.Color(aw.largeViewBgColor),o.displayRoomName=!0,o.sectorSprite=null,o.hotSpotGroups={},o.isSmallView=!0,o.hotSpotNameGroups={},o.hotSpotSprites=[],o.smallViewSize={},o.highlightHotSpotGroup=null,o.highlightHotSpotSprite=null,o.currentFloor=void 0,o.floorPlanSizeDefault=new THREE.Vector2,o.floorPlanSize={},o.floorPlanSizeCover={},o.floorPlanGroups={},o.hotSpotForDisplayJson=null,o.hotSpotForDisplayJsonCacheFlag={},o.inIE=!!window.ActiveXObject||"ActiveXObject"in window,o.camera=o.createCamera(),o.object3D.add(o.camera),o.createFloorPlanGroups(t),o.setVisibleOfHotSpotNameSprites(o.displayRoomName),o.object3D.add(o.createHighlightHotSpotGroup());var i=t.getFloorByHotSpotId(e.ID);return o.switchFloorPlan(i),window.appConfig.smallViewBackGroundParams&&(o.smallViewBackGroundSprite=o.createSmallViewBackGround(window.appConfig.smallViewBackGroundParams),o.object3D.add(o.smallViewBackGroundSprite)),o.setHighlightHotSpotPosition(e),o}return tm(r,[{key:"start",value:function(){this.app=this.getApp(),this.orbitControls=this.addOrbitControlsToCamera(this.camera,this.viewData.Floors[0].FloorSize),this.registEventListener(),this.setLayer(pw.FloorPlanManager)}},{key:"loadHotSpotForDisplayJson",value:(e=$f(regeneratorRuntime.mark((function t(e,n){var r,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=function(t,e){try{this.updateHotSpotForDisplay(t),e&&e(!0)}catch(t){console.log("hotSpotForDisplayJson execute error"),e&&e(!1)}},!this.hotSpotForDisplayJson){t.next=5;break}o.call(this,e,n),t.next=9;break;case 5:return t.next=7,iw.Ajax.getJSONAsync(this.viewData.HotSpotForDisplayJsonPath);case 7:r=t.sent;try{this.hotSpotForDisplayJson||(this.hotSpotForDisplayJson=JSON.parse(r),this.addMergedRoomHotSpot()),o.call(this,e,n),this.registEventListener()}catch(t){console.log("hotSpotForDisplayJson parse error"),n&&n(!1)}case 9:case"end":return t.stop()}}),t,this)}))),function(t,n){return e.apply(this,arguments)})},{key:"getRealPosByOffset",value:function(t,e){return{x:this.floorPlanSize[e].x*(t.X-.5),y:-this.floorPlanSize[e].y*(t.Y-.5)}}},{key:"addMergedRoomHotSpot",value:function(){var t=this;this.floorHotSpotDataForDisplay.filter((function(t){return t.IsMergedRoom})).forEach((function(e){var n=zS.ResourcesLoader.loadResource(mw.path.hotSpotPoint);n.minFilter=THREE.LinearFilter;var r=new THREE.SpriteMaterial({map:n,transparent:!0}),o=t.viewData.getHotSpotById(e.HotSpotID||e.ID);if(o){var i=t.createHotSpotGroup(o,r);t.floorPlanGroup.getObjectByName("hotSpotGroup").add(i),i.setLayer(pw.FloorPlanManager),t.signals.addMergedHotSpot.dispatch(o)}}))}},{key:"updateHotSpotForDisplay",value:function(t){var e=this,n={},r={},o=function(o){var i=e.hotSpotGroups[o],a=e.getRoomHotSpot(o);if(!a)return i.dispose(),"continue";var s=a.ID,l=a.Position,u=a.floorHotSpotId;if(void 0!==t&&t!==u)return"continue";if(l){var c=e.getRealPosByOffset(l,u);i.position.setX(c.x).setY(c.y-i.getObjectByName("nameSprite").scale.y)}else i.visible=!1;var h=a.Middle;n[u]||(n[u]={}),!n[u][s]&&h&&h.length>0&&(n[u][s]=h.map((function(t){return t.map((function(t){var n=e.getRealPosByOffset(t,u);return new THREE.Vector2(n.x,n.y)}))})));var p=a.Area,d=i.getObjectByName("areaSprite"),f=a.IsMergedRoom;if(d){var m=iw.formatAreaString(p,"feet"===window.appConfig.lengthStandard,1),g=zS.NameConverter.convertLangByUrl("约");d&&zS.TextHelper.updateTextSprite(d,f?"":g+m)}r[s]=o};for(var i in this.hotSpotGroups)o(i);this.roomRegionPoints?nm(this.roomRegionPoints,n):this.roomRegionPoints=n,this.roomHotSpotMap?nm((this.roomHotSpotMap,r)):this.roomHotSpotMap=r}},{key:"getFloorHotSpot",value:function(t){if(!this.hotSpotForDisplayJson)return null;var e=this.viewData.getFloorByHotSpotId(t),n=this.hotSpotForDisplayJson.FloorHotspots;return n?n.find((function(t){return t.ID===e.ID})):null}},{key:"getRoomHotSpot",value:function(t,e){if(!e&&!(e=this.getFloorHotSpot(t)))return null;var n=e.RoomHotspots.find((function(e){return e.HotSpotID===t||e.ID===t})),r=this.viewData.isAdditionalHotSpot(t);if(!n||!n.IsMergedRoom){var o=this.viewData.getRoomByHotSpotId(t);if(!o&&r)return null;n=e.RoomHotspots.find((function(t){return t.ID===o.ID}))}return n&&(n.floorHotSpotId=e.ID),n}},{key:"createSmallViewBackGround",value:function(t){var e=new THREE.SpriteMaterial({map:null,color:t.color||0,depthWrite:!1});e.opacity=t.opacity||.5;var n=new THREE.Sprite(e);return n.scale.set(2e3,2e3,1),n.position.set(0,0,-10),n.name="smallViewBackGround",n}},{key:"createHighlightHotSpotSprite",value:function(){var t=zS.ResourcesLoader.loadResource(mw.path.hotSpotHighlight);t.minFilter=THREE.LinearFilter;var e=new THREE.SpriteMaterial({map:t}),n=new THREE.Sprite(e);return n.scale.set(39,39,1),this.highlightHotSpotSprite=n,n}},{key:"createSectorSprite",value:function(){var t=zS.ResourcesLoader.loadResource(mw.path.hotSpotSector);t.minFilter=THREE.LinearFilter;var e=new THREE.SpriteMaterial({map:t}),n=new THREE.Sprite(e);return n.scale.set(160,160,1),this.sectorSprite=n,n}},{key:"createHighlightHotSpotGroup",value:function(){var t=new THREE.Group;return t.add(this.createSectorSprite()),this.highlightHotSpotGroup=t,this.highlightHotSpotGroup.hotSpotData=void 0,t}},{key:"createHotSpotSprite",value:function(t){var e=new THREE.Sprite(t);return e.scale.set(cw.hotSpotSize,cw.hotSpotSize,1),e.name="HotSpotSprite",this.hotSpotSprites.push(e),e}},{key:"createAreaSprite",value:function(t,e){var n=iw.formatAreaString(t.Area,"feet"===window.appConfig.lengthStandard,1),r=zS.NameConverter.convertLangByUrl("约"),o=window.appConfig&&window.appConfig.texColorIn2D?window.appConfig.texColorIn2D:this.hotSpotNameColor,i=zS.TextHelper.createTextSprite(r+n,{fontSize:e-4,fontWeight:"400",textColor:o,cornerWidth:4,spriteScale:1,borderThickness:0,fontFace:aw.textFontFamily2D,textMargin:2,enableShadow:!0,shadowColor:{r:0,g:0,b:0,a:.5},shadowOffsetX:1,shadowOffsetY:1,shadowBlur:1});return i.name="areaSprite",i}},{key:"updateAreaSprite",value:function(t){for(var e in this.hotSpotGroups){var n=this.hotSpotGroups[e].getObjectByName("areaSprite"),r=this.hotSpotGroups[e].Area;if(r&&n){var o=iw.formatAreaString(r,"feet"===t,1),i=zS.NameConverter.convertLangByUrl("约");n&&zS.TextHelper.updateTextSprite(n,i+o)}}}},{key:"updateAreaSpriteByLang",value:function(t){for(var e in this.hotSpotGroups){var n=this.hotSpotGroups[e].getObjectByName("areaSprite"),r=this.hotSpotGroups[e].Area;if(r&&n){var o=iw.formatAreaString(r,"feet"===window.appConfig.lengthStandard,1),i=zS.NameConverter.translateByDict("约",t);n&&zS.TextHelper.updateTextSprite(n,i+o)}}}},{key:"createHotSpotNameSprite",value:function(t,e){var n=zS.TextHelper.cropString(t,8),r=zS.TextHelper.createTextSprite(n,{fontSize:e,fontWeight:"500",textColor:window.appConfig&&window.appConfig.texColorIn2D?window.appConfig.texColorIn2D:this.hotSpotNameColor,spriteScale:1,cornerWidth:13,borderThickness:0,textMargin:13,fontFace:aw.textFontFamily2D,backgroundColor:{r:0,g:0,b:0,a:.3}});return r.name="nameSprite",r}},{key:"createHotSpotGroup",value:function(t,e){var n=new THREE.Group;if(n.name=t.Name,n.position.set(t.Position.x,-t.Position.z,0),this.displayRoomName&&!this.viewData.hasObjModels){var r,o=window.appConfig&&window.appConfig.textFontSize2D?isPhone?window.appConfig.textFontSize2D:2*parseInt(window.appConfig.textFontSize2D)/3:10*cw.rulerFontSize;r=this.createHotSpotNameSprite(t.Name,o),n.add(r);var i=this.viewData.getRoomByHotSpotId(t.ID);if(!window.appConfig.hideRoomAreaIn2D&&i&&i.Area&&0!==i.Area){var a=this.createAreaSprite(i,o);n.add(a),n.Area=i.Area,r&&r.position.set(0,1+a.scale.y/2,0),a.position.set(0,-2-r.scale.y/2,0)}else r&&r.position.set(0,0,0)}return n.hotSpotData=t,n.name=t.Name+" Group",n.position.z=1,this.hotSpotGroups[t.ID]=n,n}},{key:"updateHotSpotScale",value:function(){var t=Math.min(Math.abs(this.camera.top),Math.abs(this.camera.left)),e=Math.max(1,Math.min(2,t/700));for(var n in this.hotSpotGroups)this.hotSpotGroups[n].scale.set(e,e,1)}},{key:"createHotSpotsGroup",value:function(t){var e=this,n=new THREE.Group;n.name="hotSpotGroup";var r=zS.ResourcesLoader.loadResource(mw.path.hotSpotPoint);r.minFilter=THREE.LinearFilter;var o=new THREE.SpriteMaterial({map:r,transparent:!0});return t.forEach((function(t){e.viewData.isAdditionalHotSpot(t.ID)||n.add(e.createHotSpotGroup(t,o))})),n}},{key:"createFloorPlanSprite",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new THREE.SpriteMaterial(window.appConfig.display3DUnder2D?{alphaTest:.1,opacity:.85}:{alphaTest:.5}),r=new THREE.Sprite(n);r.name="FloorPlanSprite";var o=t.ID,i=t.FloorPlanPath;return e&&(i=t.FloorPlanThumbnailPath),r.material.map=zS.ResourcesLoader.loadResource(i,function(t){t.minFilter=THREE.LinearFilter;var n=t.image.width/t.image.height;if(e){var i=this.floorPlanSizeCover[o]||this.floorPlanSizeDefault;this.floorPlanSizeCover[o]=i;var a=i.x>i.y;i.x=a?i.x:i.y*n,i.y=a?i.x*(1/n):i.y,r.scale.set(i.x,i.y,1),this.floorPlanSizeCover[o]=i,this.smallViewSize[o]=Math.max(i.x,i.y)*(1+cw.smallViewMargin)}else{var s=this.floorPlanSize[o]||this.floorPlanSizeDefault;this.floorPlanSize[o]=s;var l=s.x>s.y;s.x=l?s.x:s.y*n,s.y=l?s.x*(1/n):s.y,r.scale.set(s.x,s.y,1),this.floorPlanSize[o]=s}e||this.loadHotSpotForDisplayJson(o,this.onWindowResize)}.bind(this)),r.floorPlan=r.material.map,r.hasOwnProperty("floorPlanMaps")||(r.floorPlanMaps=[],r.floorPlanMaps.push({floorPlan:r.floorPlan})),r.floorData=t,r}},{key:"createBgMask",value:function(){var t=document.createElement("canvas"),e=t.getContext("2d");t.width=4*window.innerWidth,t.height=4*window.innerHeight,e.fillStyle="#222222",e.fillRect(0,0,t.width,t.height);var n=new THREE.CanvasTexture(t);n.scaleX=t.width,n.scaleY=t.height,n.wrapS=THREE.RepeatWrapping,n.wrapT=THREE.RepeatWrapping,n.minFilter=THREE.LinearFilter,n.needsUpdate=!0;var r=new THREE.SpriteMaterial({opacity:.7}),o=new THREE.Sprite(r);return o.material.map=n,o.scale.set(t.width,t.height,1),o.name="FloorPlanBgMask",this.bgMask=o,o}},{key:"createFloorPlanGroup",value:function(t){var e=new THREE.Group;e.floorData=t,window.appConfig.display3DUnder2D&&e.add(this.createBgMask()),e.add(this.createFloorPlanSprite(t)),e.add(this.createFloorPlanSprite(t,!0));var n=this.createHotSpotsGroup(this.viewData.getHotSpotsByFloor(t));return e.add(n),e}},{key:"createCamera",value:function(){var t=new THREE.OrthographicCamera(1,1,1,1,1,20);return t.position.z=cw.cameraDepth,t.renderOrder=2,t}},{key:"addOrbitControlsToCamera",value:function(t){var e=this,n=new THREE.OrbitControls(t,this.renderer.domElement);return n.zoomSpeed=uw.largeViewZoomSpeed,n.enableDamping=!0,n.dampingFactor=.85,n.enablePan=!0,n.enableInertia=!0,n.enableRotate=!1,n.minZoom=1,n.maxZoom=5,n.getTargetObject=function(){return e.floorPlanGroup.getObjectByName("FloorPlanSprite")},n.onZoomChanged=this.signals.onCameraUpdated.dispatch.bind(this),n.onObjectMoved=this.signals.onCameraUpdated.dispatch.bind(this),n}},{key:"setVisibleOfHotSpotNameSprites",value:function(t){for(var e in this.hotSpotNameGroups)this.hotSpotNameGroups[e].visible=t}},{key:"setVisibleOfHotSpotSprite",value:function(t){for(var e in this.hotSpotSprites)this.hotSpotSprites[e].visible=t}},{key:"setHighlightHotSpotPosition",value:function(t){var e=this.viewData.getFloorByHotSpotId(t.ID);this.switchFloorPlan(e),this.highlightHotSpotGroup.hotSpotData=t,this.highlightHotSpotGroup.position.set(t.Position.x,-t.Position.z,1),this.highlightHotSpotGroup.visible=!0,this.isSmallView&&this.setVisibleOfHotSpotSprite(!1)}},{key:"updateCameraViewByHotSpot",value:function(t){(this.resetCameraPositionAndZoom(),this.currentFloor)&&(Math.max(this.currentFloor.FloorSize.x,this.currentFloor.FloorSize.z)/100<cw.cameraZoomInMaxMetre||(this.orbitControls.updateZoom(2.5),this.camera.position.x=t.Position.x,this.camera.position.y=t.Position.z,this.orbitControls.target.copy(this.camera.position)))}},{key:"resetCameraPositionAndZoom",value:function(){this.orbitControls.updateZoom(1),this.camera.position.x=0,this.camera.position.y=0,this.orbitControls.target.copy(this.camera.position)}},{key:"onPanoramaCameraUpdated",value:function(t){this.sectorSprite.material.rotation=t.rotation.y}},{key:"onMouseHover",value:function(t,e){iw.setCursorOnHover(this.renderer.domElement,e,mw.path.hand)}},{key:"enableHouseEvents",value:function(t){for(var e in this.floorPlanGroups){var n=this.floorPlanGroups[e].getObjectByName("FloorPlanSprite");zS.EventListener.get(n).enabled=t}}},{key:"registEventListener",value:function(){var t=this;for(var e in this.floorPlanGroups){var n=this.floorPlanGroups[e].getObjectByName("FloorPlanSprite");zS.EventListener.get(n).onclick=this.onFloorPlanSpriteClicked,zS.EventListener.get(n).onHover=this.onMouseHover}var r=function(e){zS.EventListener.get(t.hotSpotGroups[e]).onclick=function(){t.signals.hotSpotClicked.dispatch(t.hotSpotGroups[e].hotSpotData)},zS.EventListener.get(t.hotSpotGroups[e]).onHover=t.onMouseHover};for(var o in this.hotSpotGroups)r(o)}},{key:"switchFloorPlan",value:function(t){if(t&&this.currentFloor!==t){for(var e in this.floorPlanGroup&&(this.floorPlanGroup.visible=!1,this.floorPlanGroup=null),this.floorPlanGroups){var n=this.floorPlanGroups[e].floorData===t;if(n&&(this.floorPlanGroup=this.floorPlanGroups[e]),this.floorPlanGroups[e].visible=n,n){var r=this.floorPlanGroups[e].getObjectByName("FloorPlanSprite");r.thumbnail&&(r.material.map=this.isSmallView?r.thumbnail:r.floorPlan)}}if(this.highlightHotSpotGroup.hotSpotData){var o=this.viewData.getFloorByHotSpotId(this.highlightHotSpotGroup.hotSpotData.ID);this.isSmallView?this.highlightHotSpotGroup.visible=!1:this.highlightHotSpotGroup.visible=o===t}this.currentFloor=t,this.visible&&(this.isSmallView?this.setSmallView():this.setLargeView())}}},{key:"switchFloorPlanByFloorID",value:function(t){var e=this.viewData.getFloorById(t);this.switchFloorPlan(e)}},{key:"createFloorPlanGroups",value:function(t){var e=this,n=this.viewData.Floors[0].FloorPlanMargin||cw.floorPlanMargin;this.floorPlanSizeDefault.x=this.viewData.HouseSize.x+2*n,this.floorPlanSizeDefault.y=this.viewData.HouseSize.z+2*n,t.Floors.forEach((function(t){e.floorPlanSize[t.ID]=e.floorPlanSizeDefault.clone(),e.floorPlanSizeCover[t.ID]=e.floorPlanSizeDefault.clone();var n=e.createFloorPlanGroup(t);e.floorPlanGroups[t.ID]=n,e.object3D.add(n)}))}},{key:"onFloorPlanSpriteClicked",value:function(t,e){this.onFloorPlanSpriteClick(t,e)}},{key:"updateHotSpotNameGroup",value:function(t){var e=t.getObjectByName("nameSprite");if(zS.TextHelper.updateTextSprite(e,t.name),t.area&&0!==t.area){var n=t.getObjectByName("areaSprite");e.position.set(0,1+n.scale.y/2,0),n.position.set(0,-2-e.scale.y/2,0)}else e.position.set(0,0,0)}},{key:"updateHotSpotName",value:function(t,e){var n=this.hotSpotNameGroups[t];if(n)n.name=e,this.updateHotSpotNameGroup(n);else if(this.hotSpotGroups[t]){var r=this.hotSpotGroups[t].getObjectByName("nameSprite");r&&zS.TextHelper.updateTextSprite(r,e)}}},{key:"onFloorPlanSpriteClick",value:function(t,e){var n=this;if(this.hotSpotForDisplayJson){var r=this.currentFloor.ID,o=this.roomRegionPoints[r];Object.keys(o).forEach((function(t){o[t].forEach((function(r){if(r[0].x===r[r.length-1].x&&r[0].y===r[r.length-1].y||r.push(r[0]),new THREE.Vector2(e.point.x,e.point.y).isInPolygon(r)){var o=n.roomHotSpotMap[t],i=n.viewData.getHotSpotById(o);n.signals.hotSpotClicked.dispatch(i)}}))}))}else{var i=e.point;i=new THREE.Vector3(i.x,0,-i.y);var a=this.viewData.getHotSpotsByFloor(this.currentFloor),s=this.viewData.getNearestHotSpotByPosition(a,i);s&&this.signals.hotSpotClicked.dispatch(s)}}},{key:"update",value:function(){var t=this.isSmallView?this.camera.smallViewPort:this.camera.viewPort;if(this.isSmallView){if(!this.getApp().smallViewPanelManager.visible)return;var e=this.getApp().smallViewPanelManager.getViewPort(this.renderer.domElement.getBoundingClientRect());t.left=e.left,t.top=e.top,this.app.isDecoView&&this.inIE&&!this.fullScreen&&(t.width=0)}else window.appConfig.display3DUnder2D||(this.renderer.setClearColor(this.largeViewBackground),this.renderer.clearColor());this.renderer.setViewport(t.left,t.top,t.width,t.height),this.isSmallView?(this.camera.smallViewPort=t,this.camera.zoom=1,this.camera.position.set(0,0,10)):this.camera.viewPort=t,this.camera.updateProjectionMatrix(),this.renderer.render(this.scene,this.camera)}},{key:"onWindowResize",value:function(){var t,e,n=this.renderer.domElement.getBoundingClientRect();this.renderer.domElement.viewPort=n,this.inIE&&(this.app.isDecoView&&Math.abs(this.renderer.domElement.viewPort.width-window.innerWidth)>1?this.fullScreen=!1:this.fullScreen=!0);var r=this.isSmallView?this.app.smallViewPanelManager.getViewPort(n).width:this.screenWidth,o=this.isSmallView?this.app.smallViewPanelManager.getViewPort(n).height:this.screenHeight;this.isSmallView&&r&&(this.smallWidthRecord=r),this.isSmallView&&r&&(this.smallHeightRecord=o),this.isSmallView&&this.camera.smallViewPort&&(r=this.smallWidthRecord,o=this.smallHeightRecord);var i=r,a=o,s=cw.rulerPadding+cw.rulerTextPadding+cw.rulerFontSize,l=this.currentFloorSize.x+2*s,u=this.currentFloorSize.y+2*s,c=l/u,h=(1-cw.largeViewMargin.left-cw.largeViewMargin.right)*i,p=(1-cw.largeViewMargin.top-cw.largeViewMargin.bottom)*a,d=h/p>c?u/p:l/h;this.isSmallView&&(d*=l>u&&l>1.5*u?l/u/2:u>=l&&u>1.5*l?u/l/2:.7),t=r,e=o,this.camera.left=-r/2*d,this.camera.right=r/2*d,this.camera.top=o/2*d,this.camera.bottom=-o/2*d,this.isSmallView&&(this.camera.smallViewPort={left:0,top:0,width:t,height:e}),this.camera.viewPort={left:0,top:0,width:t,height:e},this.camera.updateProjectionMatrix(),this.updateHotSpotScale()}},{key:"setLargeView",value:function(){for(var t in this.smallViewBackGroundSprite&&(this.smallViewBackGroundSprite.visible=!1),this.isSmallView=!1,this.hotSpotGroups)this.hotSpotGroups[t].visible=!0;this.orbitControls&&this.enableOrbitControls(!0),this.compassManager&&this.compassManager.show(),this.compassManager.updateRotate(this.camera.rotation,!0);var e=this.floorPlanGroup.getObjectByName("FloorPlanSprite");for(var n in e.thumbnail&&(e.material.map=e.floorPlan),this.sectorSprite.scale.set(100,100,1),this.enableHouseEvents(!0),this.renderer&&this.onWindowResize(),this.show(),window.appConfig.display3DUnder2D&&(this.bgMask.visible=!0),this.floorPlanGroups)this.floorPlanGroups[n].children[0].setVisible(!0),this.floorPlanGroups[n].children[1].setVisible(!1)}},{key:"setSmallView",value:function(){for(var t in this.smallViewBackGroundSprite&&(this.smallViewBackGroundSprite.visible=!0),this.isSmallView=!0,this.hotSpotGroups)this.hotSpotGroups[t].visible=!1;this.orbitControls&&this.enableOrbitControls(!1),this.compassManager&&this.compassManager.hide();var e=this.floorPlanGroup.getObjectByName("FloorPlanSprite");for(var n in e.thumbnail&&(e.material.map=e.thumbnail),this.sectorSprite.scale.set(160,160,1),this.renderer&&this.onWindowResize(),this.enableHouseEvents(!1),window.appConfig.display3DUnder2D&&(this.bgMask.visible=!1),this.floorPlanGroups)this.floorPlanGroups[n].children[0].setVisible(!1),this.floorPlanGroups[n].children[1].setVisible(!0)}},{key:"hideHotSpotsByIDs",value:function(t){var e=this;this.ignoredHotSpotGroups={},t&&t.forEach((function(t){e.hotSpotGroups[t]&&(e.ignoredHotSpotGroups[t]=e.hotSpotGroups[t],e.hotSpotGroups[t].visible=!1,delete e.hotSpotGroups[t])}))}},{key:"enableOrbitControls",value:function(t){this.orbitControls.enabled=t}},{key:"cancelHideHotSpotsByIDs",value:function(){if(this.ignoredHotSpotGroups)for(var t in this.ignoredHotSpotGroups)this.ignoredHotSpotGroups[t].visible=!0,this.hotSpotGroups[t]=this.ignoredHotSpotGroups[t],delete this.ignoredHotSpotGroups[t]}},{key:"floorHotSpotDataForDisplay",get:function(){var t,e=null===(t=this.currentFloor)||void 0===t?void 0:t.ID;if(this.hotSpotForDisplayJson&&Array.isArray(this.hotSpotForDisplayJson.FloorHotspots)){var n=this.hotSpotForDisplayJson.FloorHotspots.find((function(t){return t.ID===e}));if(n)return n.RoomHotspots}return[]}},{key:"currentFloorSize",get:function(){return this.currentFloor?this.floorPlanSize[this.currentFloor.ID]:this.floorPlanSizeDefault}}]),r}(zS.VRObject);function SE(){var t={duration:700,positionPower:.5,rotationPower:3,fovPower:3,closeToHotSpotThreshold:75};zS.Animation.call(this,t,t.duration)}SE.prototype=new zS.Animation,SE.prototype.play=function(t,e,n,r,o,i,a,s,l,u){var c={camera:t,startPosition:e,startRotation:n,endPosition:r,endRotation:o,startFov:i,endFov:a,onFinish:l,onCloseToTarget:s};this.defaults=u||{},this.params=nm(this.params,c),zS.Animation.prototype.play.call(this)},SE.prototype.onUpdate=function(t,e){var n=t.startPosition.clone(),r=t.startRotation.toVector3();n=n.lerp(t.endPosition,Math.pow(e,this.defaults.positionPower||t.positionPower)),r=r.lerp(t.endRotation,Math.pow(e,this.defaults.rotationPower||t.rotationPower));var o=THREE.Math.lerp(t.startFov,t.endFov,Math.pow(e,this.defaults.fovPower||t.fovPower));t.camera.position.copy(n),t.camera.rotation.setFromVector3(r),t.camera.fov=o,t.camera.updateProjectionMatrix(),n.distanceTo(t.endPosition)<(this.defaults.closeToHotSpotThreshold||t.closeToHotSpotThreshold)&&t.onCloseToTarget&&(t.onCloseToTarget(),t.onCloseToTarget=null)},SE.prototype.onFinish=function(t){t.onFinish&&t.onFinish()};var EE=uw.beamRadius,PE=255,xE=255,_E=255,TE=uw.hotSpotHighlightColor,CE={fontSize:iw.checkIsPhone()?40:23,fontFace:aw.textFontFamily2D,fontWeight:"100",backgroundColor:{r:0,g:0,b:0,a:.5},borderThickness:1,cornerWidth:2,anisotropy:aw.anisotropy,minFilter:THREE.LinearFilter,borderColor:{r:255,g:255,b:255,a:1},textMargin:iw.checkIsPhone()?20:13,textColor:{r:225,g:225,b:225,a:1},spriteScale:iw.checkIsPhone()?45e-5:9e-4,sizeAttenuation:!1},IE=function(t){im(n,t);var e=cm(n);function n(t,r,o,i,a){var s;return Kf(this,n),(s=e.call(this)).hotSpotPosition=t,s.roomName=r,s.roomHeight=o,s.isTopFloor=i,s.walkingAnimation=null,s.isActive=!1,s.isAdditionalHotSpot=a,s}return tm(n,[{key:"init",value:function(){this.position.copy(this.hotSpotPosition.clone().addY(.5)),this.isAdditionalHotSpot||this.add(this.createBeamObject3D()),uw.beamBaseEnabled&&this.add(this.createBeamBaseObject3D()),this.isAdditionalHotSpot||this.add(this.createRoomNameSprite())}},{key:"_getBeamHeight",value:function(){return this.isTopFloor?this.roomHeight+80:this.roomHeight/2}},{key:"createBeamObject3D",value:function(){var t,e=this._getBeamHeight(),n=mw.path.hotSpotLight,r=GS.loadResource(n);r.minFilter=THREE.LinearFilter,t=iw.checkIsPhone()?new THREE.CylinderBufferGeometry(EE+3,EE+1,e,20,1,!1):new THREE.CylinderBufferGeometry(EE+1,EE,e,20,1,!1);var o=new THREE.MeshBasicMaterial({map:r,transparent:!0,depthWrite:!1,side:THREE.DoubleSide}),i=new THREE.Mesh(t,o);return i.name="beam",i.position.set(0,t.parameters.height/2,0),i.matrixAutoUpdate=!1,i.updateMatrix(),i}},{key:"createBeamBaseObject3D",value:function(){var t=GS.loadResource(mw.path.beamBase);t.minFilter=THREE.LinearFilter;var e=new THREE.MeshBasicMaterial({map:t,color:"#FFFFFF",transparent:!0,side:THREE.DoubleSide,opacity:1,alphaTest:.01}),n=new THREE.PlaneBufferGeometry(60,60,1,1),r=new THREE.Mesh(n,e);return r.position.set(0,1,0),r.matrixAutoUpdate=!1,r.name="beamBase",r.rotation.set(Math.PI/2,0,0),r.updateMatrix(),r}},{key:"getBeamBaseObject3D",value:function(){return this.getObjectByName("beamBase")}},{key:"getBeamObject3D",value:function(){return this.getObjectByName("beam")}},{key:"setBeamObjectHeight",value:function(t){var e=this.getBeamObject3D(),n=e.geometry.parameters.height;e.geometry.scale(1,t/n,1),e.position.set(0,t/2,0),e.matrixAutoUpdate=!1,e.updateMatrix()}},{key:"createFeetObject3D",value:function(){var t=mw.path.hotSpotFeet,e=GS.loadResource(t);e.minFilter=THREE.NearestFilter;var n=new THREE.MeshBasicMaterial({map:e,transparent:!0,alphaTest:.01}),r=new THREE.PlaneBufferGeometry(12,12,1,1),o=new THREE.Mesh(r,n);return o.rotation.x=THREE.Math.degToRad(270),o.matrixAutoUpdate=!1,o.updateMatrix(),o}},{key:"createRoomNameSprite",value:function(){var t=zS.TextHelper.cropString(this.roomName,8),e=zS.TextHelper.createTextSprite(t,CE);e.name="hotSpotNameSprite";var n=this.getBeamObject3D().geometry.parameters.height+25;return e.position.set(0,n,0),e.sizeAttenuation=!1,e}},{key:"hoverRoomNameSprite",value:function(t){var e=om({},CE);this.isActive?(e.textColor=t?{r:255,g:255,b:255,a:1}:{r:225,g:225,b:225,a:1},e.backgroundColor=TE):e.textColor=t?{r:255,g:255,b:255,a:1}:{r:225,g:225,b:225,a:1},zS.TextHelper.updateTextSprite(this.getRoomNameSprite(),zS.TextHelper.cropString(this.roomName,8),e)}},{key:"getRoomNameSprite",value:function(){return this.getObjectByName("hotSpotNameSprite")}},{key:"updateRoomNameSprite",value:function(t){this.getRoomNameSprite().position.set(0,t,0)}},{key:"setTopFloorHeight",value:function(t){var e=t+80;this.setBeamObjectHeight(e),this.getRoomNameSprite().position.set(0,e,0)}},{key:"active",value:function(){this.isActive=!0;var t=this.getRoomNameSprite(),e=this.getBeamObject3D();if(t&&e){e.material.color=new THREE.Color(TE.r/255,TE.g/255,TE.b/255),t.material.map.parameters.backgroundColor=TE;var n=zS.TextHelper.cropString(this.roomName,8);zS.TextHelper.updateTextSprite(t,n)}}},{key:"disActive",value:function(){this.isActive=!1;var t=this.getRoomNameSprite(),e=this.getBeamObject3D();if(t&&e){e.material.color=new THREE.Color(PE/255,xE/255,_E/255),t.material.map.parameters.backgroundColor={r:0,g:0,b:0,a:.5};var n=zS.TextHelper.cropString(this.roomName,8);zS.TextHelper.updateTextSprite(t,n)}}}]),n}(GS),DE=function(){function t(){Kf(this,t),em(this,"Floors",[]),em(this,"HotSpots",[]),em(this,"ID",""),em(this,"Name",""),em(this,"CameraHeight",0),em(this,"HouseSize",new THREE.Vector3),em(this,"CoverImagePath",""),em(this,"DefaultHotSpotId",""),em(this,"ExistEntrance",!1),em(this,"EntrancePosition",new THREE.Vector3),em(this,"EntranceDirection",0),em(this,"StandardEntranceDirection",null),em(this,"ClientVersion",""),em(this,"CaptureVersion",""),em(this,"Rotation",0),em(this,"Orientation",0),em(this,"EntrancePointGroupID",void 0),em(this,"editorData",null),em(this,"HotSpotForDisplayJsonPath",""),em(this,"MosaicDataTimeStamp",""),em(this,"ClassMapper",{Floors:kE,HotSpots:AE,HouseSize:THREE.Vector3,EntrancePosition:THREE.Vector3}),em(this,"_isSingleMode",!1)}return tm(t,[{key:"calcVisibleHotSpots",value:function(){var t,e=this,n=this.HotSpots;this.Floors.forEach((function(r){t=r.Rooms.map((function(t){return t.Walls.map((function(e){var n=e.toSegment();return n.room=t.Name,n.doors=t.getDoorsOnWall(e),n}))})),t=iw.flat(t);var o=iw.flat(r.Rooms.map((function(t){return t.HotSpotIds}))),i=(o=iw.unique(o)).map((function(t){return n.find((function(e){return e.ID===t}))}));i=i.filter((function(t){return t})),r.Rooms.forEach((function(n){return n.removeHotSpotsBlockedByWall(t,i,e)}))})),this.validateVisibleHotSpots(t)}},{key:"calcVisibleVideo",value:function(t){var e=this.HotSpots,n=null;!(n=t?this.editorData.VideoData:this.HotSpots.reduce((function(t,e){return e.VideoData&&e.VideoData.length>0&&t.push.apply(t,hm(e.VideoData)),t}),[]))||n.length<=0||this.Floors.forEach((function(t){var r=[],o=[],i=[];t.Rooms.forEach((function(t){var e;t.Walls.forEach((function(e){var n=e.toSegment();n.id=t.Name+e.ID,n.room=t.Name,n.doors=t.getDoorsOnWall(e),r.push(n)})),(e=o).push.apply(e,hm(t.HotSpotIds))})),(o=iw.unique(o)).forEach((function(t){var n=e.find((function(e){return e.ID===t}));n&&i.push(n)})),i.forEach((function(t){var e=[],o=t.Position.clone().toVector2();n.forEach((function(t){if(!e.includes(t.id)){var n,i,a=t.vertices[0],s=t.vertices[2];n=new THREE.Vector2(a.x,a.z),i=new THREE.Vector2(s.x,s.z);var l=o.clone().sub(n.clone()).normalize(),u=o.clone().sub(i.clone()).normalize(),c=new zS.Segment(o,n.add(l)),h=new zS.Segment(o,i.add(u));r.some((function(t){var e=t.intersect(c),n=t.intersect(h);return e||n}))||e.push(t.id)}})),t.VisibleVideo=e}))}))}},{key:"validateVisibleHotSpots",value:function(t){var e=this,n=this.HotSpots,r=this;this.allRooms.forEach((function(o){var i,a=!1,s=r.getAdjRooms(o,e.getFloorByHotSpotId(o.HotSpotIds[0])),l=s.map((function(t){return t.adjRoom})),u=e.getFloorByHotSpotId(o.HotSpotIds[0]);if(u&&u.Rooms.length>0){if(i=u.Rooms[0],o.ID===i.ID&&u.Rooms.length>1&&(i=u.Rooms[1]),e.allRooms&&(Math.abs(o.height-i.height)/i.height>.15||i&&Math.abs(o.Position.y-i.Position.y)>50)&&0===o.doorIds.length){var c,h,p=o.Position,d=[];d=e.allRooms.filter((function(t){return t!==o&&t.Position.y>o.Position.y})).sort((function(t,e){return t.Position.distanceTo(p)-e.Position.distanceTo(p)})).slice(0,1),c=e.allRooms.filter((function(t){return t!==o&&t.Position.y<o.Position.y})).sort((function(t,e){return t.Position.distanceTo(p)-e.Position.distanceTo(p)})).slice(0,1),h=e.allRooms.filter((function(t){return t!==o&&t.Position.y===o.Position.y})).sort((function(t,e){return t.Position.distanceTo(p)-e.Position.distanceTo(p)})).slice(0,1),l=d.concat(c).concat(h),a=!0}o.HotSpotIds.forEach((function(r){var i=n.find((function(t){return t.ID===r}));i&&(i.BehindWallHotSpotIds=[],l.forEach((function(l,u){if(iw.intersection(i.VisibleHotSpotIds,l.HotSpotIds).length<=0&&l.HotSpotIds.length>0){var c=e.getHotSpotById(l.HotSpotIds[0]).Position.toVector2(),h=i.Position.toVector2();if(!a){var p=l.Doors.find((function(t){return t.ID===s[u].doorId}));p&&(h=new THREE.Vector2((p.End.Down.x+p.Start.Down.x)/2,(p.End.Down.z+p.Start.Down.z)/2))}var d=h.distanceTo(c),f=e.getHotSpotById(l.HotSpotIds[0]).ID;if(l.HotSpotIds.forEach((function(t){var n=e.getHotSpotById(t).Position.toVector2(),r=h.distanceTo(n);r<d&&(d=r,f=t)})),!a){var m=l.Doors.find((function(t){return t.ID===s[u].doorId}));m&&(c=new THREE.Vector2((m.End.Down.x+m.Start.Down.x)/2,(m.End.Down.z+m.Start.Down.z)/2))}var g=c.distanceTo(h),v=i.ID;o.HotSpotIds.forEach((function(t){var n=e.getHotSpotById(t).Position.toVector2(),r=c.distanceTo(n);r<g&&(g=r,v=t)}));var y=e.getHotSpotById(f).Position.toVector2(),w=!0,b=!0;if(o.HotSpotIds.forEach((function(n){var o=e.getHotSpotById(n).Position.toVector2(),i=new zS.Segment(y,o),a=!1;t.forEach((function(t){if(t.intersect(i)){var e=!1;return t.doors.forEach((function(t){t.toSegment().intersect(i)&&(e=!0)})),e||(a=!0),!1}})),a||(n===r?w=!1:b=!1)})),w?w&&b&&(window.appConfig&&window.appConfig.useRoamArrow?iw.pushUniq(e.getHotSpotById(v).BehindWallHotSpotIds,f):iw.pushUniq(e.getHotSpotById(v).VisibleHotSpotIds,f)):window.appConfig&&window.appConfig.useRoamArrow?iw.pushUniq(i.BehindWallHotSpotIds,f):iw.pushUniq(i.VisibleHotSpotIds,f),a){var S=n.find((function(t){return t.ID===f}));window.appConfig.useRoamArrow?iw.pushUniq(S.BehindWallHotSpotIds,i.ID):iw.pushUniq(S.VisibleHotSpotIds,i.ID)}var E=o.getConnectDoors(l);E[0]&&(i.BehindWallConnectDoor[f]=E[0])}})))}))}})),this.Floors.forEach((function(t){var e=iw.flat(t.Rooms.map((function(t){return t.HotSpotIds}))),r=(e=iw.unique(e)).map((function(t){return n.find((function(e){return e.ID===t}))}));r.forEach((function(t){if(t&&0===iw.intersection(e,t.VisibleHotSpotIds).length){var n=0;if(r[n].ID===t.ID){if(1===r.length)return;n=1}var o=r[n].Position.toVector2(),i=t.Position.toVector2(),a=i.distanceTo(o),s=r[n].ID;r.forEach((function(e){if(e instanceof Object&&e.ID&&e.ID!==t.ID||"string"==typeof e&&e!==t.ID){var n=e.Position.toVector2(),r=i.distanceTo(n);r<a&&(a=r,s=e.ID)}})),t.VisibleHotSpotIds.push(s)}}))}))}},{key:"getAdjRooms",value:function(t,e){var n=this,r=t.doorIds,o=[];this.allRooms.forEach((function(e){var n=iw.intersection(r,e.doorIds);n.length>0&&e!==t&&o.push({adjRoom:e,doorId:n[0]})})),t.Doors.forEach((function(e){var r=e.toSegment();e.Type===WE.StairsEntrance&&n.allRooms.filter((function(e){return e!==t})).forEach((function(t){t.Doors.forEach((function(e){e.Type===WE.StairsEntrance&&r.isCoincide(e.toSegment())&&o.push({adjRoom:t,doorId:e.ID})}))}))}));var i=e.Rooms;return t.Doors.forEach((function(e){var n=e.toSegment();e.Type!==WE.StairsEntrance&&i.filter((function(e){return e!==t})).forEach((function(t){t.Doors.forEach((function(e){e.Type!==WE.StairsEntrance&&n.isCoincide(e.toSegment())&&(o.find((function(e){return e.adjRoom===t}))||o.push({adjRoom:t,doorId:e.ID}))}))}))})),o}},{key:"addHousePathPrefix",value:function(t){if(this.HotSpots.forEach((function(e){if(e.ImagePath=t+e.ImagePath,e.ThumbnailPath=t+e.ThumbnailPath,e.PanoramaThumbImagePath=t+e.PanoramaThumbImagePath,0===e.TileImagesPath.length&&e.ImagePath){var n=e.ImagePath,r=n.substring(n.lastIndexOf("/")+1,n.length),o=iw.getFileName(r);if(r&&o){r=r.substr(0,r.length-o.length-1);var i=[];i.push(t+"PanoramaTileImages/"+r+"_l."+o),i.push(t+"PanoramaTileImages/"+r+"_r."+o),i.push(t+"PanoramaTileImages/"+r+"_u."+o),i.push(t+"PanoramaTileImages/"+r+"_d."+o),i.push(t+"PanoramaTileImages/"+r+"_f."+o),i.push(t+"PanoramaTileImages/"+r+"_b."+o),e.TileImagesPath=i}}else e.TileImagesPath.forEach((function(n,r){return e.TileImagesPath[r]=t+e.TileImagesPath[r]}));if(0===e.BlurTileImagesPath.length&&e.ImagePath){var a=e.ImagePath,s=a.substring(a.lastIndexOf("/")+1,a.length),l=iw.getFileName(s);if(s&&l){s=s.substr(0,s.length-l.length-1);var u=[];u.push(t+"PanoramaBlurTileImages/"+s+"_l."+l),u.push(t+"PanoramaBlurTileImages/"+s+"_r."+l),u.push(t+"PanoramaBlurTileImages/"+s+"_u."+l),u.push(t+"PanoramaBlurTileImages/"+s+"_d."+l),u.push(t+"PanoramaBlurTileImages/"+s+"_f."+l),u.push(t+"PanoramaBlurTileImages/"+s+"_b."+l),e.BlurTileImagesPath=u}}else e.BlurTileImagesPath.forEach((function(n,r){return e.BlurTileImagesPath[r]=t+e.BlurTileImagesPath[r]}))})),this.Floors.forEach((function(e){e.FloorPlanPath=t+e.FloorPlanPath;var n=e.FloorPlanPath.lastIndexOf(".");e.FloorPlanThumbnailPath=e.FloorPlanThumbnailPath?t+e.FloorPlanThumbnailPath:e.FloorPlanPath.substr(0,n)+"_cover"+e.FloorPlanPath.substr(n),e.Models.forEach((function(e){e.Model=t+e.Model})),e.AutoModels.forEach((function(e){e.Model=t+e.Model})),e.Rooms.forEach((function(e){e.PanoramaThumbImagePath=t+e.PanoramaThumbImagePath,e.RoomFaces.forEach((function(e){return e.ImagePath=t+e.ImagePath}))}))})),this.CoverImagePath=t+this.CoverImagePath,this.HotSpotForDisplayJsonPath=t+"HotSpotForDisplay.json",!window.appConfig.isSingleMode&&window.appConfig.hotSpotsDisplayInDeco){var e,n=t.indexOf("_deco_");n>-1&&(e=t.substring(0,n)+"/",this.HotSpotForDisplayJsonPath=e+"HotSpotForDisplay.json")}}},{key:"preProcessVRHouse3Data",value:function(){if(this.isSingleMode)return this;var t=this.Floors.flatMap((function(t){return t.Rooms})),e=t.filter((function(t){return t.IsDraw}))[0],n=this.Rotation-e.Rotation;t.forEach((function(t){t.Position.applyAxisAngle(THREE.Vector3.unitY,THREE.Math.degToRad(n)),t.Rotation+=n}));var r=t.filter((function(t){return t.IsDraw})).flatMap((function(t){return t.MarkPointList.filter((function(t){return GE.isWall(t.Type)})).flatMap((function(e){var n=t.localToWorld(e.Position,!0);return[n,n.clone().addY(t.RoomHeight)]}))})),o=THREE.Vector3.getVerticesCenter(r);return t.forEach((function(t){return t.Position.sub(o)})),this.HotSpots.forEach((function(t){t.Position.applyAxisAngle(THREE.Vector3.unitY,THREE.Math.degToRad(n)).sub(o),t.Rotation.y+=n-THREE.Math.radToDeg(t.FrameRotation)})),this.EntrancePosition.applyAxisAngle(THREE.Vector3.unitY,THREE.Math.degToRad(n)).sub(o),this}},{key:"backwardsCapability",value:function(){}},{key:"fromUnity",value:function(){function t(t,e){t.Start.Up=e.localToWorld(t.Start.Up.fromUnityPositionX2()),t.Start.Down=e.localToWorld(t.Start.Down.fromUnityPositionX2()),t.End.Up=e.localToWorld(t.End.Up.fromUnityPositionX2()),t.End.Down=e.localToWorld(t.End.Down.fromUnityPositionX2())}return this.HouseSize.multiplyScalar(2),this.EntrancePosition.fromUnityPositionX2(),this.CameraHeight*=2,this.Rotation=THREE.Math.degToRad(-this.Rotation),this.EntranceDirection=THREE.Math.degToRad(-this.EntranceDirection),this.StandardEntranceDirection=this.StandardEntranceDirection?THREE.Math.degToRad(-this.StandardEntranceDirection):this.EntranceDirection,this.Orientation=THREE.Math.degToRad(-this.Orientation),this.Floors.forEach((function(e){e.FloorSize.multiplyScalar(2),e.Rooms.forEach((function(e){e.Position.fromUnityPositionX2(),e.Rotation=THREE.Math.degToRad(-e.Rotation),e.RoomHeight*=2,e.RoomFaces.forEach((function(t){t.Position.fromUnityPositionX2(),t.Rotation.degToRad(),t.Width*=2,t.Height*=2})),e.Walls.forEach((function(n){return t(n,e)})),e.Doors.forEach((function(n){return t(n,e)})),e.Windows.forEach((function(n){t(n,e),n.Depth*=2})),e.MarkPointList.forEach((function(t){return t.Position.fromUnityPositionX2()}))}))})),this.HotSpots.forEach((function(e){e.Position.fromUnityPositionX2();var n=e.Rotation.x;e.Rotation.x=e.Rotation.z,e.Rotation.z=n,e.Rotation.fromUnityRotation(),e.Walls.forEach((function(n){return t(n,e)}));var r=e.BestCameraView.x%360;e.BestCameraView.x=Math.abs(r)>45&&Math.abs(r)<315?0:-e.BestCameraView.x*THREE.Math.DEG2RAD,e.BestCameraView.y=((180-e.BestCameraView.y)*THREE.Math.DEG2RAD-e.Rotation.y)%(2*Math.PI)})),this}},{key:"getHotSpotById",value:function(t){if(t)return this.HotSpots.find((function(e){return e.ID===t}))}},{key:"getDefaultHotSpotId",value:function(){return String.isNullOrEmpty(this.DefaultHotSpotId)?this.hasMarkPoints?this.Floors[0].Rooms[0].HotSpotIds[0]:this.HotSpots[0].ID:this.DefaultHotSpotId}},{key:"getDefaultHotSpot",value:function(){var t=this.getDefaultHotSpotId();return this.getHotSpotById(t)}},{key:"getDefaultRoom",value:function(){var t=this.getDefaultHotSpotId();return this.getRoomByHotSpotId(t)}},{key:"getDefaultHotSpotByFloor",value:function(t){var e=t.Rooms.flatMap((function(t){return t.HotSpotIds}))[0];return this.getHotSpotById(e)}},{key:"getDefaultFloor",value:function(){var t=this.getDefaultHotSpotId();return this.getFloorByHotSpotId(t)}},{key:"getFloorById",value:function(t){return this.Floors.find((function(e){return e.ID===t}))}},{key:"getHotSpotsByFloor",value:function(t){var e=this;return t.Rooms.flatMap((function(t){return e.getHotSpotsByRoom(t)}))}},{key:"getHotSpotsByRoom",value:function(t){var e=this;return Array.isNullOrEmpty(t.HotSpotIds)?[]:t.HotSpotIds.map((function(t){return e.getHotSpotById(t)})).filter((function(t){return t}))}},{key:"getFloorByHotSpotId",value:function(t){if(t)return this.Floors.find((function(e){return e.Rooms.some((function(e){return e.HotSpotIds.includes(t)}))}))}},{key:"isTopFloor",value:function(t){return this.Floors[this.Floors.length-1].ID===t.ID}},{key:"getRoomByHotSpotId",value:function(t){if(t)return this.Floors.flatMap((function(t){return t.Rooms})).find((function(e){return e.HotSpotIds.includes(t)}))}},{key:"getNearestHotSpotByPosition",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,r=arguments.length>3?arguments[3]:void 0;return t.map((function(t){return{hotSpot:t,distance:r?t.Position.distanceTo(e):t.Position.toVector2().distanceTo(e.toVector2())}})).filter((function(t){return t.distance<n})).sort((function(t,e){return t.distance-e.distance})).map((function(t){return t.hotSpot}))[0]}},{key:"isAdditionalHotSpot",value:function(t){var e=this.getRoomByHotSpotId(t);if(e&&!Array.isNullOrEmpty(e.HotSpotIds))return e.HotSpotIds[0]!==t}},{key:"mergeEditorData",value:function(t){(this.editorData=t,0!==Object.keys(t.HotSpots).length?this.HotSpots.forEach((function(e){t.HotSpots[e.ID]?(e.Anchors=t.HotSpots[e.ID].Anchors,e.Mosaics=t.HotSpots[e.ID].Mosaics,e.Name=t.HotSpots[e.ID].Name||e.Name,e.VideoData=t.HotSpots[e.ID].VideoData,e.Sequence=t.HotSpots[e.ID].Sequence,t.HotSpots[e.ID].BestCameraView&&(e.BestCameraView={x:-t.HotSpots[e.ID].BestCameraView.x*THREE.Math.DEG2RAD,y:((180-t.HotSpots[e.ID].BestCameraView.y)*THREE.Math.DEG2RAD-e.Rotation.y)%(2*Math.PI)}),null!=t.HotSpots[e.ID].BestViews?e.BestViews=t.HotSpots[e.ID].BestViews:e.BestViews=null):e.BestViews=null})):this.HotSpots.forEach((function(t){t.BestViews=null})),t.DefaultHotSpotId)&&(this.editorData=t,this.HotSpots.find((function(e){return e.ID===t.DefaultHotSpotId}))&&(this.DefaultHotSpotId=t.DefaultHotSpotId));return this}},{key:"existEntrance",value:function(){return this.ExistEntrance||this.EntrancePosition.hasValue()}},{key:"getEntranceRoom",value:function(){var t=this,e=this.Floors.flatMap((function(t){return t.Rooms})),n=e.find((function(t){return t.Doors.find((function(t){return t.Type===WE.EntranceDoor}))}));if(n)return n;if(this.isVRHouse3)n=e.find((function(e){return e.MarkPointList.some((function(e){return e.MarkPointGroupID===t.EntrancePointGroupID}))}));else{var r=this.getNearestHotSpotByPosition(this.HotSpots,this.EntrancePosition,void 0,!0);r&&(n=this.getRoomByHotSpotId(r.ID))}return n}},{key:"getHouseCenter",value:function(){var t=this.Floors.flatMap((function(t){return t.Rooms})).flatMap((function(t){return t.Walls.map((function(e){var n=[];return n.push(t.localToWorld(e.Start.Up)),n.push(t.localToWorld(e.End.Up)),n.push(t.localToWorld(e.Start.Down)),n.push(t.localToWorld(e.End.Down)),n}))}));return THREE.Vector3.getVerticesCenter(t)}},{key:"isVRHouse3",get:function(){return this.Floors.flatMap((function(t){return t.Rooms})).every((function(t){return 0===t.RoomFaces.length}))}},{key:"hasObjModels",get:function(){return this.Floors.some((function(t){return!Array.isNullOrEmpty(t.Models)}))}},{key:"hasMarkPoints",get:function(){return this.Floors.flatMap((function(t){return t.Rooms})).some((function(t){return!Array.isNullOrEmpty(t.MarkPointList)||!Array.isNullOrEmpty(t.Walls)}))}},{key:"isSingleView",get:function(){return this.HotSpots.length>0&&!this.hasMarkPoints}},{key:"isSingleMode",get:function(){
/*!this.hasRooms || (!this.hasMarkPoints && this.isVRHouse3) || */
return this._isSingleMode},set:function(t){this._isSingleMode=t}},{key:"allRooms",get:function(){return this.Floors.flatMap((function(t){return t.Rooms}))}}],[{key:"fromJson",value:function(e){e=(e=(e=(e=e.replace(/"StartMarkPoint"/g,'"Start"')).replace(/"EndMarkPoint"/g,'"End"')).replace(/"UpPosition"/g,'"Up"')).replace(/"DownPosition"/g,'"Down"');var n=Vw.fromJson(e,t);if(n)return n.isVRHouse3&&n.Floors.length>0&&n.preProcessVRHouse3Data(),console.log("isVRHouse3: "+n.isVRHouse3),n.backwardsCapability(),n.fromUnity()}}]),t}(),kE=function(){function t(){Kf(this,t),em(this,"ID",""),em(this,"Name",""),em(this,"FloorSize",new THREE.Vector3),em(this,"FloorPlanPath",""),em(this,"FloorPlanThumbnailPath",""),em(this,"Rooms",[]),em(this,"ModelPath",""),em(this,"FloorPlanMargin",51),em(this,"Models",[]),em(this,"AutoModels",[]),em(this,"ClassMapper",{FloorSize:THREE.Vector3,Rooms:ME,Models:zE})}return tm(t,[{key:"getRoomByHotSpotId",value:function(t){if(t)return this.Rooms.find((function(e){return e.HotSpotIds.includes(t)}))}},{key:"hasObjModels",get:function(){return!Array.isNullOrEmpty(this.Models)||!Array.isNullOrEmpty(this.AutoModels)}},{key:"objModels",get:function(){return this.Models.length>0?this.Models:this.AutoModels.length>0?this.AutoModels:[]}}]),t}(),ME=function(){function t(){Kf(this,t),em(this,"ID",""),em(this,"Name",""),em(this,"Position",new THREE.Vector3),em(this,"Rotation",0),em(this,"RoomFaces",[]),em(this,"HotSpotIds",[]),em(this,"Walls",[]),em(this,"Doors",[]),em(this,"Windows",[]),em(this,"Area",0),em(this,"MeasurementHeight",0),em(this,"MarkPointList",[]),em(this,"PanoramaThumbImagePath",""),em(this,"IsDraw",!0),em(this,"RoomHeight",0),em(this,"ClassMapper",{Position:THREE.Vector3,RoomFaces:RE,Walls:BE,Doors:FE,Windows:NE,MarkPointList:VE})}return tm(t,[{key:"localToWorld",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t.clone().applyAxisAngle(THREE.Vector3.unitY,e?THREE.Math.degToRad(this.Rotation):this.Rotation).add(this.Position)}},{key:"getConnectedWallMarkPoints",value:function(t){var e=this.Walls.filter((function(e){return e.Start.ID===t.ID&&e.length>10})).map((function(t){return t.End})),n=this.Walls.filter((function(e){return e.End.ID===t.ID&&e.length>10})).map((function(t){return t.Start}));return e.concat(n)}},{key:"getDoorsOnWall",value:function(t){var e=t.toSegment(),n=[];return this.Doors.forEach((function(t){var r=t.toSegment(),o=Math.max(e.p1.distanceTo(r.p1),e.p1.distanceTo(e.p2),r.p1.distanceTo(e.p2)),i=zS.MathHelper.isParallel(e.p1,e.p2,r.p1,r.p2),a=zS.MathHelper.isCollinear(e.p1,r.p1,e.p2,o);i&&a&&n.push(t)})),n}},{key:"getConnectDoors",value:function(t){return this.Doors.filter((function(e){return t.Doors.map((function(t){return t.ID})).includes(e.ID)}))}},{key:"removeHotSpotsBlockedByWall",value:function(t,e){this.HotSpotIds.forEach((function(n){var r=[],o=[],i=e.find((function(t){return t.ID===n}));if(i){var a=i.Position.toVector2();e.filter((function(t){return t.ID!==n})).forEach((function(e){var n=e.Position.toVector2(),i=new zS.Segment(a,n);if(a.distanceTo(n)<=500){var s=!1;t.forEach((function(t){if(t.intersect(i)){var e=!1;return t.doors.forEach((function(t){t.toSegment().intersect(i)&&(e=!0)})),e||(s=!0),!1}})),s&&iw.pushUniq(r,e)}else iw.pushUniq(o,e)}));var s=e.map((function(t){return t.ID})),l=i.VisibleHotSpotIds.filter((function(t){return!s.includes(t)}));i.VisibleHotSpotIds=l.concat(e.map((function(t){return t.ID})).filter((function(t){return t!==i.ID}))),o.concat(r).forEach((function(t){var e=i.VisibleHotSpotIds.indexOf(t.ID);e>=0&&i.VisibleHotSpotIds.splice(e,1)}))}}))}},{key:"markPoints2DJson",get:function(){var t=this;return JSON.stringify(this.MarkPointList.map((function(e){return t.localToWorld(e.Position).toVector2().multiply(new THREE.Vector2(1,-1))})))}},{key:"roomPolygon",get:function(){var t=this;return this.Walls.flatMap((function(t){return t.toArray()})).map((function(e){return t.localToWorld(e.Down).toVector2()}))}},{key:"wallPoints2DJson",get:function(){return this.roomPolygon.map((function(t){return t.multiply(new THREE.Vector2(1,-1))}))}},{key:"height",get:function(){return this.RoomFaces.length>0?this.RoomFaces[0].Height:this.RoomHeight}},{key:"doorIds",get:function(){return this.Doors.map((function(t){return t.ID}))}},{key:"fullName",get:function(){return this.ID+"-"+this.Name}}]),t}(),RE=function t(){Kf(this,t),em(this,"Name",""),em(this,"Position",void 0),em(this,"Rotation",void 0),em(this,"Width",0),em(this,"Height",0),em(this,"ImagePath",""),em(this,"ClassMapper",{Position:THREE.Vector3,Rotation:THREE.Vector3})},AE=function(){function t(){Kf(this,t),em(this,"ID",""),em(this,"Name",""),em(this,"IsDecorating",!1),em(this,"TileImagesPath",[]),em(this,"BlurTileImagesPath",[]),em(this,"ThumbnailPath",""),em(this,"Position",new THREE.Vector3),em(this,"Rotation",0),em(this,"BestCameraView",new THREE.Vector2),em(this,"VisibleHotSpotIds",[]),em(this,"BehindWallHotSpotIds",[]),em(this,"BehindWallConnectDoor",{}),em(this,"Anchors",[]),em(this,"Mosaics",[]),em(this,"ImagePath",""),em(this,"FrameRotation",0),em(this,"Walls",[]),em(this,"ClassMapper",{Position:THREE.Vector3,Rotation:THREE.Vector3,BestCameraView:THREE.Vector2,Anchors:HE,Walls:BE})}return tm(t,[{key:"localToWorld",value:function(t){var e=Math.PI-this.Rotation.y-this.FrameRotation;return t.clone().applyAxisAngle(THREE.Vector3.unitY,e).add(this.Position)}},{key:"getThumbnailPath",value:function(){return(this.ThumbnailPath||"ThumbnailImages/"+this.ImagePath).replace("\\","/")}},{key:"getConnectedWallMarkPoints",value:function(t){var e=this.Walls.filter((function(e){return e.Start.ID===t.ID&&e.length>10})).map((function(t){return t.End})),n=this.Walls.filter((function(e){return e.End.ID===t.ID&&e.length>10})).map((function(t){return t.Start}));return e.concat(n)}}]),t}(),HE=function t(){Kf(this,t),em(this,"wID",""),em(this,"Name",""),em(this,"SpaceID",""),em(this,"ResourceType",""),em(this,"Url",""),em(this,"Desc",""),em(this,"Position",void 0),em(this,"ClassMapper",{Position:THREE.Vector2})},OE=function t(){Kf(this,t)};em(OE,"image","image"),em(OE,"video","video"),em(OE,"audio","audio"),em(OE,"iframe","iframe"),em(OE,"href","href");var LE=function(){function t(){Kf(this,t),em(this,"ID",""),em(this,"Start",void 0),em(this,"End",void 0),em(this,"ClassMapper",{Start:jE,End:jE})}return tm(t,[{key:"toArray",value:function(){return[this.Start,this.End]}},{key:"toSegment",value:function(){return new zS.Segment(this.Start.Down.toVector2(),this.End.Down.toVector2())}},{key:"length",get:function(){return this.Start.Down.distanceTo(this.End.Down)}},{key:"middleDownPos",get:function(){return this.Start.Down.clone().add(this.End.Down).multiplyScalar(.5)}},{key:"vertexes",get:function(){return[this.Start.Down.clone(),this.Start.Up.clone(),this.End.Up.clone(),this.End.Down.clone()]}}]),t}(),BE=function(t){im(n,t);var e=cm(n);function n(){var t;Kf(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return em(lm(t=e.call.apply(e,[this].concat(o))),"MeasurementWidth",0),t}return n}(LE),FE=function(t){im(n,t);var e=cm(n);function n(){var t;Kf(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return em(lm(t=e.call.apply(e,[this].concat(o))),"Type",""),t}return n}(LE),NE=function(t){im(n,t);var e=cm(n);function n(){var t;Kf(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return em(lm(t=e.call.apply(e,[this].concat(o))),"Depth",0),t}return n}(LE),jE=function t(){Kf(this,t),em(this,"ID",""),em(this,"Up",new THREE.Vector3),em(this,"Down",new THREE.Vector3),em(this,"ClassMapper",{Up:THREE.Vector3,Down:THREE.Vector3})},VE=function t(){Kf(this,t),em(this,"ID",""),em(this,"Position",void 0),em(this,"Type",void 0),em(this,"MarkPointGroupID",void 0),em(this,"MarkPointParentGroupID",void 0),em(this,"ClassMapper",{Position:THREE.Vector3})},zE=function t(){Kf(this,t),em(this,"Model",""),em(this,"LOD","")},WE=Object.freeze({Unknown:"Unknown",NormalDoor:"NormalDoor",OpenSpace:"OpenSpace",StairsEntrance:"StairsEntrance",SlidingDoor:"SlidingDoor",EntranceDoor:"EntranceDoor",SingleDoor:"SingleDoor"}),GE=Object.freeze({UnKnown:0,Wall:1,Door:2,FreePoint:3,Frame:4,Stairs:5,OpenSpace:6,StairsEntrance:7,BayWindow:8,CommonWindow:9,SlidingDoor:10,isWall:function(t){return t===GE.Wall||t===GE.Frame||t===GE.FreePoint},isDoor:function(t){return t===GE.Door||t===GE.OpenSpace||t===GE.SlidingDoor},isNotWindow:function(t){return t!==GE.CommonWindow&&t!==GE.BayWindow&&t!==GE.UnKnown},isStairsEntrance:function(t){return t===GE.StairsEntrance},isStairs:function(t){return t===GE.Stairs}}),UE={r:51,g:51,b:51,a:.6},YE=new THREE.Color(uw.hotSpotHighlightColor.r/255,uw.hotSpotHighlightColor.g/255,uw.hotSpotHighlightColor.b/255),XE=function(t){im(n,t);var e=cm(n);function n(t,r){var o;return Kf(this,n),(o=e.call(this)).viewData=t,o.room=r,o}return tm(n,[{key:"init",value:function(){var t=this.getOutdoorDirection();if(t){this._setTransform(t);var e=this.createEntranceAnimation(),n=this.createNameSprite();this.add(e),this.add(n)}else console.error("outdoorDirection未找到")}},{key:"_setTransform",value:function(t){var e=this.viewData.EntrancePosition,n=e.toVector2().add(t.multiplyScalar(100));this.position.copy(n.toVector3(e.y)),this.lookAt(e)}},{key:"getOutdoorDirection",value:function(){var t,e=this,n=this.viewData.getEntranceRoom(),r=null===(t=n.Doors.find((function(t){return t.Type===WE.EntranceDoor})))||void 0===t?void 0:t.toSegment().direction().perpendicular();if(r)return r;if(this.viewData.isVRHouse3){var o=n.MarkPointList.filter((function(t){return t.MarkPointGroupID===e.viewData.EntrancePointGroupID}));2===o.length&&(r=n.localToWorld(o[1].Position).clone().sub(n.localToWorld(o[0].Position)).toVector2().normalize().perpendicular())}if(!r){var i,a=n.Walls.find((function(t){var n=e.viewData.EntrancePosition.toVector2().distanceToSegment(t.toSegment());return zS.Mathf.approxEquals(n,50,.1)}));a||(a=n.Walls.find((function(t){var n=e.viewData.EntrancePosition.toVector2().distanceToSegment(t.toSegment());return zS.Mathf.approxEquals(n,25,.1)}))),r=null===(i=a)||void 0===i?void 0:i.toSegment().direction().normalize().perpendicular()}if(!r){var s=this.viewData.EntranceDirection-this.viewData.Orientation;r=new THREE.Vector3(0,0,-1).applyAxisAngle(new THREE.Vector3(0,1,0),s).toVector2()}return r}},{key:"createEntranceAnimation",value:function(){var t=new THREE.Group;return t.name="animationGroup",mw.path.entranceArrow?(zS.ResourcesLoader.loadResource(mw.path.entranceArrow,function(e){e.setLayer(pw.StereoHouseManager),e.scale.multiplyScalar(.5),e.rotation.y+=Math.PI;var n=e.children[0],r=n.clone();r.position.z+=70,r.material=n.material.clone(),e.add(r);var o=n.clone();o.position.z+=140,o.material=n.material.clone(),e.add(o),t.add(e);setInterval((function(t){e.visible&&(e.children.forEach((function(e,n){var r=t.highlightIndex===n?YE.getHex():16777215;e.material.color.set(r)})),t.highlightIndex--,-4===t.highlightIndex&&(t.highlightIndex=2))}),300,{highlightIndex:2})}.bind(this)),t):null}},{key:"createNameSprite",value:function(){var t=iw.getUrlParameter("lang")||iw.getUrlParameter("language");t||(t=window.appConfig&&window.appConfig.lang?window.appConfig.lang:"zh-CN");var e=zS.NameConverter.convertLangByUrl("入户门",t),n=zS.TextHelper.createTextSprite(e,{fontSize:28,fontFace:aw.textFontFamily2D,backgroundColor:UE,borderThickness:2,anisotropy:aw.anisotropy,minFilter:THREE.LinearFilter,borderColor:{r:255,g:255,b:255,a:1},textMargin:16,textColor:{r:255,g:255,b:255,a:1},spriteScale:1});return n.name="hotSpotNameSprite",n.position.z-=140,n.position.y+=30,n}}]),n}(GS),ZE=Object.freeze({__proto__:null});function qE(t){return"("+t.x+";"+t.y+")"}var JE={toString:function(t){var e=t.toString();return"[object Object]"===e?qE(t):e},toStringBase:qE,compare:function(t,e){return t.y===e.y?t.x-e.x:t.y-e.y},equals:function(t,e){return t.x===e.x&&t.y===e.y}},$E=function(t,e){this.name="PointError",this.points=e=e||[],this.message=t||"Invalid Points!";for(var n=0;n<e.length;n++)this.message+=" "+JE.toString(e[n])};($E.prototype=new Error).constructor=$E;var KE=$E,QE=function(t,e){this.x=+t||0,this.y=+e||0,this._p2t_edge_list=null};QE.prototype.toString=function(){return JE.toStringBase(this)},QE.prototype.toJSON=function(){return{x:this.x,y:this.y}},QE.prototype.clone=function(){return new QE(this.x,this.y)},QE.prototype.set_zero=function(){return this.x=0,this.y=0,this},QE.prototype.set=function(t,e){return this.x=+t||0,this.y=+e||0,this},QE.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},QE.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},QE.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},QE.prototype.mul=function(t){return this.x*=t,this.y*=t,this},QE.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},QE.prototype.normalize=function(){var t=this.length();return this.x/=t,this.y/=t,t},QE.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},QE.negate=function(t){return new QE(-t.x,-t.y)},QE.add=function(t,e){return new QE(t.x+e.x,t.y+e.y)},QE.sub=function(t,e){return new QE(t.x-e.x,t.y-e.y)},QE.mul=function(t,e){return new QE(t*e.x,t*e.y)},QE.cross=function(t,e){return"number"==typeof t?"number"==typeof e?t*e:new QE(-t*e.y,t*e.x):"number"==typeof e?new QE(e*t.y,-e*t.x):t.x*e.y-t.y*e.x},QE.toString=JE.toString,QE.compare=JE.compare,QE.cmp=JE.compare,QE.equals=JE.equals,QE.dot=function(t,e){return t.x*e.x+t.y*e.y};var tP=QE,eP=function(t,e,n){this.points_=[t,e,n],this.neighbors_=[null,null,null],this.interior_=!1,this.constrained_edge=[!1,!1,!1],this.delaunay_edge=[!1,!1,!1]},nP=JE.toString;eP.prototype.toString=function(){return"["+nP(this.points_[0])+nP(this.points_[1])+nP(this.points_[2])+"]"},eP.prototype.getPoint=function(t){return this.points_[t]},eP.prototype.GetPoint=eP.prototype.getPoint,eP.prototype.getPoints=function(){return this.points_},eP.prototype.getNeighbor=function(t){return this.neighbors_[t]},eP.prototype.containsPoint=function(t){var e=this.points_;return t===e[0]||t===e[1]||t===e[2]},eP.prototype.containsEdge=function(t){return this.containsPoint(t.p)&&this.containsPoint(t.q)},eP.prototype.containsPoints=function(t,e){return this.containsPoint(t)&&this.containsPoint(e)},eP.prototype.isInterior=function(){return this.interior_},eP.prototype.setInterior=function(t){return this.interior_=t,this},eP.prototype.markNeighborPointers=function(t,e,n){var r=this.points_;if(t===r[2]&&e===r[1]||t===r[1]&&e===r[2])this.neighbors_[0]=n;else if(t===r[0]&&e===r[2]||t===r[2]&&e===r[0])this.neighbors_[1]=n;else{if(!(t===r[0]&&e===r[1]||t===r[1]&&e===r[0]))throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call");this.neighbors_[2]=n}},eP.prototype.markNeighbor=function(t){var e=this.points_;t.containsPoints(e[1],e[2])?(this.neighbors_[0]=t,t.markNeighborPointers(e[1],e[2],this)):t.containsPoints(e[0],e[2])?(this.neighbors_[1]=t,t.markNeighborPointers(e[0],e[2],this)):t.containsPoints(e[0],e[1])&&(this.neighbors_[2]=t,t.markNeighborPointers(e[0],e[1],this))},eP.prototype.clearNeighbors=function(){this.neighbors_[0]=null,this.neighbors_[1]=null,this.neighbors_[2]=null},eP.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1,this.delaunay_edge[1]=!1,this.delaunay_edge[2]=!1},eP.prototype.pointCW=function(t){var e=this.points_;return t===e[0]?e[2]:t===e[1]?e[0]:t===e[2]?e[1]:null},eP.prototype.pointCCW=function(t){var e=this.points_;return t===e[0]?e[1]:t===e[1]?e[2]:t===e[2]?e[0]:null},eP.prototype.neighborCW=function(t){return t===this.points_[0]?this.neighbors_[1]:t===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]},eP.prototype.neighborCCW=function(t){return t===this.points_[0]?this.neighbors_[2]:t===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]},eP.prototype.getConstrainedEdgeCW=function(t){return t===this.points_[0]?this.constrained_edge[1]:t===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]},eP.prototype.getConstrainedEdgeCCW=function(t){return t===this.points_[0]?this.constrained_edge[2]:t===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]},eP.prototype.getConstrainedEdgeAcross=function(t){return t===this.points_[0]?this.constrained_edge[0]:t===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]},eP.prototype.setConstrainedEdgeCW=function(t,e){t===this.points_[0]?this.constrained_edge[1]=e:t===this.points_[1]?this.constrained_edge[2]=e:this.constrained_edge[0]=e},eP.prototype.setConstrainedEdgeCCW=function(t,e){t===this.points_[0]?this.constrained_edge[2]=e:t===this.points_[1]?this.constrained_edge[0]=e:this.constrained_edge[1]=e},eP.prototype.getDelaunayEdgeCW=function(t){return t===this.points_[0]?this.delaunay_edge[1]:t===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]},eP.prototype.getDelaunayEdgeCCW=function(t){return t===this.points_[0]?this.delaunay_edge[2]:t===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]},eP.prototype.setDelaunayEdgeCW=function(t,e){t===this.points_[0]?this.delaunay_edge[1]=e:t===this.points_[1]?this.delaunay_edge[2]=e:this.delaunay_edge[0]=e},eP.prototype.setDelaunayEdgeCCW=function(t,e){t===this.points_[0]?this.delaunay_edge[2]=e:t===this.points_[1]?this.delaunay_edge[0]=e:this.delaunay_edge[1]=e},eP.prototype.neighborAcross=function(t){return t===this.points_[0]?this.neighbors_[0]:t===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]},eP.prototype.oppositePoint=function(t,e){var n=t.pointCW(e);return this.pointCW(n)},eP.prototype.legalize=function(t,e){var n=this.points_;if(t===n[0])n[1]=n[0],n[0]=n[2],n[2]=e;else if(t===n[1])n[2]=n[1],n[1]=n[0],n[0]=e;else{if(t!==n[2])throw new Error("poly2tri Invalid Triangle.legalize() call");n[0]=n[2],n[2]=n[1],n[1]=e}},eP.prototype.index=function(t){var e=this.points_;if(t===e[0])return 0;if(t===e[1])return 1;if(t===e[2])return 2;throw new Error("poly2tri Invalid Triangle.index() call")},eP.prototype.edgeIndex=function(t,e){var n=this.points_;if(t===n[0]){if(e===n[1])return 2;if(e===n[2])return 1}else if(t===n[1]){if(e===n[2])return 0;if(e===n[0])return 2}else if(t===n[2]){if(e===n[0])return 1;if(e===n[1])return 0}return-1},eP.prototype.markConstrainedEdgeByIndex=function(t){this.constrained_edge[t]=!0},eP.prototype.markConstrainedEdgeByEdge=function(t){this.markConstrainedEdgeByPoints(t.p,t.q)},eP.prototype.markConstrainedEdgeByPoints=function(t,e){var n=this.points_;e===n[0]&&t===n[1]||e===n[1]&&t===n[0]?this.constrained_edge[2]=!0:e===n[0]&&t===n[2]||e===n[2]&&t===n[0]?this.constrained_edge[1]=!0:(e===n[1]&&t===n[2]||e===n[2]&&t===n[1])&&(this.constrained_edge[0]=!0)};var rP=eP;var oP=function(t,e){if(!t)throw new Error(e||"Assert Failed")},iP=function(t,e){this.head_=t,this.tail_=e,this.search_node_=t};iP.prototype.head=function(){return this.head_},iP.prototype.setHead=function(t){this.head_=t},iP.prototype.tail=function(){return this.tail_},iP.prototype.setTail=function(t){this.tail_=t},iP.prototype.search=function(){return this.search_node_},iP.prototype.setSearch=function(t){this.search_node_=t},iP.prototype.findSearchNode=function(){return this.search_node_},iP.prototype.locateNode=function(t){var e=this.search_node_;if(t<e.value){for(;e=e.prev;)if(t>=e.value)return this.search_node_=e,e}else for(;e=e.next;)if(t<e.value)return this.search_node_=e.prev,e.prev;return null},iP.prototype.locatePoint=function(t){var e=t.x,n=this.findSearchNode(e),r=n.point.x;if(e===r){if(t!==n.point)if(t===n.prev.point)n=n.prev;else{if(t!==n.next.point)throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call");n=n.next}}else if(e<r)for(;(n=n.prev)&&t!==n.point;);else for(;(n=n.next)&&t!==n.point;);return n&&(this.search_node_=n),n};var aP=iP,sP=function(t,e){this.point=t,this.triangle=e||null,this.next=null,this.prev=null,this.value=t.x};aP.Node=sP;var lP={CW:1,CCW:-1,COLLINEAR:0};var uP={EPSILON:1e-12,Orientation:lP,orient2d:function(t,e,n){var r=(t.x-n.x)*(e.y-n.y)-(t.y-n.y)*(e.x-n.x);return r>-1e-12&&r<1e-12?lP.COLLINEAR:r>0?lP.CCW:lP.CW},inScanArea:function(t,e,n,r){return!((t.x-e.x)*(r.y-e.y)-(r.x-e.x)*(t.y-e.y)>=-1e-12)&&!((t.x-n.x)*(r.y-n.y)-(r.x-n.x)*(t.y-n.y)<=1e-12)},isAngleObtuse:function(t,e,n){var r=e.x-t.x,o=e.y-t.y;return r*(n.x-t.x)+o*(n.y-t.y)<0}},cP=aP.Node,hP=uP.EPSILON,pP=uP.Orientation,dP=uP.orient2d,fP=uP.inScanArea,mP=uP.isAngleObtuse;function gP(t,e){var n=t.locateNode(e),r=function(t,e,n){var r=new rP(e,n.point,n.next.point);r.markNeighbor(n.triangle),t.addToMap(r);var o=new cP(e);o.next=n.next,o.prev=n,n.next.prev=o,n.next=o,SP(t,r)||t.mapTriangleToNodes(r);return o}(t,e,n);return e.x<=n.point.x+hP&&bP(t,n),function(t,e){var n=e.next;for(;n.next&&!mP(n.point,n.next.point,n.prev.point);)bP(t,n),n=n.next;n=e.prev;for(;n.prev&&!mP(n.point,n.next.point,n.prev.point);)bP(t,n),n=n.prev;e.next&&e.next.next&&function(t){var e=t.point.x-t.next.next.point.x,n=t.point.y-t.next.next.point.y;return oP(n>=0,"unordered y"),e>=0||Math.abs(e)<n}(e)&&function(t,e){dP(e.point,e.next.point,e.next.next.point)===pP.CCW?t.basin.left_node=e.next.next:t.basin.left_node=e.next;t.basin.bottom_node=t.basin.left_node;for(;t.basin.bottom_node.next&&t.basin.bottom_node.point.y>=t.basin.bottom_node.next.point.y;)t.basin.bottom_node=t.basin.bottom_node.next;if(t.basin.bottom_node===t.basin.left_node)return;t.basin.right_node=t.basin.bottom_node;for(;t.basin.right_node.next&&t.basin.right_node.point.y<t.basin.right_node.next.point.y;)t.basin.right_node=t.basin.right_node.next;if(t.basin.right_node===t.basin.bottom_node)return;t.basin.width=t.basin.right_node.point.x-t.basin.left_node.point.x,t.basin.left_highest=t.basin.left_node.point.y>t.basin.right_node.point.y,function t(e,n){if(function(t,e){var n;n=t.basin.left_highest?t.basin.left_node.point.y-e.point.y:t.basin.right_node.point.y-e.point.y;if(t.basin.width>n)return!0;return!1}(e,n))return;if(bP(e,n),n.prev===e.basin.left_node&&n.next===e.basin.right_node)return;if(n.prev===e.basin.left_node){if(dP(n.point,n.next.point,n.next.next.point)===pP.CW)return;n=n.next}else if(n.next===e.basin.right_node){if(dP(n.point,n.prev.point,n.prev.prev.point)===pP.CCW)return;n=n.prev}else n=n.prev.point.y<n.next.point.y?n.prev:n.next;t(e,n)}(t,t.basin.bottom_node)}(t,e)}(t,r),r}function vP(t,e,n){t.edge_event.constrained_edge=e,t.edge_event.right=e.p.x>e.q.x,wP(n.triangle,e.p,e.q)||(!function(t,e,n){t.edge_event.right?function(t,e,n){for(;n.next.point.x<e.p.x;)dP(e.q,n.next.point,e.p)===pP.CCW?xP(t,e,n):n=n.next}(t,e,n):function(t,e,n){for(;n.prev.point.x>e.p.x;)dP(e.q,n.prev.point,e.p)===pP.CW?TP(t,e,n):n=n.prev}(t,e,n)}(t,e,n),yP(t,e.p,e.q,n.triangle,e.q))}function yP(t,e,n,r,o){if(!wP(r,e,n)){var i=r.pointCCW(o),a=dP(n,i,e);if(a===pP.COLLINEAR)throw new KE("poly2tri EdgeEvent: Collinear not supported!",[n,i,e]);var s=r.pointCW(o),l=dP(n,s,e);if(l===pP.COLLINEAR)throw new KE("poly2tri EdgeEvent: Collinear not supported!",[n,s,e]);a===l?yP(t,e,n,r=a===pP.CW?r.neighborCCW(o):r.neighborCW(o),o):IP(t,e,n,r,o)}}function wP(t,e,n){var r=t.edgeIndex(e,n);if(-1!==r){t.markConstrainedEdgeByIndex(r);var o=t.getNeighbor(r);return o&&o.markConstrainedEdgeByPoints(e,n),!0}return!1}function bP(t,e){var n=new rP(e.prev.point,e.point,e.next.point);n.markNeighbor(e.prev.triangle),n.markNeighbor(e.triangle),t.addToMap(n),e.prev.next=e.next,e.next.prev=e.prev,SP(t,n)||t.mapTriangleToNodes(n)}function SP(t,e){for(var n=0;n<3;++n)if(!e.delaunay_edge[n]){var r=e.getNeighbor(n);if(r){var o=e.getPoint(n),i=r.oppositePoint(e,o),a=r.index(i);if(r.constrained_edge[a]||r.delaunay_edge[a]){e.constrained_edge[n]=r.constrained_edge[a];continue}if(EP(o,e.pointCCW(o),e.pointCW(o),i)){e.delaunay_edge[n]=!0,r.delaunay_edge[a]=!0,PP(e,o,r,i);var s=!SP(t,e);return s&&t.mapTriangleToNodes(e),(s=!SP(t,r))&&t.mapTriangleToNodes(r),e.delaunay_edge[n]=!1,r.delaunay_edge[a]=!1,!0}}}return!1}function EP(t,e,n,r){var o=t.x-r.x,i=t.y-r.y,a=e.x-r.x,s=e.y-r.y,l=o*s-a*i;if(l<=0)return!1;var u=n.x-r.x,c=n.y-r.y,h=u*i-o*c;return!(h<=0)&&(o*o+i*i)*(a*c-u*s)+(a*a+s*s)*h+(u*u+c*c)*l>0}function PP(t,e,n,r){var o,i,a,s,l,u,c,h,p,d,f,m;o=t.neighborCCW(e),i=t.neighborCW(e),a=n.neighborCCW(r),s=n.neighborCW(r),l=t.getConstrainedEdgeCCW(e),u=t.getConstrainedEdgeCW(e),c=n.getConstrainedEdgeCCW(r),h=n.getConstrainedEdgeCW(r),p=t.getDelaunayEdgeCCW(e),d=t.getDelaunayEdgeCW(e),f=n.getDelaunayEdgeCCW(r),m=n.getDelaunayEdgeCW(r),t.legalize(e,r),n.legalize(r,e),n.setDelaunayEdgeCCW(e,p),t.setDelaunayEdgeCW(e,d),t.setDelaunayEdgeCCW(r,f),n.setDelaunayEdgeCW(r,m),n.setConstrainedEdgeCCW(e,l),t.setConstrainedEdgeCW(e,u),t.setConstrainedEdgeCCW(r,c),n.setConstrainedEdgeCW(r,h),t.clearNeighbors(),n.clearNeighbors(),o&&n.markNeighbor(o),i&&t.markNeighbor(i),a&&t.markNeighbor(a),s&&n.markNeighbor(s),t.markNeighbor(n)}function xP(t,e,n){n.point.x<e.p.x&&(dP(n.point,n.next.point,n.next.next.point)===pP.CCW?_P(t,e,n):(!function t(e,n,r){dP(r.next.point,r.next.next.point,r.next.next.next.point)===pP.CCW?_P(e,n,r.next):dP(n.q,r.next.next.point,n.p)===pP.CCW&&t(e,n,r.next)}(t,e,n),xP(t,e,n)))}function _P(t,e,n){bP(t,n.next),n.next.point!==e.p&&dP(e.q,n.next.point,e.p)===pP.CCW&&dP(n.point,n.next.point,n.next.next.point)===pP.CCW&&_P(t,e,n)}function TP(t,e,n){n.point.x>e.p.x&&(dP(n.point,n.prev.point,n.prev.prev.point)===pP.CW?CP(t,e,n):(!function t(e,n,r){dP(r.prev.point,r.prev.prev.point,r.prev.prev.prev.point)===pP.CW?CP(e,n,r.prev):dP(n.q,r.prev.prev.point,n.p)===pP.CW&&t(e,n,r.prev)}(t,e,n),TP(t,e,n)))}function CP(t,e,n){bP(t,n.prev),n.prev.point!==e.p&&dP(e.q,n.prev.point,e.p)===pP.CW&&dP(n.point,n.prev.point,n.prev.prev.point)===pP.CW&&CP(t,e,n)}function IP(t,e,n,r,o){var i=r.neighborAcross(o);oP(i,"FLIP failed due to missing triangle!");var a=i.oppositePoint(r,o);if(r.getConstrainedEdgeAcross(o)){var s=r.index(o);throw new KE("poly2tri Intersecting Constraints",[o,a,r.getPoint((s+1)%3),r.getPoint((s+2)%3)])}fP(o,r.pointCCW(o),r.pointCW(o),a)?(PP(r,o,i,a),t.mapTriangleToNodes(r),t.mapTriangleToNodes(i),o===n&&a===e?n===t.edge_event.constrained_edge.q&&e===t.edge_event.constrained_edge.p&&(r.markConstrainedEdgeByPoints(e,n),i.markConstrainedEdgeByPoints(e,n),SP(t,r),SP(t,i)):IP(t,e,n,r=function(t,e,n,r,o,i){var a;if(e===pP.CCW)return a=r.edgeIndex(o,i),r.delaunay_edge[a]=!0,SP(t,r),r.clearDelaunayEdges(),n;return a=n.edgeIndex(o,i),n.delaunay_edge[a]=!0,SP(t,n),n.clearDelaunayEdges(),r}(t,dP(n,a,e),r,i,o,a),o)):(!function t(e,n,r,o,i,a){var s=i.neighborAcross(a);oP(s,"FLIP failed due to missing triangle");var l=s.oppositePoint(i,a);if(fP(r,o.pointCCW(r),o.pointCW(r),l))IP(e,r,l,s,l);else{var u=DP(n,r,s,l);t(e,n,r,o,s,u)}}(t,e,n,r,i,DP(e,n,i,a)),yP(t,e,n,r,o))}function DP(t,e,n,r){var o=dP(e,r,t);if(o===pP.CW)return n.pointCCW(r);if(o===pP.CCW)return n.pointCW(r);throw new KE("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[e,r,t])}var kP={triangulate:function(t){t.initTriangulation(),t.createAdvancingFront(),function(t){var e,n=t.pointCount();for(e=1;e<n;++e)for(var r=t.getPoint(e),o=gP(t,r),i=r._p2t_edge_list,a=0;i&&a<i.length;++a)vP(t,i[a],o)}(t),function(t){var e=t.front().head().next.triangle,n=t.front().head().next.point;for(;!e.getConstrainedEdgeCW(n);)e=e.neighborCCW(n);t.meshClean(e)}(t)}},MP=aP.Node,RP=function(t,e){if(this.p=t,this.q=e,t.y>e.y)this.q=t,this.p=e;else if(t.y===e.y)if(t.x>e.x)this.q=t,this.p=e;else if(t.x===e.x)throw new KE("poly2tri Invalid Edge constructor: repeated points!",[t]);this.q._p2t_edge_list||(this.q._p2t_edge_list=[]),this.q._p2t_edge_list.push(this)},AP=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};AP.prototype.clear=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};var HP=function(){this.constrained_edge=null,this.right=!1},OP=function(t,e){e=e||{},this.triangles_=[],this.map_=[],this.points_=e.cloneArrays?t.slice(0):t,this.edge_list=[],this.pmin_=this.pmax_=null,this.front_=null,this.head_=null,this.tail_=null,this.af_head_=null,this.af_middle_=null,this.af_tail_=null,this.basin=new AP,this.edge_event=new HP,this.initEdges(this.points_)};OP.prototype.addHole=function(t){this.initEdges(t);var e,n=t.length;for(e=0;e<n;e++)this.points_.push(t[e]);return this},OP.prototype.AddHole=OP.prototype.addHole,OP.prototype.addHoles=function(t){var e,n=t.length;for(e=0;e<n;e++)this.initEdges(t[e]);return this.points_=this.points_.concat.apply(this.points_,t),this},OP.prototype.addPoint=function(t){return this.points_.push(t),this},OP.prototype.AddPoint=OP.prototype.addPoint,OP.prototype.addPoints=function(t){return this.points_=this.points_.concat(t),this},OP.prototype.triangulate=function(){return kP.triangulate(this),this},OP.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}},OP.prototype.getTriangles=function(){return this.triangles_},OP.prototype.GetTriangles=OP.prototype.getTriangles,OP.prototype.front=function(){return this.front_},OP.prototype.pointCount=function(){return this.points_.length},OP.prototype.head=function(){return this.head_},OP.prototype.setHead=function(t){this.head_=t},OP.prototype.tail=function(){return this.tail_},OP.prototype.setTail=function(t){this.tail_=t},OP.prototype.getMap=function(){return this.map_},OP.prototype.initTriangulation=function(){var t,e=this.points_[0].x,n=this.points_[0].x,r=this.points_[0].y,o=this.points_[0].y,i=this.points_.length;for(t=1;t<i;t++){var a=this.points_[t];a.x>e&&(e=a.x),a.x<n&&(n=a.x),a.y>r&&(r=a.y),a.y<o&&(o=a.y)}this.pmin_=new tP(n,o),this.pmax_=new tP(e,r);var s=.3*(e-n),l=.3*(r-o);this.head_=new tP(e+s,o-l),this.tail_=new tP(n-s,o-l),this.points_.sort(tP.compare)},OP.prototype.initEdges=function(t){var e,n=t.length;for(e=0;e<n;++e)this.edge_list.push(new RP(t[e],t[(e+1)%n]))},OP.prototype.getPoint=function(t){return this.points_[t]},OP.prototype.addToMap=function(t){this.map_.push(t)},OP.prototype.locateNode=function(t){return this.front_.locateNode(t.x)},OP.prototype.createAdvancingFront=function(){var t,e,n,r=new rP(this.points_[0],this.tail_,this.head_);this.map_.push(r),t=new MP(r.getPoint(1),r),e=new MP(r.getPoint(0),r),n=new MP(r.getPoint(2)),this.front_=new aP(t,n),t.next=e,e.next=n,e.prev=t,n.prev=e},OP.prototype.removeNode=function(t){},OP.prototype.mapTriangleToNodes=function(t){for(var e=0;e<3;++e)if(!t.getNeighbor(e)){var n=this.front_.locatePoint(t.pointCW(t.getPoint(e)));n&&(n.triangle=t)}},OP.prototype.removeFromMap=function(t){var e,n=this.map_,r=n.length;for(e=0;e<r;e++)if(n[e]===t){n.splice(e,1);break}},OP.prototype.meshClean=function(t){for(var e,n,r=[t];e=r.pop();)if(!e.isInterior())for(e.setInterior(!0),this.triangles_.push(e),n=0;n<3;n++)e.constrained_edge[n]||r.push(e.getNeighbor(n))};var LP,BP=OP,FP=(LP=ZE)&&LP.default||LP,NP=r((function(t,n){var r=e.poly2tri;n.noConflict=function(){return e.poly2tri=r,n},n.VERSION=FP.version,n.PointError=KE,n.Point=tP,n.Triangle=rP,n.SweepContext=BP,n.triangulate=kP.triangulate,n.sweep={Triangulate:kP.triangulate}})),jP=(NP.noConflict,NP.VERSION,NP.PointError,NP.Point,NP.Triangle,NP.SweepContext),VP=(NP.triangulate,NP.sweep,function(){function t(e){Kf(this,t),em(this,"POINT_DIS_LIMIT",window.appConfig.POINT_DIS_LIMIT||.5),this.viewData=e}return tm(t,[{key:"createRoom",value:function(t,e){return e?this.createRoomByMarkPoint(t):this.createRoomByRoomFace(t)}},{key:"createRoomByRoomFace",value:function(t){var e=this,n=function(t,e,n){var r=e.Rotation.toRotationMatrix4("YXZ"),o=new THREE.Vector3(0,t.Rotation,0).toRotationMatrix4("YXZ");return n.applyMatrix4(r).add(e.Position).applyMatrix4(o).add(t.Position)},r=t.HotSpotIds.some((function(t){var n=e.viewData.HotSpots.find((function(e){return e.ID===t}));return!(!n||!0!==n.IsDecorating)})),o=t.RoomFaces.map((function(e,o){var i,a=e.Width/2,s=e.Height/2,l=n(t,e,new THREE.Vector3(-a,-s)),u=n(t,e,new THREE.Vector3(-a,s)),c=n(t,e,new THREE.Vector3(a,s)),h=n(t,e,new THREE.Vector3(a,-s)),p=new zS.MeshFace([l,c,u],[new THREE.Vector2(0,0),new THREE.Vector2(1,1),new THREE.Vector2(0,1)]),d=new zS.MeshFace([l,h,c],[new THREE.Vector2(0,0),new THREE.Vector2(1,0),new THREE.Vector2(1,1)]);if(r)i=new THREE.MeshBasicMaterial({color:16777215,opacity:.4,transparent:!0,depthWrite:!0,alphaTest:.01});else{var f=zS.ResourcesLoader.loadResource(e.ImagePath);f.minFilter=THREE.LinearFilter,i=new THREE.MeshBasicMaterial({map:f,transparent:!0,depthWrite:!0,alphaTest:.01})}var m=new zS.MeshSection([p,d],i);return m.ID="".concat(t.ID,"-").concat(o),m.Material.name="".concat(t.ID,"-").concat(o),m}));return new zS.MeshData(o)}},{key:"createRoomByMarkPoint",value:function(t){if(!t.IsDraw)return new zS.MeshData;for(var e,n=t.MarkPointList.filter((function(t){return GE.isNotWindow(t.Type)})),r=n.flatMap(function(e,r){var o=n[(r+1)%n.length];if(GE.isDoor(e.Type)&&GE.isDoor(o.Type)&&this.viewData.EntrancePointGroupID!==e.MarkPointGroupID)return[];if(GE.isStairsEntrance(e.Type)&&GE.isStairsEntrance(o.Type))return[];var i=t.localToWorld(e.Position),a=i.clone().addY(t.height),s=t.localToWorld(o.Position).addY(t.height),l=s.clone().addY(-t.height);return a.y=s.y=Math.min(a.y,s.y),[new zS.MeshFace([i,s,a]),new zS.MeshFace([i,l,s])]}.bind(this)),o=t.localToWorld(n[0].Position).y,i=n.filter((function(t){return!GE.isStairs(t.Type)&&!GE.isStairsEntrance(t.Type)})).map((function(e){return t.localToWorld(e.Position).toVector2()})),a=(i=zS.ClipperUtils.denoise([i])[0]).length,s=0;s<a&&i[s];s++)i[s].combinePointsTooClose(i[s+1]||i[0],this.POINT_DIS_LIMIT)&&i.splice(i[s+1]?s+1:0,1)&&s--;try{e=new jP(i).triangulate().getTriangles()}catch(t){var l=document.createEvent("HTMLEvents");l.data=t,l.initEvent("poly2triError",!1,!1),document.dispatchEvent(l)}i=e.flatMap((function(t){return t.getPoints().map((function(t){return new THREE.Vector3(t.x,o,t.y)}))}));for(var u=0;u<=i.length-3;u+=3)r.push(new zS.MeshFace([i[u+2],i[u+1],i[u]]));var c=n.filter((function(t){return GE.isStairs(t.Type)}));if(c.length%4==0)for(var h=0;h<=c.length-4;h+=4){var p=t.localToWorld(c[h].Position),d=t.localToWorld(c[h+1].Position),f=t.localToWorld(c[h+2].Position),m=t.localToWorld(c[h+3].Position);r.push(new zS.MeshFace([m,f,p])),r.push(new zS.MeshFace([f,d,p]))}for(var g=0;g<=i.length-3;g+=3)r.push(new zS.MeshFace([i[g],i[g+1],i[g+2]].map((function(e){return e.clone().addY(t.height)}))));var v=new zS.PanoramaMaterial,y=zS.ResourcesLoader.loadResource(t.PanoramaThumbImagePath);y.wrapS=THREE.RepeatWrapping,y.wrapT=THREE.RepeatWrapping,y.generateMipmaps=!1,y.magFilter=THREE.LinearFilter,y.minFilter=THREE.LinearFilter,y.format=THREE.RGBAFormat;var w=this.viewData.getHotSpotById(t.HotSpotIds[0]);return v.uniforms.panoramaMatrix.value=w.Rotation.toRotationMatrix4(aw.rotationOrder),v.uniforms.panoramaCenter.value=w.Position.clone(),v.uniforms.panoramaTexture.value=y,new zS.MeshData([new zS.MeshSection(r,v)])}}]),t}()),zP=function(){function t(){Kf(this,t),this.meshes=[],this.root=new THREE.Group("PanoramaRover")}return tm(t,[{key:"addMesh",value:function(t){var e=t.clone();e.material=new zS.PanoramaCubeMaterial,e.visible=!1,this.meshes.push(e),this.root.add(e)}},{key:"addToRoot",value:function(t){t.add(this.root)}},{key:"startSwitchPanorama",value:function(t,e){0!==this.meshes.length&&(this.root.setLayer(pw.PanoramaRoverLayer),this.root.setVisible(!0),this.meshes.forEach((function(n){var r=n.material.uniforms;r.onlyPanoramaCube1.value=0,r.panoramaMatrix1.value=t.Rotation.toRotationMatrix4(aw.rotationOrder),r.panoramaMatrix2.value=e.Rotation.toRotationMatrix4(aw.rotationOrder),r.panoramaCube1.value=t.cubeTexture,r.panoramaCube2.value=e.blurCubeTexture||e.cubeTexture,r.panoramaPos1.value=t.Position,r.panoramaPos2.value=e.Position,r.needsUpdate=!0})),this.updateMaterialOpacity(0,1))}},{key:"endSwitchPanorama",value:function(){this.root.setVisible(!1)}},{key:"updateMaterialOpacity",value:function(t,e){0!==this.meshes.length&&this.meshes.forEach((function(n){var r=n.material.uniforms;r.opacity.value=e,r.panorama2Opacity.value=t,r.needsUpdate=!0}))}}]),t}(),WP=function(){function t(){Kf(this,t),em(this,"ID",""),em(this,"HotSpots",[]),em(this,"FloorMeshDatas",[]),em(this,"ClassMapper",{FloorMeshDatas:GP}),this.houseMesh=null}return tm(t,[{key:"createHouseMesh",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0;return this.houseMesh=new THREE.Group,e<0?this.FloorMeshDatas.forEach((function(e){t.houseMesh.add(e.createFloorMesh(n,r,t.HotSpots,o))})):this.houseMesh.add(this.FloorMeshDatas[e].createFloorMesh(n,r,this.HotSpots,o)),this.houseMesh}},{key:"showInnerWallOuterMesh",value:function(t,e){this.houseMesh.children.forEach((function(n){if(n.material&&n instanceof Array){var r=n.material.find((function(e){return e.name===t}));r&&(r.visible=e)}else n.children.forEach((function(n){if(n.material&&n.material instanceof Array){var r=n.material.find((function(e){return e.name===t}));r&&(r.visible=e)}}))}))}}]),t}(),GP=function(){function t(){Kf(this,t),em(this,"Rooms",[]),em(this,"ClassMapper",{Rooms:UP}),this.floorMesh=null,this.start=0,this.count=0,this.MeshTypes=["Wall","InnerWallOuter","WallInner","WallOuter","WallSide","GroundInner","CeilingInner","BaywindowDesk","Skirting","Stonetheshold","Counter"],this.PanoramaMaterialTypes=["WallInner","GroundInner","Skirting","Counter","SuspendCeiling","CeilingInner"],this.WallInnerOuterMaterialTypes=["InnerWallOuter"]}return tm(t,[{key:"createFloorMesh",value:function(t,e,n){var r=this,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];o&&this.MeshTypes.splice(1,1);var i=new zS.MeshData,a=[];this.floorMesh=new THREE.Group,this.Rooms.forEach((function(s,l){var u,c=e.viewData.allRooms.find((function(t){return t.ID===s.ID}));if(c){var h=c.HotSpotIds[0],p=e.viewData.getHotSpotById(h),d=new zS.PanoramaMaterial;o?s.Sections.forEach((function(t){r.PanoramaMaterialTypes.includes(t.Type)?(t.materialIndex=2*l,t.keepmaterialIndex=!0):r.WallInnerOuterMaterialTypes.includes(t.Type)?(t.materialIndex=2*l+1,t.keepmaterialIndex=!0):t.materialIndex=null})):s.Sections.forEach((function(t){r.PanoramaMaterialTypes.includes(t.Type)?(t.materialIndex=0,t.keepmaterialIndex=!0):r.WallInnerOuterMaterialTypes.includes(t.Type)?(t.materialIndex=1,t.keepmaterialIndex=!0):t.materialIndex=null})),d.name=c.Name;var f=zS.ResourcesLoader.loadResource(p.ThumbnailPath.replace("ThumbnailImages","PanoramaThumbImages"),(function(t){}));f.wrapS=THREE.RepeatWrapping,f.wrapT=THREE.RepeatWrapping,f.generateMipmaps=!1,f.magFilter=THREE.LinearFilter,f.minFilter=THREE.LinearFilter,f.format=THREE.RGBAFormat,d.uniforms.panoramaMatrix.value=p.Rotation.toRotationMatrix4(aw.rotationOrder),t&&t[h]&&(t[h].position.setX(n.find((function(t){return t.ID==h})).Position.x),t[h].position.setZ(-n.find((function(t){return t.ID==h})).Position.y),t[h].position.setY(0)),d.uniforms.panoramaCenter.value=(null===(u=t&&t[h])||void 0===u?void 0:u.position.clone())||p.Position.clone(),d.uniforms.panoramaTexture.value=f,d.extensions={lights:!0},a.push(d);var m=new THREE.MeshPhongMaterial({color:"#c9c9c9",opacity:.4,transparent:!0,name:c.ID});if(a.push(m),o)i.merge(s);else{s.fromUnity();var g=s.createBufferMesh((function(t){return r.MeshTypes&&-1!==r.MeshTypes.indexOf(t.Type)}),[d,m]);g.fullname=c.Name+"-"+c.ID,g.name=c.Name,r.floorMesh.add(g)}}})),o&&(i.fromUnity(),this.floorMesh=i.createBufferMesh((function(t){return r.MeshTypes&&-1!==r.MeshTypes.indexOf(t.Type)}),a),this.floorMesh.geometry.name="floorMeshGeo"),this.computedGroup();var s=e.viewData.Rotation>Math.PI/2&&e.viewData.Rotation<3*Math.PI/2?-Math.PI:0;return this.floorMesh.rotateY(s),this.floorMesh}},{key:"computedGroup",value:function(){var t=this;this.Rooms.forEach((function(e){e.Sections.length&&(e.start=e.Sections[0].start,e.count=e.Sections.reduce((function(t,e){return t+e.count}),0)),t.count+=e.count})),this.Rooms.length&&(this.start=this.Rooms[0].start)}}]),t}(),UP=function(t){im(n,t);var e=cm(n);function n(){var t;return Kf(this,n),em(lm(t=e.call(this)),"ID",""),em(lm(t),"Position",null),em(lm(t),"RoomName",""),em(lm(t),"InnerPolygon",[]),t.start=0,t.count=0,t}return tm(n,[{key:"mergeSectionsByType",value:function(t){var e=linq(this.Sections).firstOrDefault((function(e){return e.Type===t}));if(e){for(var n=0;n<this.Sections.length;n++)this.Sections[n].Type===t&&(e.merge(this.Sections[n]),this.Sections.splice(n--,1));this.Sections.push(e)}}},{key:"setRoomMaterial",value:function(t,e,n,r){this.Sections.forEach((function(o){o.Type===n&&(o.setMaterial(t,e),o.getMaterial().then((function(t){t&&(r.material[o.materialIndex]=t)})))}))}}]),n}(zS.MeshData);function YP(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5e3;this.totalDuration=t,this.duration=1e3,this.interval=0,this.animationQue=[],this.timer=null,this.currentIndex=0,this.counter=0,this.signals={onFinish:new sE}}function XP(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.mesh,r=qP(t,e);this.meshParams=r,this.order=r.order,ZP(n,r),zS.Animation.call(this,r,r.duration)}function ZP(t,e){t.matrixAutoUpdate=!0,t.position.copy(e.startPosition),function(t){t.material instanceof Array?t.material.forEach((function(t){"fu"===t.name?t.visible=!1:(t.origOpacity=t.opacity,t.opacity=0,t.origTransparent=t.transparent,t.transparent=!0)})):"fu"===t.material.name?t.material.visible=!1:(t.material.origOpacity=t.material.opacity,t.material.opacity=0,t.material.transparent=!0)}(t),t.visible=!0}function qP(t,e){var n=t.mesh.rotation.clone(),r=t.mesh.position.clone();return nm({startPosition:new THREE.Vector3(r.x,r.y+1e3,r.z),endPosition:r,startRotation:new THREE.Euler(n.x,n.y-Math.PI/6,n.z,n.order),endRotation:n,startScale:1,endScale:1,startOpacity:.3,endOpacity:1,duration:800},t,e)}function JP(){}YP.prototype.add=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=function(){this.counter++,this.counter>=this.animationQue.length&&this.signals.onFinish.dispatch()},r={mesh:t,onFinish:n.bind(this)},o=om({duration:this.duration},e),i=new XP(r,o);this.animationQue.push(i),this.interval=(this.totalDuration-this.duration)/(this.animationQue.length-1)},YP.prototype.play=function(){var t=this;clearInterval(this.timer),this.counter=0,this.reorderAnimationQue(),this.timer=setInterval((function(){t.currentIndex<t.animationQue.length?(t.animationQue[t.currentIndex].play(),t.currentIndex++):clearInterval(t.timer)}),this.interval)},YP.prototype.reorderAnimationQue=function(){this.animationQue.sort((function(t,e){return e.order-t.order}))},YP.prototype.onFinish=function(){console.log("all animations finished!")},XP.prototype=new zS.Animation,XP.prototype.play=function(){var t;(t=this.meshParams.mesh).material instanceof Array?t.material.forEach((function(t){"fu"===t.name?t.visible=!0:(t.opacity=t.origOpacity,t.transparent=t.origTransparent)})):"fu"===t.material.name?t.material.visible=!0:(t.material.opacity=t.material.origOpacity,t.material.transparent=t.material.origTransparent),zS.Animation.prototype.play.call(this)},XP.prototype.onUpdate=function(t,e){var n=t.mesh;n.visible=!0;var r=t.startPosition,o=t.endPosition,i=zS.MathHelper.calcLightDamping(e,.9),a=(o.y-r.y)*i;n.position.setY(a+r.y);var s=t.startScale,l=t.endScale,u=Math.abs(l-s)*e+s;n.scale.set(u,u,u)},XP.prototype.onStart=function(t){},XP.prototype.onFinish=function(t,e){t.mesh.matrixAutoUpdate=!1,this.meshParams.onFinish&&this.meshParams.onFinish(t,e)},JP.Orders=["玄关","客厅","阳台","餐厅","走廊","主卧","主卫","厨房","次卧","书房","儿童房","客卫"].reverse(),JP.getOrder=function(t){return JP.Orders.findIndex((function(e){return t.includes(e)||e.includes(t)}))};var $P=function(t){im(i,t);var e,n,r,o=cm(i);function i(t,e,n){var r;return Kf(this,i),em(lm(r=o.call(this,"StereoFloor")),"signals",{hotSpotClicked:new sE,modelLoaded:new sE}),Object.bindFunctions(lm(r)),r.show3DWall=n,r.floorData=t,r.viewData=e,r.hotSpotGroups={},r.hotSpotSprites={},r.visibleHotSpots=[],r.animation=uw.animateStereoHotSpot?r.createAnimation():null,r.inAllFloors=!1,r.panoramaRover=new zP,r.floorObject=new THREE.Group,r.floorObject.name="StereoFloor-"+t.Name,r.object3D.add(r.floorObject),r.hotSpotsGroup=r.createHotSpotsGroup(),r.object3D.add(r.hotSpotsGroup),r.registEventListener(),r}return tm(i,[{key:"start",value:function(){this.panoramaRover.addToRoot(this.getApp().root)}},{key:"createHotSpotsGroup",value:function(){var t=this,e=this.floorData,n=this.viewData,r=new THREE.Group("FloorHotSpots_"+e.Name);if(r.name="FloorHotSpots_"+e.Name,this.hotSpotsGroup=r,n.hasObjModels)return r;var o=n.getHotSpotsByFloor(e);if(!(window.appConfig&&window.appConfig.hiddenHotSpotName)&&o.forEach((function(e,r){t.roomHeight=n.getRoomByHotSpotId(e.ID).height;var o=e.isAdditionalHotSpot||n.isAdditionalHotSpot(e.ID);o?window.appConfig.showAdditionalHotSpot&&t.createHotSpotGroup(e,o):t.createHotSpotGroup(e,o)})),this.viewData.existEntrance()){var i=this.viewData.getEntranceRoom();if(this.viewData.Floors.find((function(t){return t.Rooms.includes(i)}))===e){var a=new XE(this.viewData,i);a.init(),a.name="entranceHotSpotGroup",r.add(a)}}return r.position.y=-n.CameraHeight,r}},{key:"createHotSpotGroup",value:function(t,e){var n,r=this.viewData,o=r.getRoomByHotSpotId(t.ID).height,i=r.isTopFloor(this.floorData),a=r.getRoomByHotSpotId(t.ID);return(n=a.PushedRoom?new IE(t.Position.clone().setY(a.Position.y+25),t.Name,o,i,e):new IE(t.Position.clone().setY(a.Position.y),t.Name,o,i,e)).init(),n.name="StereoFloor_"+t.Name,n.hotSpotData=t,this.hotSpotsGroup.add(n),this.hotSpotGroups[t.ID]=n,this.hotSpotSprites[t.ID]=n.getRoomNameSprite(),n}},{key:"addRoomBeamAndNameSprite",value:function(t){var e=this,n=this.hotSpotGroups[t.ID];if(n){n.add(n.createBeamObject3D());var r=n.createRoomNameSprite();r&&(n.add(r),zS.EventListener.get(r).onHover=function(t,n){t.parent.hoverRoomNameSprite(n),e.onMouseHover(t,n)}),n.setLayer(pw.StereoHouseManager)}}},{key:"createFloor",value:(r=$f(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.floorData.hasObjModels){t.next=4;break}this.createFloorByObj(this.floorData),t.next=6;break;case 4:return t.next=6,this.createFloorByMesh(this.floorData,e);case 6:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})},{key:"createFloorByMesh",value:(n=$f(regeneratorRuntime.mark((function t(e){var n,r=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=r.length>1&&void 0!==r[1]?r[1]:0,window.appConfig.dropAnimation&&(this.dropAnimationTrack=new YP),this.modelLoader=this.modelLoader||new zS.ModelLoader(this.getApp().isDecoView),!this.show3DWall){t.next=8;break}return t.next=6,this.createFloorBy3DWallMesh(e,n);case 6:t.next=9;break;case 8:this.createFloorBy2DMesh(e);case 9:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"createFloorBy3DWallMesh",value:(e=$f(regeneratorRuntime.mark((function t(e,n){var r,o,i=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=HouseViewer.BaseAPI.app.viewData.Floors[0].Rooms.reduce((function(t,e){return t=t>Number(e.Position.y)?Number(e.Position.y):t}),0),t.next=4,this.modelLoader.loadHouseMeshData(this.getApp().isDecoView);case 4:this.houseMeshJson=t.sent,console.info(this.houseMeshJson),this.houseMeshData=Vw.fromJson(this.houseMeshJson,WP),o=!window.appConfig.dropAnimation,this.houseMeshData.createHouseMesh(n,this.hotSpotGroups,this.getApp(),o),this.meshData=this.houseMeshData.houseMesh,o?this.houseMeshData.houseMesh.children[0].position.y=r-this.viewData.CameraHeight:this.houseMeshData.houseMesh.children[0].children.forEach((function(t){return t.position.y=r-i.viewData.CameraHeight})),console.log(this.houseMeshData),window.appConfig.dropAnimation?(this.houseMeshData.houseMesh.children.forEach((function(t){t.children.slice().forEach((function(t){i.panoramaRover.addMesh(t);var e=zS.NameConverter.convertLangByUrl(t.name,""),n={order:JP.getOrder(e)};i.dropAnimationTrack.add(t,n)}))})),this.dropAnimationTrack.signals.onFinish.add((function(){i.viewData.allRooms.map((function(t){return t.ID})).forEach((function(t){i.houseMeshData.showInnerWallOuterMesh(t)}))}))):(this.panoramaRover.addMesh(this.houseMeshData.houseMesh.children[0]),this.shouldAddGroundThickness=!0),this.floorObject.add(this.houseMeshData.houseMesh),t.next=20;break;case 16:t.prev=16,t.t0=t.catch(0),console.info(t.t0),this.createFloorBy2DMesh(e);case 20:case"end":return t.stop()}}),t,this,[[0,16]])}))),function(t,n){return e.apply(this,arguments)})},{key:"createFloorBy2DMesh",value:function(t){var e=this,n=new zS.MeshData;if(t.Rooms.forEach((function(t){var r=new VP(e.viewData).createRoom(t,e.viewData.isVRHouse3);if(window.appConfig.dropAnimation){var o=r.createMesh();e.floorObject.add(o),e.panoramaRover.addMesh(o),e.dropAnimationTrack.add(o),o.visible=!1}else n.merge(r)})),!window.appConfig.dropAnimation){var r=n.createMesh();r.matrixAutoUpdate=!1,r.name="floorMesh-"+t.Name,this.floorObject.add(r),this.panoramaRover.addMesh(r)}}},{key:"createFloorByObj",value:function(t){var e=this;this.floorObject.name="floorObjGroup-"+t.Name;var n=t.objModels.filter((function(t){return 2===t.LOD||2===t.Lod}));window.appConfig.dropAnimation&&(this.dropAnimationTrack=new YP);var r,o=fm(n);try{for(o.s();!(r=o.n()).done;){var i=r.value;zS.ResourcesLoader.loadResource(i.Model,(function(t){t.setLayer(pw.StereoHouseManager),e.floorObject.add(t),t.updateMatrix(),t.matrixAutoUpdate=!1,t.children.forEach((function(t){t.scale.multiplyScalar(2),t.updateMatrix(),t.matrixAutoUpdate=!1,e.panoramaRover.addMesh(t)})),window.appConfig.dropAnimation&&(e.dropAnimationTrack.add(t),t.visible=!1)}))}}catch(t){o.e(t)}finally{o.f()}}},{key:"ignore3DClick",value:function(t){this.clickDisable=t}},{key:"onFloorClicked",value:function(t,e){if(!this.clickDisable){var n=e.point;n=new THREE.Vector3(n.x,0,n.z);var r=this.viewData.getHotSpotsByFloor(this.floorData),o=this.viewData.getNearestHotSpotByPosition(r,n);o&&(console.log("onFloorClicked !",o.Name),this.signals.hotSpotClicked.dispatch(o))}}},{key:"showHotSpots",value:function(t,e,n){if(this.hotSpotsGroup){if(!uw.animateStereoHotSpot)return void this.hotSpotsGroup.setVisible(t);for(var r,o,i=[],a=0;a<this.hotSpotsGroup.children.length;a++)this.hotSpotsGroup.children[a]instanceof IE&&!this.hotSpotsGroup.children[a].isActive?i.push(this.hotSpotsGroup.children[a]):this.hotSpotsGroup.children[a]instanceof XE?r=this.hotSpotsGroup.children[a]:this.hotSpotsGroup.children[a].isActive&&(o=this.hotSpotsGroup.children[a]);if(t){if(this.inAllFloors)return;var s=e.position.y,l=e.position.distanceTo(new THREE.Vector3(0,0,0));Math.asin(s/l)>Math.PI/4?(this.visibleHotSpots=this.hotSpotsGroup.children,this.hotSpotsGroup.setVisible(t)):(this.visibleHotSpots=this.getClosestHotSpotsByCamera(i,e),this.hotSpotsGroup.setVisible(t),this.hotSpotsGroup.children.forEach((function(t){return t.setVisible(!1)})));var u={visibleHotSpots:this.visibleHotSpots};r&&r.setVisible(!0),o&&o.parent.parent===n.object3D&&(o.setVisible(!0),o.children.forEach((function(t){"hotSpotNameSprite"===t.name||"beamBase"===t.name?t.material.opacity=1:(t.scale.set(1,1,1),t.updateMatrix())}))),this.animation.stop(),this.animation.play(u)}else for(var c=0;c<this.hotSpotsGroup.children.length;c++)this.hotSpotsGroup.children[c]instanceof IE&&!this.hotSpotsGroup.children[c].isActive?this.hotSpotsGroup.children[c].setVisible(t):(r=this.hotSpotsGroup.children[c].setVisible(!t),o=this.hotSpotsGroup.children[c].parent.parent===n.object3D?this.hotSpotsGroup.children[c].setVisible(!t):this.hotSpotsGroup.children[c].setVisible(!1))}}},{key:"createAnimation",value:function(){var t=new zS.Animation({},500);return t.onStart=function(t){t.visibleHotSpots.forEach((function(t){return t.setVisible(!0)}))},t.onUpdate=function(t,e){t.visibleHotSpots.forEach((function(t){t.children.forEach((function(t){"hotSpotNameSprite"===t.name||"beamBase"===t.name?t.material.opacity=e:0!==e&&(t.scale.set(e,e,e),t.updateMatrix())}))}))},t}},{key:"getClosestHotSpotsByCamera",value:function(t,e){var n=[];if(e){if(t.length<=2)return this.visibleHotSpots=hm(t),this.visibleHotSpots;t.forEach((function(t,r){var o=new THREE.Vector3(0,0,0),i=new THREE.Vector3(0,0,0);t.getWorldPosition(o),e.getWorldPosition(i),n.push({dist:o.distanceTo(i),index:r})})),n.sort((function(t,e){return t.dist<e.dist?-1:t.dist===e.dist?0:1})),this.visibleHotSpots=[];for(var r=n[0].dist,o=r+.2*(n[n.length-1].dist-r),i=0;i<5;i++)if(n[i].dist<=o)this.visibleHotSpots.push(t[n[i].index]);else if(i<2)this.visibleHotSpots.push(t[n[i].index]);else if(2===i)break;return this.visibleHotSpots}return t}},{key:"onMouseHover",value:function(t,e){iw.setCursorOnHover(this.renderer.domElement,e,mw.path.hand)}},{key:"registEventListener",value:function(){var t=this,e=function(e){zS.EventListener.get(t.hotSpotGroups[e]).onclick=t.onFloorClicked;var n=t.hotSpotGroups[e].getRoomNameSprite();n&&(zS.EventListener.get(n).onHover=function(n,r){t.hotSpotGroups[e].hoverRoomNameSprite(r),t.onMouseHover(n,r)})};for(var n in this.hotSpotGroups)e(n);zS.EventListener.get(this.floorObject).onclick=this.onFloorClicked}},{key:"enableFloorEvents",value:function(t){zS.EventListener.get(this.floorObject).enabled=t}},{key:"enableFloorMouseMoveEvents",value:function(t){zS.EventListener.get(this.object3D).enabled=t}},{key:"hideHotSpotsByIDs",value:function(t){var e=this;this.ignoredHotSpotGroups={},t&&t.forEach((function(t){e.hotSpotGroups[t]&&(e.ignoredHotSpotGroups[t]=e.hotSpotGroups[t],e.hotSpotGroups[t].visible=!1,e.hotSpotsGroup.remove(e.hotSpotGroups[t]),delete e.hotSpotGroups[t])}))}},{key:"cancelHideHotSpotsByIDs",value:function(){if(this.ignoredHotSpotGroups)for(var t in this.ignoredHotSpotGroups)this.ignoredHotSpotGroups[t].visible=!0,this.hotSpotGroups[t]=this.ignoredHotSpotGroups[t],this.hotSpotsGroup.add(this.hotSpotGroups[t]),delete this.ignoredHotSpotGroups[t]}}]),i}(zS.VRObject),KP=function(){function t(e,n){Kf(this,t),this.syncPaused=!0,this.apps=e,this.syncState={},this.logging=!!n,this.activeApp=null,this.handledTimes=null}return tm(t,[{key:"pause",value:function(){this.syncPaused=!0}},{key:"start",value:function(t){this.handledTimes=t||null,this.syncPaused=!1}},{key:"_sync",value:function(){if(!this.syncPaused){if("number"==typeof this.handledTimes){if(parseInt(this.handledTimes)-1<0)return this.handledTimes=null,void this.pause();this.handledTimes--}var t=this.activeApp,e=Array.isArray(this.apps)?this.apps.filter((function(e){return e!==t})):[];t&&e.length>0&&(this.log("start sync camera params..."),this.syncCamera(t,e))}}},{key:"_runSync",value:function(){var t=this;try{this._sync()}catch(t){this.log(t.stack)}requestAnimationFrame((function(){t._runSync()}))}},{key:"run",value:function(){this._runSync()}},{key:"log",value:function(t){if(this.logging){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];(e=console).log.apply(e,[t].concat(r))}}},{key:"setActiveApp",value:function(t){this.activeApp=t,this.log("active app setted! isDecoView?{0}.".format(t.isDecoView))}},{key:"broadAnother",value:function(t,e){for(var n=this,r=arguments.length,o=new Array(r>2?r-2:0),i=2;i<r;i++)o[i-2]=arguments[i];e.startsWith("bound ")&&(e=e.slice("bound ".length));var a=this.apps;a.filter((function(e){return e!==t})).forEach((function(t){if(t instanceof h_)try{var r=Date.now();if("hoverHotSpot"!==e&&n.syncState[e]&&r-n.syncState[e]<50)return n.log("broadAnother do function {0} ignore because of multiple calls in 50 ms.".format(e)),!0;n.syncState[e]=r,n.log("broadAnother do function {0} ok. ".format(e)),h_.prototype[e]?h_.prototype[e].apply(t,o):"function"==typeof t[e]&&t[e].apply(t,o)}catch(t){n.log("broadAnother do function {0} error: ".format(e),t.stack)}}))}},{key:"syncCamera",value:function(t,e){var n=t.panoramaManager&&t.panoramaManager.camera,r=t.stereoHouseManager&&t.stereoHouseManager.camera,o=t.floorPlanManager&&t.floorPlanManager.camera;e.forEach((function(e){var i=e.panoramaManager&&e.panoramaManager.camera;i&&(i.rotation.approxEquals(n.rotation,.001745)||e.panoramaManager.signals.onCameraUpdated.dispatch(i),i.rotation.copy(n.rotation),i.fov!==n.fov&&(i.fov=n.fov,i.updateProjectionMatrix())),(i=e.stereoHouseManager&&e.stereoHouseManager.camera)&&i.copy(r,!1),e.stereoHouseManager.orbitControls.autoRotate=t.stereoHouseManager.orbitControls.autoRotate,(i=e.floorPlanManager&&e.floorPlanManager.camera)&&i.copy(o,!1)}))}}]),t}(),QP=function(){function t(){Kf(this,t),em(this,"Rooms",[]),em(this,"ClassMapper",{Rooms:tx})}return tm(t,[{key:"getRoomByID",value:function(t){return this.Rooms.find((function(e){return e.ID===t}))}},{key:"getRoomByAnchor",value:function(t){return this.Rooms.find((function(e){return e.Anchors.indexOf(t)>=0}))}},{key:"init",value:function(){this.Rooms.length>0&&this.Rooms.forEach((function(t){var e=[],n=[];t.Anchors.forEach((function(r){-1===n.indexOf(r.ProductID)&&(n.push(r.ProductID),r.Product=t.getProductByAnchor(r),r.Position=new THREE.Vector3(r.Position.X,r.Position.Y,-r.Position.Z),e.push(r))})),t.Anchors=e}))}}]),t}(),tx=function(){function t(){Kf(this,t),em(this,"ID",""),em(this,"Name",""),em(this,"StyleRoomID",""),em(this,"Anchors",[]),em(this,"Products",[]),em(this,"ReplaceList",[]),em(this,"ClassMapper",{Anchors:nx,Products:ex})}return tm(t,[{key:"getProductByAnchor",value:function(t){return this.Products.find((function(e){return e.ID===t.ProductID}))}}]),t}(),ex=function t(){Kf(this,t),em(this,"ID",""),em(this,"Path",""),em(this,"SubPath",""),em(this,"StyleProductID",""),em(this,"StyleProductSpecId","")},nx=function t(){Kf(this,t),em(this,"ID",""),em(this,"ProductID",""),em(this,"Product",null),em(this,"IsShowAnchor",!1),em(this,"Position",new THREE.Vector3(0,0,0)),em(this,"Sprite",new THREE.Sprite)},rx=0,ox=10,ix=20,ax=30,sx=35,lx=40,ux=50,cx="//47.101.136.184:5005/",hx="//test.webapi.123kanfang.com:5000/",px="//test.webapi.123kanfang.com:5012/",dx="//test.webapi.123kanfang.com:5018/",fx=function(){function t(){Kf(this,t)}var e,n,r,o,i,a,s,l,u,c,h,p,d,f,m,g;return tm(t,null,[{key:"addOrResetTaskByLiveDeco",value:(g=$f(regeneratorRuntime.mark((function t(e,n,r){var o,i,a,s,l,u,c,h,p=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=p.length>3&&void 0!==p[3]?p[3]:"123kanfang",i=p.length>4&&void 0!==p[4]?p[4]:[],a=p.length>5&&void 0!==p[5]?p[5]:"vrhouse-test",s=p.length>6&&void 0!==p[6]?p[6]:"",l=dx+"LiveDecoTask/AddOrResetDecoTaskByLiveDeco",u=Am({styleNames:e,bucket:a,packageId:n,layout:s,dataType:o,modifiedHotspots:i}),c={method:"POST",mode:"cors",credentials:"same-origin",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Authorization:r},body:u},t.next=10,fetch(l,c);case 10:return t.next=12,t.sent.json();case 12:return h=t.sent,t.abrupt("return",h);case 14:case"end":return t.stop()}}),t)}))),function(t,e,n){return g.apply(this,arguments)})},{key:"getStyleListByUser",value:(m=$f(regeneratorRuntime.mark((function t(e){var n,r,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n="".concat(cx,"DecoDIY/GetStyleListByUser"),r={method:"GET",mode:"cors",credentials:"same-origin",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true","Content-Type":"application/json",Authorization:e}},t.next=4,fetch(n,r);case 4:return t.next=6,t.sent.json();case 6:return o=t.sent,t.abrupt("return",o);case 8:case"end":return t.stop()}}),t)}))),function(t){return m.apply(this,arguments)})},{key:"getStyleListByPackageId",value:(f=$f(regeneratorRuntime.mark((function t(e,n){var r,o,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r="".concat(cx,"DecoDIY/GetStyleListByPackageId?packageId=").concat(e),o={method:"GET",mode:"cors",credentials:"same-origin",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true","Content-Type":"application/json",Authorization:n}},t.next=4,fetch(r,o);case 4:return t.next=6,t.sent.json();case 6:return i=t.sent,t.abrupt("return",i);case 8:case"end":return t.stop()}}),t)}))),function(t,e){return f.apply(this,arguments)})},{key:"getStyleListByPackageId2",value:(d=$f(regeneratorRuntime.mark((function t(e){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n="//vrhouse-test.oss-cn-shanghai.aliyuncs.com/".concat(e,"/RelatedDecorationLinks.json"),t.next=3,fetch(n);case 3:return t.next=5,t.sent.json();case 5:return r=t.sent,t.abrupt("return",r);case 7:case"end":return t.stop()}}),t)}))),function(t){return d.apply(this,arguments)})},{key:"getRenderTaskState",value:(p=$f(regeneratorRuntime.mark((function t(e,n,r){var o,i,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o="".concat(hx,"v2/decoration/GetDecoTaskStatus?houseId=").concat(e,'&style="').concat(n),i={method:"GET",mode:"cors",credentials:"same-origin",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true","Content-Type":"application/json",Authorization:r}},t.next=4,fetch(o,i);case 4:return t.next=6,t.sent.json();case 6:return a=t.sent,t.abrupt("return",a);case 8:case"end":return t.stop()}}),t)}))),function(t,e,n){return p.apply(this,arguments)})},{key:"getHotSpotByState",value:(h=$f(regeneratorRuntime.mark((function t(e,n,r){var o,i,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o="".concat(px,"decotask/GetStateByPakcageId?packageId=").concat(n,"&styleName=").concat(e),i={method:"GET",mode:"cors",credentials:"same-origin",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Authorization:r}},t.next=4,fetch(o,i);case 4:return t.next=6,t.sent.json();case 6:return a=t.sent,t.abrupt("return",a);case 8:case"end":return t.stop()}}),t)}))),function(t,e,n){return h.apply(this,arguments)})},{key:"getAlternativeMaterials",value:(c=$f(regeneratorRuntime.mark((function t(e,n){var r,o,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=cx+"DecoDIY/GetAlternativeMaterials?path="+e+"&specId="+n,o={method:"GET",mode:"cors",credentials:"same-origin",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true","Content-Type":"application/json"}},t.next=4,fetch(r,o);case 4:return t.next=6,t.sent.json();case 6:if(403!==(i=t.sent).state){t.next=9;break}throw"获取材质列表没有数据:"+i.payload+"--"+e+"--"+n;case 9:if(200===i.state&&i){t.next=11;break}throw"获取材质列表状态错误"+i.payload;case 11:return t.abrupt("return",i.payload.filter((function(t){return t})));case 12:case"end":return t.stop()}}),t)}))),function(t,e){return c.apply(this,arguments)})},{key:"getCategoryProducts",value:(u=$f(regeneratorRuntime.mark((function t(e,n){var r,o,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=cx+"DecoDIY/GetAlternativeProducts?path="+e+"&specId="+n,o={method:"GET",mode:"cors",credentials:"same-origin",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true","Content-Type":"application/json"}},t.next=4,fetch(r,o);case 4:return t.next=6,t.sent.json();case 6:if(403!==(i=t.sent).state){t.next=9;break}throw"获取家具列表没有数据:"+i.payload+"--"+e+"--"+n;case 9:if(200===i.state){t.next=11;break}throw"获取家具列表状态错误:"+i.payload+"--"+e+"--"+n;case 11:return t.abrupt("return",i.payload.filter((function(t){return t})));case 12:case"end":return t.stop()}}),t)}))),function(t,e){return u.apply(this,arguments)})},{key:"getHouseMeshData",value:(l=$f(regeneratorRuntime.mark((function t(e){var n,r,o,i,a,s,l=this,u=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=u.length>1&&void 0!==u[1]?u[1]:["WallInner","GroundInner","CeilingInner","SuspendCeiling"],t.next=3,fetch(e);case 3:return r=t.sent,t.next=6,r.text();case 6:return o=t.sent,t.next=9,OS.decompressToString(o,"YQjyHSk2nky72BO2CW29OwRYQ8tKXFGw");case 9:return i=t.sent,a=[],JSON.parse(i).FloorMeshDatas.forEach((function(t){t.Rooms.forEach((function(t){t.Sections=t.Sections.filter((function(t){return n.includes(t.Type)})),a.push(t)}))})),s=[],a.forEach((function(t){var e=null,n=null,r=null;t.Sections.forEach((function(t){var o=0,i=0,a=0;t.MeshFaces[0].Vertices.forEach((function(t,e,n){o+=t.X,i+=t.Y,a+=t.Z}));var s={x:o/t.MeshFaces[0].Vertices.length,y:i/t.MeshFaces[0].Vertices.length,z:a/t.MeshFaces[0].Vertices.length};"WallInner"!==t.Type||e?"CeilingInner"!==t.Type&&"SuspendCeiling"!==t.Type||n?"GroundInner"!==t.Type||r||(r={ID:l.markId(),IsMaterial:!0,IsShowAnchor:!1,Position:s,ProductID:t.ID,Product:t,Sprint:new THREE.Sprite}):n={ID:l.markId(),IsMaterial:!0,IsShowAnchor:!1,Position:s,ProductID:t.ID,Product:t,Sprint:new THREE.Sprite}:e={ID:l.markId(),IsMaterial:!0,IsShowAnchor:!1,Position:s,ProductID:t.ID,Product:t,Sprint:new THREE.Sprite}}));var o=[];e&&o.push(e),n&&o.push(n),r&&o.push(r),s.push({ID:t.ID,Name:t.RoomName,Anchors:o})})),t.abrupt("return",s);case 15:case"end":return t.stop()}}),t)}))),function(t){return l.apply(this,arguments)})},{key:"markId",value:function(){return"material-"+Math.random().toString(16).substring(2)}},{key:"getHouseAnchorData",value:(s=$f(regeneratorRuntime.mark((function t(e,n){var r,o,i,a,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e);case 2:if(404!==(r=t.sent).status){t.next=6;break}return o=new QP,t.abrupt("return",o);case 6:return t.next=8,r.text();case 8:return i=t.sent,a=OS.decompressToString(i,"423EF1A0C3814442BA2FAA522BC6C252"),(s=Vw.fromJson(a,QP)).init(),s.Rooms.length>0&&s.Rooms.forEach((function(t){t.Anchors=t.Anchors.filter((function(t){var e=!0;return n.forEach((function(n){e=e&&-1===t.ProductID.indexOf(n)})),e}))})),t.abrupt("return",s);case 14:case"end":return t.stop()}}),t)}))),function(t,e){return s.apply(this,arguments)})},{key:"getProductDetails",value:(a=$f(regeneratorRuntime.mark((function t(e){var n,r,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=cx+"GoodsInfo/GetByProductPath?productPath="+e,r={method:"GET",mode:"cors",credentials:"same-origin",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true","Content-Type":"application/json"}},t.next=4,fetch(n,r);case 4:return t.next=6,t.sent.json();case 6:return o=t.sent,t.abrupt("return",o);case 8:case"end":return t.stop()}}),t)}))),function(t){return a.apply(this,arguments)})},{key:"submitReplaceListAndGeneNewStyle",value:(i=$f(regeneratorRuntime.mark((function t(e,n){var r,o,i,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=cx+"DecoDIY/NewStyleDataBy2D",o=Am(e),i={method:"POST",mode:"cors",credentials:"same-origin",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Authorization:n},body:o},t.next=5,fetch(r,i);case 5:return t.next=7,t.sent.json();case 7:if((a=t.sent)&&200===a.state){t.next=10;break}throw"生成风格文件错误"+a.payload;case 10:return t.abrupt("return",a.payload);case 11:case"end":return t.stop()}}),t)}))),function(t,e){return i.apply(this,arguments)})},{key:"addANewRenderTask",value:(o=$f(regeneratorRuntime.mark((function t(e,n,r,o){var i,a,s,l,u,c,h=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=h.length>4&&void 0!==h[4]?h[4]:"2DDIYForSingleHouse",a=h.length>5&&void 0!==h[5]?h[5]:19,s="".concat(px,"DecoTask/ResetDecotaskByDIY"),l=Am({packageId:n,styleName:r,dataType:i,priority:a,modifiedHotspots:o}),u={method:"POSt",mode:"cors",credentials:"same-origin",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Authorization:e},body:l},t.next=7,fetch(s,u);case 7:return t.next=9,t.sent.json();case 9:if((c=t.sent)&&200===c.state){t.next=12;break}throw"添加渲染任务失败"+c.payload;case 12:return t.abrupt("return",c.payload);case 13:case"end":return t.stop()}}),t)}))),function(t,e,n,r){return o.apply(this,arguments)})},{key:"submitReplaceListToRenderNewHouse",value:function(t,e,n){var r=this,o={};o.styleId=t.style.id,o.parentStyleId=t.style.id,o.styleName=t.style.name,o.productReplaceModels=[],o.materialReplaceModels=[];var i=[];t.replaceList&&t.replaceList.forEach((function(t){t.hotSpotsArr.forEach((function(e){i.push(e.hotSpotId),e.anchorsArr.forEach((function(e){if(e.isMaterial){var n=e.origin.MaterialSubPath.indexOf("_"),r=e.origin.MaterialSubPath.indexOf("_",n+1),i=e.origin.MaterialSubPath.slice(n+1,r);if("客餐厅"===t.styleRoomID){var a={};a.oldMaterialId="客厅_"+i,a.newMaterialId=e.replace.id,o.materialReplaceModels.push(a);var s={};return s.oldMaterialId="餐厅_"+i,s.newMaterialId=e.replace.id,void o.materialReplaceModels.push(s)}var l={};l.oldMaterialId=[t.styleRoomID?t.styleRoomID:t.roomName]+"_"+i,l.newMaterialId=e.replace.id,o.materialReplaceModels.push(l)}else{if("客餐厅"===t.styleRoomID){var u={};return void(e.origin.ID.startsWith("客厅")?(u.oldProductId="客厅_"+e.origin.StyleProductID,u.newSpecGroupId=e.replace.id,o.productReplaceModels.push(u)):(u.oldProductId="餐厅_"+e.origin.StyleProductID,u.newSpecGroupId=e.replace.id,o.productReplaceModels.push(u)))}var c={};c.oldProductId=[t.styleRoomID?t.styleRoomID:t.roomName]+"_"+e.origin.StyleProductID,c.newSpecGroupId=e.replace.id,o.productReplaceModels.push(c)}}))}))}));var a={packageId:t.houseId,bucket:"vrhouse-test",styleDataRequest:o};HouseViewer.DecoAPI.app.viewData;this.submitReplaceListAndGeneNewStyle(a,t.token).then((function(o){return r.addANewRenderTask(t.token,t.houseId,o.name,i).then((function(i){setTimeout((function(){return r.startCheckRenderState(t.houseId,o.name,t.token,e,n),"success"}),1e4)}))})).catch((function(t){console.info(t),n.onError()}))}},{key:"startCheckRenderState",value:(r=$f(regeneratorRuntime.mark((function t(e,n,r,o,i){var a,s,l,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=this,t.next=3,a.getRenderTaskState(e,n,r);case 3:if((s=t.sent)&&200===s.state){t.next=6;break}throw"渲染任务进行中或出现异常"+s.payload;case 6:(l=s.payload)==rx?u=setTimeout((function(){a.startCheckRenderState(e,n,r,o,i),clearTimeout(u)}),1e4):l==ox?a.diyPollGetHotSpot(e,n,r,o,i):l==ax||l==lx||l==sx||l==ux?i.onSuccess(n):l==ix&&i.onError&&i.onError(n);case 8:case"end":return t.stop()}}),t,this)}))),function(t,e,n,o,i){return r.apply(this,arguments)})},{key:"diyPollGetHotSpot",value:(n=$f(regeneratorRuntime.mark((function t(e,n,r,o,i){var a,s,l,u,c,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=HouseViewer.DecoAPI.app.viewData,s=this,clearTimeout(this.hotSpotStateTimer),l=HouseViewer.DecoAPI.app.currentHotSpot.ID,t.next=6,this.getHotSpotByState(e,n,r);case 6:u=t.sent,c=u.payload.state,h=u.payload.hotSpots,c>=30?(i.onSuccess(h[0]),o.renderState="success",a.HotSpots.forEach((function(t){var e;t.IsDecorating&&(HouseViewer.DecoAPI.deleteLoadCicle(t.ID),l===t.ID&&(HouseViewer.VRCore.ResourcesLoader.noCache=!0,HouseViewer.DecoAPI.loadDecoratedImage(t.ID)),a.Floors.forEach((function(n){e||(e=n.Rooms.find((function(e){return e.HotSpotIds.includes(t.ID)})))})),(e&&1===e.HotSpotIds.length||e&&e.HotSpotIds.every((function(t){var e=a.HotSpots.find((function(e){return e.ID===t}));return!(!e||0!=e.IsDecorating)})))&&HouseViewer.DecoAPI.updateRoomMode(e.ID),t.IsDecorating=!1)}))):20==c?i.onError():10==c&&h.length>0&&(o.renderState="decorating",HouseViewer.DecoAPI.addAllLoadCircleOnGround(),i.onSuccess(h[0]),o.renderState="haveSpotSuccess",h.forEach((function(t){var e,n=a.HotSpots.find((function(e){return e.ID==t.id}));n&&n.IsDecorating&&(HouseViewer.DecoAPI.deleteLoadCicle(t.id),l===t.id&&(HouseViewer.VRCore.ResourcesLoader.noCache=!0,HouseViewer.DecoAPI.loadDecoratedImage(t.id)),a.Floors.forEach((function(n){e||(e=n.Rooms.find((function(e){return e.HotSpotIds.includes(t.id)})))})),(e&&1===e.HotSpotIds.length||e&&e.HotSpotIds.every((function(t){var e=a.HotSpots.find((function(e){return e.ID===t}));return!(!e||0!=e.IsDecorating)})))&&HouseViewer.DecoAPI.updateRoomMode(e.ID),n.IsDecorating=!1)}))),10===c&&(this.hotSpotStateTimer=setTimeout((function(){s.diyPollGetHotSpot(e,n,r,o,i)}),1e4));case 11:case"end":return t.stop()}}),t,this)}))),function(t,e,r,o,i){return n.apply(this,arguments)})},{key:"getViewData",value:(e=$f(regeneratorRuntime.mark((function t(e,n,r,o,i){var a,s,l,u,c,h,p;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=this,t.next=3,this.getHotSpotByState(e,n,r);case 3:if(s=t.sent,l=s.payload.hotSpots,20!==(u=s.payload.state)){t.next=8;break}return t.abrupt("return");case 8:return c="//vrhouse-test.oss-cn-shanghai.aliyuncs.com/".concat(e,"_deco_").concat(n,"/ViewData.txt"),h="//vrhouse-test.oss-cn-shanghai.aliyuncs.com/".concat(e,"_deco_").concat(n,"/"),t.next=12,fetch(c);case 12:return t.next=14,t.sent.json();case 14:return p=t.sent,u>=30?p&&p.HotSpots.forEach((function(t){l.find((function(e){return e.id===t.ID}))&&(t.IsDecorating=!1)})):10===u&&p&&p.HotSpots.forEach((function(t){var e=l.find((function(e){return e.id===t.ID}));e&&1===e.state?t.IsDecorating=!1:t.IsDecorating=!0})),t.next=18,HouseViewer.DecoAPI.initDecoView(p,h,i);case 18:10===u&&setTimeout((function(){a.pollGetHotSpot(e,n,r,o,HouseViewer.DecoAPI.app.viewData)}),1e4);case 19:case"end":return t.stop()}}),t,this)}))),function(t,n,r,o,i){return e.apply(this,arguments)})}]),t}();em(fx,"hotSpotStateTimer",null),em(fx,"styleListTimer",null);var mx=function(){function t(){Kf(this,t)}var e,n,r,o;return tm(t,null,[{key:"initDecoView",value:(o=$f(regeneratorRuntime.mark((function t(e,n,r,o){var i,a,s,l,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(a in(i=om(om({},this.viewerInitConfig||g_.viewerInitConfig),{},{isDecoView:!0})).editorData.HotSpots)i.editorData.HotSpots[a].Anchors=[];if(e){if(i.viewData=e,i.editorData.VideoData=e.VideoData,i.editorData.HotSpots||(i.editorData.HotSpots={}),Object.keys(i.editorData.HotSpots).length>0)for(s=0,l=Object.keys(i.editorData.HotSpots);s<l.length;s++)u=l[s],i.editorData.HotSpots[u].VideoData=[];e.HotSpotList&&e.HotSpotList.length>0&&e.HotSpotList.forEach((function(t){i.editorData.HotSpots[t.HotSpotID]?i.editorData.HotSpots[t.HotSpotID].VideoData=t.TVDataList:i.editorData.HotSpots[t.HotSpotID]={VideoData:t.TVDataList}}))}if(n&&(i.housePathPrefix=n),!this.viewerInitConfig){t.next=10;break}return this.viewerInitConfig=i,t.next=8,this.initViewData(e,r,o);case 8:t.next=12;break;case 10:return t.next=12,this.initCompareView(i,r,o);case 12:case"end":return t.stop()}}),t,this)}))),function(t,e,n,r){return o.apply(this,arguments)})},{key:"distroyDecoView",value:function(){}},{key:"initCompareView",value:(r=$f(regeneratorRuntime.mark((function t(e,n,r){var o,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.filterHotSpotByNames();case 2:o=t.sent,(i=new h_(e,n)).ignoreHotSpotIDs=o,g_.app.ignoreHotSpotIDs=o;try{i.run(),this.app=i,this.viewerInitConfig=e,this.inited=!0,this.synzer=new KP([i,g_.app],!1),this.synzer.run(),this.setFullView(-1)}catch(t){r&&r(t)}case 7:case"end":return t.stop()}}),t,this)}))),function(t,e,n){return r.apply(this,arguments)})},{key:"filterHotSpotByNames",value:(n=$f(regeneratorRuntime.mark((function t(){var e,n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=window.appConfig.filteredHotSpotNamesInDeco,n=[],e&&e.forEach((function(t){g_.app.viewData.HotSpots.forEach((function(e){e.Name.indexOf(t)>-1&&n.push(e.ID)}))})),window.appConfig.ignoreHotSpotIDs=n,n){t.next=6;break}return t.abrupt("return");case 6:if(!n||!n.find((function(t){return g_.app.currentHotSpot.ID===t}))){t.next=10;break}return r=g_.app.viewData.HotSpots.find((function(t){return!n.find((function(e){return t.ID===e}))})),t.next=10,new Promise((function(t){g_.app.onThumbnailClick(r.ID,null,!1,(function(){t()}))}));case 10:return t.abrupt("return",n);case 11:case"end":return t.stop()}}),t)}))),function(){return n.apply(this,arguments)})},{key:"deleteLoadCicle",value:function(t){this.app.panoramaManager.hotSpotManager.deleteLoadCircleOnGround(t)}},{key:"deleteAllLoadCicle",value:function(){this.app.panoramaManager.hotSpotManager.deleteAllLoadCircleOnGround()}},{key:"addAllLoadCircleOnGround",value:function(){this.app.panoramaManager.hotSpotManager.addAllLoadCircleOnGround()}},{key:"updateRoomMode",value:function(t){this.app.stereoHouseManager.updateRoomMode(t)}},{key:"initViewData",value:function(t,e,n,r){var o=this;if(!o.app)throw new Error("DecoAPI.initViewData error! must init compare view first!");o.app.viewDataOrigin=r,o.app.suspend(),o.app.dispose();var i=o.viewerInitConfig;i.viewData=t,o.app.initData(i,(function(t){o.app.resume(),e&&e(t)}))}},{key:"loadDecoratedImage",value:function(t){this.app.loadDecoratedImage(t)}},{key:"setActiveApp",value:function(t){this.synzer&&this.synzer.setActiveApp(t)}},{key:"broadAnother",value:function(t,e,n){this.synzer&&this.synzer.broadAnother(t,e,n)}},{key:"pauseSynzer",value:function(){this.synzer&&this.synzer.pause()}},{key:"startSynzer",value:function(t){this.synzer&&this.synzer.start(t)}},{key:"setFullView",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,e=this.viewerInitConfig,n=e?e.mainContainer:null;if(n&&!(n.children.length<0)){var r=n.children.forEach?n.children:Array.from(n.children);if(r.forEach((function(t){t.classList.remove("stretch"),g_.app.ignoreHotSpotNamesEnable=!1})),this.app.inFullView=-1!==t,t<0)n.classList.add("compare");else{n.classList.remove("compare");var o=n.children[t];o.classList.add("stretch"),g_.app.ignoreHotSpotNamesEnable=!0}}}},{key:"toggleRuler",value:function(t){this.app.rulerManager.enable(t)}},{key:"toggleVR",value:function(t){this.app.toggleVR(t)}},{key:"drawFurnitureAnchorData",value:function(t){var e;null===(e=this.app)||void 0===e||e.panoramaFurniture.createFurnitureAnchor(t)}},{key:"removeFurnitureAnchorData",value:function(){var t;null===(t=this.app)||void 0===t||t.panoramaFurniture.removeFurnitureAnchor()}},{key:"getCurrentRoomId",value:function(){return this.app.viewData.getRoomByHotSpotId(this.app.getCurrentHotSpotId()).ID}},{key:"storeProductAnchorData",value:function(t,e){this.app.anchorManager&&this.app.anchorManager.parseProductAnchor(t,e)}},{key:"getProductDetails",value:(e=$f(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fx.getProductDetails(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)}))),function(t){return e.apply(this,arguments)})}]),t}(),gx=function(t){im(n,t);var e=cm(n);function n(t){var r;if(Kf(this,n),em(lm(r=e.call(this)),"signals",{floorChanged:new sE,allModelsLoaded:new sE,hotSpotClicked:new sE,minDistanceReached:new sE,onCameraUpdated:new sE,hideHotSpots:new sE,showHotSpots:new sE}),em(lm(r),"ORTHOGRAPHIC_TO_PERSPECTIVE_SCALE",170),Object.bindFunctions(lm(r)),r.viewData=t,r.largeViewBackground=new THREE.Color(aw.largeViewBgColor),r.camera=r.createCamera(t.HouseSize),r.initialCameraRotation=r.camera.rotation.clone(),r.isSmallView=!1,r.isSmallViewAutoRotate=!1,r.largeViewAutoRotateTimeout=null,r.hotSpotAutoRotateShowTimeout=null,r.lagPressedTimeout=null,r.hotSpotShowInterval=null,r.isShrinkAnimationPlayed=!1,r.maxHouseSize=t.HouseSize.maxWeight(),r.currentStereoFloor=null,r.activeFloorID=null,r.stereoFloors=[],r.currentActiveHotSpotGroup=null,r.stereoModelJustClicked=!1,r.videoObj={},r.cameraFlyAnimation=new SE,r.object3D.add(r.camera),r.show3DWall=window.appConfig.show3DWall,t.Floors[0].hasObjModels||r.show3DWall){var o=new THREE.DirectionalLight(16777215,.1);o.castShadow=!0,o.position.set(5e3,5e3,0),o.castShadow=!0,r.object3D.add(o),r.light=o}if(r.show3DWall){var i=new THREE.AmbientLight(4210752,4);r.ambientLight=i,r.object3D.add(i)}return r.initHouse(t),window.appConfig.smallViewBackGroundParams&&(r.smallViewBackGroundSprite=r.createSmallViewBackGround(window.appConfig.smallViewBackGroundParams),r.object3D.add(r.smallViewBackGroundSprite)),r.setLayer(pw.StereoHouseManager),r}return tm(n,[{key:"loadDecoVideo",value:function(){var t=this,e=this.viewData.editorData;e&&e.VideoData&&0!==e.VideoData.length&&e.VideoData.forEach((function(e){var n=e.id,r=e.Position,o=e.Rotation,i=e.Size;t.addDecoVideo(r,o,i,n)}))}},{key:"addDecoVideo",value:function(t,e,n,r){var o="http://video.699pic.com/videos/15/50/59/b_QbMrNQTi1nBH1600155059_10s.mp4",i=this.videoObj[o];if(i){var a=new THREE.VideoTexture(i);a.wrapS=a.wrapT=THREE.ClampToEdgeWrapping,a.minFilter=THREE.LinearFilter;var s=new THREE.MeshBasicMaterial({map:a}),l=new THREE.PlaneGeometry(n.x,n.y),u=new THREE.Mesh(l,s);u.position.x=t.x,u.position.y=t.y,u.position.z=t.z,u.eventOrder=100,u.renderOrder=0,u.rotation.x=e.x,u.rotation.y=e.y,u.rotation.z=e.z,u.name=r,this.object3D.add(u),i.play(),console.log(u)}else{console.log(t,e,n);var c=document.createElement("video");c.crossOrigin="anonymous";var h=new THREE.VideoTexture(c);h.wrapS=h.wrapT=THREE.ClampToEdgeWrapping,h.minFilter=THREE.LinearFilter;var p=new THREE.MeshBasicMaterial({map:h}),d=new THREE.PlaneGeometry(n.x,n.y),f=new THREE.Mesh(d,p);f.position.x=t.x,f.position.y=t.y,f.position.z=t.z,f.eventOrder=100,f.renderOrder=0,f.rotation.x=e.x,f.rotation.y=e.y,f.rotation.z=e.z,f.name=r,this.object3D.add(f),c.src=o,c.preload="auto",c.muted="true",c.autoplay="autoplay",c.loop="true",c.oncanplay=function(t){c.oncanplay=null,c.play()},this.videoObj[o]=c}}},{key:"start",value:function(){this.orbitControls=this.addOrbitControlsToCamera(this.camera,this.viewData.HouseSize),this.registEventListener(),this.setLargeViewCameraBestPosition()}},{key:"getCurrentFloor",value:function(){var t;return null!==(t=this.currentStereoFloor)&&void 0!==t?t:this.stereoFloors[0]}},{key:"createSmallViewBackGround",value:function(t){var e=new THREE.SpriteMaterial({map:null,color:t.color||0,depthWrite:!1});e.opacity=t.opacity||.5;var n=new THREE.Sprite(e);return n.scale.set(5e3,5e3,1),n.name="blackBackGround",n}},{key:"getDefaultCameraPosition",value:function(t){var e=THREE.Math.degToRad(0),n=THREE.Math.degToRad(50),r=t.maxWeight();return(new THREE.Vector3).setFromSpherical(new THREE.Spherical(r,n,e))}},{key:"getLargeViewCameraBestSpherical",value:function(t){var e,n=(new THREE.Spherical).setFromVector3(t),r=this.getLargeViewCameraAspect(),o=0;this.viewData.Floors.forEach((function(t){o+=t.FloorSize.y}));var i=Math.max(o,this.maxHouseSize);e=r<1?this.maxHouseSize/r:i;return n.radius=e+150,n}},{key:"getLargeViewCameraBestPosition",value:function(t){return(new THREE.Vector3).setFromSpherical(this.getLargeViewCameraBestSpherical(t))}},{key:"setLargeViewCameraBestPosition",value:function(){var t=this.getLargeViewCameraBestSpherical(this.camera.position);this.camera.position.setFromSpherical(t),this.orbitControls.maxDistance=t.radius+uw.orbitControlsMaxDistance}},{key:"addOrbitControlsToCamera",value:function(t,e){var n=new THREE.OrbitControls(t,this.renderer.domElement,this.object3D);n.maxPolarAngle=THREE.Math.degToRad(90),n.minPolarAngle=THREE.Math.degToRad(10),n.autoRotateSpeed=uw.largeViewAutoRotateSpeed,n.zoomSpeed=.97,n.enableDamping=!0,n.dampingFactor=uw.orbitControlsDampingFactor,n.enablePan=!0,n.enableInertia=!0;var r=(e.x+e.z)/2;return n.minDistance=window.appConfig.ZoomLimitIn3D?window.appConfig.ZoomLimitIn3D:r*uw.orbitControlsMinDistance,n.maxDistance=e.maxWeight()*uw.orbitControlsMaxDistance,n.limitInScreenPoint=new THREE.Vector3,n.onReachMinDistance=this.signals.minDistanceReached.dispatch.bind(this),n.onObjectMoved=this.signals.onCameraUpdated.dispatch.bind(this),n}},{key:"createCamera",value:function(t){var e=new THREE.PerspectiveCamera(uw.largeFov,1,.5,1e6);return e.name=n.name+"Camera",e.rotation.reorder("YXZ"),e.position.copy(this.getDefaultCameraPosition(t)),e.renderOrder=2,e}},{key:"showCurrentFloorHotSpots",value:function(){var t=this;this.currentStereoFloor?this.stereoFloors.forEach((function(e){var n=e===t.currentStereoFloor;e.showHotSpots(n,t.camera,t.currentStereoFloor),e.enableFloorEvents(n)})):(this.showAllHotSpots(!0),this.enableHouseEvents(!0))}},{key:"enableHouseEvents",value:function(t){this.stereoFloors.forEach((function(e){return e.enableFloorEvents(t)}))}},{key:"showAllHotSpots",value:function(t){uw.animateStereoHotSpot?this.stereoFloors.forEach((function(e){e.hotSpotsGroup.setVisible(t),e.inAllFloors=!!t})):this.stereoFloors.forEach((function(e){e.hotSpotsGroup.setVisible(t)}))}},{key:"resetHotSpotsPositionByModel",value:function(t){for(var e in this.stereoFloors){var n=this.stereoFloors[e];if(n.model){var r=this.viewData.getHotSpotsByFloor(n.floorData);for(var o in r){var i=n.model.geometry.boundingBox.min.y+t;r[o].Position.y=i-4.5}}}}},{key:"initHouse",value:function(t){var e=this;t.Floors.forEach((function(n){var r=new $P(n,t,e.show3DWall);e.addChild(r),e.stereoFloors.push(r),n!==t.getDefaultFloor()||window.appConfig.is3DViewAtStart||(e.currentStereoFloor=r)}))}},{key:"loadHouseModel",value:function(){var t=this;window.appConfig.dropAnimation&&this.showAllHotSpots(!1),this.stereoFloors.forEach((function(e,n){e.createFloor(n).then((function(){e.floorObject.setLayer(pw.StereoHouseManager),window.appConfig.dropAnimation&&(aw.switchAutoTimeout=1e3,t.startLargeViewAutoRotateTimer(),e.dropAnimationTrack.signals.onFinish.add(t.showAllHotSpots.bind(t,!0)),setTimeout((function(){e.dropAnimationTrack.play()}),aw.switchAutoTimeout))}))})),this.currentStereoFloor&&this.highlightFloor(this.currentStereoFloor.floorData)}},{key:"updateRoomMode",value:function(t){var e=this,n=null,r={};this.viewData.Floors.forEach((function(e){n||(n=e.Rooms.find((function(e){return e.ID===t})))})),this.stereoFloors.forEach((function(o){o.floorObject.children[0].material.forEach((function(i,a){if(i){var s=i.name.split("-")[0];if(s===t){r[s]||(r[s]=new VP(e.viewData).createRoom(n,e.viewData.isVRHouse3));var l=r[s].Sections.find((function(t){return t.Material.name===i.name}));l&&(o.floorObject.children[0].material[a]=l.Material)}}}))}))}},{key:"getFloorObjectByFloorData",value:function(t){return this.stereoFloors.find((function(e){return e.floorData===t}))}},{key:"onPanoramaCameraUpdated",value:function(t){this.updateCameraPositionInSmallView(t.rotation.y)}},{key:"updateCameraPositionInSmallView",value:function(t){if(this.isSmallView){var e=0;this.viewData.Floors.forEach((function(t){e+=t.FloorSize.y}));var n=2*Math.max(e,this.maxHouseSize),r=(new THREE.Vector3).setFromSpherical(new THREE.Spherical(n,1,t));this.camera.position.copy(r),this.smallViewBackGroundSprite&&this.smallViewBackGroundSprite.position.set(-r.x,-r.y,-r.z),this.camera.lookAt(new THREE.Vector3)}}},{key:"onPanoramaImageLoaded",value:function(t){var e=this.viewData.getFloorByHotSpotId(t.ID);e&&this.currentStereoFloor&&this.currentStereoFloor.floorData!==e&&this.signals.floorChanged.dispatch(e.ID)}},{key:"enableSmallViewAutoRotate",value:function(t){this.isSmallViewAutoRotate=t}},{key:"onMouseHover",value:function(t,e){iw.setCursorOnHover(this.renderer.domElement,e,mw.path.hand)}},{key:"registEventListener",value:function(){var t=this;this.stereoFloors.forEach((function(e){e.signals.hotSpotClicked.add(function(t){var e=this;this.stereoModelJustClicked=!0,setTimeout((function(){e.stereoModelJustClicked=!1}),500),this.signals.hotSpotClicked.dispatch(t)}.bind(t)),zS.EventListener.get(e.floorObject).onHover=t.onMouseHover})),document.attachEvent?(this.renderer.domElement.attachEvent("touchstart",this.onLargeViewWindowPressed,!1),this.renderer.domElement.attachEvent("mousedown",this.onLargeViewWindowPressed,!1),this.renderer.domElement.attachEvent("touchend",this.onLargeViewWindowReleased,!1),this.renderer.domElement.attachEvent("mouseup",this.onLargeViewWindowReleased,!1)):(this.renderer.domElement.addEventListener("touchstart",this.onLargeViewWindowPressed,!1),this.renderer.domElement.addEventListener("mousedown",this.onLargeViewWindowPressed,!1),this.renderer.domElement.addEventListener("touchend",this.onLargeViewWindowReleased,!1),this.renderer.domElement.addEventListener("mouseup",this.onLargeViewWindowReleased,!1))}},{key:"onLargeViewWindowPressed",value:function(){uw.animateStereoHotSpot&&!this.isSmallView&&this.signals.hideHotSpots.dispatch()}},{key:"highlightFloor",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"floorPlan3D";if(t&&(this.activeFloorID=t.ID,!(this.stereoFloors&&this.stereoFloors.length<2))){for(var n=this.viewData.Floors.indexOf(t),r=0;r<this.stereoFloors.length;r++){var o=this.stereoFloors[r].floorObject;r===n?window.appConfig.hideMultiFloors&&this.viewData.Floors[0].hasObjModels?o.visible=!0:(o.setOpacity(1),o.setTransparent(!1)):window.appConfig.hideMultiFloors&&this.viewData.Floors[0].hasObjModels?o.visible=!1:(o.setOpacity(uw.floorWithoutHighlightOpacity),o.setTransparent(!0)),this.stereoFloors[r].floorData===t&&(this.currentStereoFloor=this.stereoFloors[r])}this.isSmallView||"floorPlan2D"===e||this.showCurrentFloorHotSpots()}}},{key:"highlightFloorByFloorID",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"floorPlan3D";if(null!==t){var n=this.viewData.getFloorById(t);this.highlightFloor(n,e)}else this.showAllFloors(e)}},{key:"showAllFloors",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"floorPlan3D";for(var e in this.activeFloorID=-1,this.stereoFloors){var n=this.stereoFloors[e].floorObject;window.appConfig.hideMultiFloors&&this.viewData.Floors[0].hasObjModels?n.visible=!0:(n.setOpacity(1),n.setTransparent(!1))}this.enableHouseEvents(!this.isSmallView),"floorPlan2D"!==t&&this.showAllHotSpots(!this.isSmallView)}},{key:"getAllHotSpotGroups",value:function(){var t=[];for(var e in this.stereoFloors)for(var n in this.stereoFloors[e].hotSpotGroups)t[n]=this.stereoFloors[e].hotSpotGroups[n];return t}},{key:"getHotSpotGroupById",value:function(t){for(var e in this.stereoFloors)for(var n in this.stereoFloors[e].hotSpotGroups)if(this.stereoFloors[e].hotSpotGroups[n].hotSpotData.ID===t)return this.stereoFloors[e].hotSpotGroups[n]}},{key:"updateHotSpotName",value:function(t,e){var n=this.getHotSpotGroupById(t);if(n){var r=n.getObjectByName("hotSpotNameSprite");r&&zS.TextHelper.updateTextSprite(r,e)}}},{key:"getLargeViewPort",value:function(){return{left:0,top:0,width:this.screenWidth,height:this.screenHeight}}},{key:"getLargeViewCameraAspect",value:function(){var t=this.getLargeViewPort();return t.width/t.height}},{key:"onLargeViewWindowReleased",value:function(){if(uw.animateStereoHotSpot)this.isSmallView||this.signals.showHotSpots.dispatch();else{if(this.isSmallView)return;this.orbitControls.autoRotate=!1,uw.isLargeViewAutoRotate&&this.startLargeViewAutoRotateTimer()}}},{key:"startLargeViewAutoRotateTimer",value:function(){clearTimeout(this.largeViewAutoRotateTimeout),uw.animateStereoHotSpot&&(clearTimeout(this.hotSpotAutoRotateShowTimeout),clearInterval(this.hotSpotShowInterval)),this.orbitControls.autoRotate=!1,this.largeViewAutoRotateTimeout=setTimeout(function(){!this.isSmallView&&this.object3D.visible&&(this.orbitControls.autoRotate=!0,uw.animateStereoHotSpot&&!this.stereoFloors[0].inAllFloors&&this.updateAutoRotateHotSpots(),console.log("开始自动旋转的时候需要同步一次"),mx.broadAnother(this,"enableLargeViewAutoRotate",!0),mx.startSynzer(1))}.bind(this),aw.switchAutoTimeout)}},{key:"updateAutoRotateHotSpots",value:function(){!this.isSmallView&&this.object3D.visible&&(this.hotSpotAutoRotateShowTimeout=setTimeout(function(){this.currentStereoFloor&&(this.hotSpotShowInterval=setInterval(function(){this.currentStereoFloor.showHotSpots(!0,this.camera,this.currentStereoFloor)}.bind(this),8e3))}.bind(this),2e3))}},{key:"flyIn",value:function(t,e){this.smallViewBackGroundSprite&&(this.smallViewBackGroundSprite.visible=!1),this.show();var n,r,o,i,a={positionPower:2,rotationPower:2,fovPower:2},s=t.position.clone(),l=t.rotation.clone();t.isOrthographicCamera?(s.y=t.position.z*this.ORTHOGRAPHIC_TO_PERSPECTIVE_SCALE/t.zoom,s.z=-t.position.y,l.x=THREE.Math.degToRad(-90),n=this.getLargeViewCameraBestPosition(this.getDefaultCameraPosition(this.viewData.HouseSize)),r=(new THREE.Euler).setFromRotationMatrix((new THREE.Matrix4).lookAt(n,new THREE.Vector3,THREE.Vector3.unitY),aw.rotationOrder),o=i=uw.largeFov,a.closeToHotSpotThreshold=800):(n=this.getLargeViewCameraBestPosition(this.camera.position),r=this.camera.rotation.clone(),l.y=r.y,o=t.fov,i=uw.largeFov),this.setLargeView(),this.orbitControls.enabled=!1,this.orbitControls.reset(),this.cameraFlyAnimation.play(this.camera,s,l,n,r,o,i,this.showCurrentFloorHotSpots,function(){this.orbitControls.enabled=!0,e&&e()}.bind(this),a)}},{key:"flyOut",value:function(t,e){var n,r,o=this.camera.position.clone(),i=this.camera.rotation.clone(),a=t.position.clone(),s=t.rotation.clone();n=r=uw.largeFov,a.y=t.position.z*this.ORTHOGRAPHIC_TO_PERSPECTIVE_SCALE,a.x=a.z=0,s.x=THREE.Math.degToRad(-90),this.orbitControls.enabled=!1,this.enableHouseEvents(!1);var l=function(){this.object3D.visible=window.appConfig.display3DUnder2D,this.enableSmallViewAutoRotate(!1),e&&e()}.bind(this),u=function(){this.showAllHotSpots(!1)}.bind(this);this.cameraFlyAnimation.play(this.camera,o,i,a,s,n,r,u,l,{positionPower:2,rotationPower:2,fovPower:2})}},{key:"activeHotSpotGroup",value:function(t){if(!this.currentActiveHotSpotGroup||this.currentActiveHotSpotGroup.hotSpotData.ID!==t.ID){var e=this.getHotSpotGroupByData(t);e&&e.active(),this.currentActiveHotSpotGroup&&this.currentActiveHotSpotGroup.disActive(),this.currentActiveHotSpotGroup=e}}},{key:"getHotSpotGroupByData",value:function(t){var e=this.viewData.getFloorByHotSpotId(t.ID);return this.object3D.getObjectByName(e.Name).getObjectByName("FloorHotSpots_"+e.Name).getObjectByName("StereoFloor_"+t.Name)}},{key:"update",value:function(){var t;if(this.isSmallView){if(!this.getApp().smallViewPanelManager.visible)return;t=this.getApp().smallViewPanelManager.getViewPort(this.renderer.domElement.getBoundingClientRect()),(window.ActiveXObject||"ActiveXObject"in window)&&this.getApp().isDecoView&&Math.abs(this.renderer.domElement.viewPort.width-window.innerWidth)>1&&(t.width=0)}else t=this.getLargeViewPort(),this.renderer.setClearColor(this.largeViewBackground),this.renderer.clearColor();this.camera.aspect=t.width/t.height,this.camera.updateProjectionMatrix(),this.renderer.setViewport(t.left,t.top,t.width,t.height),this.renderer.render(this.scene,this.camera),this.compassManager.updateRotate(this.camera.rotation)}},{key:"setLargeView",value:function(){this.isSmallView=!1,this.orbitControls.enabled=!0,this.compassManager.show(),this.camera.fov=uw.largeFov,this.enableHouseEvents(!0)}},{key:"setSmallView",value:function(){this.smallViewBackGroundSprite&&(this.smallViewBackGroundSprite.visible=!0),this.isSmallView=!0,this.orbitControls.enabled=!1,this.compassManager.hide(),this.orbitControls.autoRotate=!1,this.camera.fov=uw.smallFov,this.enableHouseEvents(!1),this.updateCameraPositionInSmallView(this.camera.rotation.y),this.showAllHotSpots(!1),this.currentStereoFloor&&(this.currentStereoFloor.hotSpotsGroup.setVisible(!0),this.currentStereoFloor.hotSpotsGroup.children.forEach((function(t){t.setVisible(!(!t.isActive||t instanceof XE))})))}},{key:"setOpacity",value:function(t){this.object3D.getObjectByName("StereoFloor").children.forEach((function(e){e.children.forEach((function(e){"Mesh"===e.type&&e.material.forEach((function(e){return e.opacity=t}))}))}))}},{key:"updateStereoHouseWordByLang",value:function(t){function e(t,n){if(t.children&&t.children.length>0){var r,o=fm(t.children);try{for(o.s();!(r=o.n()).done;){var i=r.value;if(i.name===n)return i;if("object"===qf(i)){var a=e(i,n);if(a)return a}}}catch(t){o.e(t)}finally{o.f()}}}var n=e(this.object3D,"entranceHotSpotGroup");if(n){var r=n.getObjectByName("hotSpotNameSprite"),o=zS.NameConverter.translateByDict("入户门",t);zS.TextHelper.updateTextSprite(r,o)}var i=e(this.object3D,"northWord");if(i){var a=i.children[0],s=zS.NameConverter.translateByDict("北",t);zS.TextHelper.updateTextSprite(a,s)}}}],[{key:"getPrepareResourceUrls",value:function(t){return t.hasObjModels?t.Floors.flatMap((function(t){return t.Models})).filter((function(t){return 2===t.LOD})).map((function(t){return t.Model})):t.Floors.flatMap((function(t){return t.Rooms})).flatMap((function(t){return t.RoomFaces})).map((function(t){return t.ImagePath}))}}]),n}(zS.VRObject),vx=function(t){im(n,t);var e=cm(n);function n(t,r,o,i,a){var s;return Kf(this,n),(s=e.call(this)).viewData=t,s.orthographicLayer=r,s.isDecoView=i,s.enabled=!s.isDecoView&&o,s.unit="metre",s.connectedPositions=void 0,s.heightText="",s.hotSpot=t.getDefaultHotSpot(),s.animation=void 0,s.currentMarkPoint=void 0,s.camera=a,s.lines=[s.createLine(),s.createLine(),s.createLine()],s.lines.forEach((function(t){return s.object3D.add(t)})),s.labels=[s.createLabel(),s.createLabel(),s.createLabel()],s.labels.forEach((function(t){return s.object3D.add(t)})),s.animation=s.createAnimation(),Object.bindFunctions(lm(s)),s}return tm(n,[{key:"getHeightText",value:function(){return this.heightText}},{key:"setBaseAppHeightTextGet",value:function(t){this.getbaseAPIHeightText=t}},{key:"onWindowResize",value:function(t,e){this.lines.forEach((function(n){return n.material.resolution.set(t,e)}))}},{key:"updateLabelsByLang",value:function(t){var e=this,n=zS.NameConverter.translateByDict("约",t),r="";this.labels.forEach((function(t,o){if(r=e.labels[o].text){var i=r.split(" ");i[0]=n,r=i.join(" ")}zS.TextHelper.updateTextSprite(e.labels[o],r)}))}},{key:"enable",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"metre",r=arguments.length>2?arguments[2]:void 0;if(t&&(this.enabled||r))return this.connectedPositions.forEach((function(t,o){var i,a=zS.NameConverter.convertLangByUrl("约");r&&(a=zS.NameConverter.translateByDict("约",r)),"metre"===n?i=a+" "+(e.currentMarkPoint.Down.distanceTo(t)/100).toFixed(1)+" m":"feet"!==n&&"en-US"!==window.locale||(i=a+" "+(e.currentMarkPoint.Down.distanceTo(t)/100*3.2808399).toFixed(1)+" ft"),o===e.connectedPositions.length-1?(e.heightText=e.isDecoView?e.getbaseAPIHeightText():i,zS.TextHelper.updateTextSprite(e.labels[o],e.heightText)):zS.TextHelper.updateTextSprite(e.labels[o],i),zS.TextHelper.updateTextSprite(e.labels[o],i)})),void(this.unit=n);this.enabled=!this.isDecoView&&t,this.unit=n,t?this.detectMarkPoint(this.camera):(this.lines.forEach((function(t){return t.visible=!1})),this.labels.forEach((function(t){return t.visible=!1})),this.currentMarkPoint=void 0)}},{key:"createLine",value:function(){return new THREE.Line2(new THREE.LineGeometry,new THREE.LineMaterial({color:16777215,linewidth:1.6,resolution:new THREE.Vector2(this.screenWidth,this.screenHeight),transparent:!0,opacity:.5}))}},{key:"createLabel",value:function(){var t=hw.rulerTextSize,e={fontSize:t,fontFace:aw.textFontFamily2D,cornerWidth:9,textColor:{r:0,g:0,b:0,a:1},backgroundColor:{r:255,g:255,b:255,a:.3},spriteScale:.5,textMargin:Math.floor(.7*t)},n=zS.TextHelper.createTextSprite("",e);return n.visible=!1,this.orthographicLayer.addProjectionObject(n,n.position),n}},{key:"createAnimation",value:function(){var t=new zS.Animation({},400);return t.onStart=function(t){t.lines.forEach((function(t){return t.visible=!0})),t.labels.forEach((function(t){return t.visible=!0}))},t.onUpdate=function(t,e){t.lines.forEach((function(n,r){var o=t.markPointPosition.clone().lerp(t.connectedPositions[r],e);n.geometry.setPositions(t.markPointPosition.toArray().concat(o.toArray())),n.computeLineDistances()})),t.labels.forEach((function(t){return t.material.opacity=e}))},t}},{key:"setCurrentHotSpot",value:function(t){this.hotSpot=t}},{key:"getClosestMarkPoint",value:function(t,e){var n=t.Walls.flatMap((function(t){return t.toArray()})).map((function(t){return new Object({markPoint:t,position:t.Down.clone().project(e)})})).filter((function(t){return t.position.toArray().every((function(t){return Math.abs(t)<1}))})).sort((function(t,e){return new THREE.Vector2(t.position.x,t.position.y).length()-new THREE.Vector2(e.position.x,e.position.y).length()}))[0];if(n)return n.markPoint}},{key:"detectMarkPoint",value:function(t){if(this.camera=t||this.camera,this.enabled){var e=this.hotSpot.Walls&&this.hotSpot.Walls.length>0,n=this.viewData.getRoomByHotSpotId(this.hotSpot.ID);if(e&&(n=this.hotSpot),n){var r=this.getClosestMarkPoint(n,t),o=this.currentMarkPoint!==r;this.currentMarkPoint=r,o&&this.showRuler(n,r)}}}},{key:"showRuler",value:function(t,e){var n=this;if(this.lines.forEach((function(t){return t.visible=!1})),this.labels.forEach((function(t){return t.visible=!1})),e){var r=t.getConnectedWallMarkPoints(e).map((function(t){return t.Down}));r.push(e.Up);var o=e.Down,i={labels:[],lines:[],markPointPosition:o,connectedPositions:r};r.forEach((function(t,e){var a,s=n.labels[e],l=THREE.Vector3.getMiddle(o,t);n.orthographicLayer.updateProjectionObject(s,l);var u="约",c=window.locale||iw.getUrlParameter("lang")||iw.getUrlParameter("language");c||(c=window.appConfig&&window.appConfig.lang?window.appConfig.lang:"zh-CN"),u=zS.NameConverter.convertLangByUrl(u,c),"metre"===n.unit?a=u+" "+(o.distanceTo(t)/100).toFixed(1)+" m":"feet"!==n.unit&&"en-US"!==window.locale||(a=u+" "+(o.distanceTo(t)/100*3.2808399).toFixed(1)+" ft"),zS.TextHelper.updateTextSprite(s,a),i.labels.push(s),e===r.length-1?(n.heightText=n.isDecoView?n.getbaseAPIHeightText():a,n.isDecoView?setTimeout((function(){n.heightText=n.getbaseAPIHeightText(),zS.TextHelper.updateTextSprite(n.labels[e],n.heightText)}),40):(n.heightText=a,zS.TextHelper.updateTextSprite(n.labels[e],n.heightText))):zS.TextHelper.updateTextSprite(n.labels[e],a),i.lines.push(n.lines[e])})),this.connectedPositions=r,this.animation.stop(),this.animation.play(i)}}}]),n}(zS.VRObject),yx=function(){function t(e){Kf(this,t),this.cameraFlyAnimation=new SE,this.app=e}return tm(t,[{key:"playPanoramaTo2D",value:function(t){var e=this;this._startAnimation(),this.app.stereoHouseManager.showAllHotSpots(!1);var n=this.app.panoramaManager.camera,r=this.app.floorPlanManager.camera,o=this.app.stereoHouseManager.camera,i=n.position.clone(),a=n.rotation.clone(),s=r.position.clone(),l=r.rotation.clone();a.y=a.y%(2*Math.PI),a.y>Math.PI&&(a.y-=2*Math.PI),a.y<-Math.PI&&(a.y+=2*Math.PI),s.y=170*r.position.z/r.zoom,s.z=r.position.y,l.x=THREE.Math.degToRad(-90);this.cameraFlyAnimation.play(o,i,a,s,l,n.fov,uw.largeFov,(function(){}),(function(){e._endAnimation(),t&&t()}),{positionPower:2,rotationPower:2,fovPower:2,closeToHotSpotThreshold:800})}},{key:"play3DToPanorama",value:function(t,e,n){var r=this;this._startAnimation();var o=this.app.stereoHouseManager.camera,i=o.position.clone(),a=o.rotation.clone(),s=(new THREE.Vector3).copy(t),l=a.clone();l.x=0,l.z=0,this.app.panoramaManager.show(n);this.cameraFlyAnimation.play(o,i,a,s,l,o.fov,this.app.panoramaManager.targetZoomFov,(function(){r.app.stereoHouseManager.showAllHotSpots(!1)}),(function(){r._endAnimation(),e&&e()}))}},{key:"play2DToPanorama",value:function(t,e){var n=this;this._startAnimation();var r=this.app.stereoHouseManager.camera,o=this.app.floorPlanManager.camera,i=o.position.clone(),a=o.rotation.clone(),s=(new THREE.Vector3).copy(t);i.y=90*o.position.z/o.zoom,i.z=o.position.y,a.x=THREE.Math.degToRad(-90);var l=a.clone();l.x=0,this.app.stereoHouseManager.showAllFloors();this.cameraFlyAnimation.play(r,i,a,s,l,uw.largeFov,this.app.panoramaManager.targetZoomFov,(function(){n.app.stereoHouseManager.showAllHotSpots(!1)}),(function(){n._endAnimation(),e&&e()}),{positionPower:1})}},{key:"_startAnimation",value:function(){this.app.stereoHouseManager.object3D.visible=!0,this.app.stereoHouseManager.orbitControls.enabled=!1,this.app.stereoHouseManager.isSmallView=!1,this.app.stereoHouseManager.enableHouseEvents(!1),this.app.floorPlanManager.object3D.visible=!1,this.app.panoramaManager.hide()}},{key:"_endAnimation",value:function(){this.app.animating=!1,this.app.stereoHouseManager.object3D.visible=!1}}]),t}(),wx=function(t){im(n,THREE.EventDispatcher);var e=cm(n);function n(t,r){var o;return Kf(this,n),(o=e.call(this)).container=t||"godviewPanel",o.content=r||"small-view-content",o}return tm(n,[{key:"getViewPort",value:function(t){var e=0,n=0,r=0,o=0,i=t.left,a=t.top,s=t.height;if(this.contentEle){var l=this.contentEle.getBoundingClientRect();e=l.left-i,n=s-(o=l.height)-(l.top-a),r=l.width}return{left:e,top:n,width:r,height:o}}},{key:"toggle",value:function(t){t?this.show():this.hide()}},{key:"show",value:function(){return this.containerEle&&(this.containerEle.display="block")}},{key:"hide",value:function(){return this.containerEle&&(this.containerEle.display="none")}},{key:"containerEle",get:function(){return this.container?document.getElementById(this.container):null}},{key:"contentEle",get:function(){return this.content?document.getElementById(this.content):null}},{key:"containerStyle",get:function(){if(this.container){var t=document.getElementById(this.container);return t?getComputedStyle(t):{}}return{}}},{key:"contentStyle",get:function(){if(this.content){var t=document.getElementById(this.content);return t?getComputedStyle(t):{}}return{}}},{key:"visible",get:function(){return"none"!==this.containerStyle.display}}]),n}(),bx=function(t){im(n,t);var e=cm(n);function n(t){var r;return Kf(this,n),(r=e.call(this)).panoramaManager=t,r.camera=t.camera,r.vrControls=new THREE.VRControls(r.camera,t.renderer.domElement),r.vrEffect=new THREE.StereoEffect(t.renderer),r.vrEffect.stereo.cameraL.layers.disable(pw.OrthographicLayer),r.vrEffect.setSize(r.screenWidth,r.screenHeight),r.isLandscape=iw.isLandscape(),r.isInVRMode=!1,r.crossHairRing=r.createCrosshairRing(),r.object3D.add(r.crossHairRing),r.previousFov=null,r.DeviceOrientationEventPermission=!(window.DeviceOrientationEvent&&window.DeviceOrientationEvent.requestPermission),r}return tm(n,[{key:"createCrosshairRing",value:function(){var t=new THREE.Mesh(new THREE.RingGeometry(1,2.5,32),new THREE.MeshBasicMaterial({color:16777215,opacity:.5,transparent:!0}));return t.visible=!1,t.position.z=1,t.layers.set(pw.OrthographicLayer),t}},{key:"enable",value:function(t,e){t&&this.requestPermission(),this.object3D.visible=t,this.vrControls.resetSensor(),this.vrControls.resetCamera(),this.vrControls.enabled=t,iw.setFullScreen(t),this.isLandscape=iw.isLandscape(),this.isLandscape&&t?this.enableVRMode(!0,e):this.enableVRMode(!1,e)}},{key:"requestPermission",value:function(){var t=this;this.DeviceOrientationEventPermission||window.DeviceOrientationEvent.requestPermission().then((function(e){"granted"===e?(t.DeviceOrientationEventPermission=!0,console.log("用户允许",e)):"denied"===e?console.log("用户拒绝",e):"prompt"===e&&console.log("用户干了啥",e)})).catch((function(t){console.info(t)}))}},{key:"enableVRMode",value:function(t,e){zS.EventListener.vrEnabled=t,this.crossHairRing.visible=t,t?(this.previousFov=this.camera.fov,this.camera.fov=e||this.camera.fov):this.previousFov&&(this.camera.fov=this.previousFov),this.camera.updateProjectionMatrix(),this.onVRModeEnabled(t),n.isInVRMode=t,this.isInVRMode=t}},{key:"onVRModeEnabled",value:function(t){}},{key:"update",value:function(){iw.isLandscape()?(this.vrEffect.render(this.scene,this.camera),document.getElementById("vrStartTip").style.visibility="hidden",this.panoramaManager.orthographicLayer.updateInVrMode(this.vrEffect.stereo),this.isInVRMode||this.enableVRMode(!0)):(this.isInVRMode&&this.enableVRMode(!1),document.getElementById("vrStartTip").style.visibility="visible")}},{key:"onWindowResize",value:function(){this.isLandscape=iw.isLandscape()}}]),n}(zS.VRObject);em(bx,"isInVRMode",!1);var Sx=function(){function t(e,n){Kf(this,t),em(this,"signals",{onAutoWalkStatusChanged:new sE}),em(this,"visits",{}),em(this,"hisRoomIds",[]),em(this,"roomVisibleHotSpotIds",{}),em(this,"nearRoomInfo",{}),em(this,"targetSpotOutRoom",null),em(this,"targetSpotInRoom",null),em(this,"isAutoWalk",!1),em(this,"timeOut",null),em(this,"onSwitchSpotFinished",(function(){var t=this;if(this.isAutoWalk)if(window.appConfig.bestCameraVDuringRoaming){var e=new THREE.Euler(this.app.currentHotSpot.BestCameraView.x,this.app.currentHotSpot.BestCameraView.y,0,"YZX");this.app.panoramaManager.panoramaImageLoader.playCameraRotationAnimation(e,(function(){console.info("finished"),t.isSecondRound?t.stopAutoWalk():t.timeOut=setTimeout(function(){this.autoWalk()}.bind(t),window.appConfig.AutoWalkFrozenTime||1e3)}))}else this.timeOut=setTimeout(function(){this.autoWalk()}.bind(this),window.appConfig.AutoWalkFrozenTime||1e3);var n=this.houseData.getRoomByHotSpotId(this.app.panoramaManager.panoramaImageLoader.currentHotSpot.ID);if(n){var r=n.ID;0!==this.hisRoomIds.length&&this.hisRoomIds.lastIndexOf(r)==this.hisRoomIds.length-1||(this.hisRoomIds.push(r),this.hisRoomIds.length>256&&this.hisRoomIds.splice(0,1),++this.visits[r],this.targetSpotOutRoom=null)}})),this.houseData=e,this.app=n,this.preCalc(),this.isSecondRound=!1}return tm(t,[{key:"getRoomHotspotNearDoor",value:function(t,e,n){var r=this,o=[],i=this.houseData.getHotSpotById(t.HotSpotIds[0]);return t.HotSpotIds.forEach((function(t){var i=r.houseData.getHotSpotById(t),a=i.Position.clone().sub(e).setY(0);(a.projectOnVector(n).length()<n.length()||Math.abs(a.angleTo(n)-Math.PI/2)<Math.PI/3)&&o.push(i)})),o.sort((function(t,n){return t.Position.clone().sub(e).setY(0).length()-n.Position.clone().sub(e).setY(0).length()})),o.length>0?o[0]:i}},{key:"preCalc",value:function(){var t=this,e={};for(var n in this.houseData.Floors.forEach((function(n){n.Rooms.forEach((function(n){n.HotSpotIds.length>0&&(t.visits[n.ID]=0),n.Doors.forEach((function(t){e[t.ID]=e[t.ID]||[],e[t.ID].push({room:n,points:[t.Start.Down,t.End.Down]})})),t.roomVisibleHotSpotIds[n.ID]=[],n.HotSpotIds.forEach((function(e){var r=t.houseData.getHotSpotById(e);null==r||r.VisibleHotSpotIds.forEach((function(e){t.roomVisibleHotSpotIds[n.ID].indexOf(e)<0&&t.roomVisibleHotSpotIds[n.ID].push(e)}))}))}))})),e)if(e[n].length>1){var r=e[n][0].points[0],o=e[n][0].points[1],i=e[n][1].points[0],a=e[n][1].points[1],s=o.clone().sub(r),l=r,u=o,c=i.clone().sub(r).projectOnVector(s).add(r),h=[r,o,c,a.clone().sub(r).projectOnVector(s).add(r)].sort((function(t,e){return t.x!=e.x?t.x-e.x:t.z-e.z}));l=h[1]===r||h[1]===o?h[1]:h[1]===c?i:a,u=h[2]===r||h[2]===o?h[2]:h[2]===c?i:a;var p=l.clone().add(u).multiplyScalar(.5),d=l.clone().sub(p).setY(0),f=e[n][0].room,m=e[n][1].room;if(f.HotSpotIds.length>0&&m.HotSpotIds.length>0){var g=this.getRoomHotspotNearDoor(f,p,d),v=this.getRoomHotspotNearDoor(m,p,d);this.nearRoomInfo[g.ID]=this.nearRoomInfo[g.ID]||[],this.nearRoomInfo[g.ID].push({doorP1:l,doorP2:u,otherRoom:m,nearestHotSpot:v}),this.nearRoomInfo[v.ID]=this.nearRoomInfo[v.ID]||[],this.nearRoomInfo[v.ID].push({doorP1:l,doorP2:u,otherRoom:f,nearestHotSpot:g})}}}},{key:"autoWalk",value:function(){var t=this,e=this.app.panoramaManager.panoramaImageLoader.currentHotSpot,n=this.houseData.getRoomByHotSpotId(e.ID),r=this.app.panoramaManager.camera.position.clone(),o=new THREE.Vector3;if(this.app.panoramaManager.camera.getWorldDirection(o),o.setY(0),!this.targetSpotOutRoom){this.roomVisibleHotSpotIds[n.ID].sort((function(e,i){var a=t.houseData.getRoomByHotSpotId(e),s=t.houseData.getRoomByHotSpotId(i);if(a&&s){var l=t.hisRoomIds.lastIndexOf(a.ID),u=t.hisRoomIds.lastIndexOf(s.ID);if(l!=u)return l-u;if(t.visits[a.ID]!=t.visits[s.ID])return t.visits[a.ID]-t.visits[s.ID];var c=1/0,h=1/0;if(n.HotSpotIds.forEach((function(n){t.nearRoomInfo[n]&&t.nearRoomInfo[n].forEach((function(t){t.nearestHotSpot.ID===e?c=t.doorP1.clone().add(t.doorP2).multiplyScalar(.5).sub(r).setY(0).angleTo(o):t.nearestHotSpot.ID===i&&(h=t.doorP1.clone().add(t.doorP2).multiplyScalar(.5).sub(r).setY(0).angleTo(o))}))})),c===1/0&&h===1/0){var p=t.houseData.getHotSpotById(e).Position.clone().sub(r).setY(0),d=t.houseData.getHotSpotById(i).Position.clone().sub(r).setY(0);return p.angleTo(o)-d.angleTo(o)}if(c!==1/0){if(h===1/0)return-1}else if(h!==1/0)return 1;return c-h}}));for(var i=0;i<this.roomVisibleHotSpotIds[n.ID].length&&(this.targetSpotOutRoom=this.houseData.getHotSpotById(this.roomVisibleHotSpotIds[n.ID][i]),!this.targetSpotOutRoom);i++);if(this.targetSpotInRoom=null,this.nearRoomInfo[this.targetSpotOutRoom.ID]){var a=1/0;this.nearRoomInfo[this.targetSpotOutRoom.ID].forEach((function(e){if(e.otherRoom===n){var i=e.doorP1.clone().add(e.doorP2).multiplyScalar(.5).sub(r).setY(0).angleTo(o);i<a&&(a=i,t.targetSpotInRoom=e.nearestHotSpot)}}))}}var s=null;if(e===this.targetSpotInRoom)s=this.targetSpotOutRoom;else{var l=[],u=this.targetSpotInRoom||this.targetSpotOutRoom,c=u.Position.clone().sub(r).setY(0);n.HotSpotIds.forEach((function(n){if(n!==e.ID&&n!==u.ID){var o=t.houseData.getHotSpotById(n);c.angleTo(o.Position.clone().sub(r).setY(0))<Math.PI/4&&c.angleTo(u.Position.clone().sub(o.Position).setY(0))<Math.PI/4&&l.push(o)}})),l.length>0&&(s=l[0])}(s=s||this.targetSpotInRoom||this.targetSpotOutRoom).ID===e.ID&&(s=this.houseData.getHotSpotById(s.VisibleHotSpotIds[0]));var h=null;this.nearRoomInfo[e.ID]&&this.nearRoomInfo[e.ID].forEach((function(t){t.nearestHotSpot.ID===s.ID&&(h=t.doorP1.clone().add(t.doorP2).multiplyScalar(.5))})),window.appConfig&&window.appConfig.autoWalkInSequence&&(s=this.getNextHotSpotByCurrHotSpot(e),h=null),this.switchPano(s,h,e)}},{key:"startAutoWalk",value:function(t){this.isAutoWalk=!0,this.timeOut=setTimeout(function(){this.autoWalk(),this.signals.onAutoWalkStatusChanged.dispatch(!0)}.bind(this),t||10)}},{key:"stopAutoWalk",value:function(){this.isAutoWalk=!1,this.app.panoramaManager.panoramaImageLoader.cameraRotateAnimation.stop(),clearTimeout(this.timeOut),this.signals.onAutoWalkStatusChanged.dispatch(!1)}},{key:"startAutoRotate",value:function(){var t=this;this.rotateInterval&&clearInterval(this.rotateInterval),this.rotateInterval=null;var e=.05*Math.PI;this.rotateInterval=setInterval((function(){t.app.panoramaManager.camera.rotation.y+=5*e/1e3}),5)}},{key:"stopAutoRotate",value:function(){this.rotateInterval&&clearInterval(this.rotateInterval),this.rotateInterval=null}},{key:"switchPano",value:function(t,e,n){}},{key:"getNextHotSpotByCurrHotSpot",value:function(t){var e=HouseViewer.BaseAPI.app.viewData.HotSpots,n=e.filter((function(t){return t.Sequence>=0})),r=(e.find((function(e){return e.ID===t.ID})).Sequence+1)%n.length;return 0===r&&(this.isSecondRound=!0),e.find((function(t){return t.Sequence===r}))}}]),t}(),Ex=function(t){im(n,t);var e=cm(n);function n(t,r){var o,i,a;return Kf(this,n),(a=e.call(this)).container=t,a.entranceDirection=r%Math.PI,a.width=50,a.height=50,a.compassSize={height:28,radius:(null===(o=window.appConfig)||void 0===o?void 0:o.compassWidth)?null===(i=window.appConfig)||void 0===i?void 0:i.compassWidth:9},a.entranceDirection===Math.PI/4||a.entranceDirection===-Math.PI/4||a.entranceDirection===Math.PI/4*3||a.entranceDirection===-Math.PI/4*3?a.entranceDirection=Math.PI/4:a.entranceDirection=0,a}return tm(n,[{key:"init",value:function(){this.setLayer(1),this.camera=this._createCamera(),this.object3D.add(this.camera),this.object3D.add(this._createCompass()),this.object3D.add(this._createLight()),this.object3D.add(this._createNorthWord()),this.onWindowResize()}},{key:"_createCamera",value:function(){var t={left:-(this.width/2+22),right:this.width/2+22,top:this.height/2+22,bottom:-(this.height/2+22)},e=new THREE.OrthographicCamera(t.left,t.right,t.top,t.bottom,.1,1e3);return e.position.z=100,e.renderOrder=4,e}},{key:"_createCompass",value:function(){var t,e,n,r,o=(null===(t=window.appConfig)||void 0===t?void 0:t.compassNorthHeight)||this.compassSize.height,i=(null===(e=window.appConfig)||void 0===e?void 0:e.compassNorthColor)||"#23C993",a=this.compassSize.radius,s=new THREE.Group;s.name="compass";var l=new THREE.ConeGeometry(a,o,4,1),u=new THREE.MeshPhongMaterial({color:i,emissive:i,flatShading:!0}),c=new THREE.Mesh(l,u);c.translateY(o/2),s.add(c);var h=(null===(n=window.appConfig)||void 0===n?void 0:n.compassSouthHeight)||this.compassSize.height,p=(null===(r=window.appConfig)||void 0===r?void 0:r.compassSouthColor)||"#FFFFFF",d=new THREE.ConeGeometry(a,h,4,1);d.rotateX(THREE.Math.degToRad(180));var f=new THREE.MeshPhongMaterial({color:p,emissive:p,flatShading:!0}),m=new THREE.Mesh(d,f);return m.translateY(-h/2),s.add(m),s}},{key:"_createLight",value:function(){var t=new THREE.PointLight(16777215,1);return t.position.set(this.compassSize.radius,this.compassSize.height,0),t}},{key:"_createNorthWord",value:function(){var t=new THREE.Group;t.name="northWord";var e="北",n=iw.getUrlParameter("lang")||iw.getUrlParameter("language");n||(n=window.appConfig&&window.appConfig.lang?window.appConfig.lang:"zh-CN"),e=zS.NameConverter.convertLangByUrl(e,n);var r=zS.TextHelper.createTextSprite(e,{fontSize:30,spriteScale:.5,fontFace:aw.textFontFamily2D});return r.translateY(this.compassSize.height+11),t.add(r),t}},{key:"updateNorthWordByLang",value:function(t){var e=this.object3D.children[3].children[0],n=zS.NameConverter.convertLangByUrl("北",t);zS.TextHelper.updateTextSprite(e,n)}},{key:"_getViewPort",value:function(){var t=this.renderer.domElement.getBoundingClientRect(),e=t.left,n=t.top,r=t.height,o=0,i=0,a=0,s=0;if(this.containerEle){var l=this.containerEle.getBoundingClientRect();o=l.left-e,i=r-(s=l.height)-(l.top-n),a=l.width}return{left:o,top:i,width:a,height:s}}},{key:"onWindowResize",value:function(){}},{key:"update",value:function(){var t=this._getViewPort();this.renderer.setViewport(t.left,t.top,t.width,t.height),this.renderer.render(this.scene,this.camera)}},{key:"updateRotate",value:function(t,e){var n={x:-Math.PI/2-t.x,y:0,z:this.entranceDirection-t.y};this.object3D.getObjectByName("compass").rotation.set(e?0:n.x,n.y,n.z),this.object3D.getObjectByName("northWord").rotation.set(0,0,n.z)}},{key:"containerEle",get:function(){return this.container?document.getElementById(this.container):null}}]),n}(zS.VRObject),Px=function(){function t(){Kf(this,t)}return tm(t,[{key:"createChangeHouseAnchorTexture",value:function(t){var e=document.createElement("canvas"),n=e.getContext("2d");e.width=100,e.height=100;n.beginPath(),n.setLineDash([5,7]),n.moveTo(e.width/2,0),n.lineTo(e.width/2,e.height-16),n.lineWidth=2,n.closePath(),n.strokeStyle="#F2AA36",n.stroke(),n.beginPath(),n.setLineDash([]),n.lineWidth=1.5,n.arc(e.width/2,e.height-8-n.lineWidth,8,0,2*Math.PI),n.closePath(),n.fillStyle=t?"#ffffff":"rgba(0, 0, 0, 0.75)",n.fill(),n.strokeStyle="#F2AA36",n.stroke();var r=new THREE.Texture;return r.image=e,r.minFilter=THREE.LinearFilter,r.needsUpdate=!0,r.scaleX=e.width,r.scaleY=e.height,r}},{key:"createFlyIcon",value:function(){var t=zS.ResourcesLoader.loadResource(mw.path.flyIcon);t.minFilter=THREE.LinearFilter;var e=new THREE.SpriteMaterial({map:t,transparent:!0}),n=new THREE.Sprite(e);return n.name="flyIcon",n.position.x=.33,n.eventOrder=1,n}},{key:"createChangeHouseAnchorSprite",value:function(t,e){var n=new THREE.Sprite(new THREE.SpriteMaterial({map:this.createChangeHouseAnchorTexture(e),transparent:!0,alphaTest:.05}));return n.scale.multiplyScalar(50),n.name="anchorImage",n.renderOrder=15,n.eventOrder=1,n.position.set(0,25,0),n}},{key:"createChangeHouseAnchorNameSprite",value:function(t,e){var n=zS.TextHelper.createTextSprite(t,{fontsize:45,backgroundColor:e?{r:0,g:0,b:0,a:1}:{r:0,g:0,b:0,a:.75},cornerWidth:e?9:5,textColor:{r:242,g:170,b:54,a:1},textMargin:20,spriteScale:.65,fontFace:window.appConfig&&window.appConfig.textFontFamilyin2D?window.appConfig.textFontFamilyin2D:"sans-serif",rightIco:e,rightIcoBackground:{r:255,g:255,b:255,a:1},borderColor:{r:242,g:170,b:54,a:1},borderThickness:2,fontWeight:"600"});if(n.name=t,n.visible=!0,n.position.set(0,60,0),n.name="anchorName",n.renderOrder=15,n.eventOrder=1,e){var r=this.createFlyIcon();r.scale.set(n.scale.y/n.scale.x*.5,.5,1),n.add(r)}return n.scale.multiplyScalar(1.5),n}}]),t}(),xx=iw.checkIsPhone(),_x=function(){function t(e,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"text";Kf(this,t),this.IS_PHONE=xx,this.LOGO_SIZE=xx?e[0]:e[1],this.LOGO_IMG_SCALE=n,this.BEAM_HEIGHT=xx?2*r[0]:2*r[1],this.type=o}return tm(t,[{key:"createLogo",value:function(){var t=new THREE.Group,e=zS.ResourcesLoader.loadResource(mw.path.anchorBackground);e.minFilter=THREE.LinearFilter;var n,r=new THREE.Sprite(new THREE.SpriteMaterial({map:e,transparent:!0,alphaTest:.05}));switch(r.scale.multiplyScalar(this.LOGO_SIZE),r.name="anchorImage",r.renderOrder=15,r.eventOrder=1,this.type){case"iframe":n=mw.path.iframeAnchor;break;case"href":n=mw.path.hrefAnchor;break;case"text":n=mw.path.textAnchor;break;case"product":n=mw.path.productAnchor;break;case"video":n=mw.path.videoAnchor;break;case"image":n=mw.path.imageAnchor;break;case"audio":n=mw.path.audioAnchor;break;default:n=mw.path.textAnchor}var o=zS.ResourcesLoader.loadResource(n);o.minFilter=THREE.LinearFilter;var i=new THREE.Sprite(new THREE.SpriteMaterial({map:o,transparent:!0,alphaTest:.05}));return i.scale.set(this.LOGO_SIZE*this.LOGO_IMG_SCALE[0],this.LOGO_SIZE*this.LOGO_IMG_SCALE[1],1),i.name="anchorLogo",i.renderOrder=15,i.eventOrder=1,t.add(r),t.add(i),t}},{key:"createBeam",value:function(){var t=document.createElement("canvas"),e=t.getContext("2d");t.width=this.BEAM_HEIGHT,t.height=this.BEAM_HEIGHT;e.beginPath(),e.moveTo(t.width/2+2,0),e.lineTo(t.width/2+1,t.height),e.lineTo(t.width/2-1,t.height),e.lineTo(t.width/2-2,0);var n=e.createLinearGradient(t.width/2,0,t.width/2,t.height);n.addColorStop(0,"rgba(255, 255, 255, 1)"),n.addColorStop(1,"rgba(255, 255, 255, 0.5)"),e.fillStyle=n,e.closePath(),e.fill();var r=new THREE.CanvasTexture(t);r.scaleX=t.width,r.scaleY=t.height,r.minFilter=THREE.LinearFilter;var o=new THREE.Sprite(new THREE.SpriteMaterial({map:r,transparent:!0,alphaTest:.05}));return o.name="anchorBeam",o.scale.multiplyScalar(this.BEAM_HEIGHT/2-4),o.position.y=this.BEAM_HEIGHT/4+this.LOGO_SIZE/2+2,o.renderOrder=15,o.eventOrder=1,o}},{key:"roundRect",value:function(t,e,n,r,o,i){t.beginPath(),t.moveTo(e+i,n),t.lineTo(e+r-i,n),t.arc(e+r-i,n+i,i,3*Math.PI/2,0),t.lineTo(e+r,n+o-i),t.arc(e+r-i,n+o-i,i,0,Math.PI/2),t.lineTo(e+i,n+o),t.arc(e+i,n+o-i,i,Math.PI/2,Math.PI),t.lineTo(e,n+i),t.arc(e+i,n+i,i,Math.PI,3*Math.PI/2),t.closePath()}},{key:"createName",value:function(t){}}]),t}(),Tx=iw.checkIsPhone(),Cx=Tx?[450,140]:[590,210],Ix=Tx?12:20,Dx=Tx?114:170,kx=Tx?1:Math.min(1,Math.max(.8,window.innerHeight/1080)),Mx=function(t){im(n,t);var e=cm(n);function n(t,r,o,i){return Kf(this,n),e.call(this,t,r,o,i)}return tm(n,[{key:"createName",value:function(t){var e=this,n=document.createElement("canvas"),r=n.getContext("2d");n.width=Cx[0],n.height=Cx[1];r.fillStyle="#ffffff",this.roundRect(r,0,0,n.width,n.height,8),r.fill();var o=new THREE.CanvasTexture(n);o.scaleX=n.width,o.scaleY=n.height,o.minFilter=THREE.LinearFilter;var i=new THREE.Sprite(new THREE.SpriteMaterial({map:o,transparent:!0,alphaTest:.05,depthTest:!1}));r.shadowColor="rgba(0, 0, 0, 0.2)",r.shadowBlur=4,r.shadowOffsetY=4,this.roundRect(r,Ix,Ix,Dx,Dx,8),r.fill();var a=new Image;a.onload=function(){r.save(),e.roundRect(r,Ix,Ix,Dx,Dx,8),r.clip(),r.drawImage(a,0,0,a.width,a.height,Ix,Ix,Dx,Dx),r.restore(),o.needsUpdate=!0,o.updateMatrix(),i.updateMatrix()},a.onerror=function(){(new THREE.ImageLoader).load(mw.path.anchorDetailDefaultImg,function(t){r.save(),this.roundRect(r,Ix,Ix,Dx,Dx,8),r.clip(),r.drawImage(t,0,0,t.width,t.height,Ix,Ix,Dx,Dx),r.restore(),o.needsUpdate=!0,o.updateMatrix(),i.updateMatrix()}.bind(e),void 0,(function(t){console.error("Set default anchor image failed.",t)}))},a.crossOrigin="anonymous",t.FileUrls&&t.FileUrls.length>0?a.src=t.FileUrls[0]:t.ProductImageUrl?a.src=t.ProductImageUrl:a.src=mw.path.anchorDetailDefaultImg,r.shadowColor="transparent",r.shadowBlur=0,r.shadowOffsetY=0;var s=0,l=Tx?0:6;if(t.Brand){var u={fontFace:window.appConfig.textFontFamily2D,fontSize:18,fontWeight:"700",sizeAttenuation:!0};u=zS.TextHelper.changeFontFaceForMacOrWin(u),r.font=u.fontWeight+" "+u.fontSize+"px "+u.fontFace;for(var c=t.Brand,h=0,p=0,d=0;d<c.length;d++){var f=c.charCodeAt(d);if(f>=1&&f<=126||65376<=f&&f<=65439?h++:h+=2,p=d,h>16)break}h>16&&(c=c.substring(0,p-1)+"..."),s=r.measureText(c).width;this.roundRect(r,2*Ix+Dx,Ix+l,s+16,30,14),r.fillStyle="#3C96FF",r.fill(),r.fillStyle="white",r.fillText(c,2*Ix+Dx+8,Ix+u.fontSize+4+l)}var m=t.Brand?s+16+6:0,g={fontFace:window.appConfig.textFontFamily2D,fontSize:2*(Tx?12:16),fontWeight:"600",sizeAttenuation:!0};g=zS.TextHelper.changeFontFaceForMacOrWin(g),r.font=g.fontWeight+" "+g.fontSize+"px "+g.fontFace;var v=this.calcAvailableProductNameLength(t.Name,r,Cx[0]-3*Ix-Dx-m),y=zS.TextHelper.cropString(t.Name,v);r.fillStyle="#333333",r.fillText(y,2*Ix+Dx+m,Ix+g.fontSize),g={fontFace:window.appConfig.textFontFamily2D,fontSize:20,fontWeight:"400"},g=zS.TextHelper.changeFontFaceForMacOrWin(g),r.font=g.fontWeight+" "+g.fontSize+"px "+g.fontFace,r.fillStyle="#666666";var w=Ix+(Tx?40:62)+g.fontSize,b=t.ProductSize?t.ProductSize:"";if(r.fillText(b,2*Ix+Dx,w),t.Price){g={fontFace:window.appConfig.textFontFamily2D,fontSize:2*(Tx?10:12),fontWeight:"600"},g=zS.TextHelper.changeFontFaceForMacOrWin(g),r.font=g.fontWeight+" "+g.fontSize+"px "+g.fontFace,r.fillStyle="#f56825",r.fillText("￥",2*Ix+Dx,n.height-Ix),g={fontFace:window.appConfig.textFontFamily2D,fontSize:2*(Tx?14:16),fontWeight:"600"},g=zS.TextHelper.changeFontFaceForMacOrWin(g),r.font=g.fontWeight+" "+g.fontSize+"px "+g.fontFace,r.fillStyle="#f56825";var S=t.Price;r.fillText(S,2*Ix+Dx+3*(Tx?10:12),n.height-Ix)}return i.name="anchorName",i.scale.set(Cx[0]/2*kx,Cx[1]/2*kx,1),i.position.y=this.BEAM_HEIGHT/2+this.LOGO_SIZE/2+Cx[1]*kx/4,i.renderOrder=15,i.eventOrder=1,i}},{key:"calcAvailableProductNameLength",value:function(t,e,n){if(e.measureText(t).width>n){var r=e.measureText(t).width/t.length;return Math.floor(n/r)}return t.length}}]),n}(_x),Rx=iw.checkIsPhone(),Ax=Rx?52:60,Hx=Rx?[14,10]:[16,20],Ox=Rx?[12,18]:[14,20],Lx=function(t){im(n,t);var e=cm(n);function n(t,r,o,i){return Kf(this,n),e.call(this,t,r,o,i)}return tm(n,[{key:"createName",value:function(t){var e=document.createElement("canvas"),n=e.getContext("2d"),r={fontFace:window.appConfig.textFontFamily2D,fontSize:24,fontWeight:"500",sizeAttenuation:!0};r=zS.TextHelper.changeFontFaceForMacOrWin(r),n.font=r.fontWeight+" "+r.fontSize+"px "+r.fontFace;var o=zS.TextHelper.cropString(t.Name,20),i=n.measureText(o).width,a=i+2*Hx[1];(t.Desc||"href"===this.type)&&(a+=Ox[0]+Hx[1]),e.width=a,e.height=Ax;n.fillStyle="rgba(34, 34, 34, 0.65)",this.roundRect(n,0,0,e.width,e.height,8),n.fill();var s=new THREE.CanvasTexture(e);s.scaleX=e.width,s.scaleY=e.height,s.minFilter=THREE.LinearFilter;var l=new THREE.Sprite(new THREE.SpriteMaterial({map:s,transparent:!0,alphaTest:.05,depthTest:!1}));if(n.font=r.fontWeight+" "+r.fontSize+"px "+r.fontFace,n.fillStyle="white",n.fillText(o,Hx[1],Hx[0]+r.fontSize),t.Desc||"href"===this.type){n.beginPath();var u=2*Hx[1]+i,c=Hx[0]+6;n.lineWidth=2,n.lineCap="round",n.moveTo(u,c),n.lineTo(u+Ox[0],c+Ox[1]/2),n.lineTo(u,c+Ox[1]),n.strokeStyle="#ffffff",n.stroke()}return l.name="anchorName",l.scale.set(e.width/2,e.height/2,1),l.position.y=this.BEAM_HEIGHT/2+this.LOGO_SIZE/2+e.height/4,l.renderOrder=15,l.eventOrder=1,l}}]),n}(_x),Bx=iw.checkIsPhone(),Fx=Bx?10:20,Nx=[14,20],jx=Bx?[240,180]:[360,280],Vx=function(t){im(n,t);var e=cm(n);function n(t,r,o,i){return Kf(this,n),e.call(this,t,r,o,i)}return tm(n,[{key:"createName",value:function(t){var e=this,n=document.createElement("canvas"),r=n.getContext("2d");n.width=jx[0]+2*Fx,n.height=jx[1]+2*Fx+(t.Name?24+Fx:0);r.fillStyle="rgba(34, 34, 34, 0.65)",this.roundRect(r,0,0,n.width,n.height,8),r.fill();var o=new THREE.CanvasTexture(n);o.scaleX=n.width,o.scaleY=n.height,o.minFilter=THREE.LinearFilter;var i=new THREE.Sprite(new THREE.SpriteMaterial({map:o,transparent:!0,alphaTest:.05,depthTest:!1}));if(t.Name){var a={fontFace:window.appConfig.textFontFamily2D,fontSize:24,fontWeight:"500",sizeAttenuation:!0};a=zS.TextHelper.changeFontFaceForMacOrWin(a),r.font=a.fontWeight+" "+a.fontSize+"px "+a.fontFace,r.fillStyle="white";var s=zS.TextHelper.cropString(t.Name,Bx?9:14);if(r.fillText(s,Fx,Fx+a.fontSize),t.Desc){r.beginPath();var l=n.width-Fx-Nx[0],u=Fx+4;r.lineWidth=2,r.lineCap="round",r.moveTo(l,u),r.lineTo(l+Nx[0],u+Nx[1]/2),r.lineTo(l,u+Nx[1]),r.strokeStyle="#ffffff",r.stroke()}}if("video"===this.type){var c=document.createElement("video");c.addEventListener("loadedmetadata",function(){var e=this;setTimeout((function(){r.save(),e.roundRect(r,Fx,t.Name?2*Fx+24:Fx,jx[0],jx[1],8),r.clip(),r.drawImage(c,0,0,c.videoWidth||c.width,c.videoHeight||c.height,Fx,t.Name?2*Fx+24:Fx,jx[0],jx[1]),r.restore();var a=Fx+jx[0]/2,s=n.height-Fx-jx[1]/2;r.beginPath(),r.arc(a,s,28,0,2*Math.PI),r.closePath(),r.strokeStyle="white",r.lineWidth=2,r.lineCap="round",r.stroke(),r.fillStyle="rgba(0, 0, 0, 0.4)",r.fill(),r.beginPath(),r.moveTo(a-6,s-15),r.lineTo(a+14,s),r.lineTo(a-6,s+15),r.lineTo(a-6,s-15),r.closePath(),r.lineCap="round",r.stroke(),o.needsUpdate=!0,o.updateMatrix(),i.updateMatrix()}),1e3)}.bind(this),!1),c.onerror=function(){return e.drawDefaultImg(r,o,i,t.Name,8)},c.crossOrigin="anonymous",c.muted="muted",c.playsinline="true",c.src=t.FileUrls&&t.FileUrls.length>0?t.FileUrls[0]+"#t=0.1":t.Url+"#t=0.1"}else if("image"===this.type){var h=new Image;h.onload=function(){r.save(),e.roundRect(r,Fx,t.Name?2*Fx+24:Fx,jx[0],jx[1],8),r.clip(),r.drawImage(h,0,0,h.width,h.height,Fx,t.Name?2*Fx+24:Fx,jx[0],jx[1]),r.restore(),o.needsUpdate=!0,o.updateMatrix(),i.updateMatrix()},h.onerror=function(){e.drawDefaultImg(r,o,i,t.Name,8)},h.crossOrigin="anonymous",h.src=t.FileUrls&&t.FileUrls.length>0?t.FileUrls[0]:t.Url}return i.name="anchorName",i.scale.set(n.width/2,n.height/2,1),i.position.y=this.BEAM_HEIGHT/2+this.LOGO_SIZE/2+n.height/4,i.renderOrder=15,i.eventOrder=1,i}},{key:"drawDefaultImg",value:function(t,e,n,r,o){(new THREE.ImageLoader).load(mw.path.anchorDetailDefaultImg,function(i){t.save(),this.roundRect(t,Fx,r?2*Fx+24:Fx,jx[0],jx[1],o),t.clip(),t.drawImage(i,0,0,i.width,i.height,Fx,r?2*Fx+24:Fx,jx[0],jx[1]),t.restore(),e.needsUpdate=!0,e.updateMatrix(),n.updateMatrix()}.bind(this),void 0,(function(t){console.error("Set default anchor image failed.",t)}))}}]),n}(_x),zx=function(){function t(e,n,r){Kf(this,t),this.LOGO_SIZE=e,this.duration=n,this.scale=r-1}return tm(t,[{key:"createAnchorBackgroundAnimation",value:function(){var t=this,e=new zS.Animation({},0),n=(new Date).getTime();return e.onUpdate=function(e,r){var o=(new Date).getTime()-n,i=o%t.duration<t.duration/2?t.scale*(o%t.duration/(t.duration/2))+1:t.scale*(1-(o%t.duration-t.duration/2)/(t.duration/2))+1;if(0!==i)for(var a=0;a<e.obj.length;a++){var s;null===(s=e.obj[a])||void 0===s||s.scale.set(i*t.LOGO_SIZE,i*t.LOGO_SIZE,i*t.LOGO_SIZE),e.obj[a].updateMatrix()}},e}},{key:"createAnchorDetailAnimation",value:function(){var t=new zS.Animation({},500),e=[{},{}];return t.onStart=function(t){t.name.obj.visible=!0,t.beam.obj.visible=!0,e[0]=om({},t.name.obj.scale),e[1]=om({},t.beam.obj.scale)},t.onUpdate=function(t,n){t.name.obj.material.opacity=n,t.name.obj.scale.set(e[0].x*n,e[0].y*n,1),t.beam.obj.material.opacity=n,t.beam.obj.scale.set(e[1].x*n,e[1].y*n,1)},t}}]),t}(),Wx=iw.checkIsPhone(),Gx=Wx?18:20,Ux=Wx?[14,20]:[10,14],Yx=Wx?200:160,Xx=Wx?24:20,Zx=Wx?16:14,qx=function(t){im(n,t);var e=cm(n);function n(t,r,o,i,a){var s;return Kf(this,n),(s=e.call(this,t,r,o,i)).camera=a,s.sound=null,s.playButtonSprite=null,s.pauseButtonSprite=null,s.scrollbarSprite=null,s.scrollbarTexture=null,s.scrollbarContext=null,s.scrollbarCanvas=null,s.globalCanvas=null,s.globalContext=null,s.globalTexture=null,s.group=null,s.audioProgress=0,s.realTimeProgress=0,s.duration=0,s.updateCanvasInterval=null,s}return tm(n,[{key:"loadAudio",value:function(t){var e=this,n=new THREE.AudioListener;this.camera.add(n),this.sound=new THREE.Audio(n);var r=new THREE.AudioLoader;r.setCrossOrigin("anonymous"),r.load(t,(function(t){e.createTime("00:00",!1),e.createTime(e.formatTime(t.duration),!0),e.sound.setBuffer(t),e.sound.setLoop(!0),e.sound.setVolume(1)}))}},{key:"updateCanvas",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t?(this.createTime(this.formatTime(this.realTimeProgress),!1),this.updateScrollbar(this.realTimeProgress/this.duration)):(this.realTimeProgress+=1,this.realTimeProgress>this.sound.buffer.duration&&(this.realTimeProgress=this.realTimeProgress%this.sound.buffer.duration),this.createTime(this.formatTime(this.realTimeProgress),!1),this.updateScrollbar(this.realTimeProgress/this.sound.buffer.duration))}},{key:"toggleAudio",value:function(t){var e=this;t.getObjectByName("anchorPlay").visible?(t.getObjectByName("anchorPlay").visible=!1,t.getObjectByName("anchorPause").visible=!0,this.sound.play(),this.updateCanvasInterval=setInterval((function(){e.updateCanvas()}),1e3)):(t.getObjectByName("anchorPause").visible=!1,t.getObjectByName("anchorPlay").visible=!0,this.sound.pause(),this.audioProgress+=this.sound._pausedAt,this.audioProgress>this.sound.buffer.duration&&(this.audioProgress=this.audioProgress%this.sound.buffer.duration),this.sound._pausedAt=this.audioProgress,this.realTimeProgress=this.audioProgress,clearInterval(this.updateCanvasInterval),this.updateCanvasInterval=null)}},{key:"updateSprite",value:function(t,e){var n=this;t&&(this.realTimeProgress=e?0:t.currentTime,this.duration=t.duration),this.group&&this.group.visible&&(t.paused||e?(this.group.getObjectByName("anchorPause").visible&&(this.group.getObjectByName("anchorPlay").visible=!0,this.group.getObjectByName("anchorPause").visible=!1),clearInterval(this.updateCanvasInterval),this.updateCanvasInterval=null,this.updateCanvas(!0)):(this.group.getObjectByName("anchorPlay").visible&&(this.group.getObjectByName("anchorPlay").visible=!1,this.group.getObjectByName("anchorPause").visible=!0),clearInterval(this.updateCanvasInterval),this.updateCanvasInterval=null,this.updateCanvasInterval=setInterval((function(){n.updateCanvas(!0),n.realTimeProgress===n.duration&&(clearInterval(n.updateCanvasInterval),n.updateCanvasInterval=null),n.realTimeProgress+=1}),1e3)))}},{key:"createTime",value:function(t,e){var n={fontFace:"PingFangSC-Regular",fontSize:Zx,fontWeight:"400",sizeAttenuation:!0};n=zS.TextHelper.changeFontFaceForMacOrWin(n),this.globalContext.font=n.fontWeight+" "+n.fontSize+"px "+n.fontFace;var r=this.globalContext.measureText(t).width;e||(this.globalContext.clearRect(2*Gx+40,this.globalCanvas.height-Gx-Zx,r,Zx),this.globalContext.fillStyle="rgba(34, 34, 34, 0.65)",this.globalContext.fillRect(2*Gx+40,this.globalCanvas.height-Gx-Zx,r,Zx)),this.globalContext.fillStyle="#cccccc",this.globalContext.fillText(t,2*Gx+40+(e?Yx-r-2:0),this.globalCanvas.height-Gx),this.globalTexture.needsUpdate=!0}},{key:"createButton",value:function(t){var e=document.createElement("canvas"),n=e.getContext("2d");e.width=40,e.height=40;var r=new THREE.CanvasTexture(e);r.scaleX=e.width,r.scaleY=e.height,r.minFilter=THREE.LinearFilter;var o=new THREE.Sprite(new THREE.SpriteMaterial({map:r,transparent:!0,alphaTest:.05,depthTest:!1})),i=e.width/2,a=e.height/2;if(n.beginPath(),n.arc(i,a,20,0,2*Math.PI),n.closePath(),n.fillStyle="#ffffff",n.fill(),n.save(),n.clip(),n.globalCompositeOperation="destination-out",t){var s=[12,10];n.beginPath(),n.moveTo(i-s[0]/3,a-s[1]),n.lineTo(i+2*s[0]/3,a),n.lineTo(i-s[0]/3,a+s[1]),n.lineTo(i-s[0]/3,a-s[1]),n.closePath(),n.fill()}else{var l=[2,6];n.beginPath(),n.moveTo(i-l[1],a-l[1]),n.lineTo(i-l[1],a+l[1]),n.lineTo(i-l[0],a+l[1]),n.lineTo(i-l[0],a-l[1]),n.closePath(),n.fill(),n.beginPath(),n.moveTo(i+l[0],a-l[1]),n.lineTo(i+l[0],a+l[1]),n.lineTo(i+l[1],a+l[1]),n.lineTo(i+l[1],a-l[1]),n.closePath(),n.fill()}n.restore(),o.name=t?"anchorPlay":"anchorPause",o.scale.set(e.width,e.height,1),o.eventOrder=2,t?this.playButtonSprite=o:this.pauseButtonSprite=o}},{key:"updateScrollbar",value:function(t){this.scrollbarContext.beginPath(),this.scrollbarContext.moveTo(2,this.scrollbarCanvas.height/2),this.scrollbarContext.lineTo((this.scrollbarCanvas.width-4)*t+2,this.scrollbarCanvas.height/2),this.scrollbarContext.lineWidth=4,this.scrollbarContext.lineCap="round",this.scrollbarContext.strokeStyle="#16d475",this.scrollbarContext.stroke(),this.scrollbarContext.beginPath(),this.scrollbarContext.moveTo((this.scrollbarCanvas.width-4)*t+2,this.scrollbarCanvas.height/2),this.scrollbarContext.lineTo(this.scrollbarCanvas.width-2,this.scrollbarCanvas.height/2),this.scrollbarContext.lineWidth=4,this.scrollbarContext.lineCap="round",this.scrollbarContext.strokeStyle="#cccccc",this.scrollbarContext.stroke(),this.scrollbarTexture.needsUpdate=!0}},{key:"createScrollbar",value:function(){var t=document.createElement("canvas"),e=t.getContext("2d");t.width=Yx,t.height=4;var n=new THREE.CanvasTexture(t);n.scaleX=t.width,n.scaleY=t.height,n.minFilter=THREE.LinearFilter;var r=new THREE.Sprite(new THREE.SpriteMaterial({map:n,transparent:!0,alphaTest:.05}));this.scrollbarCanvas=t,this.scrollbarTexture=n,this.scrollbarContext=e,this.scrollbarSprite=r;var o=this.realTimeProgress?this.realTimeProgress:0;this.scrollbarContext.beginPath(),this.scrollbarContext.moveTo(2,this.scrollbarCanvas.height/2),this.scrollbarContext.lineTo((this.scrollbarCanvas.width-4)*o+2,this.scrollbarCanvas.height/2),this.scrollbarContext.lineWidth=4,this.scrollbarContext.lineCap="round",this.scrollbarContext.strokeStyle="#16d475",this.scrollbarContext.stroke(),this.scrollbarContext.beginPath(),this.scrollbarContext.moveTo((this.scrollbarCanvas.width-4)*o+2,this.scrollbarCanvas.height/2),this.scrollbarContext.lineTo(this.scrollbarCanvas.width-2,this.scrollbarCanvas.height/2),this.scrollbarContext.lineWidth=4,this.scrollbarContext.lineCap="round",this.scrollbarContext.strokeStyle="#cccccc",this.scrollbarContext.stroke(),r.name="anchorScrollbar",r.scale.set(t.width,t.height,1),r.eventOrder=1}},{key:"createName",value:function(t){var e=this,n=new THREE.Group,r=document.createElement("canvas"),o=r.getContext("2d"),i="详情",a=iw.getUrlParameter("lang")||iw.getUrlParameter("language");a||(a=window.appConfig&&window.appConfig.lang?window.appConfig.lang:"zh-CN"),i=zS.NameConverter.convertLangByUrl(i,a);var s={fontFace:window.appConfig.textFontFamily2D,fontSize:18,fontWeight:"500",sizeAttenuation:!0};s=zS.TextHelper.changeFontFaceForMacOrWin(s),o.font=s.fontWeight+" "+s.fontSize+"px "+s.fontFace;var l=o.measureText(i).width;r.width=3*Gx+40+(t.Desc?Wx?Gx+Ux[0]:1.5*Gx+Ux[0]+l:0)+Yx,r.height=t.Name?100:80;o.fillStyle="rgba(34, 34, 34, 0.65)",this.roundRect(o,0,0,r.width,r.height,8),o.fill();var u=new THREE.CanvasTexture(r);u.scaleX=r.width,u.scaleY=r.height,u.minFilter=THREE.LinearFilter;var c=new THREE.Sprite(new THREE.SpriteMaterial({map:u,transparent:!0,alphaTest:.05}));if(this.globalCanvas=r,this.globalContext=o,this.globalTexture=u,this.createButton(!0),this.createButton(!1),this.playButtonSprite.position.x=-r.width/2+Gx+20,this.pauseButtonSprite.visible=!0,this.pauseButtonSprite.position.x=-r.width/2+Gx+20,this.pauseButtonSprite.visible=!1,t.Name){var h={fontFace:window.appConfig.textFontFamily2D,fontSize:Xx,fontWeight:"500",sizeAttenuation:!0};h=zS.TextHelper.changeFontFaceForMacOrWin(h),o.font=h.fontWeight+" "+h.fontSize+"px "+h.fontFace,o.fillStyle="white";var p=zS.TextHelper.cropString(t.Name,8);o.fillText(p,2*Gx+40,Gx+h.fontSize)}if(t.Desc){o.beginPath();var d=r.width-Gx-Ux[0],f=r.height/2-Ux[1]/2;if(o.lineWidth=2,o.lineCap="round",o.moveTo(d,f),o.lineTo(d+Ux[0],f+Ux[1]/2),o.lineTo(d,f+Ux[1]),o.strokeStyle="#ffffff",o.stroke(),!Wx){var m={fontFace:window.appConfig.textFontFamily2D,fontSize:18,fontWeight:"500",sizeAttenuation:!0};m=zS.TextHelper.changeFontFaceForMacOrWin(m),o.font=m.fontWeight+" "+m.fontSize+"px "+m.fontFace,o.fillStyle="white",o.fillText(i,r.width-1.5*Gx+2-Ux[0]-l,r.height/2+9-2)}}this.createScrollbar();var g=document.createElement("audio");return g.onloadeddata=function(){e.createTime(e.formatTime(e.realTimeProgress),!1),e.createTime(e.formatTime(g.duration),!0)},g.src=t.Url,Wx?(this.scrollbarSprite.position.y=t.Name?-6:4,this.scrollbarSprite.position.x=t.Desc?10:30):(this.scrollbarSprite.position.y=t.Name?-10:0,this.scrollbarSprite.position.x=t.Desc?-4:30),c.name="anchorName",c.scale.set(r.width,r.height,1),c.renderOrder=15,c.eventOrder=1,n.name="audioAnchorSprite",n.add(c),n.add(this.playButtonSprite),n.add(this.pauseButtonSprite),n.add(this.scrollbarSprite),n.scale.multiplyScalar(.5),n.position.y=this.BEAM_HEIGHT/2+this.LOGO_SIZE/2+r.height/4,this.group=n,n}},{key:"formatTime",value:function(t){var e=Math.floor(t),n=0;return e>60&&(n=Math.floor(e/60),e%=60),(n<10?"0"+n.toString():n.toString())+":"+(e<10?"0"+e.toString():e.toString())}}]),n}(_x),Jx=function(){function t(){Kf(this,t)}return tm(t,[{key:"createBalloonAnchorSprite",value:function(){var t=zS.ResourcesLoader.loadResource(mw.path.balloonAnchor);t.minFilter=THREE.LinearFilter;var e=new THREE.Sprite(new THREE.SpriteMaterial({map:t,transparent:!0,alphaTest:.05}));return e.scale.set(36,42,1),e.position.set(0,21,0),e.name="anchorImage",e.renderOrder=15,e.eventOrder=1,e}},{key:"createBalloonAnchorNameSprite",value:function(t){var e=document.createElement("canvas"),n=e.getContext("2d"),r={fontFace:window.appConfig.textFontFamily2D,fontSize:32,fontWeight:"500"};r=zS.TextHelper.changeFontFaceForMacOrWin(r),n.font=r.fontWeight+" "+r.fontSize+"px "+r.fontFace;var o=zS.TextHelper.cropString(t,3),i=n.measureText(o).width;e.width=i,e.height=r.fontSize,n.fillStyle="rgba(242, 170, 54, 1)",n.font=r.fontWeight+" "+r.fontSize+"px "+r.fontFace,n.fillText(o,0,e.height);var a=new THREE.CanvasTexture(e);a.scaleX=e.width,a.scaleY=e.height,a.minFilter=THREE.LinearFilter;var s=new THREE.Sprite(new THREE.SpriteMaterial({map:a,transparent:!0,alphaTest:.05}));return s.scale.set(e.width/2,e.height/2,1),s.position.y=18+e.height/4,s.name="anchorName",s.renderOrder=15,s.eventOrder=1,s}}]),t}(),$x=function(t){im(n,t);var e=cm(n);function n(t,r,o,i){var a;Kf(this,n),a=e.call(this),Object.bindFunctions(lm(a)),a.domElement=r,a.width=o,a.height=i,a.obj=t,a.camera=a.createCamera(),a.object3D.add(a.camera),a.bgColor=new THREE.Color(11842740);var s=new THREE.DirectionalLight(16777215,1);s.castShadow=!0,a.object3D.add(s),a.light=s;var l=new THREE.AmbientLight(3947580,2);a.ambientLight=l,a.object3D.add(l);var u=new THREE.PointLight(16777215,.2);return a.pointLight=u,a.putObjectInScene(t),a}return tm(n,[{key:"start",value:function(){this.orbitControls=this.addOrbitControlsToCamera(this.camera),this.renderer.setClearColor(this.bgColor),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=THREE.PCFSoftShadowMap}},{key:"getViewPort",value:function(){return{left:0,top:0,width:this.domElement.getBoundingClientRect().width,height:this.domElement.getBoundingClientRect().height}}},{key:"update",value:function(){var t;this.renderer.setSize(this.width,this.height),0!=(t=this.getViewPort()).width&&0!=t.height&&(this.camera.aspect=t.width/t.height,this.camera.updateProjectionMatrix(),this.renderer.setViewport(t.left,t.top,t.width,t.height),this.renderer.render(this.scene,this.camera))}},{key:"createCamera",value:function(){var t=new THREE.PerspectiveCamera(80,1,.5,1e6);return t.name="AnchorCamera",t.rotation.reorder("YXZ"),t.renderOrder=2,t}},{key:"setCameraBestView",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;this.light.position.set(0,12*t,0),this.pointLight.position.set(0,5*-t,0);var e=THREE.Math.degToRad(0),n=THREE.Math.degToRad(60),r=2*t,o=(new THREE.Vector3).setFromSpherical(new THREE.Spherical(r,n,e));this.camera.position.copy(o),this.camera.lookAt(new THREE.Vector3(0,0,0)),this.camera.updateProjectionMatrix()}},{key:"setBestControls",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;this.orbitControls.minDistance=t/2,this.orbitControls.maxDistance=2*t}},{key:"setPlanarObject",value:function(t,e){var n=new THREE.PlaneGeometry(2*t,2*t,32),r=zS.ResourcesLoader.loadResource(mw.path.ThreeDAnchorPlane);r.minFilter=THREE.LinearFilter;var o=new THREE.MeshLambertMaterial({color:1973790,alphaMap:r,transparent:!0,opacity:1,depthTest:!0,depthWrite:!0,blending:THREE.NormalBlending}),i=new THREE.Mesh(n,o);i.rotation.set(-Math.PI/2,0,0),i.position.copy(e),i.receiveShadow=!0,this.object3D.add(i)}},{key:"addOrbitControlsToCamera",value:function(t){var e=new THREE.OrbitControls(t,this.renderer.domElement,this.object3D);return e.zoomSpeed=.97,e.enableDamping=!0,e.dampingFactor=.75,e.enablePan=!0,e.enableInertia=!0,e}},{key:"putObjectInScene",value:function(t){var e=new THREE.Group;e.name="anchor3DModel",zS.ResourcesLoader.loadResource(t,function(n){var r,o,i=-1!==t.indexOf("glb")||-1!==t.indexOf("gltf")?n.scene:n;i.traverse((function(t){t instanceof THREE.Mesh&&(r=t,t.castShadow=!0,t.receiveShadow=!0)})),r.geometry.computeBoundingSphere(),e.add(i),o=r.geometry.boundingSphere.radius;var a=new THREE.Vector3(0,-o/2,0);i.position.copy(a),this.setCameraBestView(o,a),this.setBestControls(o),this.setPlanarObject(o,a)}.bind(this),void 0,(function(t){console.log("3D Anchor Error",t)})),this.object3D.add(e)}}]),n}(zS.VRObject),Kx=function(t){im(n,t);var e=cm(n);function n(t){var r;return Kf(this,n),r=e.call(this,t),Object.bindFunctions(lm(r)),r.config=t,r.initBackground(t),zS.EventListener.listen(r.renderer.domElement,t.mainContainer),r.anchor3DManager=new $x(t.obj,t.mainContainer,t.mainContainerWidth,t.mainContainerHeight),r.addObject(r.anchor3DManager),r}return tm(n,[{key:"cover",value:function(t,e){var n=t.image.width/t.image.height;e<n?t.matrix.setUvTransform(0,0,e/n,1,0,.5,.5):t.matrix.setUvTransform(0,0,1,n/e,0,.5,.5)}},{key:"initBackground",value:function(t){var e=this,n=zS.ResourcesLoader.loadResource(mw.path.ThreeDAnchorBg,(function(n){var r=t.mainContainerWidth/t.mainContainerHeight,o=n.image.width/n.image.height;r<o?n.matrix.setUvTransform(0,0,r/o,1,0,.5,.5):n.matrix.setUvTransform(0,0,1,o/r,0,.5,.5),e.scene.background=n}));n.matrixAutoUpdate=!1,n.minFilter=THREE.LinearFilter}}]),n}(zS.VRApp),Qx=[30,36],t_=function(t){im(i,t);var e,n,r,o=cm(i);function i(t,e,n){var r;Kf(this,i),(r=o.call(this)).panoramaManager=e,r.viewdata=t,r.setHoverAnchor=n,r.anchorGroups={},r.visibleAnchorGroups={},r.anchorsHavingAnimation=[],r.productAnchors=null,r.inAddingAnchor=!1,r.currentRoomId=null,r.deleteText=zS.NameConverter.convertLangByUrl("删除"),r.anchorShowingDetail=null;var a=new zx(iw.checkIsPhone()?Qx[0]:Qx[1],2600,1.2);return r.anchorBackgroundAnimation=a.createAnchorBackgroundAnimation(),r.anchorDetailAnimation=a.createAnchorDetailAnimation(),r.enableClick=!0,r.inVrMode=!1,r.createAnchorGroups(t),r.isAddingAnchor(r.inAddingAnchor),Object.bindFunctions(lm(r)),r}return tm(i,[{key:"createAnchorGroups",value:function(t){for(var e in t.HotSpots){var n=t.HotSpots[e],r=new Set;for(var o in n.Anchors)r.has(n.Anchors[o].ID)||(r.add(n.Anchors[o].ID),this.object3D.add(this.createAnchorGroup(n.Anchors[o],n.Position,n.ID)))}}},{key:"editorAnchorGroup",value:function(t){}},{key:"addAnchorGroup",value:function(t,e,n){this.object3D.add(this.createAnchorGroup(t,e,n)),this.setLayer(pw.OrthographicLayer)}},{key:"removeAnchorGroup",value:function(t,e){var n;for(var r in this.anchorGroups)if(this.anchorGroups[r].hotSpotID===e&&this.anchorGroups[r].anchor.ID===t.ID){n=this.anchorGroups[r];break}this.object3D.remove(n)}},{key:"deleteAnchorGroup",value:function(t){for(var e in this.anchorGroups)if(this.anchorGroups[e].anchor.ID===t.anchor.ID){this.anchorGroups[e].aboutToDelete=!0;break}for(var n in this.visibleAnchorGroups)if(this.visibleAnchorGroups[n].anchor.ID===t.anchor.ID){this.visibleAnchorGroups[n].aboutToDelete=!0;break}this.object3D.remove(t)}},{key:"refreshAnchorGroup",value:function(){for(var t in this.anchorGroups)!0===this.anchorGroups[t].aboutToDelete&&delete this.anchorGroups[t];for(var e in this.visibleAnchorGroups)!0===this.visibleAnchorGroups[e].aboutToDelete&&delete this.visibleAnchorGroups[e]}},{key:"createAnchorGroup",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=t.Position.radius||100,i=THREE.Math.degToRad(t.Position.x),a=THREE.Math.degToRad(t.Position.y+90),s=(new THREE.Vector3).setFromSpherical(new THREE.Spherical(o,a,i));s.x=e.x+s.x,s.y=e.y+s.y,s.z=e.z+s.z;var l=new THREE.Group;switch(l.position.copy(s),l.anchor=t,l.hotSpotID=t.hotSpotID=n,this.anchorGroups[l.id]=l,t.IconStyle){case"salesOffice":this.createSalesOfficeAnchor(l,t);break;case"salesOfficeBalloon":this.createSalesOfficeBalloonAnchor(l,t);break;default:window.appConfig.isOutScene?this.createSalesOfficeAnchor(l,t):this.createKfAnchor(l,t,r)}return l.add(this.createAnchorDeleteSprite()),this.panoramaManager.projectOnScreen(l),this.registerEventListener(l),l}},{key:"registerAnimateListener",value:function(t){var e=this;t.addEventListener("touchend",(function(){setTimeout((function(){window.appConfig.disableAnchorDetailAnimation||e.inVrMode||e.isInShot||e.animateAnchorDetail()}),500)}),!1),t.addEventListener("mouseup",(function(){setTimeout((function(){window.appConfig.disableAnchorDetailAnimation||e.inVrMode||e.isInShot||e.animateAnchorDetail()}),500)}),!1)}},{key:"registerEventListener",value:function(t){var e=this,n=this;zS.EventListener.get(t).onclick=function(t,e){if(n.enableClick){for(;t.parent&&!t.anchor;)t=t.parent;if("anchorDelete"===e.object.name)Math.abs(t.position.z)<=1&&n.onAnchorDeleteClicked&&n.onAnchorDeleteClicked(t);else if(Math.abs(t.position.z)<=1&&n.onAnchorNameClicked){if(n.inVrMode)return;"audio"===t.anchor.ResourceType?n.onAnchorNameClicked(t):(n.onAnchorNameClicked(t),"product"===t.anchor.ResourceType&&"DIY"===t.anchor.Source&&t.getObjectByName("anchorName")&&t.getObjectByName("anchorBeam")&&(t.getObjectByName("anchorName").visible=!1,t.getObjectByName("anchorBeam").visible=!1))}}},"editor"!==iw.getUrlParameter("mode")&&(zS.EventListener.get(t.getObjectByName("anchorImage")).onHover=function(t,e,n){n&&iw.setCursorOnHover(this.renderer.domElement,e,mw.path.hand),e?this.setHoverAnchor(!0):this.setHoverAnchor(!1)}.bind(this),t.getObjectByName("anchorName")&&(zS.EventListener.get(t.getObjectByName("anchorName")).onHover=function(t,e,n){n&&iw.setCursorOnHover(this.renderer.domElement,e,mw.path.hand),e?this.setHoverAnchor(!0):this.setHoverAnchor(!1)}.bind(this))),"editor"===iw.getUrlParameter("mode")&&(zS.EventListener.get(t).dragOnObject(this.panoramaManager.panoramaImageLoader.panoramaCubeCurrent,this.panoramaManager.camera).onDrag=function(n,r,o){e.inAddingAnchor&&(t.position.copy(o),e.panoramaManager.projectOnScreen(t))},zS.EventListener.get(t).onDragStart=function(){e.panoramaManager.panoramaControls.enabled=!1},zS.EventListener.get(t).onDragEnd=function(){if(e.panoramaManager.panoramaControls.enabled=!0,e.inAddingAnchor){var n=new THREE.Spherical;n.setFromVector3(t.realPosition.clone().sub(e.panoramaManager.panoramaImageLoader.currentHotSpot.Position)),t.anchor.Position={radius:n.radius,x:THREE.Math.radToDeg(n.theta),y:THREE.Math.radToDeg(n.phi)-90}}},zS.EventListener.get(t).onHover=this.onMouseHover.bind(this))}},{key:"createSalesOfficeAnchor",value:function(t,e){var n=new Px;switch(e.ResourceType){case"changeHouse":t.add(n.createChangeHouseAnchorSprite(e,!0)),e.Name&&t.add(n.createChangeHouseAnchorNameSprite(e.Name,!0));break;default:t.add(n.createChangeHouseAnchorSprite(e,!1)),e.Name&&t.add(n.createChangeHouseAnchorNameSprite(e.Name,!1))}}},{key:"createSalesOfficeBalloonAnchor",value:function(t,e){var n=new Jx;t.add(n.createBalloonAnchorSprite()),e.Name&&t.add(n.createBalloonAnchorNameSprite(e.Name))}},{key:"createKfAnchor",value:function(t,e,n){switch(e.ResourceType){case"product":var r=new Mx(Qx,[.54,.54],[19,19],"product");t.add(r.createLogo()),n&&(t.add(r.createBeam()),t.add(r.createName(e)));break;case"iframe":case"href":var o=new Lx(Qx,[.54,.54],[20,25],e.ResourceType);t.add(o.createLogo()),e.Name&&n&&(t.add(o.createBeam()),t.add(o.createName(e)));break;case"image":var i=new Vx(Qx,[.54,.5],[20,25],"image");t.add(i.createLogo()),n&&(t.add(i.createBeam()),t.add(i.createName(e)));break;case"video":var a=new Vx(Qx,[.54,.38],[20,25],"video");t.add(a.createLogo()),n&&(t.add(a.createBeam()),t.add(a.createName(e)));break;case"audio":var s=new qx(Qx,[.54,.54],[20,25],"audio",this.panoramaManager.camera);if(t.anchorObject=s,t.add(s.createLogo()),n){t.add(s.createBeam()),t.add(s.createName(e));var l=document.createEvent("HTMLEvents");l.data=e,l.initEvent("syncAudio",!1,!1),document.dispatchEvent(l)}break;case"3dModel":var u=new Lx(Qx,[.54,.54],[20,25],e.ResourceType);t.add(u.createLogo(e));break;case"panoImage":var c=new Lx(Qx,[.54,.54],[20,25],e.ResourceType);t.add(c.createLogo(e));break;default:var h=new Lx(Qx,[.54,.54],[20,25],e.ResourceType);t.add(h.createLogo(e)),e.Name&&n&&(t.add(h.createBeam()),t.add(h.createName(e)))}}},{key:"createAnchorDeleteSprite",value:function(){var t=zS.TextHelper.createTextSprite(this.deleteText,{fontsize:30,backgroundColor:{r:0,g:0,b:0,a:.5},cornerRadius:10,textMargin:20,spriteScale:.65,fontFace:aw.textFontFamily2D});return t.name="anchorDelete",t.visible=!1,t.position.set(0,-35,0),t.renderOrder=15,t.eventOrder=1,t}},{key:"showAnchors",value:(r=$f(regeneratorRuntime.mark((function t(e,n){var r,o,i,a,s,l,u,c,h,p,d,f,m=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=m.length>2&&void 0!==m[2]?m[2]:0,this.visibleAnchorGroups={},this.hideAllAnchors(),e){t.next=5;break}return t.abrupt("return");case 5:if(e.Anchors&&0!==e.Anchors.length){t.next=11;break}return(o=document.createEvent("HTMLEvents")).data="1",o.initEvent("showSwitchAnchorButton",!1,!1),document.dispatchEvent(o),t.abrupt("return");case 11:this.anchorsHavingAnimation=[],i=[0,0,0,0,0],t.t0=regeneratorRuntime.keys(e.Anchors);case 14:if((t.t1=t.t0()).done){t.next=32;break}a=t.t1.value,s=this.getAnchorGroup(e.Anchors[a]),t.t2=r,t.next=0===t.t2?20:1===t.t2?22:2===t.t2?24:3===t.t2?26:4===t.t2?27:5===t.t2?28:29;break;case 20:return s&&("product"===s.anchor.ResourceType?(s.visible=n,!s.anchor.Source&&n&&(this.visibleAnchorGroups[s.id]=s)):(n&&(this.visibleAnchorGroups[s.id]=s),s.visible=n,-1!==(null===(l=s.anchor.Desc)||void 0===l?void 0:l.indexOf("医疗"))&&(i[0]=1),-1!==(null===(u=s.anchor.Desc)||void 0===u?void 0:u.indexOf("休闲场地"))&&(i[1]=1),-1!==(null===(c=s.anchor.Desc)||void 0===c?void 0:c.indexOf("教育"))&&(i[2]=1),-1!==(null===(h=s.anchor.Desc)||void 0===h?void 0:h.indexOf("行政"))&&(i[3]=1),-1!==(null===(p=s.anchor.Desc)||void 0===p?void 0:p.indexOf("商业"))&&(i[4]=1)),s.anchor.IconStyle||this.anchorsHavingAnimation.push(s)),t.abrupt("break",30);case 22:return-1!==s.anchor.Desc.indexOf("医疗")&&(s.visible=n,i[0]=1),t.abrupt("break",30);case 24:return-1!==s.anchor.Desc.indexOf("休闲场地")&&(s.visible=n,i[1]=1),t.abrupt("break",30);case 26:-1!==s.anchor.Desc.indexOf("教育")&&(s.visible=n,i[2]=1);case 27:-1!==s.anchor.Desc.indexOf("行政")&&(s.visible=n,i[3]=1);case 28:-1!==s.anchor.Desc.indexOf("商业")&&(s.visible=n,i[4]=1);case 29:s.visible=n;case 30:t.next=14;break;case 32:if(!(Object.keys(this.visibleAnchorGroups).length>0)||window.appConfig.isOutScene||window.appConfig.disableAnchorDetailAnimation||this.inVrMode||this.isInShot){t.next=37;break}return t.next=35,this.animateAnchorDetail();case 35:(d=t.sent)&&!d.anchor.IconStyle&&this.anchorsHavingAnimation.push(d);case 37:window.appConfig.isOutScene||this.animateAnchorBackground(this.anchorsHavingAnimation),n&&0===r&&((f=document.createEvent("HTMLEvents")).data=i,f.initEvent("showSwitchAnchorButton",!1,!1),document.dispatchEvent(f));case 39:case"end":return t.stop()}}),t,this)}))),function(t,e){return r.apply(this,arguments)})},{key:"hideAllAnchors",value:function(){for(var t in this.anchorGroups)this.anchorGroups[t].visible=!1}},{key:"getAnchorGroup",value:function(t,e){var n=null;for(var r in this.anchorGroups)if(this.anchorGroups[r].anchor===t||this.anchorGroups[r].anchor.ID===e){n=this.anchorGroups[r];break}return n}},{key:"onAnchorDeleteClicked",value:function(t){this.deleteAnchorGroup(t);var e=document.createEvent("HTMLEvents");e.data=t,e.initEvent("anchorDeleted",!1,!1),document.dispatchEvent(e)}},{key:"onAnchorNameClicked",value:function(t){var e=document.createEvent("HTMLEvents");e.data=t,e.initEvent("anchorNameClicked",!1,!1),document.dispatchEvent(e)}},{key:"onMouseHover",value:function(t,e,n){if(this.inAddingAnchor){if(n&&(this.renderer.domElement.style.cursor=e&&"anchorImage"===n.intersect.object.name?"move":""),this.isOnPress)return;var r=t.getObjectByName("anchorDelete");e?(r.visible=e,t.cleaTime=0,t.timer&&clearTimeout(t.timer)):(t.cleaTime=200,t.timer=setTimeout((function(){r.visible=e}),t.cleaTime))}}},{key:"isAddingAnchor",value:function(t){if(this.inAddingAnchor=t,!t){for(var e in this.anchorGroups)!0===this.anchorGroups[e].aboutToDelete&&(this.anchorGroups[e].aboutToDelete=!1);for(var n in this.visibleAnchorGroups)!0===this.visibleAnchorGroups[n].aboutToDelete&&(this.visibleAnchorGroups[n].aboutToDelete=!1)}}},{key:"parseProductAnchor",value:(n=$f(regeneratorRuntime.mark((function t(e,n){var r,o,i,a,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=4;break}this.productAnchors=e.Rooms,t.next=7;break;case 4:return this.productAnchors=null,this.showProductAnchors(null,!1),t.abrupt("return");case 7:r=0;case 8:if(!(r<this.productAnchors.length)){t.next=34;break}o=0;case 10:if(!(o<this.productAnchors[r].Anchors.length)){t.next=31;break}if(this.productAnchors[r].Anchors[o].IsShowAnchor){t.next=13;break}return t.abrupt("continue",28);case 13:(i=new THREE.Group).position.set(this.productAnchors[r].Anchors[o].Position.x,this.productAnchors[r].Anchors[o].Position.y-140,this.productAnchors[r].Anchors[o].Position.z),a=new Mx(Qx,[.54,.54],[19,19],"product"),i.add(a.createLogo()),i.add(this.createAnchorDeleteSprite()),this.productAnchors[r].Anchors[o].Source="DIY",this.productAnchors[r].Anchors[o].Name=this.productAnchors[r].Anchors[o].ProductID||"",this.productAnchors[r].Anchors[o].ProductSize=this.productAnchors[r].Anchors[o].Product.StyleProductSpecId||"",this.productAnchors[r].Anchors[o].RoomId=this.productAnchors[r].ID,this.productAnchors[r].Anchors[o].ResourceType="product",i.anchor=this.productAnchors[r].Anchors[o],this.anchorGroups[i.id]=i,this.panoramaManager.projectOnScreen(i),this.registerEventListener(i),this.object3D.add(i);case 28:o++,t.next=10;break;case 31:r++,t.next=8;break;case 34:if(n?this.showProductAnchors(n.ID,!0):this.showProductAnchors(this.viewdata.getDefaultHotSpot().ID,!0),window.appConfig.disableAnchorDetailAnimation||this.inVrMode||this.isInShot){t.next=38;break}return t.next=38,this.animateAnchorDetail();case 38:for(s in this.anchorsHavingAnimation=[],this.anchorGroups)"product"===this.anchorGroups[s].anchor.ResourceType&&"DIY"===this.anchorGroups[s].anchor.Source&&this.currentRoomId===this.anchorGroups[s].anchor.RoomId&&this.anchorsHavingAnimation.push(this.anchorGroups[s]);this.animateAnchorBackground(this.anchorsHavingAnimation);case 41:case"end":return t.stop()}}),t,this)}))),function(t,e){return n.apply(this,arguments)})},{key:"showProductAnchors",value:function(t,e){if(this.hideAllAnchors(),t){var n=this.viewdata.getRoomByHotSpotId(t);if(n&&(this.currentRoomId=n.ID,e)){for(var r in this.anchorsHavingAnimation=[],this.anchorGroups)"product"===this.anchorGroups[r].anchor.ResourceType&&"DIY"===this.anchorGroups[r].anchor.Source&&n.ID===this.anchorGroups[r].anchor.RoomId&&(this.anchorGroups[r].visible=e,this.anchorsHavingAnimation.push(this.anchorGroups[r]),this.anchorGroups[r].getObjectByName("anchorName")&&this.anchorGroups[r].getObjectByName("anchorBeam")&&(this.anchorGroups[r].getObjectByName("anchorName").visible=!1,this.anchorGroups[r].getObjectByName("anchorBeam").visible=!1));this.animateAnchorBackground(this.anchorsHavingAnimation)}}}},{key:"animateAnchorDetail",value:(e=$f(regeneratorRuntime.mark((function t(){var e,n,r,o,i,a,s,l,u,c,h,p,d,f,m,g,v,y;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==Object.keys(this.anchorGroups)&&this.panoramaManager.camera){t.next=2;break}return t.abrupt("return");case 2:for(s in n=new THREE.Frustum,(r=this.panoramaManager.camera).updateMatrix(),r.updateMatrixWorld(),r.matrixWorldInverse.getInverse(r.matrixWorld),n.setFromProjectionMatrix((new THREE.Matrix4).multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse)),o=Number.MAX_VALUE,i=Number.MAX_VALUE,this.anchorGroups)"product"===this.anchorGroups[s].anchor.ResourceType&&"DIY"===this.anchorGroups[s].anchor.Source&&this.currentRoomId===this.anchorGroups[s].anchor.RoomId&&((l=this.anchorGroups[s].getObjectByName("anchorImage")).updateMatrix(),l.updateMatrixWorld(),n.containsPoint(this.anchorGroups[s].realPosition)&&(u=r.position.distanceTo(this.anchorGroups[s].realPosition))<o&&(o=u,e=this.anchorGroups[s],a=s));for(c in this.visibleAnchorGroups)"DIY"!==this.visibleAnchorGroups[c].anchor.Source&&this.visibleAnchorGroups[c].position.z<1&&(h=this.visibleAnchorGroups[c].position.x*this.visibleAnchorGroups[c].position.x+this.visibleAnchorGroups[c].position.y*this.visibleAnchorGroups[c].position.y)<i&&(i=h,e=this.visibleAnchorGroups[c],a=c);if(!e||e.anchor.IconStyle){t.next=59;break}if(!this.anchorShowingDetail){t.next=20;break}if("DIY"!==this.anchorShowingDetail.anchor.Source||"DIY"!==e.anchor.Source){t.next=16;break}return t.abrupt("return");case 16:if(this.anchorShowingDetail!==e){t.next=18;break}return t.abrupt("return");case 18:this.anchorShowingDetail.getObjectByName("anchorName")&&this.anchorShowingDetail.getObjectByName("anchorBeam")&&(this.anchorShowingDetail.getObjectByName("anchorName").visible=!1,this.anchorShowingDetail.getObjectByName("anchorBeam").visible=!1),"audio"===this.anchorShowingDetail.anchor.ResourceType&&(this.anchorShowingDetail.getObjectByName("anchorPlay").visible=!1,this.anchorShowingDetail.getObjectByName("anchorPause").visible=!1,this.anchorShowingDetail.getObjectByName("anchorScrollbar").visible=!1);case 20:if(delete this.anchorGroups[a],"DIY"!==e.anchor.Source){t.next=49;break}if((p=new THREE.Group).position.set(e.anchor.Position.x,e.anchor.Position.y-140,e.anchor.Position.z),!e.anchor.Product){t.next=29;break}return t.next=27,fx.getProductDetails(e.anchor.Product.Path);case 27:d=t.sent,e.anchor=this.parseProductDetailResp(d,e.anchor);case 29:f=new Mx(Qx,[.54,.54],[19,19],"product"),p.add(f.createLogo()),p.add(f.createBeam()),p.add(f.createName(e.anchor)),p.add(this.createAnchorDeleteSprite()),p.anchor=nm({},e.anchor),this.anchorGroups[p.id]=p,this.panoramaManager.projectOnScreen(p),this.registerEventListener(p),m=0;case 39:if(!(m<this.anchorsHavingAnimation.length)){t.next=46;break}if(this.anchorsHavingAnimation[m].anchor.ID!==p.anchor.ID){t.next=43;break}return this.anchorsHavingAnimation[m]=p,t.abrupt("break",46);case 43:m++,t.next=39;break;case 46:this.animateAnchorBackground(this.anchorsHavingAnimation),t.next=54;break;case 49:for(g in p=this.createAnchorGroup(e.anchor,this.viewdata.getHotSpotById(e.anchor.hotSpotID).Position,e.anchor.hotSpotID,!0),this.anchorsHavingAnimation=[],this.visibleAnchorGroups)this.visibleAnchorGroups[g].anchor.ID===p.anchor.ID&&(delete this.visibleAnchorGroups[g],this.visibleAnchorGroups[p.id]=p);for(v in this.visibleAnchorGroups)this.visibleAnchorGroups[v].anchor.IconStyle||this.anchorsHavingAnimation.push(this.visibleAnchorGroups[v]);this.animateAnchorBackground(this.anchorsHavingAnimation);case 54:return this.object3D.add(p),p.getObjectByName("anchorName")&&p.getObjectByName("anchorBeam")&&(y={name:{obj:p.getObjectByName("anchorName")},beam:{obj:p.getObjectByName("anchorBeam")}},this.anchorDetailAnimation.stop(),this.anchorDetailAnimation.play(y)),this.anchorShowingDetail=p,this.object3D.remove(e),t.abrupt("return",p);case 59:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"animateAnchorBackground",value:function(t){if(!window.appConfig.isOutScene&&0!==t.length){for(var e=[],n=0;n<t.length;n++)e.push(t[n].getObjectByName("anchorImage"));var r={obj:e};this.anchorBackgroundAnimation.play(r)}}},{key:"parseProductDetailResp",value:function(t,e){return 200===t.state?(t.payload.name&&(e.Name=t.payload.name),e.Brand=t.payload.brand||"",e.Price=t.payload.price||"",e.FileUrls=[],e.FileUrls.push(aw.productAnchorImageDomain+t.payload.picPath||""),e.Url=t.payload.goodsUrl||"",e.Desc=t.payload.description||"",t.payload.specId&&(e.ProductSize=t.payload.specId)):(e.Brand="",e.Price="",e.FileUrls=[""],e.Url="",e.Desc=""),e}},{key:"changeAudioAnchorState",value:function(t,e,n){for(var r in this.anchorGroups)if(t.ID===this.anchorGroups[r].anchor.ID){this.anchorGroups[r].anchorObject.updateSprite(e,n),this.anchorGroups[r].realTimeProgress=e.currentTime;break}}},{key:"initAnchorCanvas",value:function(t,e){var n=t.getBoundingClientRect(),r={mainContainer:t,mainContainerWidth:n.width,mainContainerHeight:n.height,obj:e};this.anchor3DApp&&this.anchor3DApp.config.obj!==e&&(this.anchor3DApp.config.mainContainer.firstChild&&this.anchor3DApp.config.mainContainer.removeChild(this.anchor3DApp.config.mainContainer.firstChild),this.anchor3DApp.dispose()),this.anchor3DApp=new Kx(r);try{this.anchor3DApp.run()}catch(t){console.log("Anchor Canvas Error")}}},{key:"enterVrMode",value:function(t){if(this.inVrMode=t,t)for(var e in this.anchorGroups){var n=this.anchorGroups[e];if(""===n.anchor.IconStyle||!n.anchor.IconStyle){var r=n.getObjectByName("anchorBeam");if(r){var o=n.getObjectByName("anchorName");n.remove(r),n.remove(o)}}}}},{key:"lookAtAnchor",value:function(t){var e,n=this;for(var r in this.anchorGroups)if(this.anchorGroups[r].anchor.ID===t){e=this.anchorGroups[r];break}if(e)if(this.getApp().currentHotSpot.ID!==e.anchor.hotSpotID){this.getApp().onThumbnailClick(e.anchor.hotSpotID),this.getApp().panoramaManager.panoramaImageLoader.signals.hotSpotLoaded.add((function t(){n.getApp().panoramaManager.camera.lookAt(e.realPosition);var r=setTimeout((function(){n.animateAnchorDetail(),clearTimeout(r)}),100);n.getApp().panoramaManager.panoramaImageLoader.signals.hotSpotLoaded.remove(t)}))}else{this.getApp().panoramaManager.camera.lookAt(e.realPosition);var o=setTimeout((function(){n.animateAnchorDetail(),clearTimeout(o)}),100)}}}]),i}(zS.VRObject);function e_(t){this.viewData=t;var e={anchors:[],duration:0,enlarging:!0,maxScale:1.05,minScale:.95,scaSpeed:5e-4};this.duration=e.duration,zS.Animation.call(this,e,e.duration)}e_.prototype=new zS.Animation,e_.prototype.play=function(t){this.params.anchors.push(t),zS.Animation.prototype.play.call(this)},e_.prototype.onUpdate=function(t,e){for(var n=t.anchors.length,r=t.scaSpeed,o=0;o<n;o++){var i=t.anchors[o].scale.clone();i=this.params.enlarging?i.add(new THREE.Vector3(r,r,r)):i.add(new THREE.Vector3(-r,-r,-r)),t.anchors[o].scale.copy(i)}},e_.prototype.onPostUpdate=function(t,e){t.anchors[0].scale.x>=t.maxScale?t.enlarging=!1:t.anchors[0].scale.x<=t.minScale&&(t.enlarging=!0)},e_.prototype.onFinish=function(t){t.onFinish&&t.onFinish(t)};var n_=function(t){im(n,t);var e=cm(n);function n(t,r,o){var i;return Kf(this,n),(i=e.call(this,t,r,o)).anchorAnimation=new e_(t),i}return tm(n,[{key:"createAnchorGroup",value:function(t,e,n){var r=THREE.Math.degToRad(t.Position.x),o=THREE.Math.degToRad(t.Position.y+90),i=(new THREE.Vector3).setFromSpherical(new THREE.Spherical(100,o,r));i.x=e.x+i.x,i.y=e.y+i.y,i.z=e.z+i.z;var a=new THREE.Group;a.position.copy(i),a.anchor=t,a.hotSpotID=t.hotSpotID=n;var s=154,l=this.createAnchorSprite(t);l.scale.set(220,70,30);var u,c=10,h=this.createAnchorIcoSprite();if(t.Name){c=(220-(s=(u=this.createAnchorNameSprite(t.Name,3)).scale.x)-13.3-4)/2,u.position.set((220-s)/2-c,(70-53.2+3)/2,0)}h.scale.set(13.3,13.3,13.3),h.position.set(-103.35+c,(70-53.2)/2,0),a.add(l),a.add(h),u&&a.add(u);var p=this.createAnchorDeleteSprite();return p.position.set(0,-40,0),a.add(p),this.anchorGroups[a.id]=a,this.panoramaManager.projectOnScreen(a),this.registerEventListener(a),a}},{key:"createAnchorSprite",value:function(t){var e=new THREE.Sprite(new THREE.SpriteMaterial({map:zS.ResourcesLoader.loadResource("static/textures/anchor/bubble.png"),transparent:!0,opacity:1.5,alphaTest:.05}));return e.name="anchorImage",e.renderOrder=15,e.eventOrder=1,e}},{key:"createAnchorIcoSprite",value:function(){var t=new THREE.Sprite(new THREE.SpriteMaterial({map:zS.ResourcesLoader.loadResource("static/textures/anchor/anchorIco.png"),transparent:!0}));return t.name="anchorIco",t.renderOrder=15,t}},{key:"createAnchorNameSprite",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=zS.TextHelper.createTextSprite(t,{fontSize:14,fontWeight:"900",textMargin:e,spriteScale:1,fontFace:window.appConfig.textFontFamily2D});return n.name=t,n.visible=!0,n.name="anchorName",n.renderOrder=15,n}},{key:"showAnchors",value:function(t,e){if(this.anchorAnimation.stop(),this.hideAllAnchors(),t)for(var n in t.Anchors){var r=this.getAnchorGroup(t.Anchors[n]);r.visible=e,this.anchorAnimation.play(r)}}}]),n}(t_),r_=function(){function t(e){Kf(this,t),this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(45,16/9,.1,1e4),this.camera.position.set(0,0,0),this.scene.add(this.camera),this.isDecoView=e,this.isIE=!!window.ActiveXObject||"ActiveXObject"in window}return tm(t,[{key:"createWaterMarker",value:function(t){this.waterMarkerMesh=this.createWaterMarkerMesh(t),this.camera.add(this.waterMarkerMesh)}},{key:"createWaterMarkerMesh",value:function(t){var e=GS.loadResource(mw.path.waterMark),n=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0,opacity:.5,depthTest:!1});n.map=e;var r=new THREE.Mesh(new THREE.PlaneGeometry(t.width,t.height),n);return r.position.set(0,0,-10),this.isIE&&(this.waterMarkerMeshIERow=new THREE.Mesh(new THREE.PlaneGeometry(2*t.width,t.height),n),this.waterMarkerMeshIERow.visible=!1,this.waterMarkerMeshIERow.position.set(this.isDecoView?-7.35:7.35,0,-10),this.waterMarkerMeshIEColum=new THREE.Mesh(new THREE.PlaneGeometry(t.width,(this.isDecoView?2:1)*t.height),n),this.waterMarkerMeshIEColum.visible=!1,this.waterMarkerMeshIEColum.position.set(0,this.isDecoView?4.1:-4.1,-10),this.camera.add(this.waterMarkerMeshIERow),this.camera.add(this.waterMarkerMeshIEColum)),r.waterMarkerOnWindowResize=function(t,e){var n=0,r=0;if(window.innerWidth===t&&window.innerHeight===e)r=(n=t/e>this.camera.aspect?e*this.camera.aspect:t)/this.camera.aspect,this.waterMarkerSceneViewPort={x:(this.isDecoView&&t!==window.innerWidth?-window.innerWidth/2:0)+(window.innerWidth-n)/2,y:(this.isDecoView&&e!==window.innerHeight?-window.innerHeight/2:0)+(window.innerHeight-r)/2,width:n,height:r};else{var o=window.innerWidth>t;r=(n=o?2*t/e>this.camera.aspect?e*this.camera.aspect:2*t:t/(2*e)>this.camera.aspect?2*e*this.camera.aspect:t)/this.camera.aspect,this.waterMarkerSceneViewPort=o?{x:(this.isDecoView&&t!==window.innerWidth?-window.innerWidth/2:0)+(window.innerWidth-n)/2,y:(this.isDecoView&&e!==window.innerHeight?window.innerHeight/2:0)+(window.innerHeight-r)/2,width:n,height:r}:{x:(this.isDecoView&&t!==window.innerWidth?-window.innerWidth/2:0)+(window.innerWidth-n)/2,y:(this.isDecoView&&e!==window.innerHeight?0:-window.innerHeight/2)+(window.innerHeight-r)/2,width:n,height:r}}}.bind(this),r}},{key:"onWindowResize",value:function(t,e){this.waterMarkerMesh&&this.waterMarkerMesh.waterMarkerOnWindowResize(t,e),this.isIE&&(t!==window.innerWidth?(this.waterMarkerMesh.visible=!1,this.waterMarkerMeshIERow.visible=!0,this.waterMarkerMeshIEColum.visible=!1):e!==window.innerHeight?(this.waterMarkerMesh.visible=!1,this.waterMarkerMeshIERow.visible=!1,this.waterMarkerMeshIEColum.visible=!0):(this.waterMarkerMesh.visible=!0,this.waterMarkerMeshIERow.visible=!1,this.waterMarkerMeshIEColum.visible=!1))}},{key:"update",value:function(t){this.waterMarkerMesh&&(t.setViewport(this.waterMarkerSceneViewPort.x,this.waterMarkerSceneViewPort.y,this.waterMarkerSceneViewPort.width,this.waterMarkerSceneViewPort.height),t.render(this.scene,this.camera))}}]),t}(),o_={screenWidth:window.innerWidth,screenHeight:window.innerHeight,Publisher:function(){this.messageTypes={}}};o_.Publisher.prototype.subscribe=function(t,e,n){var r=this.messageTypes[t];if(r){if(-1!==this.findSubscriber(r,e))return}else r=[],this.messageTypes[t]=r;r.push({subscriber:e,callback:n})},o_.Publisher.prototype.unsubscribe=function(t,e,n){if(e){var r=this.messageTypes[t];if(r){var o=this.findSubscriber(r,e,n);-1!==o&&this.messageTypes[t].splice(o,1)}}else delete this.messageTypes[t]},o_.Publisher.prototype.publish=function(t){var e=this.messageTypes[t];if(e)for(var n=0;n<e.length;n++){for(var r=[],o=0;o<arguments.length-1;o++)r.push(arguments[o+1]);e[n].callback.apply(e[n].subscriber,r)}},o_.Publisher.prototype.findSubscriber=function(t,e){for(var n=0;n<t.length;n++)if(t[n]===e)return n;return-1},o_.App=function(){o_.Publisher.call(this),this.renderer=null,this.scene=null,this.objects=[],this.isWindowResized=!1},o_.App.prototype=new o_.Publisher,o_.App.prototype.init=function(t){t=t||{},this.container=t.container,this.renderer=t.renderer,this.container.appendChild(this.renderer.domElement),this.scene=t.scene,this.scene.data=this;var e=new THREE.Object3D;e.name="root",this.scene.add(e),this.root=e},o_.App.prototype.run=function(){try{this.update()}catch(t){console.log(t)}var t=this;requestAnimationFrame((function(){t.run()}))},o_.App.prototype.update=function(){var t,e;for(o_.screenWidth===window.innerWidth&&o_.screenHeight===window.innerHeight||(o_.screenWidth=window.innerWidth,o_.screenHeight=window.innerHeight,this.isWindowResized=!0,this.onWindowResize()),e=this.objects.length,t=0;t<e;t++)this.isWindowResized&&this.objects[t].onWindowResize(),this.objects[t].object3D.visible&&i_(this.objects[t].object3D)&&this.objects[t].update(),this.objects[t].updateChildren();this.isWindowResized=!1};var i_=function t(e){var n=!0;return e.parent&&(n=!!e.parent.visible&&t(e.parent)),n};o_.App.prototype.addObject=function(t){this.objects.push(t),t.object3D&&this.root.add(t.object3D)},o_.App.prototype.removeObject=function(t){var e=this.objects.indexOf(t);-1!==e&&(this.objects.splice(e,1),t.object3D&&this.root.remove(t.object3D))},o_.App.prototype.onWindowResize=function(){},o_.Object=function(){o_.Publisher.call(this),this.object3D=null,this.children=[]},o_.Object.prototype=new o_.Publisher,o_.Object.prototype.init=function(){},o_.Object.prototype.onWindowResize=function(){},o_.Object.prototype.update=function(){},o_.Object.prototype.setVisible=function(t){this.setVisibleIncludeChildren(this.object3D,t)},o_.Object.prototype.setVisibleIncludeChildren=function(t,e){t&&function t(e,n){e.visible=n;var r,o=e.children.length;for(r=0;r<o;r++)t(e.children[r],n)}(t,e)},o_.Object.prototype.setLayer=function(t,e){(e=e||this.object3D)&&function t(e,n){e.layers.set(n);var r,o=e.children.length;for(r=0;r<o;r++)t(e.children[r],n)}(e,t)},o_.Object.prototype.setRenderOrder=function(t){this.object3D&&function t(e,n){e.renderOrder=n;var r,o=e.children.length;for(r=0;r<o;r++)t(e.children[r],n)}(this.object3D,t)},o_.Object.prototype.updateChildren=function(){var t,e;for(e=this.children.length,t=0;t<e;t++)this.isWindowResized&&this.children[t].onWindowResize(),this.children[t].object3D.visible&&i_(this.children[t].object3D)&&this.children[t].update(),this.children[t].updateChildren()},o_.Object.prototype.setObject3D=function(t){t.data=this,this.object3D=t},o_.Object.prototype.addChild=function(t){this.children.push(t),t.object3D&&this.object3D.add(t.object3D)},o_.Object.prototype.removeChild=function(t){var e=this.children.indexOf(t);-1!==e&&(this.children.splice(e,1),t.object3D&&this.object3D.remove(t.object3D))},o_.Object.prototype.getScene=function(){var t=null;if(this.object3D){for(var e=this.object3D;e.parent;)e=e.parent;t=e}return t},o_.Object.prototype.getApp=function(){var t=this.getScene();return t?t.data:null},o_.Object.prototype.getRenderer=function(){var t=this.getApp();return t?t.renderer:null};var a_=0,s_=1,l_=2,u_=function(t){o_.Object.call(this);var e=new THREE.Object3D;e.data=this,this.object3D=e,t.addObject(this);var n=this,r={color:new THREE.Color(0,255,0),opacity:.8,width:.3},o={fontsize:10,backgroundColor:{r:0,g:0,b:0,a:.6},borderColor:{r:0,g:0,b:0,a:0},cornerRadius:3,textColor:{r:255,g:255,b:255,a:1},textMargin:6},i={fontsize:26,backgroundColor:{r:0,g:0,b:0,a:0},borderColor:{r:0,g:0,b:0,a:0},textColor:{r:255,g:255,b:255,a:1},cornerRadius:13,textPadding:3,spriteScale:.6},a={r:0,g:255,b:0,a:1},s=new THREE.Color(0,255,0),l=new THREE.Color(255,255,0);$(DomElements.measureWallButton).click(m),$(DomElements.measureLineButton).click(g),$(DomElements.measureGridButton).click(y),$(DomElements.addCubeButton).click(w),$(DomElements.measureDeleteButton).click(b),$(DomElements.measureWallButton).attr("title",lang.measureWallBtnTip),$(DomElements.measureLineButton).attr("title",lang.measureLineBtnTip),$(DomElements.addCubeButton).attr("title",lang.measureCubeBtnTip),$(DomElements.measureDeleteButton).attr("title",lang.measureDeleteBtnTip);var u="up",c="down",h="front",p="back",d="left",f="right";function m(){n.isMeasuring?L():function(){if(!n.selectedMeasurementWall||n.isMeasuring)return;n.isMeasuring=!0,EventListener.get(n.selectedMeasurementWall.getObjectByName("intersectPlane")).enabled=!0,EventListener.get(n.selectedMeasurementWall.getObjectByName("mesh")).enabled=!1,n.isShowMeasurementGrid&&X(n.selectedMeasurementWall);for(var t in n.measurementGroup.children){var e=n.measurementGroup.children[t],r=e.getObjectByName("mesh"),o=e.getObjectByName("line"),i=e===n.selectedMeasurementWall;o.visible=i,r.visible=i,i&&(o.material.color=new THREE.Color(16776960),r.material.opacity=0)}n.panoramaManager.hideAllHotSpotGroups(),$(DomElements.measureLineButton).show(),$(DomElements.measureGridButton).show(),$(DomElements.addCubeButton).show(),$(DomElements.measureDeleteButton).show(),$(DomElements.measureWallButton)[0].style.backgroundImage="url('"+Resources.path.measureWallEnd+"')",$(DomElements.measureWallButton).attr("title",lang.measureWallEndTip)}()}function g(){n.isMeasuring&&(n.measureType===s_?F():B())}function v(){n.isMeasuring&&(n.measureType===l_?N():n.measureType=l_)}function y(){n.isMeasuring&&n.showMeasurementGrid(!n.isShowMeasurementGrid)}function w(){if(n.isMeasuring){var t,e=n.selectedMeasurementWall.getObjectByName("mesh");n.selectedMeasurementPointGroup?t=n.selectedMeasurementPointGroup.getObjectByName("point").realPosition.clone():(t=new THREE.Vector3,e.geometry.vertices.forEach((function(e){t.add(e)})),t.multiplyScalar(1/e.geometry.vertices.length));var r=function(t,e,r){var o=.1*AppParams.unitPerMetre,i=.1*AppParams.unitPerMetre,a=new THREE.Group;a.name="cubeGroup",t.add(a);var m=new THREE.Vector3(0,1,0).cross(r).normalize().multiplyScalar(o),g=m.clone().applyAxisAngle(r,Math.PI/2),v=e.clone().sub(m).add(g),y=e.clone().sub(m).sub(g),w=e.clone().add(m).add(g),b=e.clone().add(m).sub(g),C=r.clone().multiplyScalar(i);a.heightVector=C;var I=[y,b,w,v];return a.bufferPlanes=[],a.bufferPlanes.push(z(u,_(u,I,C))),a.bufferPlanes.push(z(c,I)),a.bufferPlanes.push(z(d,_(d,I,C))),a.bufferPlanes.push(z(h,_(h,I,C))),a.bufferPlanes.push(z(f,_(f,I,C))),a.bufferPlanes.push(z(p,_(p,I,C))),a.bufferPlanes.forEach((function(t){THREE.Util.setRenderOrder(t,1),a.add(t)})),function(t,e){t.controllers=[],t.bufferPlanes.forEach((function(r){var o=r.getObjectByName("mesh");if(r.name===c){t.movableCorners=[];for(var i=0;i<o.geometry.vertices.length;i++){var a=P(t,o.geometry.vertices,i);t.movableCorners.push(a),t.controllers.push(a)}}else if(r.name===u){var l=function(t,e){var r=new THREE.Group;r.name="gizmoGroup",t.add(r);var o=new THREE.MeshBasicMaterial({color:s,transparent:!0,depthWrite:!1,opacity:.5}),i=new THREE.Mesh(new THREE.CylinderGeometry(0,.5,2,12,1,!1),o);i.position.y=3,i.name="mesh",r.add(i);var a=[new THREE.Vector3,new THREE.Vector3(0,2,0)],l=THREE.Util.createLine2(a,s,.5,1.5);l.name="line",r.add(l);var u=new THREE.PlaneBufferGeometry(1e6,1e6),c=new THREE.MeshBasicMaterial({visible:!1,side:THREE.DoubleSide}),h=new THREE.Mesh(u,c);h.name="intersectPlane",h.ignoreEvent=!0,r.add(h);var p=THREE.Util.getCenterPoint(t.getObjectByName("mesh").geometry.vertices);r.position.copy(p);var d=new THREE.Vector3(0,1,0).angleTo(e),f=new THREE.Vector3(0,1,0).cross(e).normalize();return r.rotateOnAxis(f,d),function(t,e,r){var o=3*AppParams.unitPerMetre,i=t.position.clone();EventListener.get(t).dragOnPlane(t.getObjectByName("intersectPlane")),EventListener.get(t).onDragStart=function(){n.panoramaManager.enablePanoramaControls(!1)},EventListener.get(t).onDrag=function(t,n){var a=n.clone().projectOnVector(r).add(t.position);n=a.clone().sub(t.position),a.clone().distanceTo(i)<o&&S(e,t,n)},EventListener.get(t).onDragEnd=function(){n.panoramaManager.enablePanoramaControls(!0)}}(r,t.parent,e),THREE.Util.setRenderOrder(r,20),r}(r,e);t.controllers.push(l);var h=function(t,e){var r=new THREE.Vector3(0,1,0).cross(e).normalize().multiplyScalar(2),o=r.clone().applyAxisAngle(e,Math.PI/2),i=(new THREE.Vector3).sub(r).add(o),a=(new THREE.Vector3).sub(r).sub(o),l=(new THREE.Vector3).add(r).add(o),u=(new THREE.Vector3).add(r).sub(o),h=z("cubeMoveController",[a,i,l,u],s);THREE.Util.setRenderOrder(h,10),t.add(h);var p=THREE.Util.getCenterPoint(t.getObjectByName("mesh").geometry.vertices);return h.position.copy(p),function(t,e){EventListener.get(t).dragOnPlane(e.getObjectByName("intersectPlane")),EventListener.get(t).onDragStart=function(){n.panoramaManager.enablePanoramaControls(!1)},EventListener.get(t).onDrag=function(t,n){var r=t.parent.parent;r.movableCorners.forEach((function(t){n=x(e.getObjectByName("mesh"),t.position,n)})),function(t,e){t.controllers.forEach((function(t){t.position.add(e)}));var n=t.getObjectByName(c).getObjectByName("mesh").geometry;n.vertices.forEach((function(t){t.add(e)})),t.bufferPlanes.forEach((function(e){var r=_(e.name,n.vertices,t.heightVector);T(e.getObjectByName("mesh"),r)})),G(t.getObjectByName("textSpriteGroup"),t,n.normal)}(r,n)},EventListener.get(t).onDragEnd=function(){n.panoramaManager.enablePanoramaControls(!0)}}(h,n.selectedMeasurementWall),h}(r,e);t.controllers.push(h)}})),t.controllers.forEach((function(e){!function(t,e){var n=EventListener.get(e);function r(){var t=n.isMouseIn||n.isPressDown?l:s;THREE.Util.setObject3DColor(e,t)}EventListener.get(e).onHover=function(){r()},EventListener.get(e).onPress=function(n,o){r(),t.controllers.forEach((function(t){EventListener.get(t).enabled=e===t||!o}))}}(t,e)}))}(a,r),a.add(function(t,e){var r=new THREE.Group;r.name="textSpriteGroup";var o=t.parent;function i(t,i,a,s){var l=V(o,i,a,s),u=U(i,a,e,l,1);u.name=t,n.panoramaManager.projectOnScreen(u),r.add(u)}var a=t.getObjectByName(c).getObjectByName("mesh").geometry.vertices;return i("width",a[1],a[0]),i("length",a[0],a[3]),i("height",a[0],a[0].clone().add(t.heightVector),!0),r}(a,r)),EventListener.get(a).onPress=function(t,e){e&&E(t,!0)},a.normal=r.normalize(),a}(n.selectedMeasurementWall,t,e.geometry.normal);E(r,!0),D()}}function b(){n.selectedCubeGroup&&(THREE.Util.disposeObject3D(n.selectedCubeGroup),n.selectedCubeGroup=null)}function S(t,e,n){e.position.add(n),t.getObjectByName(u).getObjectByName("cubeMoveController").position.copy(e.position),t.heightVector.add(n);var r=t.getObjectByName(c).getObjectByName("mesh").geometry;t.bufferPlanes.forEach((function(e){var n=_(e.name,r.vertices,t.heightVector);T(e.getObjectByName("mesh"),n)})),G(t.getObjectByName("textSpriteGroup"),t,r.normal)}function E(t,e){if(t){if(e){if(t===n.selectedCubeGroup)return;n.selectedCubeGroup&&E(n.selectedCubeGroup,!1),n.selectedCubeGroup=t,D()}t.controllers.forEach((function(t){t.visible=e})),t.getObjectByName("textSpriteGroup").visible=e}}function P(t,e,r){var o=(r-1+e.length)%e.length,i=(r+1+e.length)%e.length,a=e[o].clone(),l=e[r].clone(),h=e[i].clone(),p=a.clone().sub(l).normalize().multiplyScalar(2),d=h.clone().sub(l).normalize().multiplyScalar(2),f=p,m=new THREE.Vector3,g=d,v=z("movableCorner",[d.clone().add(p),g,m,f],s);return THREE.Util.setRenderOrder(v,11),t.add(v),v.position.copy(l),v.index=r,function(t,e){EventListener.get(t).dragOnPlane(e.getObjectByName("intersectPlane")),EventListener.get(t).onDragStart=function(){n.panoramaManager.enablePanoramaControls(!1),D()},EventListener.get(t).onDrag=function(t,n){n=x(e.getObjectByName("mesh"),t.position,n),t.position.add(n),function(t){var e=t.parent,n=e.getObjectByName(c).getObjectByName("mesh").geometry,r=n.vertices,o=t.index,i=(t.index-1+r.length)%r.length,a=(t.index+1+r.length)%r.length,s=(t.index+2+r.length)%r.length,l=t.position.clone(),h=r[i].clone(),p=r[a].clone(),d=r[s].clone(),f=l.clone().sub(d);p=f.clone().projectOnVector(p.clone().sub(d)).add(d),h=f.clone().projectOnVector(h.clone().sub(d)).add(d);var m=new Array(4);m[o]=l,m[i]=h,m[a]=p,m[s]=d,e.bufferPlanes.forEach((function(t){var n=_(t.name,m,e.heightVector);T(t.getObjectByName("mesh"),n)})),e.movableCorners.forEach((function(t){t.position.copy(m[t.index])}));var g=e.getObjectByName(u),v=THREE.Util.getCenterPoint(g.getObjectByName("mesh").geometry.vertices);g.getObjectByName("gizmoGroup").position.copy(v),g.getObjectByName("cubeMoveController").position.copy(v),G(e.getObjectByName("textSpriteGroup"),e,n.normal)}(t)},EventListener.get(t).onDragEnd=function(){n.panoramaManager.enablePanoramaControls(!0)}}(v,n.selectedMeasurementWall),v}function x(t,e,n){if(n.equals(new THREE.Vector3))return n;var r=t.geometry,o=e.clone().add(n),i=MathHelper.convertPointToXYPlane(e,r.normal),a=MathHelper.convertPointToXYPlane(o,r.normal),s=[];r.vertices.forEach((function(t){s.push(MathHelper.convertPointToXYPlane(t,r.normal))}));var l=s.length;if(!MathHelper.isPointInConvexPolygonVector2(a,s)){for(var u=!1,c=0;c<l;c++){var h=(c+1)%l,p=MathHelper.getIntersectPointOfTwoLineSegments(i,a,s[c],s[h]);if(p){u=!0;var d,f=r.vertices[h].clone().sub(r.vertices[c]),m=n.clone().projectOnVector(f);if(isNaN(p.x)||isNaN(p.y))d=new THREE.Vector3;else{var g=p.distanceTo(i)/a.distanceTo(i);d=n.clone().sub(m).multiplyScalar(g)}if((n=m.add(d)).equals(new THREE.Vector3))break;o=e.clone().add(n),a=MathHelper.convertPointToXYPlane(o,r.normal)}}u||(n=new THREE.Vector3)}return n}function _(t,e,n){var r,o=[];return e.forEach((function(t){o.push(t.clone().add(n))})),t===u?r=[o[0],o[3],o[2],o[1]]:t===c?r=e:t===d?r=[e[0],e[3],o[3],o[0]]:t===h?r=[e[3],e[2],o[2],o[3]]:t===f?r=[e[2],e[1],o[1],o[2]]:t===p&&(r=[e[1],e[0],o[0],o[1]]),r}function T(t,e){t.geometry.attributes.position=THREE.Util.getPlaneBufferAttribute(e),t.geometry.vertices=e,t.updateMatrix(),t.geometry.applyMatrix(t.matrix)}function C(t,e){var i=new THREE.Group;i.name="measurementPointGroup";var a=ResourcesLoader.loadResource(Resources.path.anchor);a.minFilter=THREE.NearestFilter;var s=AppParams.isWebGLSupport?1:7,l=new THREE.PlaneBufferGeometry(15,15,s,s),u=new THREE.MeshBasicMaterial({map:a,transparent:!0,alphaTest:.5});u.opacity=.8;var c=new THREE.Mesh(l,u);c.name="point",c.position.copy(t),i.add(c),n.panoramaManager.projectOnScreen(c),function(t,e){EventListener.get(t).dragOnPlane(e.getObjectByName("intersectPlane")),EventListener.get(t).onDragStart=function(){n.panoramaManager.enablePanoramaControls(!1)},EventListener.get(t).onDrag=function(r,o){!function(t,e,r){var o=t.parent;t.position.copy(r),n.panoramaManager.projectOnScreen(t);for(var i=e.getObjectByName("mesh").geometry.vertices,a=0;a<i.length;a++){var s=(a+1)%i.length,l=k(r,i[a],i[s]),u=o.lines[a];THREE.Util.updateLine2(u,[l.startPoint,l.endPoint]);var c=o.texts[a],h=V(e,l.startPoint,l.endPoint);TextHelper.updateTextSprite(c,h),c.position.copy(M(l)),n.panoramaManager.projectOnScreen(c),I(o)}}(t,e,t.realPosition.clone().add(o))},EventListener.get(t).onDragEnd=function(){n.panoramaManager.enablePanoramaControls(!0)}}(c,e);var h=e.getObjectByName("mesh").geometry.vertices;i.lines=[],i.texts=[];for(var p=0;p<h.length;p++){var d=(p+1)%h.length,f=k(t,h[p],h[d]),m=[f.startPoint,f.endPoint],g=THREE.Util.createLine2(m,r.color,r.opacity,r.width);g.name="pointLine",i.add(g),i.lines.push(g);var v=V(e,f.startPoint,f.endPoint),y=TextHelper.createTextSprite(v,o);y.name="pointText",y.position.copy(M(f)),i.add(y),i.texts.push(y),n.panoramaManager.projectOnScreen(y),I(i)}return i}function I(t){for(var e=t.lines.length,n=0;n<e;n++)t.lines[n].visible=!0,t.texts[n].visible=!0;for(n=0;n<e-1;n++)for(var r=t.lines[n].geometry.vertices,o=r[1].clone().sub(r[0]),i=n+2;i<e;i++){var a=t.lines[i].geometry.vertices,s=a[1].clone().sub(a[0]).angleTo(o);if((s=THREE.Math.radToDeg(s))<1e-4){var l=r[1].distanceTo(r[0])<a[1].distanceTo(a[0])?i:n;t.lines[l].visible=!1,t.texts[l].visible=!1}}}function D(){n.selectedMeasurementPointGroup&&(THREE.Util.disposeObject3D(n.selectedMeasurementPointGroup),n.selectedMeasurementPointGroup=null)}function k(t,e,n){var r=(new THREE.Vector3).subVectors(t,e),o=(new THREE.Vector3).subVectors(n,e),i=r.projectOnVector(o);return{startPoint:t,endPoint:(new THREE.Vector3).addVectors(e,i)}}function M(t){return(new THREE.Vector3).subVectors(t.endPoint,t.startPoint).normalize().multiplyScalar(5).add(t.startPoint)}function R(t,e){var n=THREE.Util.getCenterPoint(t),r=[];return t.forEach((function(t){r.push(t.clone().sub(n).multiplyScalar(e).add(t))})),r}function A(t,e){var o=new THREE.Group;o.name="measurementLineGroup",t.add(o);var i=[new THREE.Vector3(0,1,0),new THREE.Vector3(0,-1,0)],a=THREE.Util.createLine2(i,r.color,r.opacity,r.width);a.name="startPointLine",a.position.copy(e),THREE.Util.setRenderOrder(a,1),o.add(a);var s=a.clone();s.name="endPointLine",s.visible=!1,THREE.Util.setRenderOrder(s,1),o.add(s),i=[a.position,s.position];var l=THREE.Util.createLine2(i,r.color,r.opacity,r.width);return l.name="measurementLine",l.visible=!1,o.add(l),function(t,e){var r=EventListener.get(t.getObjectByName("startPointLine")),o=EventListener.get(t.getObjectByName("endPointLine"));r.dragOnPlane(e),o.dragOnPlane(e),r.onDragStart=o.onDragStart=function(){n.panoramaManager.enablePanoramaControls(!1)},r.onDrag=o.onDrag=function(e,n){e.position.add(n),O(t)},r.onDragEnd=o.onDragEnd=function(){n.panoramaManager.enablePanoramaControls(!0)},EventListener.get(e).onMouseMove=function(e,n){t.isWaitingForSecondLinePoint&&(t.getObjectByName("endPointLine").position.copy(n),O(t))}}(o,t.getObjectByName("intersectPlane")),o}function H(){n.selectedMeasurementLineGroup&&(THREE.Util.disposeObject3D(n.selectedMeasurementLineGroup),n.selectedMeasurementLineGroup.isWaitingForSecondLinePoint=!1,n.selectedMeasurementLineGroup=null)}function O(t){var e=t.parent,r=e.getObjectByName("mesh").geometry.normal,i=t.getObjectByName("startPointLine"),a=t.getObjectByName("endPointLine"),s=t.getObjectByName("measurementLine"),l=t.getObjectByName("measurementText"),u=i.position,c=a.position;THREE.Util.updateLine2(s,[u,c]),s.visible=!0;var h=c.clone().sub(u).normalize().multiplyScalar(1),p=h.clone().applyAxisAngle(r,Math.PI/2),d=h.clone().applyAxisAngle(r,-Math.PI/2);THREE.Util.updateLine2(i,[p,d]),THREE.Util.updateLine2(a,[p,d]);var f=V(e,u,c);l?TextHelper.updateTextSprite(l,f):((l=TextHelper.createTextSprite(f,o)).name="measurementText",t.add(l));var m=(new THREE.Vector3).addVectors(u,c).multiplyScalar(.5);l.position.copy(m),n.panoramaManager.projectOnScreen(l)}function L(){if(n.isMeasuring){for(var t in n.selectedMeasurementWall&&THREE.Util.disposeObject3D(n.selectedMeasurementWall.getObjectByName("measurementGridGroup")),EventListener.get(n.selectedMeasurementWall.getObjectByName("intersectPlane")).enabled=!1,EventListener.get(n.selectedMeasurementWall.getObjectByName("mesh")).enabled=!0,n.isMeasuring=!1,H(),D(),n.measurementGroup.children){var e=n.measurementGroup.children[t],r=e.getObjectByName("mesh"),o=e.getObjectByName("line");o.visible=!0,o.material.color=new THREE.Color(16777215),r.visible=!0,r.material.opacity=e===n.selectedMeasurementWall?n.selectedOpacity:0}n.currentHotSpot&&n.panoramaManager.showVisibleHotSpotGroups(n.currentHotSpot),$(DomElements.measureLineButton).hide(),$(DomElements.measureGridButton).hide(),$(DomElements.addCubeButton).hide(),$(DomElements.measureDeleteButton).hide(),$(DomElements.measureWallButton)[0].style.backgroundImage="url('"+Resources.path.measureWall+"')",$(DomElements.measureWallButton).attr("title",lang.measureWallBtnTip),F()}}function B(){n.measureType=s_,$(DomElements.measureLineButton)[0].style.backgroundImage="url('"+Resources.path.measureLineEnd+"')",$(DomElements.measureLineButton).attr("title",lang.measurePointBtnTip)}function F(){n.selectedMeasurementLineGroup&&n.selectedMeasurementLineGroup.isWaitingForSecondLinePoint&&H(),$(DomElements.measureLineButton)[0].style.backgroundImage="url('"+Resources.path.measureLine+"')",$(DomElements.measureLineButton).attr("title",lang.measureLineBtnTip),n.measureType=a_}function N(){n.selectedMeasurementDegreeGroup&&n.selectedMeasurementDegreeGroup.isWaitingForSecondLinePoint&&(THREE.Util.disposeObject3D(n.selectedMeasurementDegreeGroup),n.selectedMeasurementDegreeGroup.isWaitingForSecondLinePoint=!1,n.selectedMeasurementDegreeGroup=null)}function j(t,e){n.isMeasuring||(n.selectedMeasurementWall===t.parent?t.material.opacity=n.selectedOpacity:t.material.opacity=e?n.hoverOpacity:0)}function V(t,e,n,r){var o=e.distanceTo(n),i=s(o),a=i;function s(t){return Math.round(t/AppParams.unitPerMetre*1e3)+"mm"}if(t.measurementScale&&!r){var l=t.getObjectByName("mesh").geometry.vertices,u=l[3].clone().sub(l[0]),c=l[1].clone().sub(l[0]),h=n.clone().sub(e),p=h.clone().projectOnVector(u).multiplyScalar(t.measurementScale.width),d=h.clone().projectOnVector(c).multiplyScalar(t.measurementScale.height),f=p.add(d).length();if(a=s(f),AppParams.showUnrealMeasurement){var m=((o-f)/f*100).toFixed(2),g=s(o-f);a="真：{0}\n测：{1}\n误差：{2}%, {3}".format(a,i,m,g)}}return a}function z(t,e,n){var r=new THREE.Group;r.name=t;var o=THREE.Util.createBufferPlane(e),i=new THREE.MeshBasicMaterial({color:16777215,transparent:!0,depthWrite:!1,opacity:.2,side:THREE.DoubleSide}),a=new THREE.LineBasicMaterial;a.color=new THREE.Color(16777215);var s=new THREE.Line(o,a);s.name="line",r.add(s);var l=new THREE.Mesh(o,i);return l.name="mesh",n&&(i.color=n),r.add(l),r}function W(t,e){var n=(0===e||2===e)&&1!==t.measurementScale.height,r=(1===e||3===e)&&1!==t.measurementScale.width;return n||r}function G(t,e,r){var o=e.parent;function i(t,e,i,a){var s=V(o,e,i,a);!function(t,e,n,r,o,i){TextHelper.updateTextSprite(t,o),t.position.copy(Y(e,n,r,i))}(t,e,i,r,s,1),n.panoramaManager.projectOnScreen(t)}var a=e.getObjectByName(c).getObjectByName("mesh").geometry.vertices;i(t.getObjectByName("width"),a[0],a[1]),i(t.getObjectByName("length"),a[3],a[0]),i(t.getObjectByName("height"),a[0],a[0].clone().add(e.heightVector),!0)}function U(t,e,n,r,o,a){var s=nm({},i);a&&(s.textColor=a);var l=TextHelper.createTextSprite(r,s);return l.position.copy(Y(t,e,n,o)),l}function Y(t,e,n,r){var o=(new THREE.Vector3).subVectors(e,t).clone().normalize().applyAxisAngle(n,Math.PI/2),i=(new THREE.Vector3).addVectors(t,e).multiplyScalar(.5);return i.add(o.clone().multiplyScalar(r)),i}function X(t){var e=.5*AppParams.unitPerMetre,n=.1*AppParams.unitPerMetre,r=new THREE.Color(93,80,64),o=new THREE.Group;o.name="measurementGridGroup",t.add(o);var i=R(t.getObjectByName("mesh").geometry.vertices,1.05),a=Z(i,e,r,.4),s=Z(i,n,r,.11);return o.add(a),o.add(s),o}function Z(t,e,n,r){var o=new THREE.Group;o.name="gridGroup";var i,a,s,l,u=t[0],c=t[1],h=(t[2],t[3]),p=(new THREE.Vector3).subVectors(h,u).normalize().multiplyScalar(e),d=(new THREE.Vector3).subVectors(c,u).normalize().multiplyScalar(e),f=Math.floor(h.distanceTo(u)/e),m=Math.floor(c.distanceTo(u)/e);for(i=0;i<f;i++){var g=p.clone().multiplyScalar(i+1);a=(new THREE.Vector3).addVectors(u,g),s=(new THREE.Vector3).addVectors(c,g),l=THREE.Util.createLine2([a,s],n,r),o.add(l)}for(i=0;i<m;i++){var v=d.clone().multiplyScalar(i+1);a=(new THREE.Vector3).addVectors(u,v),s=(new THREE.Vector3).addVectors(h,v),l=THREE.Util.createLine2([a,s],n,r),o.add(l)}return o}this.showMeasurementGrid=function(t){if(n.isShowMeasurementGrid=t,$(DomElements.measureGridButton)[0].style.backgroundImage="url('"+(t?Resources.path.measureGridEnd:Resources.path.measureGrid)+"')",n.selectedMeasurementWall){var e=n.selectedMeasurementWall.getObjectByName("measurementGridGroup");e?e.visible=t:t&&X(n.selectedMeasurementWall)}$(DomElements.measureGridButton).attr("title",t?lang.measureHideGridTip:lang.measureShowGridTip)},this.startMeasure=function(t){n.endMeasure();var e=n.measurementGroups[t.ID];if(!e){var r=HouseModel.getRoomByHotSpotId(n.houseData,t.ID);if(!r)return;var o=t.MeasurementWalls&&t.MeasurementWalls.length>0?t.MeasurementWalls:r.Walls;if(!o||0===o.length)return;(e=new THREE.Group).name="measurementGroup",n.object3D.add(e),n.measurementGroups[t.ID]=e,o.forEach((function(t){e.add(function(t,e){var r=HouseModel.getPositionInHouse(t.StartMarkPoint.DownPosition,e),o=HouseModel.getPositionInHouse(t.StartMarkPoint.UpPosition,e),s=HouseModel.getPositionInHouse(t.EndMarkPoint.DownPosition,e),l=HouseModel.getPositionInHouse(t.EndMarkPoint.UpPosition,e),u=[r,o,l,s],c=z("measurementWallGroup",u,new THREE.Color(204,232,255));c.wall=t;var h=R(u,1.05),p=THREE.Util.createBufferPlane(h),d=new THREE.Mesh(p);d.material.visible=!1,d.name="intersectPlane",c.add(d);var f=c.getObjectByName("mesh");return f.material.opacity=0,EventListener.get(f).onHover=j,EventListener.get(f).onclick=function(t,e){!function(t){if(t===n.selectedMeasurementWall)return;var e=t.getObjectByName("mesh");e.material.opacity=1,e.material.opacity=n.selectedOpacity,n.selectedMeasurementWall&&(n.selectedMeasurementWall.getObjectByName("mesh").material.opacity=0,n.selectedMeasurementWall.getObjectByName("textSpriteGroup").visible=!1);n.selectedMeasurementWall=t;var r=t.getObjectByName("textSpriteGroup");r||(r=function(t,e){var r=new THREE.Group;r.name="textSpriteGroup";for(var o=t.getObjectByName("mesh").geometry.vertices,s=o.length,l=0;l<s;l++){var u=(l+1+s)%s,c=V(t,o[l],o[u]),h=W(t,l)?U(o[l],o[u],e,c,i.textPadding,a):U(o[l],o[u],e,c,i.textPadding);h.name="textSprite",n.panoramaManager.projectOnScreen(h),r.add(h)}return r}(t,e.geometry.normal),t.add(r));r.visible=!0,$(DomElements.measureWallButton).show()}(t.parent)},EventListener.get(d).onclick=function(t,e){!function(t,e){if(!n.isMeasuring)return;if(n.measureType===s_)if(n.selectedMeasurementLineGroup&&n.selectedMeasurementLineGroup.isWaitingForSecondLinePoint){var r=n.selectedMeasurementLineGroup.getObjectByName("endPointLine");r.visible=!0,r.position.copy(e.point),O(n.selectedMeasurementLineGroup),n.selectedMeasurementLineGroup.isWaitingForSecondLinePoint=!1}else THREE.Util.disposeObject3D(n.selectedMeasurementLineGroup),n.selectedMeasurementLineGroup=A(t,e.point),n.selectedMeasurementLineGroup.isWaitingForSecondLinePoint=!0;else if(n.measureType===l_);else if(n.measureType===a_){THREE.Util.disposeObject3D(n.selectedMeasurementPointGroup);var o=C(e.point,t);t.add(o),n.selectedMeasurementPointGroup=o}}(t.parent,e),n.selectedCubeGroup&&(E(n.selectedCubeGroup,!1),n.selectedCubeGroup=null)},EventListener.get(d).enabled=!1,function(t,e){t.measurementScale={width:1,height:1};var n=t.wall,r=t.getObjectByName("mesh").geometry.vertices;if(n.MeasurementWidth&&0!==n.MeasurementWidth){var o=r[0].clone().distanceTo(r[3])/AppParams.unitPerMetre*1e3,i=n.MeasurementWidth/o;Math.abs(1-i)<.1&&(t.measurementScale.width=i)}if(e.MeasurementHeight&&0!==e.MeasurementHeight){var a=r[0].clone().distanceTo(r[1])/AppParams.unitPerMetre*1e3,s=e.MeasurementHeight/a;Math.abs(1-s)<.1&&(t.measurementScale.height=s)}}(c,e),c}(t,r))})),n.setLayer(Layer.PanoramaManager)}e.visible=!0,n.currentHotSpot=t,n.measurementGroup=e},this.endMeasure=function(){n.measurementGroup&&(n.measurementGroup.visible=!1),n.currentHotSpot=null,L(),function(){n.selectedMeasurementWall&&(n.selectedMeasurementWall.getObjectByName("mesh").material.opacity=0,n.selectedMeasurementWall.getObjectByName("textSpriteGroup").visible=!1,n.selectedMeasurementWall=null);$(DomElements.measureWallButton).hide()}()},this.updateOtherModels=function(t){n.panoramaManager.stopPanoramaAutoPlay(),function(){for(var t in n.panoramaManager.hotSpotGroups){var e=HouseModel.isAdditionalHotSpot(n.houseData,t),r=n.panoramaManager.hotSpotGroups[t].getObjectByName("hotSpotAnimation");if(e&&r){var o=r.getObjectByName("hotSpotAnimationSprite"),i=ResourcesLoader.loadResource(Resources.path.hotSpotCircularAnimation);o.material.map=i,r.animation.updateAtlas(i)}}}(),function(){for(var t in n.panoramaManager.hotSpotGroups){var e=n.panoramaManager.hotSpotGroups[t],r=e.hotSpotData,o=r.Position.y-n.houseData.CameraHeight;e.position.set(r.Position.x,o,-r.Position.z),n.panoramaManager.projectOnScreen(e)}}(),this.getApp().removeObject(t),PanoramaParams.minFov=20,PanoramaParams.maxFov=110},this.registerKeyboardEvent=function(){var t=1;document.onkeydown=function(e){if(e.preventDefault(),e.stopPropagation(),38===e.keyCode||40===e.keyCode){var r=.001*AppParams.unitPerMetre*t;if(t<20&&(t+=.5),n.selectedCubeGroup){var o;o=38===e.keyCode?n.selectedCubeGroup.normal.clone().multiplyScalar(-r):n.selectedCubeGroup.normal.clone().multiplyScalar(r);var i=n.selectedCubeGroup.getObjectByName("gizmoGroup");S(n.selectedCubeGroup,i,o)}}},document.onkeyup=function(e){n.panoramaManager.object3D.visible&&(27===e.keyCode?n.selectedMeasurementLineGroup&&n.selectedMeasurementLineGroup.isWaitingForSecondLinePoint&&H():32===e.keyCode?y():9===e.keyCode?g():68===e.keyCode?v():77===e.keyCode?m():67===e.keyCode?w():76===e.keyCode?n.isMeasuring&&n.measureType!==s_&&B():80===e.keyCode?n.isMeasuring&&n.measureType!==a_&&(F(),N()):46===e.keyCode?b():38!==e.keyCode&&40!==e.keyCode||(t=1))}}};u_.prototype.init=function(t,e,n){this.houseData=t,this.renderer=this.getRenderer(),this.panoramaManager=e,this.selectedOpacity=.3,this.hoverOpacity=.1,this.measurementGroup=null,this.selectedMeasurementWall=null,this.isShowMeasurementGrid=!1,this.isMeasuring=!1,this.measureType=a_,this.currentHotSpot=null,this.measurementGroups=[],this.measurementPoints=[],this.selectedMeasurementLineGroup=null,this.selectedMeasurementPointGroup=null,this.selectedMeasurementDegreeGroup=null,this.selectedCubeGroup=null,this.showMeasurementGrid(!0),this.updateOtherModels(n),this.registerKeyboardEvent()},u_.prototype.update=function(){};var c_=function t(){Kf(this,t)};em(c_,"panorama","panorama"),em(c_,"floorPlan2D","floorPlan2D"),em(c_,"floorPlan3D","floorPlan3D"),em(c_,"vr","vr");var h_=function(t){im(p,t);var e,n,r,o,i,a,s,l,u,c,h=cm(p);function p(t,e){var n;Kf(this,p),em(lm(n=h.call(this,t)),"loadRulerManager",(function(t,e,n){this.rulerManager=new vx(t,this.panoramaManager.orthographicLayer,n.rulerManager?n.rulerManager.enabled:e,this.isDecoView,this.panoramaManager.camera),this.isDecoView&&this.rulerManager.setBaseAppHeightTextGet(n.rulerManager.getHeightText),this.addObject(this.rulerManager),this.panoramaManager.panoramaImageLoader.signals.panoramaImageLoaded.add(this.rulerManager.setCurrentHotSpot),this.panoramaManager.signals.onCameraUpdated.add(this.rulerManager.detectMarkPoint)})),Object.bindFunctions(lm(n)),zS.ResourcesLoader.noCache=aw.noCache,aw.anisotropy=n.anisotropy,zS.EventListener.listen(n.renderer.domElement,t.mainContainer),n.currentHotSpot=void 0,n.currentFloor=void 0,n.mouseInHotSpot=!1,n.walkingAnimation=uw.walkingAnimation&&n.createWalking3D(),n.sceneMode=c_.panorama,n.signals={onTriggerOperation:new sE,onPanoramaCameraUpdated:new sE,onStereoHouseCameraUpdated:new sE,onFloorPlanCameraUpdated:new sE,onViewChanged:new sE},n.initCallbacksConfig(t);var r=function(t){n.hoverAnchor&&n.enableAnchorClick(!0),mx.setActiveApp(lm(n)),mx.startSynzer(t)},o=function(){n.hoverAnchor&&n.enableAnchorClick(!1),mx.pauseSynzer(),mx.startSynzer(60)};return isPhone?(n.renderer.domElement.addEventListener("touchstart",r.bind(lm(n))),n.renderer.domElement.addEventListener("touchend",o.bind(lm(n)))):(n.renderer.domElement.addEventListener("mousedown",r.bind(lm(n))),n.renderer.domElement.addEventListener("mouseup",o.bind(lm(n))),n.renderer.domElement.addEventListener("wheel",r.bind(lm(n),1))),n.initData(t,e),n}return tm(p,[{key:"enableAnchorClick",value:function(t){this.anchorManager.enableClick=t,mx.broadAnother(this,"enableAnchorClick",!1)}},{key:"setAnchorHover",value:function(t){this.hoverAnchor=t,mx.broadAnother(this,"setAnchorHover",t)}},{key:"initData",value:(c=$f(regeneratorRuntime.mark((function t(e,n){var r,o,i,a,s,l,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.isDecoView=!!e.isDecoView,r=window.appConfig&&window.appConfig.hotSpotsDisplayInDeco,this.isDecoView&&r&&(o=JSON.parse(g_.viewerInitConfig.viewData),i="object"===qf(e.viewData)?e.viewData:JSON.parse(e.viewData),a=[],s=[],o.Floors.forEach((function(t){var e=i.Floors.find((function(e){return e.ID===t.ID})),n=[];t.Rooms.forEach((function(r){var a=i.Floors.find((function(e){return e.ID===t.ID})).Rooms.find((function(t){return t.ID===r.ID}));if(a){var l=[];r.HotSpotIds.length>0&&r.HotSpotIds.forEach((function(t){l.push(o.HotSpots.find((function(e){return e.ID===t})).Name)})),l.length>0&&a.HotSpotIds.slice().forEach((function(t){var e=i.HotSpots.find((function(e){return e.ID===t}));e&&l.indexOf(e.Name)<0&&(s=s.concat(a.HotSpotIds.splice(a.HotSpotIds.indexOf(t),1)))}))}else{var u=JSON.parse(JSON.stringify(r));u.RoomFaces=[],u.RoomHeight=JSON.parse(JSON.stringify(e.Rooms[0].RoomFaces[0])).Height,u.PushedRoom=!0,n.push(u)}})),n.length>0&&a.push({ID:t.ID,Rooms:n})})),a.length>0&&a.forEach((function(t){t.Rooms.forEach((function(e){i.Floors.find((function(e){return e.ID===t.ID})).Rooms.find((function(t){return t.HotSpotIds.indexOf(e.HotSpotIds[0])>-1}))||(i.Floors.find((function(e){return e.ID===t.ID})).Rooms.push(e),e.HotSpotIds.forEach((function(t){var e=s.findIndex((function(e){return e===t}));-1!==e&&s.splice(e,1)})))}))})),s.length>0&&s.forEach((function(t){o.Floors.forEach((function(e){e.Rooms.forEach((function(n){if(n.HotSpotIds.includes(t)){var r=i.Floors.find((function(t){return t.ID===e.ID})).Rooms.find((function(t){return t.ID===n.ID}));r&&!r.HotSpotIds.includes(t)&&r.HotSpotIds.push(t)}}))}))})),i.HotSpots.forEach((function(t){var e=o.HotSpots.find((function(e){return e.ID===t.ID}));e&&(t.VisibleHotSpotIds=e.VisibleHotSpotIds.slice())})),window.appConfig&&window.appConfig.hotSpotsDisplayInDeco3D&&i.HotSpots.forEach((function(t){var e=o.HotSpots.find((function(e){return e.ID===t.ID}));t.isAdditionalHotSpot=g_.app.viewData.isAdditionalHotSpot(e)})),e.viewData=JSON.stringify(i)),this.viewData=DE.fromJson(e.viewData),window.localStorage&&this.viewData.MosaicDataTimeStamp&&localStorage["mosaicUpdateTimeStamp"+e.houseId]!=this.viewData.MosaicDataTimeStamp&&(zS.ResourcesLoader.noCache=!0,window.localStorage.setItem("mosaicUpdateTimeStamp"+e.houseId,this.viewData.MosaicDataTimeStamp)),this.viewData.ID=e.houseId,this.viewData=this.convertViewDataLang(this.viewData),e.editorData&&this.viewData.mergeEditorData(e.editorData),this.viewData.addHousePathPrefix(e.housePathPrefix),this.housePathPrefix=e.housePathPrefix,!(window.appConfig&&window.appConfig.calcVisibleHotSpots)||r&&this.isDecoView||this.viewData.calcVisibleHotSpots(),this.viewData.isSingleMode=e.isSingleMode,this.id=iw.UUID8Bit(),this.isInSceneSwitch=!1,hw.logoOpacity=e.logoOpacity?iw.getUrlParameter("logoOpacity")||e.logoOpacity:iw.getUrlParameter("logoOpacity")||(window.appConfig&&window.appConfig.hasOwnProperty("panoramaLogoOpacity")?window.appConfig.panoramaLogoOpacity:1),this.viewData.isSingleMode&&(e.is3DViewAtStart=!1),this.loadAppResources(this.viewData,e,function(){this.viewData.isSingleView||(mx.setActiveApp(g_.app),mx.startSynzer(60));try{n&&n(this.viewData,this)}catch(t){console.log(t.stack)}this.viewData.isSingleMode||this.viewData.isSingleView||this.stereoHouseManager.loadHouseModel()}.bind(this)),e.anotherHotSpot=null,this.isDecoView?(l=g_.app,e.smallView.defaultManager=l.floorPlanManager.object3D.visible?"2D":"3D",u=l.getCurrentHotSpotId(),this.viewData.getDefaultHotSpotId()!==u&&(e.anotherHotSpot=this.viewData.getHotSpotById(u))):g_.app=this,this.loadManagers(e),this.onWindowResize();case 22:case"end":return t.stop()}}),t,this)}))),function(t,e){return c.apply(this,arguments)})},{key:"suspend",value:function(){zS.EventListener.remove(this.renderer.domElement),this.panoramaManager&&this.panoramaManager.enablePanoramaControls(!1),this.stereoHouseManager&&this.stereoHouseManager.enableSmallViewAutoRotate(!1),this.autoWalkManager&&this.autoWalkManager.isAutoWalk&&(this.autoWalkManager.stopAutoWalk(),this.isAutoWalkTempState=!0),this.scene.visible=!1,this.needsUpdate=!1,mx.pauseSynzer()}},{key:"resume",value:function(){this.needsUpdate=!0,this.scene.visible=!0,this.autoWalkManager&&this.isAutoWalkTempState&&(this.autoWalkManager.startAutoWalk(),this.isAutoWalkTempState=!1),this.panoramaManager&&this.panoramaManager.enablePanoramaControls(!0),zS.EventListener.listen(this.renderer.domElement)}},{key:"enlargeFov",value:function(){this.panoramaManager&&this.panoramaManager.enablePanoramaControls(!0)}},{key:"onWindowResize",value:function(){var t=this;this.ignoreHotSpotNamesDisable=!this.isDecoView&&this.screenWidth>.9*window.innerWidth&&this.screenHeight>.9*window.innerHeight&&!this.ignoreHotSpotNamesEnable,this.ignoreHotSpotNamesDisable?(this.panoramaManager.cancelHideHotSpotsByIDs(this.ignoreHotSpotIDs),!this.viewData.isSingleView&&this.floorPlanManager.cancelHideHotSpotsByIDs(this.ignoreHotSpotIDs),!this.viewData.isSingleView&&this.stereoHouseManager.stereoFloors.forEach((function(e){return e.cancelHideHotSpotsByIDs(t.ignoreHotSpotIDs)}))):(mx.filterHotSpotByNames(),this.panoramaManager.hideHotSpotsByIDs(this.ignoreHotSpotIDs),!this.viewData.isSingleView&&this.floorPlanManager.hideHotSpotsByIDs(this.ignoreHotSpotIDs),!this.viewData.isSingleView&&this.stereoHouseManager.stereoFloors.forEach((function(e){return e.hideHotSpotsByIDs(t.ignoreHotSpotIDs)}))),this.renderer.setSize(this.screenWidth,this.screenHeight),this.waterMarkerManager&&this.waterMarkerManager.onWindowResize(this.screenWidth,this.screenHeight)}},{key:"update",value:function(){this.waterMarkerManager&&this.waterMarkerManager.update(this.renderer),this.mosaicSprite&&(this.renderer.setViewport(this.mosaicScene.viewPort.left,this.mosaicScene.viewPort.top,this.mosaicScene.viewPort.width,this.mosaicScene.viewPort.height),this.renderer.render(this.mosaicScene,this.mosaicCamera))}},{key:"triggerOperation",value:function(t,e){this.signals.onTriggerOperation.dispatch(t,e)}},{key:"executeFunction",value:function(t,e){if(this.hasOwnProperty(t)){"updateCurrentHotSpot"===t||"switch2DToPanorama"===t?"object"!==qf(e)&&(e=this.viewData.getHotSpotById(e)):"switch3DToPanorama"!==t&&"switchPanorama"!==t||"object"!==qf(e)&&(e=new fw(this.viewData.getHotSpotById(e))),e=e?[e,!1]:[!1],p.prototype[t].apply(this,e)}}},{key:"switch2DTo3D",value:(u=$f(regeneratorRuntime.mark((function t(){var e,n=this,r=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=!(r.length>0&&void 0!==r[0])||r[0],!this.isInSceneSwitch){t.next=3;break}return t.abrupt("return");case 3:return this.switch2DTo3DCallback("animationBegin"),mx.broadAnother(this,"switch2DTo3D"),e&&this.triggerOperation("switch2DTo3D"),this.sceneMode=c_.floorPlan3D,this.floorPlanManager.hide(),uw.isLargeViewAutoRotate&&this.stereoHouseManager.startLargeViewAutoRotateTimer(),window.appConfig.display3DUnder2D&&this.stereoHouseManager.setOpacity(1),this.signals.onViewChanged.dispatch("3D"),t.abrupt("return",new Promise((function(t){n.stereoHouseManager.flyIn(n.floorPlanManager.camera,(function(){n.stereoHouseManager.orbitControls.enabled=!0,n.isInSceneSwitch=!1,n.switch2DTo3DCallback("animationEnd"),t()}))})));case 12:case"end":return t.stop()}}),t,this)}))),function(){return u.apply(this,arguments)})},{key:"switch3DTo2D",value:(l=$f(regeneratorRuntime.mark((function t(){var e,n=this,r=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=!(r.length>0&&void 0!==r[0])||r[0],!this.isInSceneSwitch){t.next=3;break}return t.abrupt("return");case 3:return this.switch3DTo2DCallback("animationBegin"),mx.broadAnother(this,"switch3DTo2D"),e&&this.triggerOperation("switch3DTo2D"),this.sceneMode=c_.floorPlan2D,this.signals.onViewChanged.dispatch("2D"),t.abrupt("return",new Promise((function(t){n.stereoHouseManager.flyOut(n.floorPlanManager.camera,(function(){if(n.stereoHouseManager.orbitControls.enabled=!1,window.appConfig.display3DUnder2D)if(n.stereoHouseManager.largeViewAutoRotateTimeout&&(clearTimeout(n.stereoHouseManager.largeViewAutoRotateTimeout),n.stereoHouseManager.largeViewAutoRotateTimeout=null),n.stereoHouseManager.hotSpotAutoRotateShowTimeout&&(clearTimeout(n.stereoHouseManager.hotSpotAutoRotateShowTimeout),n.stereoHouseManager.hotSpotAutoRotateShowTimeout=null),n.stereoHouseManager.hotSpotShowInterval&&(clearInterval(n.stereoHouseManager.hotSpotShowInterval),n.stereoHouseManager.hotSpotShowInterval=null),n.stereoHouseManager.setOpacity(.9),n.stereoHouseManager.activeFloorID&&-1!==n.stereoHouseManager.activeFloorID)n.stereoHouseManager.highlightFloorByFloorID(n.stereoHouseManager.activeFloorID,n.sceneMode);else{var e=n.viewData.getDefaultFloor();n.stereoHouseManager.highlightFloorByFloorID(e.ID,n.sceneMode)}n.floorPlanManager.resetCameraPositionAndZoom(),n.floorPlanManager.setLargeView(),n.isInSceneSwitch=!1,n.switch3DTo2DCallback("animationEnd"),t()}))})));case 9:case"end":return t.stop()}}),t,this)}))),function(){return l.apply(this,arguments)})},{key:"switchPanoramaTo2D",value:(s=$f(regeneratorRuntime.mark((function t(){var e,n=this,r=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=!(r.length>0&&void 0!==r[0])||r[0],!this.isInSceneSwitch){t.next=3;break}return t.abrupt("return");case 3:return this.autoWalkManager&&this.autoWalkManager.isAutoWalk&&this.autoWalkManager.stopAutoWalk(),this.switchPanoramaTo2DCallback("animationBegin"),mx.broadAnother(this,"switchPanoramaTo2D"),e&&this.triggerOperation("switchPanoramaTo2D"),g_.pauseAnchorAudio(),this.stereoHouseManager.smallViewBackGroundSprite&&(this.stereoHouseManager.smallViewBackGroundSprite.visible=!1),this.stereoHouseManager.camera.zoom=1,this.sceneMode=c_.floorPlan2D,this.signals.onViewChanged.dispatch("2D"),t.abrupt("return",new Promise((function(t){n.stereoHouseAnimation.playPanoramaTo2D((function(){if(n.floorPlanManager.resetCameraPositionAndZoom(),window.appConfig.display3DUnder2D)if(n.stereoHouseManager.setOpacity(.9),n.stereoHouseManager.show(),n.stereoHouseManager.activeFloorID&&-1!==n.stereoHouseManager.activeFloorID)n.stereoHouseManager.highlightFloorByFloorID(n.stereoHouseManager.activeFloorID,n.sceneMode);else{var e=n.viewData.getDefaultFloor();n.stereoHouseManager.highlightFloorByFloorID(e.ID,n.sceneMode)}n.floorPlanManager.setLargeView(),n.panoramaManager.hide(),n.floorPlanManager.resetCameraPositionAndZoom(),n.floorPlanManager.sectorSprite.scale.set(100,100,1),n.isInSceneSwitch=!1,n.switchPanoramaTo2DCallback("animationEnd"),t()}))})));case 13:case"end":return t.stop()}}),t,this)}))),function(){return s.apply(this,arguments)})},{key:"switchPanoramaTo3D",value:(a=$f(regeneratorRuntime.mark((function t(){var e,n=this,r=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=!(r.length>0&&void 0!==r[0])||r[0],!this.isInSceneSwitch){t.next=3;break}return t.abrupt("return");case 3:return this.isInSceneSwitch=!0,this.autoWalkManager&&this.autoWalkManager.isAutoWalk&&this.autoWalkManager.stopAutoWalk(),this.switchPanoramaTo3DCallback("animationBegin"),mx.broadAnother(this,"switchPanoramaTo3D"),e&&this.triggerOperation("switchPanoramaTo3D"),g_.pauseAnchorAudio(),this.sceneMode=c_.floorPlan3D,this.floorPlanManager.hide(),this.panoramaManager.hide(),uw.isLargeViewAutoRotate&&this.stereoHouseManager.startLargeViewAutoRotateTimer(),window.appConfig.display3DUnder2D&&this.stereoHouseManager.setOpacity(1),this.signals.onViewChanged.dispatch("3D"),t.abrupt("return",new Promise((function(t){n.stereoHouseManager.flyIn(n.panoramaManager.camera,(function(){n.panoramaManager.hide(),n.sceneMode=c_.floorPlan3D,n.switchPanoramaTo3DCallback("animationEnd"),n.isInSceneSwitch=!1,null!==n.stereoHouseManager.activeFloorID&&n.changeFloor(n.stereoHouseManager.activeFloorID,!1),t()}))})));case 16:case"end":return t.stop()}}),t,this)}))),function(){return a.apply(this,arguments)})},{key:"switch2DToPanorama",value:(i=$f(regeneratorRuntime.mark((function t(e){var n,r,o,i,a,s,l,u,c,h,p,d=this,f=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=!(f.length>1&&void 0!==f[1])||f[1],e.IsDecorating?(o=this.handleImagePath(e.TileImagesPath),i=this.handleImagePath(e.BlurTileImagesPath),r=om(om({},e),{},{TileImagesPath:o,BlurTileImagesPath:i})):r=e,a=new fw(r),this.sceneMode!==c_.panorama||this.panoramaManager.panoramaImageLoader.currentHotSpot.ID!==a.hotSpotData.ID){t.next=5;break}return t.abrupt("return");case 5:if(!this.isInSceneSwitch){t.next=7;break}return t.abrupt("return");case 7:return this.isInSceneSwitch=!0,"object"===qf(a)&&(a=Vw.fromJson(a,fw)),a=a.clone(this.viewData.getHotSpotById(a.hotSpotData.ID),!1),this.isDecoView&&a.hotSpotData.IsDecorating&&(s=a.hotSpotData,l=this.handleImagePath(a.hotSpotData.TileImagesPath),u=this.handleImagePath(a.hotSpotData.BlurTileImagesPath),c=om(om({},s),{},{TileImagesPath:l,BlurTileImagesPath:u}),h=HouseViewer.BaseAPI.app.viewData.getHotSpotById(c.ID),c.Rotation.y=h.Rotation.y,a=a.clone(c)),a.isCameraWalk=!1,mx.broadAnother(this,"switch2DToPanorama",a.hotSpotData),n&&this.triggerOperation("switch2DToPanorama",a.hotSpotData.ID),this.stereoHouseManager.compassManager.hide(),p=a.hotSpotData,this.floorPlanManager.updateCameraViewByHotSpot(p),t.abrupt("return",new Promise((function(t){a.onPanoramaImageLoaded=function(){d.videoManager&&d.videoManager.setAllVideoInvisible(),d.switch2DToPanoramaCallback("animationBegin",p.ID),d.panoramaManager.setCameraFov(hw.defaultFov),d.stereoHouseAnimation.play2DToPanorama(p.Position,(function(){d.sceneMode=c_.panorama,d.stereoHouseManager.setSmallView(),d.stereoHouseManager.camera.zoom=1e-4,d.floorPlanManager.show();var e=setTimeout((function(){d.floorPlanManager.setSmallView(),clearTimeout(e)}),0);d.panoramaManager.show(p),d.smallViewPanelManager.show(),a.showBestCameraView&&d.panoramaManager.setBestCameraView(a.hotSpotData),d.switch2DToPanoramaCallback("animationEnd",p.ID),d.isInSceneSwitch=!1,d.isCompare()&&!d.isDecoView||d.videoManager&&d.videoManager.initVideo(a.hotSpotData.ID),t()}))},d.panoramaManager.panoramaImageLoader.loadPanoramaImage(a)})));case 18:case"end":return t.stop()}}),t,this)}))),function(t){return i.apply(this,arguments)})},{key:"switch3DToPanorama",value:(o=$f(regeneratorRuntime.mark((function t(e){var n,r,o,i,a,s,l,u,c,h,p,d=this,f=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=!(f.length>1&&void 0!==f[1])||f[1],(o=this.viewData.getHotSpotById(e.hotSpotData.ID)).IsDecorating?(a=this.handleImagePath(o.TileImagesPath),s=this.handleImagePath(o.BlurTileImagesPath),i=om(om({},o),{},{TileImagesPath:a,BlurTileImagesPath:s})):i=o,r=new fw(i),this.sceneMode!==c_.panorama||this.panoramaManager.panoramaImageLoader.currentHotSpot.ID!==r.hotSpotData.ID){t.next=6;break}return t.abrupt("return");case 6:if(!this.isInSceneSwitch){t.next=8;break}return t.abrupt("return");case 8:return this.isInSceneSwitch=!0,"object"===qf(r)&&(r=Vw.fromJson(r,fw)),r=r.clone(this.viewData.getHotSpotById(r.hotSpotData.ID),!1),this.isDecoView&&r.hotSpotData.IsDecorating&&(l=r.hotSpotData,u=this.handleImagePath(r.hotSpotData.TileImagesPath),c=this.handleImagePath(r.hotSpotData.BlurTileImagesPath),h=om(om({},l),{},{TileImagesPath:u,BlurTileImagesPath:c}),p=HouseViewer.BaseAPI.app.viewData.getHotSpotById(h.ID),h.Rotation.y=p.Rotation.y,r=r.clone(h)),mx.broadAnother(this,"switch3DToPanorama",r),n&&this.triggerOperation("switch3DToPanorama",r.hotSpotData.ID),this.stereoHouseManager.compassManager.hide(),this.floorPlanManager.updateCameraViewByHotSpot(o),t.abrupt("return",new Promise((function(t){r.onPanoramaImageLoaded=function(){d.videoManager&&d.videoManager.setAllVideoInvisible(),d.switch3DToPanoramaCallback("animationBegin",o.ID),d.panoramaManager.panoramaImageLoader.onPanoramaImageLoaded=null,d.panoramaManager.setCameraFov(hw.defaultFov),d.stereoHouseAnimation.play3DToPanorama(r.hotSpotData.Position,(function(){d.sceneMode=c_.panorama,d.stereoHouseManager.setSmallView(),d.stereoHouseManager.show(),d.smallViewPanelManager.show(),d.panoramaManager.updateCameraRotation(new THREE.Vector3(0,d.stereoHouseManager.camera.rotation.y,0)),r.showBestCameraView&&d.panoramaManager.setBestCameraView(r.hotSpotData),d.switch3DToPanoramaCallback("animationEnd",o.ID),d.isInSceneSwitch=!1,d.isCompare()&&!d.isDecoView||d.videoManager&&d.videoManager.initVideo(r.hotSpotData.ID),o.blurCubeTexture&&o.cubeTexture&&d.panoramaManager.panoramaImageLoader.switchFromBlurToHighQualityTextures(d.panoramaManager.panoramaImageLoader.panoramaCubeCurrent,d.panoramaManager.panoramaImageLoader.panoramaCubeHD,o.cubeTexture,o),t()}),o)},d.panoramaManager.panoramaImageLoader.loadPanoramaImage(r)})));case 17:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)})},{key:"switchPanorama",value:(r=$f(regeneratorRuntime.mark((function t(e){var n,r,o,i,a,s,l,u=this,c=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=!(c.length>1&&void 0!==c[1])||c[1],r=c.length>2?c[2]:void 0,!this.isInSceneSwitch){t.next=5;break}return console.log("in scene switching"),t.abrupt("return");case 5:return this.panoramaManager.signals.onHotSpotChanged.dispatch(e),r&&(e.isPlayFadeAnimation=!0),e.isCameraWalk=!0,this.isInSceneSwitch=!0,g_.pauseAnchorAudio(),this.updateCurrentHotSpot(e.hotSpotData,!1),!hw.panoramaMouseEnabled||window.appConfig.isOutScene||this.viewData.isSingleView||(this.stereoHouseManager.stereoFloors.forEach((function(t){t.enableFloorMouseMoveEvents(!1)})),this.panoramaManager.panoramaMouse&&this.panoramaManager.panoramaMouse.setVisible(!1)),"object"===qf(e)&&(e=Vw.fromJson(e,fw)),e=e.clone(this.viewData.getHotSpotById(e.hotSpotData.ID),!1),!1===n&&(e.isCameraWalk=!0),this.isDecoView&&e.hotSpotData.IsDecorating&&(o=e.hotSpotData,i=this.handleImagePath(e.hotSpotData.TileImagesPath),a=this.handleImagePath(e.hotSpotData.BlurTileImagesPath),s=om(om({},o),{},{TileImagesPath:i,BlurTileImagesPath:a}),l=HouseViewer.BaseAPI.app.viewData.getHotSpotById(s.ID),s.Rotation.y=l.Rotation.y,e=e.clone(s)),mx.broadAnother(this,"switchPanorama",e),n&&this.triggerOperation("switchPanorama",e.hotSpotData.ID),this.panoramaManager.enablePanoramaControls(!1),this.viewData.isSingleMode||this.viewData.isSingleView||(this.floorPlanManager.sectorSprite.scale.set(160,160,1),this.stereoHouseManager.setSmallView()),this.videoManager&&this.videoManager.setAllVideoInvisible(),this.switchPanoramaCallback("animationBegin",e.hotSpotData.ID),t.abrupt("return",new Promise((function(t){e.onAnimationFinished=function(){u.panoramaManager.enablePanoramaControls(!0),e.showBestCameraView&&u.panoramaManager.setBestCameraView(e.hotSpotData),u.switchPanoramaCallback("animationEnd",e.hotSpotData.ID),u.isCompare()&&!u.isDecoView||u.videoManager&&u.videoManager.initVideo(e.hotSpotData.ID),u.isInSceneSwitch=!1,u.panoramaFurniture.switchFurnitureAnchors(u.viewData.getRoomByHotSpotId(e.hotSpotData.ID)),u.updateCurrentHotSpot(e.hotSpotData,!1),!hw.panoramaMouseEnabled||window.appConfig.isOutScene||u.viewData.isSingleView||(u.stereoHouseManager.stereoFloors.forEach((function(t){t.enableFloorMouseMoveEvents(!1)})),u.stereoHouseManager.currentStereoFloor?u.stereoHouseManager.currentStereoFloor.enableFloorMouseMoveEvents(!0):u.stereoHouseManager.stereoFloors[0].enableFloorMouseMoveEvents(!0),u.panoramaManager.panoramaMouse&&u.panoramaManager.panoramaMouse.setVisible(!0)),t()},u.panoramaManager.panoramaImageLoader.loadPanoramaImage(e)})));case 23:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})},{key:"isCompare",value:function(){return window.innerWidth/this.renderer.domElement.viewPort.width==2}},{key:"toggleVR",value:function(t){t?this.floorPlanManager.object3D.setVisible(!1):this.floorPlanManager.object3D.setVisible(!0),this.anchorManager&&this.anchorManager.enterVrMode(t),this.vrManager.enable(t,lw.fov),this.panoramaManager.enablePanoramaControls(!t),t||this.panoramaManager.updateCameraRotation(new THREE.Vector3(0,this.panoramaManager.camera.rotation.y,0))}},{key:"onThumbnailClick",value:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3?arguments[3]:void 0,o=this.viewData.getHotSpotById(t),i=new fw(o);i.isCameraWalk=!0,i.showBestCameraView=e,this.switchToPanoramaView(i,n).then((function(){r&&r()}));var a=this.viewData.Floors.find((function(e){return e.Rooms.find((function(e){return e.HotSpotIds.indexOf(t)>-1}))}));a&&this.changeFloor(a.ID)}},{key:"onExplorationThumbnailClick",value:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3?arguments[3]:void 0,o=this.viewData.getHotSpotById(t.ID),i=new fw(o);i.isCameraWalk=!0,i.showBestCameraView=e,i.checkID=t.checkID,i.fade=!0,this.switchToPanoramaViewExploration(i,n).then(r);var a=this.viewData.Floors.find((function(e){return e.Rooms.find((function(e){return e.HotSpotIds.indexOf(t.ID)>-1}))}));this.changeFloor(a.ID)}},{key:"onExplorationClickRemainedHotSpot",value:function(){var t=0,e=document.getElementById("vr_house_container").children[0],n=setInterval((function(){var r=1;r=t<.4?1-t/.4:t>.7?(t-.7)/(1-.7):0,t>=1?(e.style.removeProperty("opacity"),clearInterval(n),e=null):e.style.opacity=""+r,t+=.04}),25)}},{key:"loadDecoratedImage",value:function(t){var e=om(om({},this.viewData.getHotSpotById(t)),{},{IsDecorating:!1}),n=HouseViewer.BaseAPI.app.viewData.getHotSpotById(t);e.Rotation.y=n.Rotation.y;var r=new fw(e);r.isUpdate=!0,r.isCameraWalk=!0,this.panoramaManager.panoramaImageLoader.loadPanoramaImage(r)}},{key:"loadPanoramaImage",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];"object"===qf(t)&&(t=Vw.fromJson(t,fw)),t=t.clone(this.viewData.getHotSpotById(t.hotSpotData.ID),!1),this.panoramaManager.panoramaImageLoader.loadPanoramaImage(t),mx.broadAnother(this,"loadPanoramaImage",t),e&&this.triggerOperation("loadPanoramaImage",t)}},{key:"switchToPanoramaView",value:(n=$f(regeneratorRuntime.mark((function t(e){var n,r,o=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=!(o.length>1&&void 0!==o[1])||o[1],!this.viewData.isSingleMode&&!this.viewData.isSingleView){t.next=5;break}return t.next=4,this.switchPanorama(e);case 4:return t.abrupt("return");case 5:if((r=document.createEvent("HTMLEvents")).hotSpotId=e.hotSpotData.ID,r.checkID=!1,r.initEvent("thumbnailIndexChange",!1,!1),r.initEvent("thumbnailIndexChangeExploration",!1,!1),document.dispatchEvent(r),this.floorPlanManager.updateCameraViewByHotSpot(e.hotSpotData),this.sceneMode!==c_.floorPlan2D){t.next=17;break}return t.next=15,this.switch2DToPanorama(e.hotSpotData,n);case 15:t.next=24;break;case 17:if(this.sceneMode!==c_.floorPlan3D){t.next=22;break}return t.next=20,this.switch3DToPanorama(e,n);case 20:t.next=24;break;case 22:return t.next=24,this.switchPanorama(e,n);case 24:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"switchToPanoramaViewExploration",value:(e=$f(regeneratorRuntime.mark((function t(e){var n,r,o=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=!(o.length>1&&void 0!==o[1])||o[1],!this.viewData.isSingleMode){t.next=5;break}return t.next=4,this.switchPanorama(e);case 4:return t.abrupt("return");case 5:if((r=document.createEvent("HTMLEvents")).hotSpotId=e.hotSpotData.ID,r.checkID=e.checkID,r.initEvent("thumbnailIndexChange",!1,!1),r.initEvent("thumbnailIndexChangeExploration",!1,!1),document.dispatchEvent(r),this.floorPlanManager.updateCameraViewByHotSpot(e.hotSpotData),this.sceneMode!==c_.floorPlan2D){t.next=17;break}return t.next=15,this.switch2DToPanorama(e,n);case 15:t.next=24;break;case 17:if(this.sceneMode!==c_.floorPlan3D){t.next=22;break}return t.next=20,this.switch3DToPanorama(e,n);case 20:t.next=24;break;case 22:return t.next=24,this.switchPanorama(e,n,!0);case 24:g_.app.panoramaManager.enablePanoramaControls(!1),g_.app.panoramaManager.hideAllHotSpotGroups();case 26:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"enableLargeViewAutoRotate",value:function(t){c_.floorPlan3D===this.sceneMode&&(this.stereoHouseManager.orbitControls.autoRotate=t,uw.animateStereoHotSpot&&!this.stereoHouseManager.stereoFloors[0].inAllFloors&&(clearTimeout(this.stereoHouseManager.hotSpotAutoRotateShowTimeout),clearInterval(this.stereoHouseManager.hotSpotShowInterval),this.stereoHouseManager.updateAutoRotateHotSpots()))}},{key:"onLargeViewWindowPressed",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(c_.floorPlan3D===this.sceneMode){if(this.stereoHouseManager.isSmallView)return;if(this.stereoHouseManager.stereoFloors[0].inAllFloors)return;clearTimeout(this.stereoHouseManager.largeViewAutoRotateTimeout),this.stereoHouseManager.orbitControls.autoRotate=!1,clearTimeout(this.stereoHouseManager.hotSpotAutoRotateShowTimeout),clearInterval(this.stereoHouseManager.hotSpotShowInterval),this.stereoHouseManager.currentStereoFloor&&this.stereoHouseManager.currentStereoFloor.showHotSpots(!1,this.stereoHouseManager.camera,this.stereoHouseManager.currentStereoFloor),t&&this.triggerOperation("onLargeViewWindowPressed")}}},{key:"onLargeViewWindowReleased",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(c_.floorPlan3D===this.sceneMode){if(this.stereoHouseManager.isSmallView)return;this.stereoHouseManager.orbitControls.autoRotate=!1,!this.stereoHouseManager.stereoFloors[0].inAllFloors&&this.stereoHouseManager.currentStereoFloor&&this.stereoHouseManager.currentStereoFloor.showHotSpots(!0,this.stereoHouseManager.camera,this.stereoHouseManager.currentStereoFloor),uw.isLargeViewAutoRotate&&this.stereoHouseManager.startLargeViewAutoRotateTimer(),t&&this.triggerOperation("onLargeViewWindowReleased")}}},{key:"backToPanoramaView",value:function(){var t=this.panoramaManager.panoramaImageLoader.currentHotSpot||this.viewData.getDefaultHotSpot();this.switchToPanoramaView(new fw(t)),this.signals.onViewChanged.dispatch("P")}},{key:"switchTo2DSmallView",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.floorPlanManager.isSmallView&&this.floorPlanManager.visible&&!this.stereoHouseManager.visible||(this.floorPlanManager.setSmallView(),this.floorPlanManager.show(),this.floorPlanManager.bgMask&&(this.floorPlanManager.bgMask.visible=!1),this.stereoHouseManager.camera.zoom=1e-4,mx.broadAnother(this,"switchTo2DSmallView"),t&&this.triggerOperation("switchTo2DSmallView"),this.switch3DTo2DCallback("animationBegin"))}},{key:"switchTo3DSmallView",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.stereoHouseManager.isSmallView&&this.stereoHouseManager.visible&&!this.floorPlanManager.visible||(this.floorPlanManager.hide(),this.stereoHouseManager.setSmallView(),this.stereoHouseManager.camera.zoom=1,this.stereoHouseManager.show(),mx.broadAnother(this,"switchTo3DSmallView"),t&&this.triggerOperation("switchTo3DSmallView"),this.switch2DTo3DCallback("animationBegin"))}},{key:"getCurrentHotSpotId",value:function(){return this.currentHotSpot.ID}},{key:"loadAnchorManager",value:function(t,e){var n=this;switch(e){case"bubble":this.anchorManager=new n_(t,this.panoramaManager,this.setAnchorHover);break;default:this.anchorManager=new t_(t,this.panoramaManager,this.setAnchorHover),this.anchorManager.registerAnimateListener(this.renderer.domElement)}this.addObject(this.anchorManager),setTimeout((function(){console.log(n.anchorManager)}),3e3)}},{key:"handleImagePath",value:function(t){var e=[];return t.forEach((function(t){var n=t.indexOf("_deco_");if(n>0){var r=t.indexOf("/",n),o=t.slice(0,n)+t.slice(r);e.push(o)}else e.push(t)})),e}},{key:"loadPanoramaManager",value:function(t){var e=this;this.panoramaManager=new vE,this.addObject(this.panoramaManager),this.panoramaManager.init(t,this);var n={app:this,viewData:t,object3D:this.panoramaManager.object3D,camera:this.panoramaManager.camera,drawOnScreen:this.panoramaManager.projectOnScreen};this.panoramaFurniture=new wE(n),this.panoramaManager.onHotSpotClick=function(t){if(e.ignoreHotSpotNamesDisable||!e.ignoreHotSpotIDs||!e.ignoreHotSpotIDs.find((function(e){return t.ID===e}))){var n=new fw(t);n.isCameraWalk=!0,e.switchToPanoramaView(n)}},this.panoramaManager.signals.onCameraUpdated.add(this.signals.onPanoramaCameraUpdated.dispatch),this.panoramaManager.signals.hideMouse.add((function(){e.panoramaManager&&e.panoramaManager.panoramaMouse&&(e.mouseInHotSpot=!e.mouseInHotSpot)})),this.panoramaManager.signals.hoverHotspotCircle.add((function(t,n){e.hoverHotSpot([t,n]),mx.broadAnother(e,"hoverHotSpot",[t,n])})),this.panoramaManager.signals.onTouchOrMouseDown.add((function(){e.autoWalkManager&&e.autoWalkManager.isAutoWalk&&e.autoWalkManager.stopAutoWalk()}))}},{key:"loadStereoHouseManager",value:function(t,e){var n=this;this.stereoHouseManager=new gx(t,e);var r=t.getDefaultFloor(),o=this.stereoHouseManager.stereoFloors.find((function(t){return t.floorData.ID===r.ID}));if(o&&o.hotSpotsGroup&&o.hotSpotsGroup.children){var i=o.hotSpotsGroup.children.findIndex((function(t){var e;return(null===(e=t.hotSpotData)||void 0===e?void 0:e.ID)===n.currentHotSpot.ID}));-1!==i&&(o.hotSpotsGroup.children[i].active(),this.walkingAnimation&&!this.viewData.isAdditionalHotSpot(o.hotSpotsGroup.children[i].hotSpotData.ID)&&o.hotSpotsGroup.children[i].add(this.walkingAnimation))}this.addObject(this.stereoHouseManager),this.stereoHouseManager.signals.floorChanged.add(this.changeFloor);var a=new Ex(e,this.viewData.StandardEntranceDirection);this.stereoHouseManager.addChild(a),this.stereoHouseManager.compassManager=a,a.init(),this.panoramaManager.panoramaImageLoader.signals.panoramaImageLoaded.add(this.stereoHouseManager.onPanoramaImageLoaded),this.panoramaManager.signals.onCameraRotationChanged.add(this.stereoHouseManager.onPanoramaCameraUpdated),this.stereoHouseManager.signals.onCameraUpdated.add(this.signals.onStereoHouseCameraUpdated.dispatch);var s=function(t,e,n,r){this.stereoHouseManager.stereoFloors.forEach((function(o){if(0===t)o.panoramaRover.startSwitchPanorama(n,r);else if(1===t)o.panoramaRover.endSwitchPanorama();else{var i=1;if(e){i=t<.4?1-t/.4:t>.7?(t-.7)/(1-.7):0}o.panoramaRover.updateMaterialOpacity(t,i)}}))}.bind(this);this.panoramaManager.panoramaImageLoader.signals.switchHotSpotAnimationProgress.add(s),this.stereoHouseManager.signals.hotSpotClicked.add((function(t){n.onHotSpotClicked(t),mx.broadAnother(n,"onHotSpotClicked",t)})),this.stereoHouseManager.signals.minDistanceReached.add((function(){n.backToPanoramaView()})),uw.animateStereoHotSpot&&(this.stereoHouseManager.signals.hideHotSpots.add((function(){n.stereoHouseManager.lagPressedTimeout||(n.stereoHouseManager.lagPressedTimeout=setTimeout((function(){n.onLargeViewWindowPressed(),mx.broadAnother(n,"onLargeViewWindowPressed"),clearTimeout(n.stereoHouseManager.lagPressedTimeout),n.stereoHouseManager.lagPressedTimeout=null}),500))})),this.stereoHouseManager.signals.showHotSpots.add((function(){"2D"!==n.sceneMode&&setTimeout((function(){n.stereoHouseManager.stereoModelJustClicked||(clearTimeout(n.stereoHouseManager.lagPressedTimeout),n.stereoHouseManager.lagPressedTimeout=null,n.onLargeViewWindowReleased(),mx.broadAnother(n,"onLargeViewWindowReleased"))}),500)})))}},{key:"onHotSpotClicked",value:function(t){if(this.ignoreHotSpotNamesDisable||!this.ignoreHotSpotIDs||!this.ignoreHotSpotIDs.find((function(e){return t.ID===e}))){this.updateCurrentHotSpot(t),"floorPlan2D"===this.sceneMode?this.switch2DToPanorama(t):this.switch3DToPanorama(new fw(t));var e=this.viewData.getFloorByHotSpotId(t.ID);this.changeFloor(e.ID)}}},{key:"onAddMergedHotSpot",value:function(t){this.stereoHouseManager.currentStereoFloor.addRoomBeamAndNameSprite(t),t.isMergedRoom=!0;var e=this.panoramaManager.hotSpotManager.hotSpotGroups[t.ID];e&&(e.hotSpotNameSprite.visible=!0)}},{key:"loadSmallViewPanelManager",value:function(t){var e=null,n=null;t&&(e=t.container,n=t.content),this.smallViewPanelManager?(this.smallViewPanelManager.container=e,this.smallViewPanelManager.content=n):this.smallViewPanelManager=new wx(e,n)}},{key:"loadFloorPlanManager",value:function(t,e){var n=this,r=t.getDefaultHotSpot();this.floorPlanManager=new bE(t,r),this.addObject(this.floorPlanManager);var o=new Ex(e,this.viewData.StandardEntranceDirection);this.floorPlanManager.addChild(o),this.floorPlanManager.compassManager=o,o.init(),this.panoramaManager.panoramaImageLoader.signals.panoramaImageLoaded.add(this.floorPlanManager.setHighlightHotSpotPosition),this.panoramaManager.signals.onCameraRotationChanged.add(this.floorPlanManager.onPanoramaCameraUpdated),this.floorPlanManager.signals.onCameraUpdated.add(this.signals.onFloorPlanCameraUpdated.dispatch),this.floorPlanManager.signals.hotSpotClicked.add((function(t){n.onHotSpotClicked(t),mx.broadAnother(n,"onHotSpotClicked",t)})),this.floorPlanManager.signals.addMergedHotSpot.add((function(t){n.onAddMergedHotSpot(t),mx.broadAnother(n,"onAddMergedHotSpot",t)}))}},{key:"loadVrManager",value:function(){this.vrManager=new bx(this.panoramaManager),this.addObject(this.vrManager),this.vrManager.object3D.visible=!1,this.vrManager.onVRModeEnabled=function(t){this.panoramaManager.setTargetZoomFov(t?lw.fov:this.previousFov)}}},{key:"loadMeasurementManager",value:function(){this.measurementManager=new u_(this),this.measurementManager.init(this.houseData,this.panoramaManager,this.rulerManager),this.panoramaManager.panoramaImageLoader.signals.showHotSpots.add((function(t){t&&_this.measurementManager.startMeasure(_this.panoramaManager.panoramaImageLoader.currentHotSpot)}))}},{key:"loadAutoWalkManager",value:function(t,e){var n=this;this.autoWalkManager=new Sx(t,this),this.autoWalkManager.switchPano=function(t,e,r,o){var i=new fw(t);i.isPlayFadeAnimation=!1,i.isCameraWalk=!0;var a=n.panoramaManager.camera.rotation.clone();n.panoramaManager.camera.lookAt(e||t.Position);var s=n.panoramaManager.camera.rotation.clone(),l=THREE.Math.radToDeg(Math.abs(s.y-a.y))%360;window.appConfig.autoWalkInSequence&&(l=(l=THREE.Math.radToDeg(Math.abs(t.BestCameraView.y-o.BestCameraView.y))%360)>180?360-l:l),n.panoramaManager.camera.rotation.copy(a),l>=30?(n.isDecoView||mx.setActiveApp(n),mx.startSynzer(),n.panoramaManager.panoramaImageLoader.cameraRotateAnimation.play(n.panoramaManager.camera,a,new THREE.Vector3(0,s.y,0),(function(){mx.pauseSynzer(),(n.autoWalkManager&&n.autoWalkManager.isAutoWalk||r)&&n.switchToPanoramaView(i)}))):n.switchToPanoramaView(i)},e&&this.autoWalkManager.startAutoWalk(),this.autoWalkManager.signals.onAutoWalkStatusChanged.add((function(t){g_.callbacks.onAutoWalkStatusChanged.dispatch(t)}))}},{key:"changeFloor",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.stereoHouseManager){if(hw.panoramaMouseEnabled&&!window.appConfig.isOutScene&&this.stereoHouseManager.stereoFloors.forEach((function(t){return t.enableFloorMouseMoveEvents(!1)})),-1===t)this.stereoHouseManager.showAllFloors(this.sceneMode),hw.panoramaMouseEnabled&&!window.appConfig.isOutScene&&this.stereoHouseManager.stereoFloors[0].enableFloorMouseMoveEvents(!0);else{var n=this.viewData.getFloorById(t);if(this.floorPlanManager&&this.floorPlanManager.switchFloorPlan(n),this.stereoHouseManager.highlightFloor(n,this.sceneMode),hw.panoramaMouseEnabled&&!window.appConfig.isOutScene)for(var r=0;r<this.stereoHouseManager.stereoFloors.length;r++)if(this.stereoHouseManager.stereoFloors[r].floorData===n){this.stereoHouseManager.stereoFloors[r].enableFloorMouseMoveEvents(!0);break}uw.animateStereoHotSpot&&this.stereoHouseManager.stereoFloors.forEach((function(t){return t.inAllFloors=!1}))}mx.broadAnother(this,"changeFloor",t),e&&this.triggerOperation("changeFloor",t);try{this.changeFloorCallBack(t)}catch(t){console.info(t)}}}},{key:"changeHotSpotOnFloorChangedIfNeed",value:function(t){if(this.panoramaManager.object3D.visible&&this.panoramaManager.panoramaImageLoader.currentHotSpot&&this.viewData.getFloorByHotSpotId(this.panoramaManager.panoramaImageLoader.currentHotSpot.ID)!==t){var e=this.viewData.getDefaultHotSpotByFloor(t);if(e){var n=new fw(e);e.showBestCameraView=!0,this.switchToPanoramaView(n)}}}},{key:"updateCurrentHotSpot",value:function(t){var e,n=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.currentHotSpot&&(this.currentHotSpot=t),this.stereoHouseManager&&this.stereoHouseManager.stereoFloors.forEach((function(r){r.hotSpotsGroup.children.forEach((function(r){var o;(null===(o=r.hotSpotData)||void 0===o?void 0:o.ID)===t.ID?e=r:r instanceof IE&&(r.disActive(),r.getObjectByName("walkingAnimation")&&r.remove(n.walkingAnimation))})),n.currentFloor=r.floorData})),e&&(e.active(),this.walkingAnimation&&!this.viewData.isAdditionalHotSpot(e.hotSpotData.ID)&&this.walkingAnimation&&e.add(this.walkingAnimation),r&&this.triggerOperation("updateCurrentHotSpot",t.ID))}},{key:"loadAppResources",value:function(t,e,n){var r=0,o=0,i=!1,a=document.createEvent("HTMLEvents");function s(t){var e=t||Math.min(r,o);a.progress=e/100;var s=e>=100&&i;s&&n&&n(),s?setTimeout((function(){document.dispatchEvent(a)}),30):document.dispatchEvent(a)}a.canvas=this.renderer.domElement,a.appID=this.id,a.initEvent("LoadingProgress",!1,!1);var l=Date.now(),u=setInterval((function(){r=(Date.now()-l)/10,s(),r>=100&&clearTimeout(u)}),1),c=t.getDefaultHotSpot(),h=[],p=[];e.is3DViewAtStart?p=gx.getPrepareResourceUrls(this.viewData,this):h=vE.getPrepareResourceUrls(c,this);var d=h.concat(p);if(0===d.length)var f=setInterval((function(){a.progress+=.1,document.dispatchEvent(a),a.progress>=1&&(n&&n(),clearInterval(f))}),200);else{var m=0;zS.ResourcesLoader.prepareResources(d,(function(){i=!0,s()}),(function(t){o=t,s()}),(function(){clearTimeout(u),++m===d.length&&(i=!0,s(100))}))}}},{key:"addWaterMarker",value:function(t){this.waterMarkerManager=new r_(this.isDecoView),this.waterMarkerManager.createWaterMarker(t)}},{key:"restoreToInitialView",value:function(){this.onThumbnailClick(this.viewData.getDefaultHotSpotId(),!0,!1),this.switchTo3DSmallView(!1)}},{key:"loadManagers",value:function(t){var e=this,n=t.anotherHotSpot,r=n||this.viewData.getDefaultHotSpot();this.currentHotSpot=r,this.loadSmallViewPanelManager(t.smallView);var o=new fw(r);o.showBestCameraView=!0,this.sceneMode=t.is3DViewAtStart?c_.floorPlan3D:c_.panorama,this.viewData.isSingleMode||this.viewData.isSingleView?(this.loadPanoramaManager(this.viewData),this.panoramaManager.panoramaImageLoader.loadPanoramaImage(o)):(this.sceneMode===c_.floorPlan3D?(this.loadPanoramaManager(this.viewData),this.panoramaManager.object3D.visible=!1,this.loadRulerManager(this.viewData,t.isShowRulerAtStart,g_.app),this.rulerManager.setCurrentHotSpot(this.panoramaManager.panoramaImageLoader.currentHotSpot),this.loadStereoHouseManager(this.viewData,t.compassContainer),this.loadFloorPlanManager(this.viewData,t.compassContainer),this.floorPlanManager.object3D.visible=!1,this.loadAnchorManager(this.viewData,t.diyAnchorStyle),this.anchorManager.showAnchors(this.panoramaManager.panoramaImageLoader.currentHotSpot,!0),this.smallViewPanelManager.hide(),this.stereoHouseAnimation=new yx(this),this.floorPlanManager.enableOrbitControls(!1)):(this.loadPanoramaManager(this.viewData),o.onAnimationFinished=function(){e.panoramaManager.panoramaControls.isAutoPlay=!1},this.panoramaManager.panoramaImageLoader.loadPanoramaImage(o),this.loadRulerManager(this.viewData,t.isShowRulerAtStart,g_.app),this.rulerManager.setCurrentHotSpot(this.currentHotSpot),this.loadAnchorManager(this.viewData,t.diyAnchorStyle),this.loadStereoHouseManager(this.viewData,t.compassContainer),this.panoramaManager.setBestCameraView(r,this.panoramaManager.camera),this.panoramaManager.updateCameraRotation(new THREE.Vector3(0,this.stereoHouseManager.camera.rotation.y,0)),this.stereoHouseManager.showAllHotSpots(!1),this.stereoHouseManager.setSmallView(),this.stereoHouseAnimation=new yx(this),this.loadFloorPlanManager(this.viewData,t.compassContainer),"3D"===t.smallView.defaultManager?(this.stereoHouseManager.show(),this.floorPlanManager.hide()):(this.floorPlanManager.show(),this.stereoHouseManager.camera.zoom=1e-4),this.floorPlanManager.setSmallView()),window.appConfig.waterMarkSize&&this.addWaterMarker(window.appConfig.waterMarkSize)),isPhone&&aw.enableVRMode&&this.loadVrManager(),aw.enableMeasurement&&this.loadMeasurementManager(),this.loadAutoWalkManager(this.viewData,t.isAutoWalkAtStart),hw.panoramaMouseEnabled&&!window.appConfig.isOutScene&&this.renderer.domElement.addEventListener("mousemove",(function(){e.mouseInHotSpot||e.isInSceneSwitch?e.panoramaManager.panoramaMouse.setVisible(!1):e.panoramaManager.panoramaMouse.setVisible(!0),mx.broadAnother(e,"hideOtherMouse")})),hw.panoramaMouseEnabled&&!window.appConfig.isOutScene&&this.panoramaManager.panoramaMouse&&this.stereoHouseManager&&(this.panoramaManager.signals.onMouseMove.add((function(t){if(!isPhone){var n;n=e.isDecoView||e.inDecoMode?e.inFullView||mx.app&&mx.app.inFullView?mx.app:2*t.domEvent.clientX<=window.innerWidth?g_.app:mx.app:g_.app,t.camera=n.panoramaManager.camera;var r=t.getIntersectOnObject(n.stereoHouseManager.getCurrentFloor().floorObject);r&&n.updateMousePosition(r,n)}})),this.stereoHouseManager.stereoFloors.forEach((function(t){t.enableFloorMouseMoveEvents(!1)})),this.stereoHouseManager.getCurrentFloor().enableFloorMouseMoveEvents(!0),document.attachEvent?document.attachEvent("mousemove",function(t){"CANVAS"!==(t.target||t.srcElement).tagName&&this.panoramaManager.panoramaMouse.setVisible(!1)}.bind(this),!1):document.addEventListener("mousemove",function(t){"CANVAS"!==(t.target||t.srcElement).tagName&&this.panoramaManager.panoramaMouse.setVisible(!1)}.bind(this),!1))}},{key:"loadVideoManager",value:function(t){this.videoManager=new yE(t,this),this.isDecoView&&HouseViewer.BaseAPI.app.videoManager.setAllVideoInvisible()}},{key:"loadVisiblePanoramaImage",value:function(){this.panoramaManager.panoramaImageLoader.loadVisiblePanoramaImage()}},{key:"initCallbacksConfig",value:function(t){this.switchPanoramaTo2DCallback=t.switchPanoramaTo2DCallback||function(){},this.switchPanoramaTo3DCallback=t.switchPanoramaTo3DCallback||function(){},this.switch2DToPanoramaCallback=t.switch2DToPanoramaCallback||function(){},this.switch3DToPanoramaCallback=t.switch3DToPanoramaCallback||function(){},this.switchPanoramaCallback=t.switchPanoramaCallback||function(){},this.switch2DTo3DCallback=t.switch2DTo3DCallback||function(){},this.switch3DTo2DCallback=t.switch3DTo2DCallback||function(){},this.changeFloorCallBack=t.changeFloorCallBack||function(){}}},{key:"convertViewDataLang",value:function(t){var e=iw.getUrlParameter("lang")||iw.getUrlParameter("language")||(window.appConfig&&window.appConfig.lang?window.appConfig.lang:"zh-CN");return t.Floors&&t.Floors.forEach((function(t){t.Name&&(t.Name=zS.NameConverter.convertLangByUrl(t.Name,e)||t.Name),t.Rooms&&t.Rooms.forEach((function(t){t.Name&&(t.Name=zS.NameConverter.convertLangByUrl(t.Name,e)||t.Name)}))})),t.HotSpots&&t.HotSpots.forEach((function(t){t.Name&&(t.Name=zS.NameConverter.convertLangByUrl(t.Name,e)||t.Name)})),t}},{key:"hideOtherMouse",value:function(){this.panoramaManager.panoramaMouse.setVisible(!1)}},{key:"updateMousePosition",value:function(t,e){e.panoramaManager.panoramaMouse.updateMousePosition(t)}},{key:"hoverHotSpot",value:function(t){if(t[0]){var e,n=null===(e=t[0].hotSpotData)||void 0===e?void 0:e.ID,r=n&&this.panoramaManager.hotSpotManager.hotSpotGroups[n].getObjectByName("circle");r&&(r.material.opacity=t[1]?1:.5)}}},{key:"createWalking3D",value:function(){var t=new THREE.Group;return t.name="walkingAnimation",mw.path.walkingAnimation?(zS.ResourcesLoader.loadResource(mw.path.walkingAnimation,function(e){e.setLayer(pw.StereoHouseManager),e.scale.multiplyScalar(7);var n=new THREE.Color(uw.hotSpotHighlightColor.r/255,uw.hotSpotHighlightColor.g/255,uw.hotSpotHighlightColor.b/255);e.children[0].material.forEach((function(t){return t.color.set(n.getHex())})),t.add(e)}.bind(this)),t.position.set(0,2,0),t):null}}]),p}(zS.VRApp),p_="endAll",d_="changeIndex",f_=function(){function t(e,n){var r=this;Kf(this,t),this.audioCtx=window.ActiveXObject||"ActiveXObject"in window?null:new(window.AudioContext||window.webkitAudioContext),this.audioCtx.suspend(),this.audioSrcMap=[],this.audioCurr=this.audioCtx.createBufferSource(),this.app=e;var o=[];e.viewData.Floors.forEach((function(t){t.Rooms.forEach((function(t){o.push(t.HotSpotIds[0])}))})),this.roomHotSpots=o,this.introduceModule=n;var i=this.introduceModule.find((function(t){return"空间介绍"===t.moduleName}));this.handleEachRoomAudio(i),this.allAudio=[],this.introduceModule.forEach((function(t){return r.allAudio=r.allAudio.concat(t.steps)})),this.signals={endAll:new sE,changeAudioIndex:new sE},this.currentModule=0,this.currentIndexInModule=0,this.useEditorSpeech=!1,this.isFirefox=navigator.userAgent.indexOf("Firefox")>-1,this.isIntroducing=!1,this.endAllFinished=function(){}}var e,n,r,o;return tm(t,[{key:"loadResource",value:function(t){this.preloadAudio(t),this.loadAroundFacilities(t)}},{key:"loadAroundFacilities",value:function(t){var e=this;fetch(t+"AroundFacilities.json").then((function(t){t.json().then((function(t){e.AroundFacilities=t}))}))}},{key:"preloadAudio",value:function(t,e){var n=this;if(e){this.useEditorSpeech=!0,this.introduceModule.forEach((function(t){t.steps=[]})),this.allAudio=[],e.scenes.forEach((function(t){n.allAudio.push(t.ID),n.introduceModule[2].steps.push(t.ID)}));var r=this.introduceModule.find((function(t){return"空间介绍"===t.moduleName})),o=r.onEachAudioStart,i=function(t){console.log("playRecords",t),n.playRecords(e.scenes.find((function(e){return e.ID===t})).actionRecords)};r.onEachAudioStart=function(t,r,a){return new Promise((function(r){n.timeoutList&&n.timeoutList.forEach((function(t){t&&clearTimeout(t)})),n.cameraRotateInterval&&clearInterval(n.cameraRotateInterval),e.roamSwitch?(n.roamCallback=function(){i(t),o&&o(t),n.app.panoramaManager.panoramaImageLoader.signals.hotSpotLoaded.remove(n.roamCallback),r()},n.roamToNextScene(e.scenes.find((function(e){return e.ID===t})).actionRecords[1].hotSpotID)):n.app.onThumbnailClick(e.scenes.find((function(e){return e.ID===t})).actionRecords[1].hotSpotID,null,null,(function(){i(t),o&&o(t),r()}))}))}}var a=this;return new Promise((function(e){var r=[],o=[],i=function(t,n){t?r.push(n):o.push(n),o.length+r.length===a.allAudio.length&&e({loadedAudio:r,errorAudio:o})};n.allAudio.forEach((function(e){fetch(t+"speechdata/"+e+".mp3",{responseType:"arraybuffer"}).then((function(t){return t.arrayBuffer()})).then((function(t){a.audioCtx.decodeAudioData(t,(function(t){var n={name:e,audioBuffer:t};a.audioSrcMap.push(n),i(!0,e)}),(function(t){i(!1,e)}))})).catch((function(t){i(!1,e)}))}))}))}},{key:"handleEachRoomAudio",value:function(t){var e=this;t.steps=t.steps.concat(this.roomHotSpots);var n=t.onEachAudioEnd;t.onEachAudioEnd=function(t,r,o){console.info(t),e.cameraRotateInterval&&(clearInterval(e.cameraRotateInterval),e.cameraRotateInterval=0),o.indexOf(t)===o.length-1&&e.app.onThumbnailClick(o[0]),n&&n(t,r)};var r=t.onEachAudioStart;t.onEachAudioStart=function(t,n,o){return new Promise((function(n){e.roomHotSpots.indexOf(t)>-1?e.app.onThumbnailClick(t,null,null,(function(){e.cameraRotateInterval&&(clearInterval(e.cameraRotateInterval),e.cameraRotateInterval=null),e.isIntroducing&&e.roomHotSpots.indexOf(e.currSrc)>-1&&(e.cameraRotateInterval=window.setInterval((function(){e.app.panoramaManager.camera.rotation.y+=.005}),10)),r&&r(t),n()})):(r&&r(t),n())}))}}},{key:"setCurrentAudio",value:(o=$f(regeneratorRuntime.mark((function t(e,n,r){var o,i,a,s=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.currSrc=e,i=null===(o=this.audioSrcMap.find((function(t){return t.name===e})))||void 0===o?void 0:o.audioBuffer){t.next=5;break}return console.info("没找到对应资源"),t.abrupt("return",new Promise((function(t){r.bind(s)(e),t()})));case 5:this.audioCurr.onended=null,"running"!==this.audioCtx.state&&this.audioCtx.resume();try{this.audioCurr.stop(),this.audioCurr.disconnect()}catch(t){console.info("stop失败",t)}return t.next=10,n.bind(this)(e,!1,this.roomHotSpots);case 10:return console.info(e),(a=this.audioCtx.createBufferSource()).buffer=i,a.connect(this.audioCtx.destination),a.start(),this.audioCurr=a,console.info("return new Promise(resolve => {"),t.abrupt("return",new Promise((function(t){if(s.isFirefox)var n=setTimeout((function(){s.audioCtx.resume(),clearTimeout(n)}),100);s.canChangeIndexInSeries||(s.canChangeIndexInSeries=!0,"number"==typeof s.watingSetIndexInSeries&&setTimeout((function(){t({type:d_,index:s.watingSetIndexInSeries})}),10));var o=function(n){try{s.audioCurr.stop(),s.audioCurr.disconnect()}catch(t){}r.bind(s)(e,!1,s.roomHotSpots),t(n)};s.signals.endAll.removeAll(),s.signals.endAll.add(o),s.signals.changeAudioIndex.removeAll(),s.signals.changeAudioIndex.add(o),s.audioCurr.onended=function(){r.bind(s)(e,!0,s.roomHotSpots),t()}})));case 18:case"end":return t.stop()}}),t,this)}))),function(t,e,n){return o.apply(this,arguments)})},{key:"playSeriesOfAudio",value:(r=$f(regeneratorRuntime.mark((function t(e,n,r,o){var i,a=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=(e||0)-1,t.abrupt("return",new Promise((function(t){!function e(s){s&&s.type===p_?t(s):(s&&s.type===d_&&(i=s.index-1),n[++i]?(a.currentIndexInModule=i,a.setCurrentAudio(n[i],r,o).then(e)):t())}()})));case 2:case"end":return t.stop()}}),t)}))),function(t,e,n,o){return r.apply(this,arguments)})},{key:"start",value:(n=$f(regeneratorRuntime.mark((function t(e,n){var r,o=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=(e||0)-1,this.isIntroducing=!0,this.app.panoramaManager.panoramaImageLoader.signals.hotSpotLoaded.add(this.singleRoam.bind(this)),t.abrupt("return",new Promise((function(t){!function e(i){i&&i.type===p_?(o.endAllFinished(),t(p_)):o.introduceModule[++r]?(o.currentModule=r,"空间介绍"===o.introduceModule[r].moduleName&&o.sortRoomLayoutByCurrentRoom(r),n&&n(o.introduceModule[r]),o.playSeriesOfAudio(0,o.introduceModule[r].steps,o.introduceModule[r].onEachAudioStart,o.introduceModule[r].onEachAudioEnd).then(e)):(o.endAll(),t())}()})));case 4:case"end":return t.stop()}}),t,this)}))),function(t,e){return n.apply(this,arguments)})},{key:"setIndexInSeries",value:function(t){this.watingSetIndexInSeries=0,this.canChangeIndexInSeries?this.signals.changeAudioIndex.dispatch({type:d_,index:t}):this.watingSetIndexInSeries=t}},{key:"changeSeries",value:(e=$f(regeneratorRuntime.mark((function t(e,n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.canChangeIndexInSeries=!1,t.next=3,this.forceEndAll();case 3:return this.endAllFinished=function(){},t.abrupt("return",this.start(e,n));case 5:case"end":return t.stop()}}),t,this)}))),function(t,n){return e.apply(this,arguments)})},{key:"sortRoomLayoutByCurrentRoom",value:function(t){}},{key:"playRecords",value:function(t){this.playTimeStart=(new Date).getTime(),this.timeoutList=[];var e=2;for(HouseViewer.BaseAPI.changeFov(t[0].fov),this.app.panoramaManager.camera.rotation.x=t[0].x,this.app.panoramaManager.camera.rotation.y=t[0].y,this.app.currentHotSpot.ID!==t[1].hotSpotID&&HouseViewer.BaseAPI.onThumbnailClick(t[1].hotSpotID);t[e];){var n=t[e];this.playSingleRecord(n,e,t),"camera"===n.type?e+=2:e++}}},{key:"playSingleRecord",value:function(t,e,n){var r=this;switch(t.type){case"camera":var o=t,i=n[e+1];if(o.fov===i.fov){var a=Math.floor((i.time-o.time)/5),s=(i.x-o.x)/a,l=(i.y-o.y)/a,u=new m_((function(){r.cameraRotateInterval&&clearInterval(r.cameraRotateInterval),r.cameraRotateInterval=setInterval((function(){r.app.panoramaManager.camera.rotation.x+=s,r.app.panoramaManager.camera.rotation.y+=l,Math.abs(r.app.panoramaManager.camera.rotation.x-i.x)<.01&&Math.abs(r.app.panoramaManager.camera.rotation.y-i.y)<.01&&(clearInterval(r.cameraRotateInterval),u.clear())}),5)}),o.time);this.timeoutList.push(u)}else{var c=new m_((function(){HouseViewer.BaseAPI.changeFov(i.fov),c.clear()}),o.time);this.timeoutList.push()}break;case"hotSpot":var h=new m_((function(){HouseViewer.BaseAPI.onThumbnailClick(t.hotSpotID),h.clear()}),t.time);this.timeoutList.push(h);break;case"view":var p=new m_((function(){r.playViewChange(t.view),p.clear()}),t.time);this.timeoutList.push(p);break;case"2DFloor":var d=new m_((function(){HouseViewer.BaseAPI.getFloorPlanSignals().hotSpotClicked.dispatch(r.app.viewData.getHotSpotById(t.ID)),d.clear()}),t.time);this.timeoutList.push(d);break;case"3DFloor":var f=new m_((function(){HouseViewer.BaseAPI.getStereoFloorSignals().hotSpotClicked.dispatch(r.app.viewData.getHotSpotById(t.ID)),f.clear()}),t.time);this.timeoutList.push(f)}}},{key:"playViewChange",value:function(t){switch(t){case"2D":HouseViewer.BaseAPI.switchTo2DLargeView();break;case"3D":HouseViewer.BaseAPI.switchTo3DLargeView();break;case"P":HouseViewer.BaseAPI.backToPanoramaView()}}},{key:"roamToNextScene",value:function(t){this.path=this.findRoamPath(t),this.isRoaming=!0,this.singleRoam()}},{key:"singleRoam",value:function(){var t=this;if(this.isRoaming){var e=this.app.viewData.getHotSpotById(this.path.shift()),n=setTimeout((function(){t.app.autoWalkManager.switchPano(e,void 0,!0),t.app.panoramaManager.panoramaImageLoader.signals.hotSpotLoaded.add(t.roamCallback),clearTimeout(n)}),1e3);0===this.path.length&&(this.isRoaming=!1)}}},{key:"findRoamPath",value:function(t){var e=this,n=this.app.currentHotSpot;if(n.VisibleHotSpotIds.includes(t))return[t];var r=[],o=[],i=!1;r.push({ID:n.ID,previous:null});for(var a=function(){var n=r.shift();o.push(n);var a=e.app.viewData.getHotSpotById(n.ID);if(a.VisibleHotSpotIds.forEach((function(e){o.find((function(t){return t.ID===e}))||(r.push({ID:e,previous:a.ID}),e===t&&(i=!0))})),i)return"break"};r.length>0;){if("break"===a())break}var s=[];s.push(t);for(var l=r.find((function(e){return e.ID===t}));l&&l.previous;){var u=o.find((function(t){return t.ID===l.previous}));if(!u||!u.previous)break;s.push(u.ID),l=u}return s.reverse()}},{key:"forceEndAll",value:function(){var t=this;return this.endAll(),this.signals.endAll.dispatch({type:p_}),new Promise((function(e){t.endAllFinished=e}))}},{key:"endAll",value:function(){try{this.audioCurr.stop(),this.audioCurr.disconnect(),this.audioCtx.suspend()}catch(t){console.info({end:t})}}},{key:"pause",value:function(){this.cameraRotateInterval&&(clearInterval(this.cameraRotateInterval),this.cameraRotateInterval=null,this.shouldRotation=!0),this.timeoutList&&this.timeoutList.forEach((function(t){t.pause()})),this.lastPanoRecord={hotSpotId:this.app.currentHotSpot.ID,fov:this.app.panoramaManager.camera.fov,cameraRotation:this.app.panoramaManager.camera.rotation.clone()},this.audioCtx.suspend(),this.isIntroducing=!1}},{key:"resume",value:function(){var t=this;this.isIntroducing=!0,"空间介绍"===this.introduceModule[this.currentModule].moduleName&&this.currentIndexInModule>0&&!this.useEditorSpeech?this.app.onThumbnailClick(this.introduceModule[this.currentModule].steps[this.currentIndexInModule]):"空间介绍"===this.introduceModule[this.currentModule].moduleName&&this.useEditorSpeech&&(this.app.onThumbnailClick(this.lastPanoRecord.hotSpotId),HouseViewer.BaseAPI.changeFov(this.lastPanoRecord.fov),this.app.panoramaManager.camera.rotation.x=this.lastPanoRecord.cameraRotation.x,this.app.panoramaManager.camera.rotation.y=this.lastPanoRecord.cameraRotation.y),this.timeoutList&&this.timeoutList.forEach((function(t){t.play()})),this.roomHotSpots.indexOf(this.currSrc)>-1&&(this.cameraRotateInterval=window.setInterval((function(){t.app.panoramaManager.camera.rotation.y+=.005}),10)),this.audioCtx.resume()}}]),t}(),m_=function(){function t(e,n){Kf(this,t),this.callback=e,this.delay=n,this.remaining=n,this.enabled=!0,this.play()}return tm(t,[{key:"pause",value:function(){this.enabled&&(this.setTimeoutId&&clearTimeout(this.setTimeoutId),this.remaining-=new Date-this.start)}},{key:"play",value:function(){this.enabled&&(this.start=new Date,this.setTimeoutId&&clearTimeout(this.setTimeoutId),this.setTimeoutId=setTimeout(this.callback,this.remaining))}},{key:"clear",value:function(){this.setTimeoutId&&clearTimeout(this.setTimeoutId),this.enabled=!1}}]),t}(),g_=function(){function t(){Kf(this,t)}var e,n;return tm(t,null,[{key:"initNameConvert",value:function(t){zS.NameConverter=t}},{key:"initViewer",value:function(t,e,n){var r,o,i=new h_(t,e);(console.info(zS),t.useVrTakeSee&&!(null===(r=iw.detectInfo.browser)||void 0===r?void 0:r.ie))&&(null===(o=window.GuidedTour)||void 0===o||o.GuidedTourAPI.initAppRemoteSyncer(i));t.introduceModules&&(this.AIIntroducing=new f_(i,t.introduceModules)),this.viewerInitConfig=t;try{this.app=i,i.run()}catch(t){n&&n(t)}return i.viewData}},{key:"deleteBoxChooseEvent",value:function(){this.app.videoManager.deleteBoxChooseEvent()}},{key:"deleteDashedLine",value:function(){this.app.videoManager.deleteDashedLine()}},{key:"deleteVideo",value:(n=$f(regeneratorRuntime.mark((function t(e,n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.app.videoManager.deleteVideo(e,n);case 2:case"end":return t.stop()}}),t,this)}))),function(t,e){return n.apply(this,arguments)})},{key:"setVideoInvisible",value:function(t){this.app.videoManager.setVideoInvisible(t)}},{key:"deleteVertex",value:function(){this.app.videoManager.deleteVertex()}},{key:"drawDashedLine",value:(e=$f(regeneratorRuntime.mark((function t(e,n,r,o){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.app.videoManager.drawDashedLine(e,n,r,o);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)}))),function(t,n,r,o){return e.apply(this,arguments)})},{key:"addVideo",value:function(t,e,n,r){this.app.videoManager.addVideo(t,e,n,r)}},{key:"initChangeHouse",value:function(t,e){var n=this;if(!n.app)throw new Error("DecoAPI.initViewData error! must init compare view first!");n.app.suspend(),n.app.dispose(),n.app.initData(t,(function(t){n.app.resume(),e&&e(t)}))}},{key:"updateHotSpotName",value:function(t,e){this.app.stereoHouseManager.updateHotSpotName(t,e),this.app.floorPlanManager.updateHotSpotName(t,e),this.app.panoramaManager.updateHotSpotName(t,e)}},{key:"onThumbnailClick",value:function(t){this.app.onThumbnailClick(t)}},{key:"onExplorationThumbnailClick",value:function(t){this.app.onExplorationThumbnailClick(t)}},{key:"onExplorationClickRemainedHotSpot",value:function(){this.app.onExplorationClickRemainedHotSpot()}},{key:"isInExploration",value:function(t){this.app.panoramaManager&&this.app.panoramaManager.isInExploration(t)}},{key:"restoreToInitialView",value:function(){this.app.restoreToInitialView()}},{key:"switchTo2DSmallView",value:function(){this.app.switchTo2DSmallView()}},{key:"switchTo3DSmallView",value:function(){this.app.switchTo3DSmallView()}},{key:"switchTo2DLargeView",value:function(){this.app.sceneMode===c_.panorama?this.app.switchPanoramaTo2D():this.app.switch3DTo2D()}},{key:"switchTo3DLargeView",value:function(){this.app.sceneMode===c_.panorama?this.app.switchPanoramaTo3D():this.app.sceneMode===c_.floorPlan2D&&this.app.switch2DTo3D()}},{key:"backToPanoramaView",value:function(){this.app.backToPanoramaView()}},{key:"startAutoRotate",value:function(){this.app&&this.app.autoWalkManager&&this.app.autoWalkManager.startAutoRotate()}},{key:"stopAutoRotate",value:function(){this.app&&this.app.autoWalkManager&&this.app.autoWalkManager.stopAutoRotate()}},{key:"start3DAutoRotate",value:function(){this.app&&this.app.stereoHouseManager&&this.app.stereoHouseManager.startLargeViewAutoRotateTimer()}},{key:"startAutoPlay",value:function(){this.app&&this.app.autoWalkManager&&this.app.autoWalkManager.startAutoWalk()}},{key:"stopAutoPlay",value:function(){this.app&&this.app.autoWalkManager&&this.app.autoWalkManager.stopAutoWalk()}},{key:"changeFloor",value:function(t){var e=t?t.id:-1;this.app.changeFloor(e)}},{key:"changeFloorById",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.app.changeFloor(t)}},{key:"toggleVR",value:function(t){this.app.toggleVR(t)}},{key:"toggleRuler",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"metre";this.app.rulerManager.enable(t,e)}},{key:"toggleRoomAreaSprite",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"metre";this.app.floorPlanManager.updateAreaSprite(t)}},{key:"updateSpriteLang",value:function(t){this.app.floorPlanManager.updateAreaSpriteByLang(t),this.app.rulerManager.updateLabelsByLang(t),this.app.floorPlanManager.compassManager.updateNorthWordByLang(t),this.app.stereoHouseManager.updateStereoHouseWordByLang(t)}},{key:"enlargeFov",value:function(){return this.app.panoramaManager.onZoomOutClicked()}},{key:"narrowFov",value:function(){return this.app.panoramaManager.onZoomInClicked()}},{key:"setStereoHouseFov",value:function(t){this.app.stereoHouseManager.camera.fov=t}},{key:"onAutoWalkStatusChanged",value:function(e){t.callbacks.onAutoWalkStatusChanged.add(e)}},{key:"showAnchor",value:function(t){var e=this.app.panoramaManager.panoramaImageLoader.currentHotSpot;e||(e=this.app.viewData.getDefaultHotSpot()),this.app.anchorManager.showAnchors(e,!0,t)}},{key:"hideAllAnchors",value:function(){this.app.anchorManager.hideAllAnchors()}},{key:"isInShot",value:function(t){this.app.panoramaManager.panoramaImageLoader.isInShot=t,this.app.anchorManager.isInShot=t}},{key:"isInBestView",value:function(t){this.app.panoramaManager.panoramaImageLoader.isInBestView=t}},{key:"isAddingAnchor",value:function(t){this.app.anchorManager&&this.app.anchorManager.isAddingAnchor(t)}},{key:"refreshAnchorGroup",value:function(){this.app.anchorManager&&this.app.anchorManager.refreshAnchorGroup()}},{key:"storeProductAnchorData",value:function(t,e){this.app.anchorManager&&this.app.anchorManager.parseProductAnchor(t,e)}},{key:"parseProductDetailResp",value:function(t,e){if(this.app.anchorManager)return this.app.anchorManager.parseProductDetailResp(t,e)}},{key:"loadVisiblePanoramaImage",value:function(){this.app.loadVisiblePanoramaImage()}},{key:"changeAudioAnchorState",value:function(t,e,n){this.app.anchorManager&&this.app.anchorManager.changeAudioAnchorState(t,e,n)}},{key:"pauseAnchorAudio",value:function(){var t=document.createEvent("HTMLEvents");t.initEvent("pauseAudio",!1,!1),document.dispatchEvent(t)}},{key:"ignore3DClick",value:function(t){this.app.stereoHouseManager.getCurrentFloor().ignore3DClick(t)}},{key:"inDecoMode",value:function(t){this.app.inDecoMode=t}},{key:"initAnchorCanvas",value:function(t,e){this.app.anchorManager.initAnchorCanvas(t,e)}},{key:"getPanoramaSignals",value:function(){return this.app.panoramaManager.signals}},{key:"getFloorPlanSignals",value:function(){return this.app.floorPlanManager.signals}},{key:"getStereoFloorSignals",value:function(){return this.app.stereoHouseManager.signals}},{key:"getAppSignals",value:function(){return this.app.signals}},{key:"getUUID8Bit",value:function(){return iw.UUID8Bit()}},{key:"changeFov",value:function(t){this.app.panoramaManager.targetZoomFov=t,this.app.panoramaManager.playCameraZoomAnimation(this.app.panoramaManager.camera.fov)}},{key:"rotateCamera",value:function(t,e){this.app.panoramaManager.camera.rotation.x+=t,this.app.panoramaManager.camera.rotation.y+=e}},{key:"enablePanoramaControls",value:function(t){this.app.panoramaManager.enablePanoramaControls(t)}}]),t}();em(g_,"callbacks",{onAutoWalkStatusChanged:new sE}),THREE.Object3D.prototype.setRenderOrder=function(t){this.renderOrder=t,this.children.forEach((function(e){return e.setRenderOrder(t)}))},THREE.Object3D.prototype.setLayer=function(t){this.layers.set(t),this.children.forEach((function(e){return e.setLayer(t)}))},THREE.Object3D.prototype.setVisible=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.visible=t,e&&this.children.forEach((function(e){return e.setVisible(t)}))},THREE.Object3D.prototype.isVisible=function(t){return this.visible&&(!t||this.layers.test(t))&&(!this.parent||this.parent.isVisible())},THREE.Object3D.prototype.getChildren=function(t){return t?this.children.concat(this.children.flatMap((function(e){return e.getChildren(t)}))):this.children},THREE.Object3D.prototype.getRoot=function(){for(var t=this;t.parent;)t=t.parent;return t},THREE.Object3D.prototype.setTransparent=function(t){this.setMaterialProperty("transparent",t)},THREE.Object3D.prototype.setOpacity=function(t){this.setMaterialProperty("opacity",t)},THREE.Object3D.prototype.setAlphaTest=function(t){this.setMaterialProperty("alphaTest",t)},THREE.Object3D.prototype.setMaterialProperty=function(t,e){this.material instanceof Array?this.material.forEach((function(n){n[t]=e})):this.material&&(this.material[t]=e),this.children.forEach((function(n){return n.setMaterialProperty(t,e)}))},THREE.Object3D.prototype.dispose=function(){this.parent&&this.parent.remove(this),this.geometry&&this.geometry.dispose(),this.material&&(this.material instanceof Array?this.material.forEach((function(t){t.map&&t.map.dispose(),t.dispose()})):(this.material.map&&this.material.map.dispose(),this.material.dispose())),this.children.slice().forEach((function(t){return t.dispose&&t.dispose()}))},THREE.Object3D.getCompoundBoundingBox=function(t){var e=[];return t.traverse((function(t){return e.push(t)})),THREE.Object3D.getObjectsBoundingBox(e)},THREE.Object3D.getObjectsBoundingBox=function(t){var e=new THREE.Box3;return t.forEach((function(t){t.geometry&&(t.geometry.computeBoundingBox(),e.union(t.geometry.boundingBox))})),e},THREE.Euler.prototype.toString=function(){return"x: "+this.x+", y: "+this.y+", z: "+this.z},THREE.Euler.prototype.lerp=function(t,e){return Math.abs(t.y-this.y)>Math.PI&&(this.y>0&&t.y<0?this.y-=2*Math.PI:this.y<0&&t.y>0&&(this.y+=2*Math.PI)),this.y+=(t.y-this.y)*e,this.x+=(t.x-this.x)*e,this},THREE.Spherical.prototype.lerp=function(t,e){return Math.abs(t.theta-this.theta)>Math.PI&&(this.theta<0&&(this.theta+=2*Math.PI),t.theta<0&&(t.theta+=2*Math.PI)),this.theta+=(t.theta-this.theta)*e,this.phi+=(t.phi-this.phi)*e,this.radius+=(t.radius-this.radius)*e,this.makeSafe(),this},THREE.Euler.prototype.approxEquals=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:EPSILON;return Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e&&Math.abs(this.z-t.z)<e},THREE.Vector2.prototype.containsNAN=function(){return isNaN(this.x)||isNaN(this.y)},THREE.Vector2.prototype.round=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new THREE.Vector2(Rw.round(this.x,t),Rw.round(this.y,t))},THREE.Vector2.prototype.toVector3=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new THREE.Vector3(this.x,t,this.y)},THREE.Vector2.prototype.toString=function(){return"x: "+this.x+", y: "+this.y},THREE.Vector2.prototype.approxEquals=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01;return this.distanceTo(t)<e},THREE.Vector2.prototype.fromUnityRotation=function(){return this.set(-this.x,this.y+180).degToRad()},THREE.Vector2.prototype.degToRad=function(){return this.multiplyScalar(THREE.Math.DEG2RAD)},THREE.Vector2.prototype.projectInSegment=function(t,e){var n=this.clone().sub(t).dot(e.clone().sub(t))/Math.pow(e.clone().sub(t).length(),2);return n<0&&(n=0),n>1&&(n=1),e.clone().sub(t).multiplyScalar(n).add(t)},THREE.Vector2.prototype.isParallel=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(this.approxEquals(new THREE.Vector2)||t.approxEquals(new THREE.Vector2))return!1;if(Rw.approxEquals(this.y,0)&&Rw.approxEquals(t.y,0)||Rw.approxEquals(this.x,0)&&Rw.approxEquals(t.x,0))return!0;var n=1-Math.cos(THREE.Math.degToRad(e));return Math.abs(Math.abs(this.clone().normalize().dot(t.clone().normalize()))-1)<n},THREE.Vector2.prototype.isSameDirection=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=1-Math.cos(THREE.Math.degToRad(e));return Math.abs(this.clone().normalize().dot(t.clone().normalize())-1)<n},THREE.Vector2.prototype.perpendicular=function(){return new THREE.Vector2(this.y,-this.x)},THREE.Vector2.prototype.distanceToSegment=function(t){return this.projectInSegment(t.p1,t.p2).distanceTo(this)},THREE.Vector2.prototype.combinePointsTooClose=function(t,e){var n=this.x-t.x,r=this.y-t.y;return Math.pow(n,2)+Math.pow(r,2)<Math.pow(e,2)&&(this.x=(this.x+t.x)/2,this.y=(this.y+t.y)/2,!0)},THREE.Vector2.prototype.isInPolygon=function(t){var e=0,n=t.length;if(n<3)return!1;for(var r=t[0],o=1;o<=n;++o){var i=o===n?t[0]:t[o];if(i.y===this.y&&(i.x===this.x||r.y===this.y&&i.x>this.x==r.x<this.x)){e=-1;break}if(r.y<this.y!=i.y<this.y)if(r.x>=this.x)if(i.x>this.x)e=1-e;else{var a=(r.x-this.x)*(i.y-this.y)-(i.x-this.x)*(r.y-this.y);if(0===a){e=-1;break}a>0==i.y>r.y&&(e=1-e)}else if(i.x>this.x){var s=(r.x-this.x)*(i.y-this.y)-(i.x-this.x)*(r.y-this.y);if(0===s){e=-1;break}s>0==i.y>r.y&&(e=1-e)}r=i}return 1===e||-1===e},THREE.Vector2.prototype.isOnSegment=function(t){return this.approxEquals(t.p1)||this.approxEquals(t.p2)||this.clone().sub(t.p1).isSameDirection(t.p2.clone().sub(this))},THREE.Vector2.prototype.project=function(t,e){if(t.approxEquals(e))return t.clone().add(e).multiplyScalar(.5);var n=t.x-e.x,r=t.y-e.y,o=((this.x-t.x)*n+(this.y-t.y)*r)/(n*n+r*r);return new THREE.Vector2(t.x+o*n,t.x+o*r)},THREE.Vector3.unitX=Object.freeze(new THREE.Vector3(1,0,0)),THREE.Vector3.unitY=Object.freeze(new THREE.Vector3(0,1,0)),THREE.Vector3.unitZ=Object.freeze(new THREE.Vector3(0,0,1)),THREE.Vector3.prototype.toVector2=function(){return new THREE.Vector2(this.x,this.z)},THREE.Vector3.prototype.hasValue=function(){return 0!==this.x||0!==this.y||0!==this.z},THREE.Vector3.prototype.fromUnityPosition=function(){return this.z=-this.z,this},THREE.Vector3.prototype.fromUnityRotation=function(){return this.set(this.x,this.y+180,-this.z).degToRad()},THREE.Vector3.prototype.fromUnityScale=function(){return this.z=-this.z,this},THREE.Vector3.prototype.U2TPosition=function(){return this.set(this.x,this.z,this.y),this},THREE.Vector3.prototype.U2TScale=function(){return this.set(this.x,this.z,this.y),this},THREE.Vector3.prototype.U2TRotation=function(){return this.set(this.x,-this.z,this.y).degToRad(),this},THREE.Vector3.prototype.T2UPosition=function(){return this.set(this.x,this.z,this.y),this},THREE.Vector3.prototype.T2UScale=function(){return this.set(this.x,this.z,this.y),this},THREE.Vector3.prototype.T2URotation=function(){return this.set(this.x,this.z,-this.y).radToDeg(),this},THREE.Vector3.prototype.fromUnityPositionX2=function(){return this.fromUnityPosition(),this.multiplyScalar(2),this},THREE.Vector3.prototype.degToRad=function(){return this.multiplyScalar(THREE.Math.DEG2RAD)},THREE.Vector3.prototype.radToDeg=function(){return this.multiplyScalar(1/THREE.Math.DEG2RAD)},THREE.Vector3.prototype.containsNAN=function(){return isNaN(this.x)||isNaN(this.y)||isNaN(this.z)},THREE.Vector3.prototype.projectPointToXZPlane=function(t){var e=t.y<.1?THREE.Vector3.unitY.clone().setY(-1):THREE.Vector3.unitY,n=t.angleTo(e);return 0===n?this.toVector2():this.applyAxisAngle(n,e.clone().cross(t).normalize()).toVector2()},THREE.Vector3.prototype.addY=function(t){return this.y+=t,this},THREE.Vector3.prototype.toRotationMatrix4=function(t){return(new THREE.Matrix4).makeRotationFromEuler((new THREE.Euler).setFromVector3(this,t))},THREE.Vector3.prototype.maxWeight=function(){return Math.max(this.x,this.y,this.z)},THREE.Vector3.prototype.approxEquals=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:EPSILON;return this.distanceTo(t)<e},THREE.Vector3.getVerticesCenter=function(t){return 0===t.length?new THREE.Vector3:THREE.Vector3.max(t).add(THREE.Vector3.min(t)).divideScalar(2)},THREE.Vector3.getMiddle=function(t,e){return t.clone().add(e).multiplyScalar(.5)},THREE.Vector3.max=function(t){return new THREE.Vector3(Math.max.apply(Math,hm(t.map((function(t){return t.x})))),Math.max.apply(Math,hm(t.map((function(t){return t.y})))),Math.max.apply(Math,hm(t.map((function(t){return t.z})))))},THREE.Vector3.min=function(t){return new THREE.Vector3(Math.min.apply(Math,hm(t.map((function(t){return t.x})))),Math.min.apply(Math,hm(t.map((function(t){return t.y})))),Math.min.apply(Math,hm(t.map((function(t){return t.z})))))},THREE.Vector3.prototype.toString=function(){return"x: "+this.x+", y: "+this.y+", z: "+this.z},THREE.Vector3.prototype.rotatePointByY=function(t,e){var n=t.clone().sub(this);return new THREE.Vector3(n.z*Math.sin(e)+n.x*Math.cos(e)+this.x,t.y,n.z*Math.cos(e)-n.x*Math.sin(e)+this.z)},THREE.Vector3.prototype.toFixed=function(t){return this.set(+this.x.toFixed(t),+this.y.toFixed(t),+this.z.toFixed(t)),this},t.BaseAPI=g_,t.DIY2DInterface=fx,t.DecoAPI=mx,t.EventListener=Dw,t.FloorFurnitureAnchorData=QP,t.FurnitureAnchorManger=wE,t.Resources=mw,t.VRCore=zS,t.ZipUtils=OS,Object.defineProperty(t,"__esModule",{value:!0})}));
